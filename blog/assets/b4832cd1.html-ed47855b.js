import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as l,c as i,a as n,b as a,d as e,e as t}from"./app-b57bd53e.js";const c={},r=t('<p>使用到的类有：</p><ul><li>android.support.design.widget.CoordinatorLayout</li><li>android.support.design.widget.AppBarLayout</li><li>android.support.design.widget.CollapsingToolbarLayout</li><li>android.support.v7.widget.Toolbar</li></ul><h1 id="效果预览" tabindex="-1"><a class="header-anchor" href="#效果预览" aria-hidden="true">#</a> 效果预览</h1><p>如图：</p><figure><img src="http://jixiaoyong.github.io/blog/images/default/2018-02-22/coordinatorlayout.gif" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h1 id="简要说明" tabindex="-1"><a class="header-anchor" href="#简要说明" aria-hidden="true">#</a> 简要说明</h1><p>CoordinatorLayout类，协调者布局，通过Behavior将一个子view（<code>child</code>）的行为和另一个子view（<code>dependency</code>）的活动联结起来，从而实现子view之间的联动。</p><p>AppBarLayout类，是一个实现了材料设计的默认垂直布局的ViewGroup，当其是CoordinatorLayout类的直接子view时,另外一个CoordinatorLayout的子view指定了behavior为AppBarLayout.ScrollingViewBehavior的实例（<code>app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;</code>）,且该子view需要是NestedScrollingChild的实现类。</p><p>CollapsingToolbarLayout类，提供一个可以折叠的toolbar布局，可以在这个布局里面，设置toolbar以及和toolbar一起联动的子view，本案例中是一张图片。</p><p>Toolbar类，实现toolbar的效果。</p><h1 id="具体实现" tabindex="-1"><a class="header-anchor" href="#具体实现" aria-hidden="true">#</a> 具体实现</h1>',11),u={href:"https://github.com/jixiaoyong/AndroidNote/tree/master/code/2018-02-22",target:"_blank",rel:"noopener noreferrer"},d=t(`<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.design.widget.CoordinatorLayout</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.design.widget.AppBarLayout</span><span class="token punctuation">&gt;</span></span>

         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.design.widget.CollapsingToolbarLayout</span>
              <span class="token attr-name"><span class="token namespace">app:</span>layout_scrollFlags</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll|exitUntilCollapsed<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span> 
                  <span class="token attr-name"><span class="token namespace">app:</span>layout_collapseMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parallax<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.v7.widget.Toolbar</span>
                  <span class="token attr-name"><span class="token namespace">app:</span>layout_collapseMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pin<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.design.widget.CollapsingToolbarLayout</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.design.widget.AppBarLayout</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.v4.view.ViewPager</span>
            <span class="token attr-name"><span class="token namespace">app:</span>layout_behavior</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/appbar_scrolling_view_behavior<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.design.widget.CoordinatorLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>CoordinatorLayout在最外层，注意其直接子view必须就是要实现联动的view，否则联动失效。</li><li>CollapsingToolbarLayout必须设置layout_scrollFlags，其余属性可选。</li></ol>`,2),k=t("<p>layout_scrollFlags说明如下：</p><p><strong>scroll</strong>：所有想滚动出屏幕的view都需要设置这个flag， 没有设置这个flag的view将被固定在屏幕顶部。</p><p><strong>enterAlways</strong>：这个flag让任意向下的滚动都会导致该view变为可见，启用快速“返回模式”。</p><p><strong>enterAlwaysCollapsed</strong>：假设你定义了一个最小高度（minHeight）同时enterAlways也定义了，那么view将在到达这个最小高度的时候开始显示，并且从这个时候开始慢慢展开，当滚动到顶部的时候展开完。</p><p><strong>exitUntilCollapsed</strong>：当你定义了一个minHeight，此布局将在滚动到达这个最小高度的时候折叠。</p><p><strong>snap</strong>：当一个滚动事件结束，如果视图是部分可见的，那么它将被滚动到收缩或展开。例如，如果视图只有底部25%显示，它将折叠。相反，如果它的底部75%可见，那么它将完全展开。</p><p>作者：尹star</p>",7),v={href:"https://www.jianshu.com/p/5287d090e777",target:"_blank",rel:"noopener noreferrer"},g=t(`<ol><li>CollapsingToolbarLayout的子view需要指定layout_collapseMode，还有一点需注意：<strong>和toolbar联动的子view高度需大于toolbar高度，否则无效果。</strong></li><li>ViewPager就是本案例中触发子view联动效果的<code>dependency</code>，需要指定其behavior：</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>其实际对应于android.support.design.widget.AppBarLayout$ScrollingViewBehavior ，这个是系统实现的一个behavior，用于和嵌套滑动事件绑定，<strong>指定该behavior的子view需要是NestedScrollingChild的实现类</strong>（系统提供了4个实现类：NavigationMenuView、NestedScrollView、RecyclerView、SwipleRefreshLayout），所以viewPager中页面有上述4个类或其子类时，才能实现绑定效果。</p><h1 id="延伸" tabindex="-1"><a class="header-anchor" href="#延伸" aria-hidden="true">#</a> 延伸</h1><p><strong>自定义Behavior</strong></p><p>自定义Behavior有两个目的：</p><ol><li>将两个或多个子view绑定；</li><li>将一个子view与另一个子view的滑动事件绑定在一起</li></ol><p>两者的差异在于在实现<code>CoordinatorLayout.Behavior&lt;T&gt;</code> 类时候具体重写的方法不一样。</p><p><strong>目的1</strong>：需要重写的方法有：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">layoutDependsOn</span><span class="token punctuation">(</span><span class="token class-name">CoordinatorLayout</span> parent<span class="token punctuation">,</span> <span class="token class-name">T</span> child<span class="token punctuation">,</span> <span class="token class-name">View</span> dependency<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果dependency是要依赖的子view（此处是TempView类）的实例，说明它就是我们所需要的Dependency</span>
    <span class="token keyword">return</span> dependency <span class="token keyword">instanceof</span> <span class="token class-name">TempView</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//每次dependency位置发生变化，都会执行onDependentViewChanged方法</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onDependentViewChanged</span><span class="token punctuation">(</span><span class="token class-name">CoordinatorLayout</span> parent<span class="token punctuation">,</span> <span class="token class-name">T</span> child<span class="token punctuation">,</span> <span class="token class-name">View</span> dependency<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//根据dependency的位置，设置child的位置,对child进行想要实现的变化</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//返回true表示改变了child 的尺寸和位置参数，否则返回false</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>目的2</strong>：需要重写的方法有：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//判断是否要开始根据dependency子view的行为改变child的状态</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onStartNestedScroll</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">CoordinatorLayout</span> coordinatorLayout<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ImageView</span> child<span class="token punctuation">,</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">View</span> directTargetChild<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">View</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> axes<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> child <span class="token keyword">instanceof</span> <span class="token class-name">ImageView</span> <span class="token operator">&amp;&amp;</span> axes <span class="token operator">==</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">SCROLL_AXIS_VERTICAL</span><span class="token punctuation">;</span><span class="token comment">//子view是ImageView，并且滑动的方向是垂直的</span>
<span class="token punctuation">}</span>

<span class="token comment">//当dependency子view滑动时，对child进行相应处理</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNestedPreScroll</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">CoordinatorLayout</span> coordinatorLayout<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ImageView</span> child<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">View</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> dx<span class="token punctuation">,</span> <span class="token keyword">int</span> dy<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> consumed<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onNestedPreScroll</span><span class="token punctuation">(</span>coordinatorLayout<span class="token punctuation">,</span> child<span class="token punctuation">,</span> target<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">,</span> consumed<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12),m=n("h1",{id:"自定义-behavior-的总结",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#自定义-behavior-的总结","aria-hidden":"true"},"#"),a(" 自定义 Behavior 的总结")],-1),h=n("ol",null,[n("li",null,"确定 CoordinatorLayout 中 View 与 View 之间的依赖关系，通过 layoutDependsOn() 方法，返回值为 true 则依赖，否则不依赖。"),n("li",null,"当一个被依赖项 dependency 尺寸或者位置发生变化时，依赖方会通过 Byhavior 获取到，然后在 onDependentViewChanged 中处理。如果在这个方法中 child 尺寸或者位置发生了变化，则需要 return true。"),n("li",null,"当 Behavior 中的 View 准备响应嵌套滑动时，它不需要通过 layoutDependsOn() 来进行依赖绑定。只需要在 onStartNestedScroll() 方法中通过返回值告知 ViewParent，它是否对嵌套滑动感兴趣。返回值为 true 时，后续的滑动事件才能被响应。"),n("li",null,"嵌套滑动包括滑动(scroll) 和 快速滑动(fling) 两种情况。开发者根据实际情况运用就好了。"),n("li",null,"Behavior 通过 3 种方式绑定：1. xml 布局文件。2. 代码设置 layoutparam。3. 自定义 View 的注解。")],-1),b={href:"http://blog.csdn.net/briblue/article/details/73076458",target:"_blank",rel:"noopener noreferrer"},w=n("h1",{id:"参考文献",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#参考文献","aria-hidden":"true"},"#"),a(" 参考文献")],-1),y={href:"http://blog.csdn.net/briblue/article/details/73076458",target:"_blank",rel:"noopener noreferrer"},_={href:"http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2016/0824/6565.html",target:"_blank",rel:"noopener noreferrer"},f={href:"https://www.jianshu.com/p/8c92d0a1e591",target:"_blank",rel:"noopener noreferrer"},L={href:"https://www.jianshu.com/p/5287d090e777",target:"_blank",rel:"noopener noreferrer"};function C(V,x){const s=p("ExternalLinkIcon");return l(),i("div",null,[r,n("p",null,[a("源码："),n("a",u,[a("github"),e(s)])]),d,n("blockquote",null,[k,n("p",null,[a("链接："),n("a",v,[a("https://www.jianshu.com/p/5287d090e777"),e(s)])])]),g,n("blockquote",null,[m,h,n("p",null,[a("来源 ："),n("a",b,[a("针对 CoordinatorLayout 及 Behavior 的一次细节较真 - frank 的专栏 - CSDN博客"),e(s)])])]),w,n("ul",null,[n("li",null,[n("a",y,[a("针对 CoordinatorLayout 及 Behavior 的一次细节较真 - frank 的专栏 - CSDN博客"),e(s)])]),n("li",null,[n("a",_,[a("CoordinatorLayout 自定义Behavior并不难，由简到难手把手带你撸三款！ - 泡在网上的日子"),e(s)])]),n("li",null,[n("a",f,[a("一步一步深入理解CoordinatorLayout - 简书"),e(s)])]),n("li",null,[n("a",L,[a("使用CoordinatorLayout打造一个炫酷的详情页 - 简书"),e(s)])])])])}const q=o(c,[["render",C],["__file","b4832cd1.html.vue"]]);export{q as default};

import{_ as p,r as o,o as c,c as l,a as n,b as s,d as e,e as t}from"./app-54b0e827.js";const i={},u=n("img",{src:"https://images.pexels.com/photos/2881229/pexels-photo-2881229.jpeg?cs=srgb&dl=white-and-blue-cables-2881229.jpg&fm=jpg",class:"full-image"},null,-1),r={href:"https://www.pexels.com/@pixabay?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels",target:"_blank",rel:"noopener noreferrer"},k={href:"https://www.pexels.com/photo/close-up-of-telephone-booth-257736/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels",target:"_blank",rel:"noopener noreferrer"},d=t("<p><strong>åºåˆ—åŒ–</strong>ï¼šæŒ‡å°†<code>Javaå¯¹è±¡</code>è½¬åŒ–ä¸º<code>å­—èŠ‚æµ</code>ä»¥ä¾¿åœ¨ç½‘ç»œã€æ–‡ä»¶ä¸­ä¿å­˜ã€ä¼ è¾“ã€‚</p><p><strong>ååºåˆ—åŒ–</strong>ï¼šæŒ‡çš„æ˜¯ä»<code>å­—èŠ‚æµ</code>ä¸­æ¢å¤<code>Javaå¯¹è±¡</code>ã€‚</p><p>æœ¬æ–‡ä¸»è¦è®¨è®º Android å’Œ Java ä¸­å®ç°åºåˆ—åŒ–çš„ 4 ç§æ–¹å¼ï¼Œå¹¶æ¢è®¨ä¸€ä¸‹å…¶å®ç°åŸç†ã€‚</p><p>Android &amp; Java ä¸­å®ç°åºåˆ—åŒ–çš„æ–¹å¼æœ‰ï¼š</p>",4),v=n("li",null,[n("code",null,"android.os.Parcelable"),s(" Android å¹³å°ç‰¹æœ‰ï¼Œéœ€è¦è‡ªå·±å®ç°å…·ä½“ç»†èŠ‚ï¼Œæ€§èƒ½æ¶ˆè€—å°ï¼Œåªèƒ½åœ¨å†…å­˜ä¸­å­˜åœ¨")],-1),m=n("li",null,[n("code",null,"java.io.Serializable"),s(" å®ç°ç®€å•ï¼Œåªéœ€è¦å®ç°"),n("code",null,"Serializable"),s("æ¥å£å³å¯ï¼Œå¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ã€ç½‘ç»œç­‰")],-1),b=n("li",null,[n("code",null,"java.io.Externalizable"),s(" éœ€è¦è‡ªå·±å®ç°å…·ä½“ç»†èŠ‚")],-1),h={href:"https://github.com/twitter/Serial/blob/master/README-CHINESE.rst/",target:"_blank",rel:"noopener noreferrer"},w=n("code",null,"Twitter Serial",-1),f={href:"https://www.jianshu.com/p/1b42608478c0",target:"_blank",rel:"noopener noreferrer"},y=t(`<h2 id="serializable" tabindex="-1"><a class="header-anchor" href="#serializable" aria-hidden="true">#</a> Serializable</h2><p><code>Serializable</code>æ¥å£æ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œåªæ˜¯ä¸€ä¸ªæ ‡è®°â€”â€”è¡¨ç¤ºè¿™ä¸ªç±»å¯ä»¥ç”¨æ¥<code>åºåˆ—åŒ–/ååºåˆ—åŒ–</code>ï¼ˆç”±<code>ObjectOutputStream/ObjectInputStream</code>å®ç°å…·ä½“ç»†èŠ‚ï¼‰ã€‚</p><p>ä¸€ä¸ªç±»æ²¡æœ‰å®ç°<code>Serializableæ¥å£</code>ï¼Œæˆ–è€…åŒ…å«æ²¡æœ‰<code>å®ç°Serializableæ¥å£çš„å˜é‡</code>ï¼Œåˆ™ä¼šåºåˆ—åŒ–å¤±è´¥<code>NotSerializableException</code>ã€‚</p><h3 id="serialversionuid" tabindex="-1"><a class="header-anchor" href="#serialversionuid" aria-hidden="true">#</a> serialVersionUID</h3><p>ä½¿ç”¨<code>serialVersionUID</code>æ ‡è®°å½“å‰<code>Serializable</code>çš„ç‰ˆæœ¬ã€‚</p><p>å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”¨å¯¹è±¡çš„<code>hashCode()</code>æŒ‡å®š<code>serialVersionUID</code>ï¼Œè¯¥å€¼ä¼šåœ¨ç±»å‘ç”Ÿæ”¹å˜æ—¶å˜åŒ–ï¼Œä»è€Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚</p><p>è€Œå¦‚æœ<code>serialVersionUID</code>ä¸€è‡´ï¼Œå³ä½¿ç±»ç»“æ„æœ‰å˜åŒ–ï¼Œä¹Ÿä¼šååºåˆ—åŒ–ï¼ˆç»™æ–°å¢çš„å˜é‡é»˜è®¤å€¼ï¼‰ï¼Œæ‰€ä»¥æœ€å¥½èµ‹äºˆä¸€ä¸ªé»˜è®¤çš„å€¼ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//å¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼Œä¹Ÿå¯ä»¥éšæœºæ•°ï¼Œåªè¦ä¿æŒä¸€è‡´å³å¯ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™ä¼šä½¿ååºåˆ—åŒ–å¤±è´¥</span>
<span class="token constant">ANY</span><span class="token operator">-</span><span class="token constant">ACCESS</span><span class="token operator">-</span><span class="token constant">MODIFIER</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="readresolve" tabindex="-1"><a class="header-anchor" href="#readresolve" aria-hidden="true">#</a> readResolve()</h3><p>å¦‚æœ<code>class</code>å®ç°äº†<code>readResolve()</code>æ–¹æ³•ï¼Œä¼šåœ¨ååºåˆ—åŒ–æ—¶ç”¨åˆ°å¹¶è¿”å›è¿™é‡Œæä¾›çš„å¯¹è±¡ï¼ˆååºåˆ—åŒ–å¾—åˆ°çš„å¯¹è±¡ä¼šè¢«ä¸¢å¼ƒï¼‰ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 1. ååºåˆ—åŒ–</span>
<span class="token class-name">SerializableClass</span> serializableClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SerializableClass</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2.readObject() å†…éƒ¨è°ƒç”¨äº† readObject0(false):</span>
<span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">readObject0</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> unshared<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>tc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿™é‡ŒåŒ¹é…äº† TC_NULL,TC_REFERENCE,TC_CLASS,TC_CLASSDESC,</span>
                <span class="token comment">// TC_PROXYCLASSDESC,TC_STRING,TC_LONGSTRING,TC_ARRAY,TC_ENUM</span>
                <span class="token comment">// TC_EXCEPTION,TC_BLOCKDATA,TC_BLOCKDATALONG,TC_ENDBLOCKDATA ç­‰ç­‰ç±»å‹</span>

                <span class="token keyword">case</span> <span class="token constant">TC_OBJECT</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>å¦‚æœæ˜¯ <span class="token constant">OBECJT</span> ç±»å‹ï¼Œå°±è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ğŸ‘‡
                    <span class="token keyword">return</span> <span class="token function">checkResolve</span><span class="token punctuation">(</span><span class="token function">readOrdinaryObject</span><span class="token punctuation">(</span>unshared<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ...</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StreamCorruptedException</span><span class="token punctuation">(</span>
                        <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;invalid type code: %02X&quot;</span><span class="token punctuation">,</span> tc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            depth<span class="token operator">--</span><span class="token punctuation">;</span>
            bin<span class="token punctuation">.</span><span class="token function">setBlockDataMode</span><span class="token punctuation">(</span>oldMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token comment">// 3. åœ¨è¿™é‡Œä¼šæ£€æµ‹æ˜¯å¦å­˜åœ¨ readResolve() æ–¹æ³•ï¼Œæœ‰çš„è¯å°±è¿”å›ä» readResolve() è·å–çš„å¯¹è±¡</span>
<span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">readOrdinaryObject</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> unshared<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IOException</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token class-name">Object</span> obj<span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
        <span class="token comment">// çœ‹è¿™é‡Œï¼Œå¦‚æœ hasReadResolveMethod() ä¸ºçœŸåˆ™æ‰§è¡Œ invokeReadResolve() å¹¶è¿”å›å…¶ç»“æœ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
            handles<span class="token punctuation">.</span><span class="token function">lookupException</span><span class="token punctuation">(</span>passHandle<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
            desc<span class="token punctuation">.</span><span class="token function">hasReadResolveMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> rep <span class="token operator">=</span> desc<span class="token punctuation">.</span><span class="token function">invokeReadResolve</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>unshared <span class="token operator">&amp;&amp;</span> rep<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                rep <span class="token operator">=</span> <span class="token function">cloneArray</span><span class="token punctuation">(</span>rep<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rep <span class="token operator">!=</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Filter the replacement object</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>rep <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">filterCheck</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span>rep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">filterCheck</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                handles<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>passHandle<span class="token punctuation">,</span> obj <span class="token operator">=</span> rep<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">// Invokes the readResolve method of the represented serializable class and returns the result.</span>
    <span class="token class-name">Object</span> <span class="token function">invokeReadResolve</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸ªç‰¹æ€§æˆ‘ä»¬å¯ä»¥ç¡®ä¿åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿèƒ½å®ç°<strong>å•ä¾‹</strong>ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>private Object readResolve() throws ObjectStreamException {
    return this;//è¿”å›å•ä¾‹æœ¬èº«ï¼Œè€Œéæ–°å»ºçš„å¯¹è±¡
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯æ ¹æ®ä¸‹é¢çš„è¯´æ³•ï¼Œè¦å®ç°å¯ä»¥åºåˆ—åŒ–çš„å•ä¾‹æœ€ç®€å•å®‰å…¨çš„ï¼Œè¿˜æ˜¯ä½¿ç”¨æšä¸¾ï¼š</p>`,14),g=n("p",null,[n("strong",null,"äº‹å®ä¸Šï¼Œå¦‚æœä¾èµ– readResolve è¿›è¡Œå®ä¾‹æ§åˆ¶ï¼Œå¸¦æœ‰å¯¹è±¡å¼•ç”¨ç±»å‹çš„æ‰€æœ‰å®ä¾‹åŸŸåˆ™éƒ½å¿…é¡»å£°æ˜ä¸º transient çš„"),s("ã€‚å¦åˆ™ï¼Œåˆ©ç”¨"),n("code",null,"readResolve()"),s("æ–¹æ³•å®ç°çš„å•ä¾‹ä¹Ÿä¼šé­å—åˆ°æ”»å‡»ã€‚")],-1),j=n("p",null,[s("å®ç°å¯åºåˆ—åŒ–æœ€ç®€å•å®‰å…¨çš„æ–¹å¼æ˜¯é‡‡ç”¨æšä¸¾çš„å½¢å¼ï¼Œåº”è¯¥å°½å¯èƒ½é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚å¦‚æœé‡‡ç”¨"),n("code",null,"readResolve"),s("å®ç°çš„è¯ï¼Œè¦ç¡®ä¿è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹åŸŸéƒ½ä¸º"),n("code",null,"åŸºæœ¬ç±»å‹"),s("ï¼Œæˆ–è€…æ˜¯"),n("code",null,"transient"),s("çš„ã€‚")],-1),O={href:"https://cl0610.github.io/effective-java-learning/%E7%AC%AC%E5%8D%81%E7%AB%A0%20%E5%BA%8F%E5%88%97%E5%8C%96/77.%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%8C%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%85%88%E4%BA%8EreadResolve.html",target:"_blank",rel:"noopener noreferrer"},E=t(`<h3 id="è‡ªå®šä¹‰åºåˆ—åŒ–è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰åºåˆ—åŒ–è¿‡ç¨‹" aria-hidden="true">#</a> è‡ªå®šä¹‰åºåˆ—åŒ–è¿‡ç¨‹</h3><p>å¦‚æœæƒ³è¦è‡ªå·±å¤„ç†åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œå¯ä»¥å®ç°ä¸‹é¢çš„æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObjectNoData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ObjectStreamException</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•å®ç°<code>è¯»/å†™</code><strong>è¯¥ç±»è‡ªèº«çš„å±æ€§</strong>ï¼ˆ<code>All non-static and non-transient fields of the current class, include private</code>ï¼‰ï¼Œç„¶ååœ¨è°ƒç”¨è¯¸å¦‚<code>out.writeObject(string);</code>ç­‰æ–¹æ³•<strong>ä¿å­˜å…¶ä»–å˜é‡</strong>ã€‚</p><blockquote><p>The method does not need to concern itself with the state belonging to its superclasses or subclasses.</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>in<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>readObjectNoData</code>æ–¹æ³•ä¸»è¦ç”¨åœ¨åºåˆ—åŒ–æµå’Œæˆ‘ä»¬è¦ååºåˆ—åŒ–çš„ç±»ä¸ä¸€è‡´æ—¶åˆå§‹åŒ–ä¸€äº›å¿…è¦çš„çŠ¶æ€ã€‚</p>`,7),_=n("code",null,"readObjectNoData",-1),S=n("br",null,null,-1),x=n("br",null,null,-1),C={href:"https://juejin.im/post/5d7206c5f265da03ab427181",target:"_blank",rel:"noopener noreferrer"},z=t(`<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>ObjectOutputStream</code>çš„<code>putFields()</code>å’Œ<code>ObjectInputStream</code>çš„<code>readFields()</code>å†™å…¥/è¯»å–å˜é‡ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•å¯ä»¥<em>åŠ å¯†/è§£å¯†</em>éƒ¨åˆ†å˜é‡ï¼Œæˆ–è€…åœ¨åºåˆ—åŒ–çš„æ—¶å€™<em>åªå¤„ç†éƒ¨åˆ†å˜é‡</em>ã€‚</p><p>å…·ä½“ä½¿ç”¨æ–¹æ³•è§å¦‚ä¸‹ï¼š</p><blockquote><p><strong>æ³¨æ„</strong>ï¼š<code>putFields()/readFields()</code>æ–¹æ³•åˆ†åˆ«ä¸èƒ½ä¸<code>defaultWriteObject/defaultReadObject</code>ä¸€èµ·ä½¿ç”¨ï¼›</p><p><code>putFields.put()</code>ä¹‹åå¿…é¡»è°ƒç”¨<code>out.writeFields()</code>æ–¹æ³•</p><p>å¹¶ä¸”ï¼Œæ²¡æœ‰åœ¨<code>putFields()</code>ä¸­åŠ å…¥çš„æ•°æ®ï¼Œåœ¨<code>readObject</code>ä¸­åªèƒ½è·å–åˆ°è¯¥ç±»å‹çš„é»˜è®¤å€¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//è¿™æ®µç¤ºä¾‹ä»£ç æ¥è‡ª https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutputStream</span> out<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">PutField</span> putFields <span class="token operator">=</span> out<span class="token punctuation">.</span><span class="token function">putFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åŸå¯†ç ï¼š&quot;</span> <span class="token operator">+</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           password <span class="token operator">=</span> <span class="token string">&quot;encryption&quot;</span><span class="token punctuation">;</span><span class="token comment">//æ¨¡æ‹ŸåŠ å¯†</span>
           putFields<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åŠ å¯†åçš„å¯†ç ï¼š&quot;</span> <span class="token operator">+</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           out<span class="token punctuation">.</span><span class="token function">writeFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// putFields.put() ä¹‹åå¿…é¡»è°ƒç”¨æœ¬æ–¹æ³•</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">GetField</span> readFields <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Object</span> object <span class="token operator">=</span> readFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¦è§£å¯†çš„å­—ç¬¦ä¸²ï¼š&quot;</span> <span class="token operator">+</span> object<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           password <span class="token operator">=</span> <span class="token string">&quot;pass&quot;</span><span class="token punctuation">;</span><span class="token comment">//æ¨¡æ‹Ÿè§£å¯†ï¼Œéœ€è¦è·å¾—æœ¬åœ°çš„å¯†é’¥</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

   <span class="token punctuation">}</span>
<span class="token comment">// æ‰§è¡Œååºåˆ—åŒ–ç»“æœï¼š</span>
<span class="token comment">// åŸå¯†ç ï¼špass</span>
<span class="token comment">// åŠ å¯†åçš„å¯†ç ï¼šencryption</span>
<span class="token comment">// è¦è§£å¯†çš„å­—ç¬¦ä¸²ï¼šencryption</span>
<span class="token comment">// æœ€åååºåˆ—åŒ–åçš„ password ä¸º pass</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="çˆ¶ç±»æœªç»§æ‰¿-serializable-çš„ç±»çš„åºåˆ—åŒ–" tabindex="-1"><a class="header-anchor" href="#çˆ¶ç±»æœªç»§æ‰¿-serializable-çš„ç±»çš„åºåˆ—åŒ–" aria-hidden="true">#</a> çˆ¶ç±»æœªç»§æ‰¿ Serializable çš„ç±»çš„åºåˆ—åŒ–</h3><p>å¦‚æœä¸€ä¸ªç±»å®ç°äº†åºåˆ—åŒ–ï¼Œä½†ä»–çš„çˆ¶ç±»æ²¡æœ‰å®ç°åºåˆ—åŒ–ï¼Œé‚£ä¹ˆçˆ¶ç±»<strong>å¿…é¡»è¦æœ‰ä¸€ä¸ªå…¬å¼€çš„æ— å‚æ„é€ å‡½æ•°</strong>ï¼Œå¦åˆ™ååºåˆ—åŒ–æ—¶ä¼šå‡ºé”™ã€‚</p><p>æ­¤æ—¶ååºåˆ—åŒ–æ—¶ï¼Œçˆ¶ç±»çš„å˜é‡å€¼ï¼ˆ<code>public, protected, and (if accessible) package fields</code>ï¼‰éƒ½ä¼šæ˜¯<strong>é»˜è®¤çš„å€¼</strong>æˆ–è€…æ˜¯åœ¨<strong>çˆ¶ç±»æ— å‚æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–çš„å€¼</strong>ï¼ˆå³ä½¿è¿™äº›å€¼åœ¨å­ç±»å¯¹è±¡ä¸­å·²ç»è¢«ä¿®æ”¹äº†ï¼‰ã€‚</p><p>è¦æƒ³ä½¿å¾—è¿™äº›å€¼ä¹Ÿå¯ä»¥æ”¯æŒåºåˆ—åŒ–ï¼Œå¯ä»¥é€šè¿‡<code>writeObject/readObject</code>è‡ªå·±å¤„ç†è¿™äº›å€¼çš„åºåˆ—åŒ–ã€‚</p><p>åä¹‹ï¼Œå¦‚æœä¸€ä¸ªç±»å®ç°äº†<code>Serializable</code>æ¥å£ï¼Œé‚£ä¹ˆä»–çš„å­ç±»ä¹Ÿè‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚</p><h3 id="å®ç°" tabindex="-1"><a class="header-anchor" href="#å®ç°" aria-hidden="true">#</a> å®ç°</h3><p>ä¸‹é¢æ˜¯ä½¿ç”¨<code>Serializable</code>å®ç°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç®€å•ç¤ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * author: jixiaoyong
 * email: jixiaoyong1995@gmail.com
 * website: https://jixiaoyong.github.io
 * date: 12/24/19
 * description: æ¼”ç¤ºåºåˆ—åŒ–åŠŸèƒ½
 */</span>
<span class="token keyword">class</span> <span class="token class-name">SerializableClass</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> anInt <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> aLong <span class="token operator">=</span> <span class="token number">100L</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">transient</span> <span class="token class-name">String</span> aTransient <span class="token operator">=</span> <span class="token string">&quot;transient filed cannot be serialized&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">A_STATIC_FILED</span> <span class="token operator">=</span> <span class="token string">&quot;static filed belong to class not object, cannot be serialized&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SerializableClass</span> clazz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SerializableClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;ObjectOutputFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ObjectOutputStream</span> objectOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">//write object to byte sequences</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//chang the object filed</span>
            clazz<span class="token punctuation">.</span>aLong <span class="token operator">=</span> <span class="token number">666L</span><span class="token punctuation">;</span>
            <span class="token comment">// A_STATIC_FILED belong to the class, so you can see it has the value read form</span>
            <span class="token comment">// the JVM rather the object you serialized before when you deserializes it.</span>
            <span class="token class-name">SerializableClass</span><span class="token punctuation">.</span><span class="token constant">A_STATIC_FILED</span> <span class="token operator">=</span> <span class="token string">&quot;Change the static filed!&quot;</span><span class="token punctuation">;</span>

            <span class="token class-name">SerializableClass</span> serializableClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SerializableClass</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>serializableClass<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;SerializableClass{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;anInt=&quot;</span> <span class="token operator">+</span> anInt <span class="token operator">+</span>
                <span class="token string">&quot;, aLong=&quot;</span> <span class="token operator">+</span> aLong <span class="token operator">+</span>
                <span class="token string">&quot;, aTransient=&#39;&quot;</span> <span class="token operator">+</span> aTransient <span class="token operator">+</span> <span class="token char">&#39;\\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, A_STATIC_FILED=&#39;&quot;</span> <span class="token operator">+</span> <span class="token constant">A_STATIC_FILED</span> <span class="token operator">+</span> <span class="token char">&#39;\\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output:</span>
<span class="token comment">// SerializableClass{anInt=10, aLong=100, aTransient=&#39;null&#39;, A_STATIC_FILED=&#39;Change the static filed!&#39;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¤šæ¬¡åºåˆ—åŒ–åŒä¸€ä¸ªå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#å¤šæ¬¡åºåˆ—åŒ–åŒä¸€ä¸ªå¯¹è±¡" aria-hidden="true">#</a> å¤šæ¬¡åºåˆ—åŒ–åŒä¸€ä¸ªå¯¹è±¡</h3><p>è¿”åºåˆ—åŒ–è¯»å–çš„è¿‡ç¨‹åœ¨<code>readResolve()</code>æ–¹æ³•ä¸€èŠ‚å·²ç»æ¶‰åŠåˆ°äº†ï¼Œæˆ‘ä»¬åœ¨çœ‹ä¸€ä¸‹ä¿å­˜çš„éƒ¨åˆ†ï¼Œè¿™é‡Œä¼šæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„ç°è±¡ï¼š</p>`,14),I=n("p",null,"Java åºåˆ—åŒ–æœºåˆ¶ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼Œå…·æœ‰ç‰¹å®šçš„å­˜å‚¨è§„åˆ™ï¼Œå½“å†™å…¥æ–‡ä»¶çš„ä¸ºåŒä¸€å¯¹è±¡æ—¶ï¼Œå¹¶ä¸ä¼šå†å°†å¯¹è±¡çš„å†…å®¹è¿›è¡Œå­˜å‚¨ï¼Œè€Œåªæ˜¯å†æ¬¡å­˜å‚¨ä¸€ä»½å¼•ç”¨ã€‚",-1),A={href:"https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html",target:"_blank",rel:"noopener noreferrer"},T=t(`<p>è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šå½“ä½¿ç”¨åŒä¸€ä¸ª<code>ObjectOutputStreamå¯¹è±¡</code>åºåˆ—åŒ–<code>åŒä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡</code>æ—¶ï¼Œå³ä½¿åœ¨ç¬¬ä¸€æ¬¡åºåˆ—åŒ–å¹¶ä¿å­˜åä¿®æ”¹äº†è¿™ä¸ªå¯¹è±¡çš„éƒ¨åˆ†å±æ€§ï¼Œå½“å†æ¬¡åºåˆ—åŒ–æ—¶ä¿å­˜çš„<strong>åªæ˜¯å‰ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨</strong>â€”â€”ä¹Ÿå°±æ˜¯è¯´å°†å®Œå…¨ç›¸åŒä¸€ä¸ªå¯¹è±¡ä¿å­˜äº†ä¸¤æ¬¡ï¼Œ<strong>ç¬¬äºŒæ¬¡åšçš„ä¿®æ”¹åœ¨åºåˆ—åŒ–çš„æ—¶å€™å¹¶æ²¡æœ‰ä¿å­˜</strong>ã€‚</p><p>æˆ‘ä»¬å†™ä¸ªç®€å•çš„ DEMO éªŒè¯ä¸€ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readAndwriteObject2</span><span class="token punctuation">(</span><span class="token class-name">SerializableClass</span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;ObjectOutputFile&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span>
                <span class="token class-name">ObjectOutputStream</span> objectOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// ç¬¬ä¸€æ¬¡åºåˆ—åŒ–</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            clazz<span class="token punctuation">.</span>aLong <span class="token operator">=</span> <span class="token number">9344L</span><span class="token punctuation">;</span><span class="token comment">//åœ¨è¿™é‡Œä¿®æ”¹äº†éƒ¨åˆ†å±æ€§</span>

            <span class="token comment">// ç¬¬äºŒæ¬¡åºåˆ—åŒ–</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">// ååºåˆ—åŒ–ï¼Œè¯»å–ä¹‹å‰åºåˆ—åŒ–çš„ä¸¤ä¸ªå¯¹è±¡</span>
            <span class="token class-name">SerializableClass</span> serializableClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SerializableClass</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>serializableClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SerializableClass</span> serializableClass1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SerializableClass</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>serializableClass1<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;serializableClass == serializableClass1: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>serializableClass <span class="token operator">==</span> serializableClass1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token comment">// output</span>
<span class="token comment">// SerializableClass{anInt=10, aLong=100, aaLong=100, aTransient=&#39;null&#39;, A_STATIC_FILED=&#39;static filed belong to class not object, cannot be serialized&#39;}</span>
<span class="token comment">// SerializableClass{anInt=10, aLong=100, aaLong=100, aTransient=&#39;null&#39;, A_STATIC_FILED=&#39;static filed belong to class not object, cannot be serialized&#39;}</span>
<span class="token comment">// serializableClass == serializableClass1: true //å¯ä»¥çœ‹åˆ°ä¸¤æ¬¡è·å–çš„æ˜¯å®Œå…¨ç›¸åŒçš„å¯¹è±¡</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æºç ä¸­çœ‹åˆ°åŸå› ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// åºåˆ—åŒ–æ—¶ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ ObjectOutputStream çš„ writeObject æ–¹æ³•</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>enableOverride<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">writeObjectOverride</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">writeObject0</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ³¨æ„è¿™é‡Œï¼Œç¬¬äºŒä¸ªå‚æ•° unshared æ˜¯ false</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeFatalException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token doc-comment comment">/** obj -&gt; wire handle map */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">HandleTable</span> handles<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject0</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token keyword">boolean</span> unshared<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>obj <span class="token operator">=</span> subs<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>unshared <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> handles<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// å¯ä»¥çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœ unshared ä¸º false çš„è¯ï¼Œ</span>
              <span class="token comment">// å°±ä¼šå»æ‰¾è¿™ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»è¢«åºåˆ—åŒ–è¿‡äº†ï¼Œæ˜¯çš„è¯å°±ç›´æ¥å†™å…¥å¼•ç”¨ï¼Œ</span>
              <span class="token comment">// è€Œä¸æ˜¯å†æ¬¡åºåˆ—åŒ–</span>
                <span class="token function">writeHandle</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeClass</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">ObjectStreamClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeClassDesc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ObjectStreamClass</span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Writes given object handle to stream.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeHandle</span><span class="token punctuation">(</span><span class="token keyword">int</span> handle<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        bout<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token constant">TC_REFERENCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bout<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>baseWireHandle <span class="token operator">+</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåœ¨ä¿å­˜åŒä¸€ä¸ªå¯¹è±¡æ—¶è¦æ³¨æ„ä½¿ç”¨ä¸åŒçš„<code>ObjectOutputStream</code>å¯¹è±¡ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨<code>writeUnshared</code>æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Writes an &quot;unshared&quot; object to the ObjectOutputStream.</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeUnshared</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">writeObject0</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">writeFatalException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹" aria-hidden="true">#</a> ä¼˜ç¼ºç‚¹</h3><ul><li>ç®€å•ï¼Œåªéœ€è¦å®ç°æ¥å£</li><li>åºåˆ—åŒ–çš„å­—èŠ‚æµå¯ä»¥åœ¨æ–‡ä»¶ã€ç½‘ç»œä¸­ä¼ é€’ï¼Œå¯ä»¥æŒä¹…åŒ–ä¿å­˜</li><li>æ€§èƒ½å·®ï¼Œåºåˆ—åŒ–è¿‡ç¨‹å¤§é‡ä½¿ç”¨åå°„å’Œä¸´æ—¶å˜é‡</li></ul><h2 id="externalizable" tabindex="-1"><a class="header-anchor" href="#externalizable" aria-hidden="true">#</a> Externalizable</h2><p><code>Externalizable</code>ç»§æ‰¿è‡ª<code>Serializable</code>ã€‚</p><p>ç”¨æˆ·éœ€è¦é€šè¿‡<code>writeExternal(ObjectOutput out)</code>å’Œ<code>readExternal(ObjectInput in)</code>å®ç°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç»†èŠ‚ï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªæ˜ç¡®å®ç°çš„**<code>public no-arg constructor</code>**</p><h3 id="å®ç°-1" tabindex="-1"><a class="header-anchor" href="#å®ç°-1" aria-hidden="true">#</a> å®ç°</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">NewClass</span> <span class="token keyword">implements</span> <span class="token class-name">Externalizable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> anInt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> string <span class="token operator">=</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Long</span> aLong <span class="token operator">=</span> <span class="token number">10L</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">transient</span> <span class="token keyword">float</span> aFloat <span class="token operator">=</span> <span class="token number">10F</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">NewClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutput</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>anInt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>aLong<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeFloat</span><span class="token punctuation">(</span>aFloat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectInput</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        anInt <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aLong <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aFloat <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;NewClass{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;anInt=&quot;</span> <span class="token operator">+</span> anInt <span class="token operator">+</span>
                <span class="token string">&quot;, string=&#39;&quot;</span> <span class="token operator">+</span> string <span class="token operator">+</span> <span class="token char">&#39;\\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, aFloat=&quot;</span> <span class="token operator">+</span> aFloat <span class="token operator">+</span>
                <span class="token string">&quot;, aLong=&quot;</span> <span class="token operator">+</span> aLong <span class="token operator">+</span>
                <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åŸç†" tabindex="-1"><a class="header-anchor" href="#åŸç†" aria-hidden="true">#</a> åŸç†</h3><p>çœ‹æºç å¯ä»¥çŸ¥é“ï¼Œå¦‚æœæ£€æµ‹åˆ°å½“å‰å¯¹è±¡æ˜¯<code>Externalizable</code>æ—¶ï¼Œå°±ä¼šå»è°ƒç”¨è¯¥å¯¹è±¡çš„<code>writeExternalæ–¹æ³•</code>ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Externalizable</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span>

<span class="token comment">// writeObject0 æ–¹æ³•ä¸­ï¼š</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeString</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cl<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Enum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeEnum</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Serializable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeOrdinaryObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¦‚æœæ˜¯ Serializable å°±æ‰§è¡Œè¿™ä¸ª</span>
            <span class="token punctuation">}</span>
<span class="token comment">// writeOrdinaryObject æ–¹æ³•ä¸­ï¼š</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>desc<span class="token punctuation">.</span><span class="token function">isExternalizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>desc<span class="token punctuation">.</span><span class="token function">isProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeExternalData</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Externalizable</span><span class="token punctuation">)</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¦‚æœæ˜¯ Externalizable å°±æ‰§è¡Œè¿™ä¸ª</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">writeSerialData</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
<span class="token comment">// writeExternalData æ–¹æ³•ä¸­</span>
<span class="token comment">// Writes externalizable data of given object by invoking its writeExternal() method.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>protocol <span class="token operator">==</span> <span class="token constant">PROTOCOL_VERSION_1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                obj<span class="token punctuation">.</span><span class="token function">writeExternal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                bout<span class="token punctuation">.</span><span class="token function">setBlockDataMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                obj<span class="token punctuation">.</span><span class="token function">writeExternal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                bout<span class="token punctuation">.</span><span class="token function">setBlockDataMode</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                bout<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token constant">TC_ENDBLOCKDATA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¼˜ç¼ºç‚¹-1" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹-1" aria-hidden="true">#</a> ä¼˜ç¼ºç‚¹</h3><ul><li>æ¯”<code>Serializable</code>éº»çƒ¦ï¼Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–éƒ½éœ€è¦ç”¨æˆ·è‡ªå·±å®ç°</li><li>çµæ´»ï¼Œå¯ä»¥è‡ªå®šä¹‰è¦å‚ä¸åˆ°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å˜é‡</li></ul><h2 id="parcelable" tabindex="-1"><a class="header-anchor" href="#parcelable" aria-hidden="true">#</a> Parcelable</h2><p><code>Parcelable</code>æ˜¯ Android ä¸ºäº†è§£å†³<code>Serializable</code>æ€§èƒ½é—®é¢˜è€Œæ¨å‡ºçš„ï¼Œä¸»è¦ç”¨åœ¨ Android çš„<code>Intent</code>æˆ–<code>çº¿ç¨‹é—´é€šä¿¡</code>ä¸­ã€‚</p><p><code>Parcelable</code>é€šè¿‡<code>Parcel</code>ä¼ è¾“åˆ°<code>IBinder</code>ä¸­ï¼Œä»è€Œå®ç°è·¨è¿›ç¨‹ä¼ è¾“ã€‚</p><blockquote><p>å¯¹äº<code>kotlin</code>è¯­è¨€æ¥è¯´ï¼ŒAndroid Studio è‡ªåŠ¨ç”Ÿæˆçš„<code>Parcelable</code>ä»£ç ä¸ä¼šå¤„ç† val å˜é‡ï¼ˆå› ä¸ºè¿™äº›å˜é‡ä¸ä¼šå˜åŒ–ï¼‰</p><p>æ­¤å¤–ï¼Œ<code>Parcelable</code>åœ¨ååºåˆ—åŒ–æ—¶ï¼Œè°ƒç”¨<code>parcel.readParcelable(classLoader)</code>ä¼ å…¥çš„æ˜¯<code>ClassLoader</code>ã€‚</p></blockquote><h3 id="å®ç°-2" tabindex="-1"><a class="header-anchor" href="#å®ç°-2" aria-hidden="true">#</a> å®ç°</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ª<code>Parcelable</code>çš„å®ç°ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">class</span> <span class="token function">AParcelable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> Parcelable <span class="token punctuation">{</span>

    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">10</span>

    <span class="token comment">// ä» Parcel ä¸­æ¢å¤æ•°æ®ï¼Œå¿…é¡»æŒ‰ç…§å†™å…¥çš„é¡ºåºè¯»å–</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> Parcel<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i <span class="token operator">=</span> parcel<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å°†å˜é‡å†™å…¥åˆ° Parcel ä¸­ï¼Œå¿…é¡»ä¸è¯»å–çš„é¡ºåºå¯¹åº”</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">writeToParcel</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> Parcel<span class="token punctuation">,</span> flags<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parcel<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ–‡ä»¶æè¿°ï¼Œä¸€èˆ¬é»˜è®¤ä¸º 0</span>
    <span class="token comment">// å¦‚æœè¿™ä¸ªå¯¹è±¡çš„ writeToParcel æ–¹æ³•çš„è¾“å‡ºä¸­æœ‰ç‰¹æ®Šçš„å¯¹è±¡åˆ™ä¼ é€’å¯¹åº”çš„æè¿°ä»£ç </span>
    <span class="token comment">// å¦‚ï¼šå¦‚æœåŒ…å«ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ FileDescriptorï¼Œå°±è¦è¿”å› CONTENTS_FILE_DESCRIPTOR</span>
    <span class="token comment">//  https://developer.android.google.cn/reference/android/os/Parcelable.html#CONTENTS_FILE_DESCRIPTOR</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">describeContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å¿…é¡»æœ‰è¿™ä¸ªå˜é‡ï¼Œç”¨æ¥ä» Parcel ä¸­åˆ›å»º Parcelable ç±»</span>
    <span class="token comment">// åœ¨ JAVA ä¸­æ˜¯ public static final Creator&lt;Book&gt; CREATOR = new Creator&lt;Book&gt;() {...}</span>
    <span class="token keyword">companion</span> <span class="token keyword">object</span> CREATOR <span class="token operator">:</span> Parcelable<span class="token punctuation">.</span>Creator<span class="token operator">&lt;</span>AParcelable<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">createFromParcel</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> Parcel<span class="token punctuation">)</span><span class="token operator">:</span> AParcelable <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">AParcelable</span><span class="token punctuation">(</span>parcel<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Create a new array of the Parcelable class.</span>
        <span class="token comment">// Returns an array of the Parcelable class, with every entry</span>
        <span class="token comment">// initialized to null.</span>
        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">newArray</span><span class="token punctuation">(</span>size<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>AParcelable<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">arrayOfNulls</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åŸç†-1" tabindex="-1"><a class="header-anchor" href="#åŸç†-1" aria-hidden="true">#</a> åŸç†</h3>`,27),F={href:"https://www.kancloud.cn/xcy396/android_tech/1296524",target:"_blank",rel:"noopener noreferrer"},q=t('<h3 id="ä¼˜ç¼ºç‚¹-2" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹-2" aria-hidden="true">#</a> ä¼˜ç¼ºç‚¹</h3><ul><li>æ€§èƒ½å¥½ï¼Œ<code>Parcelable</code>æ¥å£æ¯”<code>Serializable</code>æ¥å£æ•ˆç‡æ›´é«˜ï¼Œæ€§èƒ½æ–¹é¢é«˜å‡º 10 å¤šå€ [^Parcelable æºç åˆ†æ]:</li><li>è¾ƒå¤æ‚ï¼Œéœ€è¦è‡ªå·±å®ç°å¯¹è±¡çš„åºåˆ—åŒ–å†…å®¹</li></ul><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>ä¸€èˆ¬éœ€è¦æŒä¹…åŒ–ä¿å­˜æ•°æ®æˆ–åœ¨ç½‘ç»œé—´ä¼ è¾“æ—¶æ¨èä½¿ç”¨<code>Serializable</code>æˆ–è€…<code>Externalizable</code>ã€‚</p><p>åœ¨ Android ä¸­<code>Activity</code>ä¹‹é—´ç­‰ä¼ é€’å¯¹è±¡ï¼Œä»¥åŠè·¨è¿›ç¨‹ä¼ é€’å¯¹è±¡ç­‰æ—¶ä½¿ç”¨<code>Parcelable</code>ä»¥èŠ‚çœæ€§èƒ½ã€‚</p><h2 id="å‚è€ƒèµ„æ–™" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™" aria-hidden="true">#</a> å‚è€ƒèµ„æ–™</h2>',6),L={href:"http://darryrzhong.xyz/2019/09/15/Android%E4%B9%8B%E5%BA%8F%E5%88%97%E5%8C%96%E8%AF%A6%E8%A7%A3/",target:"_blank",rel:"noopener noreferrer"},R={href:"https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html",target:"_blank",rel:"noopener noreferrer"},B={href:"https://juejin.im/post/5d7206c5f265da03ab427181#heading-0",target:"_blank",rel:"noopener noreferrer"},P={href:"https://www.javacodegeeks.com/2019/08/serialization-everything-java-serialization-explained.html",target:"_blank",rel:"noopener noreferrer"},D={href:"https://juejin.im/post/5ce3cdc8e51d45777b1a3cdf#heading-0",target:"_blank",rel:"noopener noreferrer"},N={href:"https://blog.csdn.net/qq_16628781/article/details/70049623",target:"_blank",rel:"noopener noreferrer"},J={href:"https://cl0610.github.io/effective-java-learning/%E7%AC%AC%E5%8D%81%E7%AB%A0%20%E5%BA%8F%E5%88%97%E5%8C%96/77.%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%8C%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%85%88%E4%BA%8EreadResolve.html",target:"_blank",rel:"noopener noreferrer"},M={href:"https://juejin.im/post/5a3b24ab6fb9a04515440bd7",target:"_blank",rel:"noopener noreferrer"},V={href:"https://www.jianshu.com/p/32a2ec8f35ae",target:"_blank",rel:"noopener noreferrer"},U={href:"https://www.kancloud.cn/xcy396/android_tech/1296524",target:"_blank",rel:"noopener noreferrer"};function W(H,G){const a=o("ExternalLinkIcon");return c(),l("div",null,[u,n("p",null,[s("Photo by "),n("a",r,[s("Pixabay "),e(a)]),s(" from "),n("a",k,[s("Pexels"),e(a)])]),d,n("ul",null,[v,m,b,n("li",null,[n("a",h,[w,e(a)]),s(" Twitter å‡ºå“çš„é«˜æ€§èƒ½åºåˆ—åŒ–æ–¹æ¡ˆï¼Œå®ƒåŠ›æ±‚å¸®åŠ©å¼€å‘è€…å®ç°é«˜æ€§èƒ½å’Œé«˜å¯æ§çš„åºåˆ—åŒ–è¿‡ç¨‹ã€‚ï¼ˆæœ¬æ–‡ä¸è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ"),n("a",f,[s("è¿™ç¯‡æ–‡ç« "),e(a)]),s("ï¼‰")])]),y,n("blockquote",null,[g,j,n("p",null,[n("a",O,[s("77.å•ä¾‹æ¨¡å¼ï¼Œæšä¸¾ç±»å‹ä¼˜å…ˆäº readResolve"),e(a)])])]),E,n("blockquote",null,[n("p",null,[s("è¿™ç§æƒ…å†µå¯èƒ½å‡ºç°åœ¨æ¥æ”¶æ–¹ä½¿ç”¨äº†ä¸€ä¸ªä¸å‘é€æ–¹ä¸åŒç‰ˆæœ¬çš„ç±»ã€‚æ¥æ”¶æ–¹çš„ç‰ˆæœ¬å¤šæ‰©å±•äº†ä¸€äº›å­—æ®µï¼Œè€Œå‘é€æ–¹çš„ç‰ˆæœ¬æ²¡æœ‰è¿™äº›å­—æ®µã€‚è¿˜æœ‰ä¸€ç§å¯èƒ½å°±æ˜¯åºåˆ—åŒ–æµè¢«ç¯¡æ”¹äº†ã€‚è¿™æ—¶ï¼Œæ— è®ºæ˜¯æ¶æ„çš„æµè¿˜æ˜¯ä¸å®Œæ•´çš„æµï¼Œéƒ½å¯ä»¥ç”¨ "),_,s(" æ–¹æ³•æ¥å°†åºåˆ—åŒ–å¾—åˆ°çš„å¯¹è±¡åˆå§‹åŒ–åˆ°æ­£ç¡®çš„çŠ¶æ€ã€‚"),S,s(" ä½œè€…ï¼šç¦å°”é©¬æ—"),x,s(" é“¾æ¥ï¼š"),n("a",C,[s("https://juejin.im/post/5d7206c5f265da03ab427181"),e(a)])])]),z,n("blockquote",null,[I,n("p",null,[n("a",A,[s("https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html"),e(a)])])]),T,n("p",null,[s("åŸç†å‚è€ƒè¿™ç¯‡æ–‡ç« "),n("a",F,[s("Parcelable æºç åˆ†æ"),e(a)])]),q,n("p",null,[n("a",L,[s("Android ä¹‹åºåˆ—åŒ–è¯¦è§£"),e(a)])]),n("p",null,[n("a",R,[s("Java åºåˆ—åŒ–çš„é«˜çº§è®¤è¯†"),e(a)])]),n("p",null,[n("a",B,[s("ã€åŸåˆ›ã€‘ï¼ˆè¯‘ï¼‰Java åºåˆ—åŒ–é­”æ³•æ–¹æ³•åŠä½¿ç”¨ç¤ºä¾‹"),e(a)])]),n("p",null,[n("a",P,[s("What is Serialization? Everything You Need to Know About Java Serialization Explained With Example"),e(a)])]),n("p",null,[n("a",D,[s("java åºåˆ—åŒ–ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†"),e(a)])]),n("p",null,[n("a",N,[s("Java ä¹‹ Serializable/Externalizable åºåˆ—åŒ–å’Œååºåˆ—åŒ–"),e(a)])]),n("p",null,[n("a",J,[s("77.å•ä¾‹æ¨¡å¼ï¼Œæšä¸¾ç±»å‹ä¼˜å…ˆäº readResolve"),e(a)])]),n("p",null,[s("Pareclable å®ç°åŸç†ï¼š"),n("a",M,[s("Parcelable æœ€å¼ºè§£æ"),e(a)])]),n("p",null,[s("Parcelable ä½¿ç”¨ï¼š"),n("a",V,[s("è¯¦ç»†ä»‹ç» Android ä¸­ Parcelable çš„åŸç†å’Œä½¿ç”¨æ–¹æ³•"),e(a)])]),n("p",null,[n("a",U,[s("Parcelable æºç åˆ†æ"),e(a)])])])}const Y=p(i,[["render",W],["__file","9d9183ec.html.vue"]]);export{Y as default};

import{_ as p,r as o,o as c,c as l,a as n,b as s,d as e,e as t}from"./app-54b0e827.js";const i={},u=n("img",{src:"https://images.pexels.com/photos/2881229/pexels-photo-2881229.jpeg?cs=srgb&dl=white-and-blue-cables-2881229.jpg&fm=jpg",class:"full-image"},null,-1),r={href:"https://www.pexels.com/@pixabay?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels",target:"_blank",rel:"noopener noreferrer"},k={href:"https://www.pexels.com/photo/close-up-of-telephone-booth-257736/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels",target:"_blank",rel:"noopener noreferrer"},d=t("<p><strong>序列化</strong>：指将<code>Java对象</code>转化为<code>字节流</code>以便在网络、文件中保存、传输。</p><p><strong>反序列化</strong>：指的是从<code>字节流</code>中恢复<code>Java对象</code>。</p><p>本文主要讨论 Android 和 Java 中实现序列化的 4 种方式，并探讨一下其实现原理。</p><p>Android &amp; Java 中实现序列化的方式有：</p>",4),v=n("li",null,[n("code",null,"android.os.Parcelable"),s(" Android 平台特有，需要自己实现具体细节，性能消耗小，只能在内存中存在")],-1),m=n("li",null,[n("code",null,"java.io.Serializable"),s(" 实现简单，只需要实现"),n("code",null,"Serializable"),s("接口即可，可以输出到文件、网络等")],-1),b=n("li",null,[n("code",null,"java.io.Externalizable"),s(" 需要自己实现具体细节")],-1),h={href:"https://github.com/twitter/Serial/blob/master/README-CHINESE.rst/",target:"_blank",rel:"noopener noreferrer"},w=n("code",null,"Twitter Serial",-1),f={href:"https://www.jianshu.com/p/1b42608478c0",target:"_blank",rel:"noopener noreferrer"},y=t(`<h2 id="serializable" tabindex="-1"><a class="header-anchor" href="#serializable" aria-hidden="true">#</a> Serializable</h2><p><code>Serializable</code>接口没有任何方法，只是一个标记——表示这个类可以用来<code>序列化/反序列化</code>（由<code>ObjectOutputStream/ObjectInputStream</code>实现具体细节）。</p><p>一个类没有实现<code>Serializable接口</code>，或者包含没有<code>实现Serializable接口的变量</code>，则会序列化失败<code>NotSerializableException</code>。</p><h3 id="serialversionuid" tabindex="-1"><a class="header-anchor" href="#serialversionuid" aria-hidden="true">#</a> serialVersionUID</h3><p>使用<code>serialVersionUID</code>标记当前<code>Serializable</code>的版本。</p><p>如果没有指定，系统会自动用对象的<code>hashCode()</code>指定<code>serialVersionUID</code>，该值会在类发生改变时变化，从而导致反序列化失败。</p><p>而如果<code>serialVersionUID</code>一致，即使类结构有变化，也会反序列化（给新增的变量默认值），所以最好赋予一个默认的值。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//可以手动指定，也可以随机数，只要保持一致即可，如果不一致则会使反序列化失败</span>
<span class="token constant">ANY</span><span class="token operator">-</span><span class="token constant">ACCESS</span><span class="token operator">-</span><span class="token constant">MODIFIER</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="readresolve" tabindex="-1"><a class="header-anchor" href="#readresolve" aria-hidden="true">#</a> readResolve()</h3><p>如果<code>class</code>实现了<code>readResolve()</code>方法，会在反序列化时用到并返回这里提供的对象（反序列化得到的对象会被丢弃）。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 1. 反序列化</span>
<span class="token class-name">SerializableClass</span> serializableClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SerializableClass</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2.readObject() 内部调用了 readObject0(false):</span>
<span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">readObject0</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> unshared<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>tc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 这里匹配了 TC_NULL,TC_REFERENCE,TC_CLASS,TC_CLASSDESC,</span>
                <span class="token comment">// TC_PROXYCLASSDESC,TC_STRING,TC_LONGSTRING,TC_ARRAY,TC_ENUM</span>
                <span class="token comment">// TC_EXCEPTION,TC_BLOCKDATA,TC_BLOCKDATALONG,TC_ENDBLOCKDATA 等等类型</span>

                <span class="token keyword">case</span> <span class="token constant">TC_OBJECT</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>如果是 <span class="token constant">OBECJT</span> 类型，就调用下面的方法👇
                    <span class="token keyword">return</span> <span class="token function">checkResolve</span><span class="token punctuation">(</span><span class="token function">readOrdinaryObject</span><span class="token punctuation">(</span>unshared<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ...</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StreamCorruptedException</span><span class="token punctuation">(</span>
                        <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;invalid type code: %02X&quot;</span><span class="token punctuation">,</span> tc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            depth<span class="token operator">--</span><span class="token punctuation">;</span>
            bin<span class="token punctuation">.</span><span class="token function">setBlockDataMode</span><span class="token punctuation">(</span>oldMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token comment">// 3. 在这里会检测是否存在 readResolve() 方法，有的话就返回从 readResolve() 获取的对象</span>
<span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">readOrdinaryObject</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> unshared<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IOException</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token class-name">Object</span> obj<span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
        <span class="token comment">// 看这里，如果 hasReadResolveMethod() 为真则执行 invokeReadResolve() 并返回其结果</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
            handles<span class="token punctuation">.</span><span class="token function">lookupException</span><span class="token punctuation">(</span>passHandle<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
            desc<span class="token punctuation">.</span><span class="token function">hasReadResolveMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> rep <span class="token operator">=</span> desc<span class="token punctuation">.</span><span class="token function">invokeReadResolve</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>unshared <span class="token operator">&amp;&amp;</span> rep<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                rep <span class="token operator">=</span> <span class="token function">cloneArray</span><span class="token punctuation">(</span>rep<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rep <span class="token operator">!=</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Filter the replacement object</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>rep <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">filterCheck</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span>rep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">filterCheck</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                handles<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>passHandle<span class="token punctuation">,</span> obj <span class="token operator">=</span> rep<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">// Invokes the readResolve method of the represented serializable class and returns the result.</span>
    <span class="token class-name">Object</span> <span class="token function">invokeReadResolve</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过这个特性我们可以确保在反序列化的时候也能实现<strong>单例</strong>：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>private Object readResolve() throws ObjectStreamException {
    return this;//返回单例本身，而非新建的对象
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是根据下面的说法，要实现可以序列化的单例最简单安全的，还是使用枚举：</p>`,14),g=n("p",null,[n("strong",null,"事实上，如果依赖 readResolve 进行实例控制，带有对象引用类型的所有实例域则都必须声明为 transient 的"),s("。否则，利用"),n("code",null,"readResolve()"),s("方法实现的单例也会遭受到攻击。")],-1),j=n("p",null,[s("实现可序列化最简单安全的方式是采用枚举的形式，应该尽可能采用这种方式。如果采用"),n("code",null,"readResolve"),s("实现的话，要确保该类的所有实例域都为"),n("code",null,"基本类型"),s("，或者是"),n("code",null,"transient"),s("的。")],-1),O={href:"https://cl0610.github.io/effective-java-learning/%E7%AC%AC%E5%8D%81%E7%AB%A0%20%E5%BA%8F%E5%88%97%E5%8C%96/77.%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%8C%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%85%88%E4%BA%8EreadResolve.html",target:"_blank",rel:"noopener noreferrer"},E=t(`<h3 id="自定义序列化过程" tabindex="-1"><a class="header-anchor" href="#自定义序列化过程" aria-hidden="true">#</a> 自定义序列化过程</h3><p>如果想要自己处理序列化的过程，可以实现下面的方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObjectNoData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ObjectStreamException</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中，可以使用下面的方法实现<code>读/写</code><strong>该类自身的属性</strong>（<code>All non-static and non-transient fields of the current class, include private</code>），然后在调用诸如<code>out.writeObject(string);</code>等方法<strong>保存其他变量</strong>。</p><blockquote><p>The method does not need to concern itself with the state belonging to its superclasses or subclasses.</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>in<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>readObjectNoData</code>方法主要用在序列化流和我们要反序列化的类不一致时初始化一些必要的状态。</p>`,7),_=n("code",null,"readObjectNoData",-1),S=n("br",null,null,-1),x=n("br",null,null,-1),C={href:"https://juejin.im/post/5d7206c5f265da03ab427181",target:"_blank",rel:"noopener noreferrer"},z=t(`<p>此外，还可以使用<code>ObjectOutputStream</code>的<code>putFields()</code>和<code>ObjectInputStream</code>的<code>readFields()</code>写入/读取变量。使用这种方法可以<em>加密/解密</em>部分变量，或者在序列化的时候<em>只处理部分变量</em>。</p><p>具体使用方法见如下：</p><blockquote><p><strong>注意</strong>：<code>putFields()/readFields()</code>方法分别不能与<code>defaultWriteObject/defaultReadObject</code>一起使用；</p><p><code>putFields.put()</code>之后必须调用<code>out.writeFields()</code>方法</p><p>并且，没有在<code>putFields()</code>中加入的数据，在<code>readObject</code>中只能获取到该类型的默认值</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//这段示例代码来自 https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutputStream</span> out<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">PutField</span> putFields <span class="token operator">=</span> out<span class="token punctuation">.</span><span class="token function">putFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;原密码：&quot;</span> <span class="token operator">+</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           password <span class="token operator">=</span> <span class="token string">&quot;encryption&quot;</span><span class="token punctuation">;</span><span class="token comment">//模拟加密</span>
           putFields<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;加密后的密码：&quot;</span> <span class="token operator">+</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           out<span class="token punctuation">.</span><span class="token function">writeFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// putFields.put() 之后必须调用本方法</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">GetField</span> readFields <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Object</span> object <span class="token operator">=</span> readFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;要解密的字符串：&quot;</span> <span class="token operator">+</span> object<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           password <span class="token operator">=</span> <span class="token string">&quot;pass&quot;</span><span class="token punctuation">;</span><span class="token comment">//模拟解密，需要获得本地的密钥</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

   <span class="token punctuation">}</span>
<span class="token comment">// 执行反序列化结果：</span>
<span class="token comment">// 原密码：pass</span>
<span class="token comment">// 加密后的密码：encryption</span>
<span class="token comment">// 要解密的字符串：encryption</span>
<span class="token comment">// 最后反序列化后的 password 为 pass</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="父类未继承-serializable-的类的序列化" tabindex="-1"><a class="header-anchor" href="#父类未继承-serializable-的类的序列化" aria-hidden="true">#</a> 父类未继承 Serializable 的类的序列化</h3><p>如果一个类实现了序列化，但他的父类没有实现序列化，那么父类<strong>必须要有一个公开的无参构造函数</strong>，否则反序列化时会出错。</p><p>此时反序列化时，父类的变量值（<code>public, protected, and (if accessible) package fields</code>）都会是<strong>默认的值</strong>或者是在<strong>父类无参构造函数中初始化的值</strong>（即使这些值在子类对象中已经被修改了）。</p><p>要想使得这些值也可以支持序列化，可以通过<code>writeObject/readObject</code>自己处理这些值的序列化。</p><p>反之，如果一个类实现了<code>Serializable</code>接口，那么他的子类也自动支持序列化与反序列化。</p><h3 id="实现" tabindex="-1"><a class="header-anchor" href="#实现" aria-hidden="true">#</a> 实现</h3><p>下面是使用<code>Serializable</code>实现序列化与反序列化的简单示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * author: jixiaoyong
 * email: jixiaoyong1995@gmail.com
 * website: https://jixiaoyong.github.io
 * date: 12/24/19
 * description: 演示序列化功能
 */</span>
<span class="token keyword">class</span> <span class="token class-name">SerializableClass</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> anInt <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> aLong <span class="token operator">=</span> <span class="token number">100L</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">transient</span> <span class="token class-name">String</span> aTransient <span class="token operator">=</span> <span class="token string">&quot;transient filed cannot be serialized&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">A_STATIC_FILED</span> <span class="token operator">=</span> <span class="token string">&quot;static filed belong to class not object, cannot be serialized&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SerializableClass</span> clazz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SerializableClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;ObjectOutputFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ObjectOutputStream</span> objectOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">//write object to byte sequences</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//chang the object filed</span>
            clazz<span class="token punctuation">.</span>aLong <span class="token operator">=</span> <span class="token number">666L</span><span class="token punctuation">;</span>
            <span class="token comment">// A_STATIC_FILED belong to the class, so you can see it has the value read form</span>
            <span class="token comment">// the JVM rather the object you serialized before when you deserializes it.</span>
            <span class="token class-name">SerializableClass</span><span class="token punctuation">.</span><span class="token constant">A_STATIC_FILED</span> <span class="token operator">=</span> <span class="token string">&quot;Change the static filed!&quot;</span><span class="token punctuation">;</span>

            <span class="token class-name">SerializableClass</span> serializableClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SerializableClass</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>serializableClass<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;SerializableClass{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;anInt=&quot;</span> <span class="token operator">+</span> anInt <span class="token operator">+</span>
                <span class="token string">&quot;, aLong=&quot;</span> <span class="token operator">+</span> aLong <span class="token operator">+</span>
                <span class="token string">&quot;, aTransient=&#39;&quot;</span> <span class="token operator">+</span> aTransient <span class="token operator">+</span> <span class="token char">&#39;\\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, A_STATIC_FILED=&#39;&quot;</span> <span class="token operator">+</span> <span class="token constant">A_STATIC_FILED</span> <span class="token operator">+</span> <span class="token char">&#39;\\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output:</span>
<span class="token comment">// SerializableClass{anInt=10, aLong=100, aTransient=&#39;null&#39;, A_STATIC_FILED=&#39;Change the static filed!&#39;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="多次序列化同一个对象" tabindex="-1"><a class="header-anchor" href="#多次序列化同一个对象" aria-hidden="true">#</a> 多次序列化同一个对象</h3><p>返序列化读取的过程在<code>readResolve()</code>方法一节已经涉及到了，我们在看一下保存的部分，这里会有一个有意思的现象：</p>`,14),I=n("p",null,"Java 序列化机制为了节省磁盘空间，具有特定的存储规则，当写入文件的为同一对象时，并不会再将对象的内容进行存储，而只是再次存储一份引用。",-1),A={href:"https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html",target:"_blank",rel:"noopener noreferrer"},T=t(`<p>这会导致一个问题：当使用同一个<code>ObjectOutputStream对象</code>序列化<code>同一个序列化对象</code>时，即使在第一次序列化并保存后修改了这个对象的部分属性，当再次序列化时保存的<strong>只是前一个对象的引用</strong>——也就是说将完全相同一个对象保存了两次，<strong>第二次做的修改在序列化的时候并没有保存</strong>。</p><p>我们写个简单的 DEMO 验证一下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readAndwriteObject2</span><span class="token punctuation">(</span><span class="token class-name">SerializableClass</span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;ObjectOutputFile&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span>
                <span class="token class-name">ObjectOutputStream</span> objectOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// 第一次序列化</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            clazz<span class="token punctuation">.</span>aLong <span class="token operator">=</span> <span class="token number">9344L</span><span class="token punctuation">;</span><span class="token comment">//在这里修改了部分属性</span>

            <span class="token comment">// 第二次序列化</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">// 反序列化，读取之前序列化的两个对象</span>
            <span class="token class-name">SerializableClass</span> serializableClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SerializableClass</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>serializableClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SerializableClass</span> serializableClass1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SerializableClass</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>serializableClass1<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;serializableClass == serializableClass1: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>serializableClass <span class="token operator">==</span> serializableClass1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token comment">// output</span>
<span class="token comment">// SerializableClass{anInt=10, aLong=100, aaLong=100, aTransient=&#39;null&#39;, A_STATIC_FILED=&#39;static filed belong to class not object, cannot be serialized&#39;}</span>
<span class="token comment">// SerializableClass{anInt=10, aLong=100, aaLong=100, aTransient=&#39;null&#39;, A_STATIC_FILED=&#39;static filed belong to class not object, cannot be serialized&#39;}</span>
<span class="token comment">// serializableClass == serializableClass1: true //可以看到两次获取的是完全相同的对象</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这是为什么呢，我们可以在源码中看到原因：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 序列化时，我们会调用 ObjectOutputStream 的 writeObject 方法</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>enableOverride<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">writeObjectOverride</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">writeObject0</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//注意这里，第二个参数 unshared 是 false</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeFatalException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token doc-comment comment">/** obj -&gt; wire handle map */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">HandleTable</span> handles<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject0</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token keyword">boolean</span> unshared<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>obj <span class="token operator">=</span> subs<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>unshared <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> handles<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 可以看到这里，如果 unshared 为 false 的话，</span>
              <span class="token comment">// 就会去找这个对象是否已经被序列化过了，是的话就直接写入引用，</span>
              <span class="token comment">// 而不是再次序列化</span>
                <span class="token function">writeHandle</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeClass</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">ObjectStreamClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeClassDesc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ObjectStreamClass</span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Writes given object handle to stream.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeHandle</span><span class="token punctuation">(</span><span class="token keyword">int</span> handle<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        bout<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token constant">TC_REFERENCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bout<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>baseWireHandle <span class="token operator">+</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了避免这种情况，在保存同一个对象时要注意使用不同的<code>ObjectOutputStream</code>对象，或者可以使用<code>writeUnshared</code>方法。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Writes an &quot;unshared&quot; object to the ObjectOutputStream.</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeUnshared</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">writeObject0</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">writeFatalException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优缺点" tabindex="-1"><a class="header-anchor" href="#优缺点" aria-hidden="true">#</a> 优缺点</h3><ul><li>简单，只需要实现接口</li><li>序列化的字节流可以在文件、网络中传递，可以持久化保存</li><li>性能差，序列化过程大量使用反射和临时变量</li></ul><h2 id="externalizable" tabindex="-1"><a class="header-anchor" href="#externalizable" aria-hidden="true">#</a> Externalizable</h2><p><code>Externalizable</code>继承自<code>Serializable</code>。</p><p>用户需要通过<code>writeExternal(ObjectOutput out)</code>和<code>readExternal(ObjectInput in)</code>实现序列化与反序列化的细节，并且需要一个明确实现的**<code>public no-arg constructor</code>**</p><h3 id="实现-1" tabindex="-1"><a class="header-anchor" href="#实现-1" aria-hidden="true">#</a> 实现</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">NewClass</span> <span class="token keyword">implements</span> <span class="token class-name">Externalizable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> anInt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> string <span class="token operator">=</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Long</span> aLong <span class="token operator">=</span> <span class="token number">10L</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">transient</span> <span class="token keyword">float</span> aFloat <span class="token operator">=</span> <span class="token number">10F</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">NewClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutput</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>anInt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>aLong<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeFloat</span><span class="token punctuation">(</span>aFloat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectInput</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        anInt <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aLong <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aFloat <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;NewClass{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;anInt=&quot;</span> <span class="token operator">+</span> anInt <span class="token operator">+</span>
                <span class="token string">&quot;, string=&#39;&quot;</span> <span class="token operator">+</span> string <span class="token operator">+</span> <span class="token char">&#39;\\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, aFloat=&quot;</span> <span class="token operator">+</span> aFloat <span class="token operator">+</span>
                <span class="token string">&quot;, aLong=&quot;</span> <span class="token operator">+</span> aLong <span class="token operator">+</span>
                <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="原理" tabindex="-1"><a class="header-anchor" href="#原理" aria-hidden="true">#</a> 原理</h3><p>看源码可以知道，如果检测到当前对象是<code>Externalizable</code>时，就会去调用该对象的<code>writeExternal方法</code>。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Externalizable</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span>

<span class="token comment">// writeObject0 方法中：</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeString</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cl<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Enum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeEnum</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Serializable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeOrdinaryObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> unshared<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果是 Serializable 就执行这个</span>
            <span class="token punctuation">}</span>
<span class="token comment">// writeOrdinaryObject 方法中：</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>desc<span class="token punctuation">.</span><span class="token function">isExternalizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>desc<span class="token punctuation">.</span><span class="token function">isProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">writeExternalData</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Externalizable</span><span class="token punctuation">)</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果是 Externalizable 就执行这个</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">writeSerialData</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
<span class="token comment">// writeExternalData 方法中</span>
<span class="token comment">// Writes externalizable data of given object by invoking its writeExternal() method.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>protocol <span class="token operator">==</span> <span class="token constant">PROTOCOL_VERSION_1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                obj<span class="token punctuation">.</span><span class="token function">writeExternal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                bout<span class="token punctuation">.</span><span class="token function">setBlockDataMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                obj<span class="token punctuation">.</span><span class="token function">writeExternal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                bout<span class="token punctuation">.</span><span class="token function">setBlockDataMode</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                bout<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token constant">TC_ENDBLOCKDATA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优缺点-1" tabindex="-1"><a class="header-anchor" href="#优缺点-1" aria-hidden="true">#</a> 优缺点</h3><ul><li>比<code>Serializable</code>麻烦，序列化与反序列化都需要用户自己实现</li><li>灵活，可以自定义要参与到序列化与反序列化的变量</li></ul><h2 id="parcelable" tabindex="-1"><a class="header-anchor" href="#parcelable" aria-hidden="true">#</a> Parcelable</h2><p><code>Parcelable</code>是 Android 为了解决<code>Serializable</code>性能问题而推出的，主要用在 Android 的<code>Intent</code>或<code>线程间通信</code>中。</p><p><code>Parcelable</code>通过<code>Parcel</code>传输到<code>IBinder</code>中，从而实现跨进程传输。</p><blockquote><p>对于<code>kotlin</code>语言来说，Android Studio 自动生成的<code>Parcelable</code>代码不会处理 val 变量（因为这些变量不会变化）</p><p>此外，<code>Parcelable</code>在反序列化时，调用<code>parcel.readParcelable(classLoader)</code>传入的是<code>ClassLoader</code>。</p></blockquote><h3 id="实现-2" tabindex="-1"><a class="header-anchor" href="#实现-2" aria-hidden="true">#</a> 实现</h3><p>下面是一个<code>Parcelable</code>的实现：</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">class</span> <span class="token function">AParcelable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> Parcelable <span class="token punctuation">{</span>

    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">10</span>

    <span class="token comment">// 从 Parcel 中恢复数据，必须按照写入的顺序读取</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> Parcel<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i <span class="token operator">=</span> parcel<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 将变量写入到 Parcel 中，必须与读取的顺序对应</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">writeToParcel</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> Parcel<span class="token punctuation">,</span> flags<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parcel<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 文件描述，一般默认为 0</span>
    <span class="token comment">// 如果这个对象的 writeToParcel 方法的输出中有特殊的对象则传递对应的描述代码</span>
    <span class="token comment">// 如：如果包含一个文件描述符 FileDescriptor，就要返回 CONTENTS_FILE_DESCRIPTOR</span>
    <span class="token comment">//  https://developer.android.google.cn/reference/android/os/Parcelable.html#CONTENTS_FILE_DESCRIPTOR</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">describeContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 必须有这个变量，用来从 Parcel 中创建 Parcelable 类</span>
    <span class="token comment">// 在 JAVA 中是 public static final Creator&lt;Book&gt; CREATOR = new Creator&lt;Book&gt;() {...}</span>
    <span class="token keyword">companion</span> <span class="token keyword">object</span> CREATOR <span class="token operator">:</span> Parcelable<span class="token punctuation">.</span>Creator<span class="token operator">&lt;</span>AParcelable<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">createFromParcel</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> Parcel<span class="token punctuation">)</span><span class="token operator">:</span> AParcelable <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">AParcelable</span><span class="token punctuation">(</span>parcel<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Create a new array of the Parcelable class.</span>
        <span class="token comment">// Returns an array of the Parcelable class, with every entry</span>
        <span class="token comment">// initialized to null.</span>
        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">newArray</span><span class="token punctuation">(</span>size<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>AParcelable<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">arrayOfNulls</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="原理-1" tabindex="-1"><a class="header-anchor" href="#原理-1" aria-hidden="true">#</a> 原理</h3>`,27),F={href:"https://www.kancloud.cn/xcy396/android_tech/1296524",target:"_blank",rel:"noopener noreferrer"},q=t('<h3 id="优缺点-2" tabindex="-1"><a class="header-anchor" href="#优缺点-2" aria-hidden="true">#</a> 优缺点</h3><ul><li>性能好，<code>Parcelable</code>接口比<code>Serializable</code>接口效率更高，性能方面高出 10 多倍 [^Parcelable 源码分析]:</li><li>较复杂，需要自己实现对象的序列化内容</li></ul><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>一般需要持久化保存数据或在网络间传输时推荐使用<code>Serializable</code>或者<code>Externalizable</code>。</p><p>在 Android 中<code>Activity</code>之间等传递对象，以及跨进程传递对象等时使用<code>Parcelable</code>以节省性能。</p><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2>',6),L={href:"http://darryrzhong.xyz/2019/09/15/Android%E4%B9%8B%E5%BA%8F%E5%88%97%E5%8C%96%E8%AF%A6%E8%A7%A3/",target:"_blank",rel:"noopener noreferrer"},R={href:"https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html",target:"_blank",rel:"noopener noreferrer"},B={href:"https://juejin.im/post/5d7206c5f265da03ab427181#heading-0",target:"_blank",rel:"noopener noreferrer"},P={href:"https://www.javacodegeeks.com/2019/08/serialization-everything-java-serialization-explained.html",target:"_blank",rel:"noopener noreferrer"},D={href:"https://juejin.im/post/5ce3cdc8e51d45777b1a3cdf#heading-0",target:"_blank",rel:"noopener noreferrer"},N={href:"https://blog.csdn.net/qq_16628781/article/details/70049623",target:"_blank",rel:"noopener noreferrer"},J={href:"https://cl0610.github.io/effective-java-learning/%E7%AC%AC%E5%8D%81%E7%AB%A0%20%E5%BA%8F%E5%88%97%E5%8C%96/77.%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%8C%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%85%88%E4%BA%8EreadResolve.html",target:"_blank",rel:"noopener noreferrer"},M={href:"https://juejin.im/post/5a3b24ab6fb9a04515440bd7",target:"_blank",rel:"noopener noreferrer"},V={href:"https://www.jianshu.com/p/32a2ec8f35ae",target:"_blank",rel:"noopener noreferrer"},U={href:"https://www.kancloud.cn/xcy396/android_tech/1296524",target:"_blank",rel:"noopener noreferrer"};function W(H,G){const a=o("ExternalLinkIcon");return c(),l("div",null,[u,n("p",null,[s("Photo by "),n("a",r,[s("Pixabay "),e(a)]),s(" from "),n("a",k,[s("Pexels"),e(a)])]),d,n("ul",null,[v,m,b,n("li",null,[n("a",h,[w,e(a)]),s(" Twitter 出品的高性能序列化方案，它力求帮助开发者实现高性能和高可控的序列化过程。（本文不详细介绍，可以参考"),n("a",f,[s("这篇文章"),e(a)]),s("）")])]),y,n("blockquote",null,[g,j,n("p",null,[n("a",O,[s("77.单例模式，枚举类型优先于 readResolve"),e(a)])])]),E,n("blockquote",null,[n("p",null,[s("这种情况可能出现在接收方使用了一个与发送方不同版本的类。接收方的版本多扩展了一些字段，而发送方的版本没有这些字段。还有一种可能就是序列化流被篡改了。这时，无论是恶意的流还是不完整的流，都可以用 "),_,s(" 方法来将序列化得到的对象初始化到正确的状态。"),S,s(" 作者：福尔马林"),x,s(" 链接："),n("a",C,[s("https://juejin.im/post/5d7206c5f265da03ab427181"),e(a)])])]),z,n("blockquote",null,[I,n("p",null,[n("a",A,[s("https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html"),e(a)])])]),T,n("p",null,[s("原理参考这篇文章"),n("a",F,[s("Parcelable 源码分析"),e(a)])]),q,n("p",null,[n("a",L,[s("Android 之序列化详解"),e(a)])]),n("p",null,[n("a",R,[s("Java 序列化的高级认识"),e(a)])]),n("p",null,[n("a",B,[s("【原创】（译）Java 序列化魔法方法及使用示例"),e(a)])]),n("p",null,[n("a",P,[s("What is Serialization? Everything You Need to Know About Java Serialization Explained With Example"),e(a)])]),n("p",null,[n("a",D,[s("java 序列化，看这篇就够了"),e(a)])]),n("p",null,[n("a",N,[s("Java 之 Serializable/Externalizable 序列化和反序列化"),e(a)])]),n("p",null,[n("a",J,[s("77.单例模式，枚举类型优先于 readResolve"),e(a)])]),n("p",null,[s("Pareclable 实现原理："),n("a",M,[s("Parcelable 最强解析"),e(a)])]),n("p",null,[s("Parcelable 使用："),n("a",V,[s("详细介绍 Android 中 Parcelable 的原理和使用方法"),e(a)])]),n("p",null,[n("a",U,[s("Parcelable 源码分析"),e(a)])])])}const Y=p(i,[["render",W],["__file","9d9183ec.html.vue"]]);export{Y as default};

<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="https://jixiaoyong.github.io/blog/rss.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <atom:link href="https://jixiaoyong.github.io/blog/rss.xml" rel="self" type="application/rss+xml"/>
    <title>JI,XIAOYONG</title>
    <link>https://jixiaoyong.github.io/blog/</link>
    <description>Let&amp;apos;s make something different!</description>
    <language>zh-CN</language>
    <pubDate>Thu, 02 May 2024 13:21:22 GMT</pubDate>
    <lastBuildDate>Thu, 02 May 2024 13:21:22 GMT</lastBuildDate>
    <generator>vuepress-plugin-feed2</generator>
    <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
    <copyright>Â©CC BY-NC-SA è®¸å¯åè®®æˆæƒï¼Œç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«</copyright>
    <item>
      <title>Android æ¶æ„æ¨¡å¼ä¸€è§ˆ</title>
      <link>https://jixiaoyong.github.io/blog/posts/6f46f598.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/6f46f598.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android æ¶æ„æ¨¡å¼ä¸€è§ˆ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 15 Dec 2023 09:10:00 GMT</pubDate>
      <content:encoded><![CDATA[<p>Android çš„æ¶æ„ä¾æ¬¡æœ‰ï¼š</p>
<ul>
<li>MVC</li>
<li>MVP</li>
<li>MVVM</li>
<li>MVI</li>
<li>Clean Architecture</li>
</ul>
<p>ä¸Šè¿°æ¶æ„å¾ªåºæ¸è¿›ï¼Œå½“å‰ä¸»æµè®¾è®¡æ¨¡å¼æ˜¯ MVVMï¼ŒMVI å’Œ Clean Architectureï¼Œè¿™ä¸‰è€…çš„ç€é‡ç‚¹å„æœ‰ä¸åŒï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®è§„æ¨¡å¤§å°é€’è¿›é€‰æ‹©ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_0.png" alt="https://github.com/skydoves/android-developer-roadmap/blob/main/README_CN.md" tabindex="0" loading="lazy"><figcaption><a href="https://github.com/skydoves/android-developer-roadmap/blob/main/README_CN.md" target="_blank" rel="noopener noreferrer">https://github.com/skydoves/android-developer-roadmap/blob/main/README_CN.md</a></figcaption></figure>
<h2> MVC</h2>
<p><strong>MVC</strong>ï¼Œ<strong>M</strong>odel-<strong>V</strong>iew-<strong>C</strong>ontrollerï¼Œæ˜¯ Android æœ€åŸå§‹çš„å¼€å‘æ–¹å¼ï¼Œé€šè¿‡ Controllerï¼ˆä¸€èˆ¬ä¸º Activityï¼ŒFragment ç­‰ï¼‰æ¥æ ¹æ®ç”¨æˆ·è¾“å…¥å¤„ç† Modelï¼ˆæ•°æ®/ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚/æ•°æ®è¯»å†™ï¼‰ï¼Œå¹¶å°†ç»“æœæ›´æ–°åˆ° Viewï¼ˆç”¨æˆ·ç•Œé¢ï¼ŒåŒ…æ‹¬ XMLï¼ŒActivityï¼ŒFragment ç­‰ï¼‰ä¸Šé¢ã€‚</p>
<p>åœ¨ Android å¼€å‘ä¸­ï¼ŒMVC é€šå¸¸è¢«ç”¨äºå®ç°åº”ç”¨ç¨‹åºçš„ UI å±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºä¸­ï¼Œ<strong>View</strong> å¯ä»¥æ˜¯ Activity æˆ– Fragmentï¼Œ<strong>Controller</strong> å¯ä»¥æ˜¯ Activity æˆ– Fragment çš„å†…éƒ¨ç±»ï¼Œ<strong>Model</strong> å¯ä»¥æ˜¯ POJO ç±»ï¼ˆç±»ä¼¼ data classï¼‰ã€‚</p>
<p>ä½†æ˜¯å®é™…å¼€å‘æ—¶ï¼Œ<strong>View é€šå¸¸ä¼šæŒæœ‰ Controller å’Œ Model çš„å¼•ç”¨äº§ç”Ÿè€¦åˆï¼Œå¹¶ä¸”å‡ ä¹æ‰€æœ‰çš„é€»è¾‘éƒ½å†™åœ¨ Controllerï¼ˆæ¯”å¦‚ Activity/Fragmentï¼‰</strong>ï¼Œéšç€é¡¹ç›®çš„è¿›è¡Œï¼Œç»å¸¸åœ¨ Activity ä¸­å³è´Ÿè´£ View çš„å±•ç¤ºï¼Œåˆè´Ÿè´£ä¸šåŠ¡é€»è¾‘åŠæ•°æ®æ›´æ–°ï¼Œå¯¼è‡´å…¶è‡ƒè‚¿éš¾ä»¥ç»´æŠ¤ã€‚</p>
<h2> MVP</h2>
<p>å› è€Œï¼Œ<strong>MVP</strong>åº”è¿è€Œç”Ÿï¼Œ<strong>M</strong>odel-<strong>V</strong>iew-<strong>P</strong>resenterï¼š</p>
<ul>
<li>Presenter æŒæœ‰ View çš„<strong>æŠ½è±¡æ¥å£</strong>å’Œ Modelï¼Œè´Ÿè´£äºŒè€…ä¹‹é—´çš„é€šä¿¡ï¼Œå¤„ç†ç”¨æˆ·çš„è¾“å…¥ï¼Œå°† Model çš„æ•°æ®å¤„ç†ä¸º View å¯ä½¿ç”¨çš„çŠ¶æ€ï¼›</li>
<li>View åªéœ€æŒæœ‰ Presenter å¹¶å®ç°æŠ½è±¡æ¥å£å¯¹åº”çš„æ–¹æ³•å³å¯ï¼›</li>
<li>Model åˆ™è´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œæš´éœ²è®¿é—®æ•°æ®çš„æ¥å£ï¼Œè¯·æ±‚æ•°æ®ç­‰ã€‚</li>
</ul>
<p>è¿™æ ·å°† View å’Œ Model éš”ç¦»ï¼ŒV å’Œ P ä¸€ä¸€å¯¹åº”ï¼Œå¤æ‚çš„è§†å›¾å¯ä»¥ç»„åˆå¤ç”¨å¤šä¸ª Pã€‚å¹¶ä¸”æ­¤æ—¶çš„ Presenter ä¸å†å’Œ Android API å…³è”ï¼Œæ›´å®¹æ˜“å•å…ƒæµ‹è¯•å’Œç»´æŠ¤ã€‚</p>
<p>äºŒè€…çš„åŒºåˆ«å¦‚ä¸‹å›¾ï¼ŒMVP ç›¸å¯¹äº MVCï¼Œ<strong>å°† V å’Œ M è§£è€¦</strong>ï¼Œä½¿å¾— V å¯ä»¥æ¯”è¾ƒä¸“æ³¨äº View çš„é€»è¾‘ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_1.png" alt="https://medium.com/cr8resume/make-you-hand-dirty-with-mvp-model-view-presenter-eab5b5c16e42" tabindex="0" loading="lazy"><figcaption><a href="https://medium.com/cr8resume/make-you-hand-dirty-with-mvp-model-view-presenter-eab5b5c16e42" target="_blank" rel="noopener noreferrer">https://medium.com/cr8resume/make-you-hand-dirty-with-mvp-model-view-presenter-eab5b5c16e42</a></figcaption></figure>
<p>å…³äº MVP çš„ä»£ç å®ç°ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ª<a href="https://github.com/antoniolg/androidmvp" target="_blank" rel="noopener noreferrer">é¡¹ç›®</a>ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œå‚è€ƒäº†è¿™ä¸ª<a href="http://antonioleiva.com/mvp-android/" target="_blank" rel="noopener noreferrer">æ–‡ç« </a>ï¼š</p>
<p><strong>Model</strong>ï¼Œè¿™é‡Œæ˜¯è¯·æ±‚åå°æä¾›ç™»å½•ç›¸å…³æ•°æ®ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>View</strong>ï¼Œè¿™ä¸€å±‚ä¸€èˆ¬ä½¿ç”¨ Activity/Fragment/View å®ç°ï¼Œä¼šæŒæœ‰ Presenter çš„å¼•ç”¨æ¥æ“ä½œæ•°æ®ï¼ŒåŒæ—¶ä¸ºäº†è®© Presenter å¯ä»¥ä¸ç›´æ¥å’Œ View å…³è”ï¼Œéœ€è¦æœ‰ä¸€ä¸ª<strong>æŠ½è±¡æ¥å£</strong>å°†äºŒè€…éš”ç¦»ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨ View ä¸­é™¤äº†æ­£å¸¸çš„é€»è¾‘ä¹‹å¤–ï¼Œè¿˜éœ€è¦å®ç°è¿™ä¸ª<code>LoginView</code>æ¥å£ä»¥ä¾¿ Presenter è°ƒç”¨ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹¶ä¸”ï¼ŒView ä¸­è¿˜ä¼šåˆå§‹åŒ–å¹¶æŒæœ‰ Presenterï¼Œä»¥é€šè¿‡ä»–æ¥å“åº”ç”¨æˆ·çš„äº¤äº’ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Presenter</strong>ï¼Œè´Ÿè´£ View å’Œ Model çš„äº¤äº’ï¼Œå°†ä» Model ä¸­æ£€ç´¢åˆ°çš„<strong>æ•°æ®</strong>è½¬åŒ–ä¸º View ä½¿ç”¨çš„<strong>çŠ¶æ€</strong>ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ MVP å¯¹äºç®€å•çš„é¡¹ç›®æ¥è¯´ï¼Œå¢åŠ äº†æ²¡å¿…è¦çš„å¤æ‚æ€§ï¼ˆView æŠ½è±¡ç±»ï¼ŒPresenter å•ç‹¬å‡ºæ¥ç­‰ï¼‰ï¼Œä»£ç é‡å¢åŠ ï¼Œ<strong>Presenter æŒæœ‰ View åœ¨æ‰§è¡Œè€—æ—¶ä»»åŠ¡æ—¶å¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ï¼ŒActivity destroy ä¹‹åå¦‚æœ Presenter è®¿é—® View å¯èƒ½ä¼šå¯¼è‡´å´©æºƒ</strong>ï¼Œå¹¶ä¸” View å’Œ Presenter å­˜åœ¨ä¸€å®šçš„è€¦åˆï¼ˆå½“ View ä¸­å‡ºç°è¯¸å¦‚ view ç±»å˜åŒ–ç­‰æ—¶éœ€è¦åŒæ­¥ä¿®æ”¹ Presenterï¼‰ã€‚</p>
<h2> MVVM</h2>
<p>ç”±æ­¤ï¼Œè¿›åŒ–å‡º MVVMï¼Œ<strong>M</strong>odel-<strong>V</strong>iew-<strong>V</strong>iewModelï¼Œä½¿ç”¨ ViewModel å°† View å’Œ Model å…³è”èµ·æ¥ï¼ŒåŒæ—¶<strong>ViewModel ä¸æŒæœ‰ View çš„å¼•ç”¨</strong>ï¼Œè€Œæ˜¯ View é€šè¿‡ ViewModel æ“ä½œ Modelï¼ŒView ç›‘å¬ ViewModel æš´éœ²å‡ºæ¥çš„æ•°æ®å¹¶æ›´æ–° UIã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_2.png" alt="https://medium.com/@husayn.hakeem/android-by-example-mvvm-data-binding-introduction-part-1-6a7a5f388bf7d" tabindex="0" loading="lazy"><figcaption><a href="https://medium.com/@husayn.hakeem/android-by-example-mvvm-data-binding-introduction-part-1-6a7a5f388bf7d" target="_blank" rel="noopener noreferrer">https://medium.com/@husayn.hakeem/android-by-example-mvvm-data-binding-introduction-part-1-6a7a5f388bf7d</a></figcaption></figure>
<p>åœ¨ MVVM ä¸­<strong>ViewModel åªè´Ÿè´£å¤„ç†å’Œæä¾›æ•°æ®ï¼Œä¸å†å…³å¿ƒ View</strong>ï¼Œä¾¿äºæµ‹è¯•ï¼Œé¿å…å†…å­˜æ³„éœ²ï¼›</p>
<p>é¡µé¢çš„æ›´æ–°å’Œç”¨æˆ·äº‹ä»¶å¤„ç†éƒ½ç”± <strong>View</strong> è‡ªå·±å¤„ç†ï¼ˆæ¯”å¦‚ç”¨æˆ·<code>ç‚¹å‡»é¡µé¢event</code>ä¹‹åï¼ŒView è°ƒç”¨ <strong>ViewModel</strong> è¯·æ±‚é€šè¿‡<strong>Model</strong>è¯·æ±‚ç½‘ç»œ/æ•°æ®åº“ï¼Œå¾—åˆ°å¹¶æ›´æ–°<code>æ•°æ®state</code>åï¼ŒView ç›‘å¬åˆ°æ•°æ®å¹¶åˆ·æ–°<code>é¡µé¢ui</code>ï¼‰ï¼Œ<strong>äºŒè€…çš„è€¦åˆå¾ˆä½</strong>ã€‚è€Œä¸” Jetpack å®˜æ–¹æä¾›äº† LiveData/StateFlow ç­‰å¯ä»¥ç›‘å¬ Activity ç­‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œé™ä½äº†å†…å­˜æ³„éœ²é£é™©ï¼ˆå‚è€ƒï¼š<a href="https://blog.csdn.net/u011033906/article/details/118113466" target="_blank" rel="noopener noreferrer">æ¢ç©¶ Android MVCã€MVPã€MVVM çš„åŒºåˆ«ä»¥åŠä¼˜ç¼ºç‚¹</a>ï¼‰ã€‚</p>
<p>ViewModel æä¾›æ•°æ®çš„è¯»å†™æ–¹æ³•ä¹‹åï¼Œé€šè¿‡ä½¿ç”¨ DataBindingï¼Œå¯ä»¥å®ç° View å’Œ ViewMode<strong>l<a href="https://developer.android.com/topic/libraries/data-binding/two-way?hl=zh-cn" target="_blank" rel="noopener noreferrer">åŒå‘æ•°æ®ç»‘å®š</a></strong>ï¼ˆå…·ä½“çš„ä»£ç å®ç°å¯ä»¥å‚è€ƒ<a href="https://github.com/husaynhakeem/TicTacToe-MVVM" target="_blank" rel="noopener noreferrer">TicTacToe-MVVM</a>ï¼‰ã€‚</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> MVI</h2>
<p>è€Œä¸ºäº†<strong>è¿›ä¸€æ­¥é™ä½ MVVM ä¸­ ViewModel å’Œ View çš„è€¦åˆ</strong>é—®é¢˜ï¼ˆMVVM ä¸­ View è¦è°ƒç”¨ ViewModel æ–¹æ³•è§¦å‘æ•°æ®å¤„ç†ï¼Œæ•°æ®å¯ä»¥åŒå‘ç»‘å®šï¼‰ï¼Œç®€åŒ–æ•°æ®æµçš„ç®¡ç†ï¼Œè¿›ä¸€æ­¥æ¼”åŒ–å‡ºäº† MVIï¼ˆ<strong>M</strong>odel-<strong>V</strong>iew-<strong>I</strong>ntentï¼‰ï¼š</p>
<p>å°†ç”¨æˆ·æ“ä½œé€šè¿‡ <strong>Intent</strong> ä¼ é€’ç»™ <strong>ViewModel</strong>ï¼ŒViewModel æ®æ­¤æ›´æ–°æ•°æ®ï¼Œå¹¶å°†æ•°æ®ä¼ é€’ç»™ <strong>View</strong> å±•ç¤ºï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­<strong>äº‹ä»¶å’Œæ•°æ®æ˜¯å•å‘</strong>çš„ã€‚</p>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼Œè¿™é‡Œçš„ Intent è¡¨ç¤ºæ„å›¾ã€äº‹ä»¶ï¼Œå¹¶é Android ä¸­ Activity ä¹‹é—´ä¼ é€’çš„<code>Intent</code>ç±»</p>
</blockquote>
<figure><img src="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_3.png" alt="https://proandroiddev.com/best-architecture-for-android-mvi-livedata-viewmodel-71a3a5ac7ee3" tabindex="0" loading="lazy"><figcaption><a href="https://proandroiddev.com/best-architecture-for-android-mvi-livedata-viewmodel-71a3a5ac7ee3" target="_blank" rel="noopener noreferrer">https://proandroiddev.com/best-architecture-for-android-mvi-livedata-viewmodel-71a3a5ac7ee3</a></figcaption></figure>
<p>MVI å’Œ MVVM çš„æœ€å¤§åŒºåˆ«åœ¨äºï¼ŒUI å±‚ä¸å†ç›´æ¥è°ƒç”¨ VM çš„å„ä¸ªæ–¹æ³•æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ˆæ¯”å¦‚ä¸‹è½½æ•°æ®ï¼‰è€Œæ˜¯é€šè¿‡<strong>V ç»™ VM å‘é€ Intentï¼ˆæ¯”å¦‚ viewModel.setEventï¼‰ï¼Œ<strong>ç”± VM å†…éƒ¨æ ¹æ®ä¸åŒçš„ Intent æ‰§è¡Œä¸åŒçš„é€»è¾‘ï¼Œä»è€Œä½¿å¾—</strong>V å’Œ VM çš„è€¦åˆé™ä½ï¼Œ<strong>æ­¤å¤–</strong>MVI å¼ºè°ƒå•ä¸€æ•°æ®æºï¼Œæ•°æ®æ˜¯å•å‘æµåŠ¨çš„</strong>ã€‚</p>
<p>ä»£ç å®ç°å¦‚ä¸‹ï¼ˆå‚è€ƒè‡ªï¼š<a href="https://github.com/myofficework000/MVI-JetpackCompose-Github" target="_blank" rel="noopener noreferrer">MVI-JetpackCompose-Github</a>ï¼‰ï¼š</p>
<p><strong>UI</strong> ç»™ VM å‘é€ <strong>Intent</strong>ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>VM</strong> å†…éƒ¨æ ¹æ®ä¸åŒçš„ Intent å¤„ç†é€»è¾‘ï¼Œå¹¶æš´éœ²<strong>å•ä¸€æ•°æ®</strong> State ç»™ Viewï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿° ViewModel æš´éœ²å‡ºæ¥çš„æ•°æ®ï¼Œåœ¨ View ä¸­ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†æä¸Šè¿°ä»£ç çš„é€»è¾‘ï¼Œå¯ä»¥çœ‹å‡ºï¼Œåœ¨ MVI ä¸­ï¼Œ<strong>V</strong>iew å‘é€å°†ç”¨æˆ·æ“ä½œä½¿ç”¨<strong>I</strong>ntent ç»™<strong>V</strong>iewModel å¤„ç†ï¼Œå¹¶ä» ViewModel è·å–åˆ°å¤„ç†åçš„çŠ¶æ€æ›´æ–°ç•Œé¢ï¼Œæ­¤å¤– ViewModel è¿˜è´Ÿè´£ä½¿ç”¨ Repository å®é™…å¤„ç† Dataï¼Œå¤§ä½“çš„é€»è¾‘ç¤ºæ„å¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_4.png" alt="https://www.scaler.com/topics/mvi-architecture-android/" tabindex="0" loading="lazy"><figcaption><a href="https://www.scaler.com/topics/mvi-architecture-android/" target="_blank" rel="noopener noreferrer">https://www.scaler.com/topics/mvi-architecture-android/</a></figcaption></figure>
<h2> Clean Architecture</h2>
<p>é€šè¿‡è§‚å¯Ÿä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œæ— è®ºæ˜¯ MVVM è¿˜æ˜¯ MVI ä¸­ï¼Œéšç€ä¸šåŠ¡å‘å±•ï¼ŒVM å¤„ç†çš„é€»è¾‘ä¼šæ—¥ç›Šå¢é•¿ï¼Œç¹é‡ã€‚åœ¨ MVVM/MVI çš„åŸºç¡€ä¹‹ä¸Šï¼Œé€šè¿‡å¯¹ä¸šåŠ¡é€»è¾‘çš„è¿›ä¸€æ­¥æŠ½è±¡ï¼Œå¯ä»¥å®ç°<strong>Clean Architecture</strong>æ¨¡å¼ï¼š</p>
<p>è¿™ä¹Ÿæ˜¯ Android å®˜æ–¹å¦‚ä»ŠåŠ›æ¨çš„æ¨¡å¼ï¼Œå°† Android APP åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>
<ul>
<li><strong>UI Layer</strong>ï¼Œåº”ç”¨å±‚ï¼Œç”¨äºå’Œç”¨æˆ·äº¤äº’ï¼Œç”± Viewï¼ˆä¸‹å›¾çš„ UI elementsï¼‰å’Œ ViewModel/å•çº¯ç±»ï¼ˆä¸‹å›¾ä¸­çš„ State holdersï¼‰ç­‰ç»„æˆï¼Œå’Œ Android API å¼ºå…³è”ï¼Œå‘èµ· eventï¼Œå±•ç¤ºæ–°çš„ stateã€‚</li>
<li><strong>Domain Layer</strong>ï¼ˆå¤æ‚é¡¹ç›®å¯é€‰ï¼‰ï¼Œä¸šåŠ¡é€»è¾‘å±‚ï¼Œå¯¹äºå¤æ‚é¡¹ç›®ï¼Œå¯ä»¥å°†ä¸€äº›é‡è¦çš„ä¸šåŠ¡æŠ½è±¡å‡ºæ¥ï¼ˆæ¯”å¦‚ç™»å½•é€»è¾‘ï¼šæ£€éªŒå¯†ç ï¼Œè¯·æ±‚ç™»å½•ï¼Œæ›´æ–°ç™»å½•çŠ¶æ€ç­‰æµç¨‹ï¼‰ï¼Œä¹ŸåŒ…æ‹¬ä¸€äº›ä¹‹å‰ä½¿ç”¨å·¥å…·ç±»å®ç°çš„æ–¹æ³•ï¼ˆæ¯”å¦‚æ ¼å¼åŒ–æ—¥æœŸç­‰ï¼‰ã€‚è¿™éƒ¨åˆ†çš„ä»£ç ä¸ Android API æ²¡æœ‰ä»»ä½•å…³è”ï¼Œæ˜¯å¹³å°æ— å…³çš„æŠ½è±¡é€»è¾‘ï¼Œ<strong>ä¸ Data Layer é€šè¿‡æŠ½è±¡æ¥å£è§£è€¦</strong>ï¼ˆDomain Layer åªé€šè¿‡ repository çš„æŠ½è±¡ç±»ä¸ Data äº¤äº’ï¼Œè€Œ Data Layer åˆ™è´Ÿè´£å®ç°å…·ä½“é€»è¾‘ï¼Œæ¯”å¦‚è¯·æ±‚æ•°æ®åº“ï¼Œç½‘ç»œç­‰ï¼‰ã€‚ä¸ä¾èµ–äºå…·ä½“çš„æŠ€æœ¯æˆ–æ¡†æ¶ï¼Œæ–¹ä¾¿ç§»æ¤ã€‚</li>
<li><strong>Data Layer</strong>ï¼Œæ•°æ®å±‚ï¼Œè¿™ä¸€å±‚è´Ÿè´£å®ç°ä¸Šä¸€å±‚è°ƒç”¨çš„æŠ½è±¡æ¥å£ï¼ŒçœŸæ­£å®ç°å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€‚</li>
</ul>
<p>ä¸Šè¿°ä¸‰è€…ä¸­ï¼Œ<strong>UI Layer ä¾èµ–äº Domain Layer å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ŒData Layer ä¾èµ–äºåŸºç¡€æ¡†æ¶ï¼ˆç½‘ç»œï¼Œæ•°æ®åº“ç­‰ï¼‰æ¥è®¿é—®æ•°æ®ï¼Œè€Œ Domain Layer åˆ™ä¸ä¾èµ–ä¸Šè¿°äºŒè€…æ–¹ä¾¿è°ƒè¯•å’Œå¤ç”¨</strong>ã€‚</p>
<blockquote>
<p>ğŸ’¡ æ³¨æ„ Clean Architecture æ˜¯ä¸€ç§æ¶æ„æ€æƒ³ï¼Œæœ¬æ–‡åªä»‹ç»åŸºäº MVVM/MVI çš„å®ç°ï¼ŒåŸºäº MVP çš„å®ç°å¯å‚è€ƒ <a href="https://github.com/SmartDengg/android-clean-architecture-boilerplate" target="_blank" rel="noopener noreferrer">android-clean-architecture-boilerplate</a>ã€‚</p>
</blockquote>
<p><strong>Domain layer</strong>ç›¸å½“äºå°†ä¸€äº›å¸¸ç”¨ï¼Œå¤æ‚çš„é€»è¾‘å•ç‹¬æå–å‡ºæ¥ï¼ˆæ¯”å¦‚è¿‡æ»¤æ–°é—»åˆ—è¡¨ï¼Œæä¾›æ—¥æœŸæ ¼å¼åŒ–å·¥å…·ï¼‰ï¼Œé¿å… UI è¿‡äºç¹é‡ã€‚è¿™ä¸ªå±‚<strong>å•çº¯å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä¸»çº¿ç¨‹å®‰å…¨ï¼Œæ— ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥å¤ç”¨</strong>ã€‚ä¸€å®šç¨‹åº¦ä¸Šå‡è½»äº† ViewModel çš„è´Ÿæ‹…ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_5.png" alt="Android Clean Arhictecture https://developer.android.com/topic/architecture?hl=zh-cn" tabindex="0" loading="lazy"><figcaption>Android Clean Arhictecture <a href="https://developer.android.com/topic/architecture?hl=zh-cn" target="_blank" rel="noopener noreferrer">https://developer.android.com/topic/architecture?hl=zh-cn</a></figcaption></figure>
<p>åœ¨ä¸Šå›¾ä¸­ï¼ŒUI elements ç”¨æ¥å‘ç”¨æˆ·å±•ç¤º UIï¼ŒState holder åˆ™ä½¿ç”¨ ViewModel/æ™®é€šç±»ç­‰ç±»ç®¡ç†æ•°æ®ï¼Œå¯¹ UI æš´éœ² dataï¼Œå¹¶å¤„ç†é€»è¾‘ã€‚è¿™äºŒè€…ç»„åˆå®ç°äº†åœ¨å±å¹•ä¸Šå±•ç¤ºåº”ç”¨æ•°æ®ï¼Œå¹¶åœ¨ç”¨æˆ·äº¤äº’ç­‰æƒ…å†µä¸‹å¯¼è‡´æ•°æ®å˜åŒ–æ—¶ï¼Œå°†æœ€æ–°æ•°æ®å±•ç¤ºåˆ° UI ä¸Šã€‚</p>
<p>åœ¨ Clean Architecture ä¸­<strong>Presentation/UI Layer</strong>ï¼Œ<strong>Domain Layer</strong>å’Œ<strong>Data Layer</strong>è¿™ä¸‰è€…çš„å±‚çº§å…³ç³»ï¼Œå¯ä»¥çœ‹ä¸‹å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_6.png" alt="https://proandroiddev.com/clean-architecture-data-flow-dependency-rule-615ffdd79e29" tabindex="0" loading="lazy"><figcaption><a href="https://proandroiddev.com/clean-architecture-data-flow-dependency-rule-615ffdd79e29" target="_blank" rel="noopener noreferrer">https://proandroiddev.com/clean-architecture-data-flow-dependency-rule-615ffdd79e29</a></figcaption></figure>
<p>ä¸€ä¸ªé‡è¦çš„åŸåˆ™å°±æ˜¯ï¼Œé«˜å±‚æ¨¡å—ï¼ˆåœ†åœˆå†…éƒ¨ï¼‰ä¸åº”è¯¥ä¾èµ–åº•å±‚æ¨¡å—ï¼ˆåœ†åœˆå¤–éƒ¨ï¼‰ï¼Œä¸¤è€…åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚</p>
<p>è¿™ä¸ªæ¶æ„æ»¡è¶³äº†ä»¥ä¸‹å¸¸è§æ¶æ„åŸåˆ™ï¼š</p>
<ul>
<li>å…³æ³¨ç‚¹åˆ†ç¦»</li>
<li>æ•°æ®é©±åŠ¨ UIï¼ˆæ›´æ–°ï¼‰</li>
<li>å•ä¸€æ•°æ®æ¥æº</li>
<li>å•å‘æ•°æ®æµ</li>
</ul>
<blockquote>
<p>Keep in mind that you don't own implementations of Activity and Fragment; rather, these are just glue classes that represent the contract between the Android OS and your app. The OS can destroy them at any time based on user interactions or because of system conditions like low memory.</p>
<p>å¼€å‘è€…å¹¶ä¸å®é™…æ‹¥æœ‰/æ§åˆ¶ Activity å’Œ Fragmentï¼Œç³»ç»Ÿå¯ä»¥åœ¨å¿…è¦æ—¶å€™å›æ”¶ä»–ä»¬ï¼Œå› æ­¤è¦å°½é‡å‡å°‘å¯¹å…¶çš„ä¾èµ–ï¼Œåªåœ¨è¿™é‡Œå¤„ç†å’Œ UIã€æ“ä½œç³»ç»Ÿç›¸å…³çš„é€»è¾‘ï¼Œå°†<strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ã€‚</p>
</blockquote>
<p><strong>ä»æ•°æ®é©±åŠ¨ UI</strong>ï¼šåº”è¯¥ä½¿ç”¨æ•°æ®æ¨¡å‹ data modelsï¼ˆæœ€å¥½æ˜¯æŒä¹…æ¨¡å‹ï¼‰é©±åŠ¨ UIï¼Œè¿™äº›æ•°æ®æ¨¡å‹ç‹¬ç«‹äº UI å’Œå…¶ä»–ç»„ä»¶ï¼Œå®ç°åœ¨æ“ä½œç³»ç»Ÿé”€æ¯ APP è¿›ç¨‹æ—¶ä»–ä»¬ä¹Ÿè¢«é”€æ¯åï¼Œç”¨æˆ·ä¸ä¼šä¸¢å¤±æ•°æ®ï¼ˆå¯ä»¥ä»æœ¬åœ°ï¼Œç½‘ç»œæ¢å¤ï¼‰ã€‚</p>
<p><strong>å•ä¸€äº‹å®æ¥æº</strong> Single source of truthï¼šåº”ç”¨ä¸­å®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œåº”è¯¥åˆ†é…ä¸€ä¸ªå•ä¸€äº‹å®æ¥æºï¼ˆSSOTï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ SSOT å”¯ä¸€æŒæœ‰/ä¿®æ”¹æ•°æ®ï¼Œå¯¹å¤–æš´éœ²æ— å¯ä¿®æ”¹æ•°æ®ï¼Œåœ¨æ¥å—å‡½æ•°æˆ–äº‹ä»¶æ—¶æ›´æ–°æ•°æ®ï¼Œæ¯”å¦‚æ•°æ®åº“ï¼ŒViewModel ç­‰ã€‚è¿™æ ·å°†å¯¹æ•°æ®ä¿®æ”¹é›†ä¸­åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ã€‚</p>
<p><strong>å•å‘æ•°æ®æµ</strong> Unidirectional Data Flowï¼šåœ¨ UDF ä¸­ï¼Œæ•°æ® state åªä¼šæ²¿ä¸€ä¸ªæ–¹å‘æµåŠ¨ï¼Œè€Œ event æ²¿ç€ç›¸åæ–¹å‘ä¿®æ”¹æ•°æ®ã€‚è¿™æ ·ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä¸å®¹æ˜“å‡ºé”™ï¼Œä¾¿äºè°ƒè¯•ã€‚æ¯”å¦‚ jetpack compose ä¸­ï¼Œæ¯ä¸ª composable å‡½æ•°ä»ä¸Šä¸€çº§æ¥å—æ•°æ®ï¼Œå¹¶å°†äº‹ä»¶æš´éœ²ç»™ä¸Šä¸€çº§ï¼ˆæ•°æ®å‘ä¸‹ï¼Œäº‹ä»¶å‘ä¸Šï¼‰</p>
<figure><img src="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_7.png" alt="https://developer.android.com/topic/architecture/ui-layer" tabindex="0" loading="lazy"><figcaption><a href="https://developer.android.com/topic/architecture/ui-layer" target="_blank" rel="noopener noreferrer">https://developer.android.com/topic/architecture/ui-layer</a></figcaption></figure>
<blockquote>
<p>âš ï¸ <a href="https://developer.android.com/topic/architecture/ui-layer/state-production?hl=zh-cn#initializing-state-production" target="_blank" rel="noopener noreferrer"><strong>è­¦å‘Šï¼šè¯·é¿å…åœ¨ ViewModel çš„ init å—æˆ–æ„é€ å‡½æ•°ä¸­å¯åŠ¨å¼‚æ­¥æ“ä½œ</strong></a>ã€‚å¼‚æ­¥æ“ä½œä¸åº”æ˜¯åˆ›å»ºå¯¹è±¡æ—¶çš„é™„å¸¦æ•ˆåº”ï¼Œå› ä¸ºå¼‚æ­¥ä»£ç åœ¨å¯¹è±¡å®Œå…¨åˆå§‹åŒ–ä¹‹å‰å¯èƒ½ä¼šå¯¹è¯¥å¯¹è±¡æ‰§è¡Œè¯»å†™æ“ä½œã€‚è¿™ä¹Ÿç§°ä¸ºå¯¹è±¡æ³„éœ²ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç»†å¾®ä¸”éš¾ä»¥è¯Šæ–­çš„é”™è¯¯ã€‚ä½¿ç”¨ Compose çŠ¶æ€æ—¶ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦ã€‚å½“ ViewModel å­˜å‚¨äº† Compose çŠ¶æ€å­—æ®µæ—¶ï¼Œè¯·å‹¿åœ¨æ›´æ–° Compose çŠ¶æ€å­—æ®µçš„ ViewModel çš„ init å—ä¸­å¯åŠ¨åç¨‹ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç° IllegalStateExceptionã€‚</p>
</blockquote>
<p>çœ‹ä¸€ä¸ª Clean Architecture åœ¨ Andorid ä¸­ä»£ç å®ç°ï¼ˆ<a href="https://github.com/android10/Android-CleanArchitecture-Kotlin" target="_blank" rel="noopener noreferrer">Android-CleanArchitecture-Kotlin</a>ï¼‰ï¼š</p>
<p>ä¸‹é¢ä»£ç çš„æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_8.png" alt="https://fernandocejas.com/2018/05/07/architecting-android-reloaded/" tabindex="0" loading="lazy"><figcaption><a href="https://fernandocejas.com/2018/05/07/architecting-android-reloaded/" target="_blank" rel="noopener noreferrer">https://fernandocejas.com/2018/05/07/architecting-android-reloaded/</a></figcaption></figure>
<p>åœ¨<strong>UI Layer</strong>ä¸­ï¼Œä½¿ç”¨ Activity/Fragment ç­‰ä¸ ViewModel äº¤äº’ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<strong>Domain Layer</strong>ï¼Œä½¿ç”¨ <code>XXXUseCase</code> æå–<strong>é€šç”¨çš„ä¸šåŠ¡é€»è¾‘</strong>ä¼ é€’ç»™ ViewModelï¼Œå°† ViewModel å’Œ DataLayer éš”ç¦»è§£è€¦ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†çœ‹ä¸€ä¸‹ UseCase çš„ä»£ç ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<strong>Data Layer</strong>ï¼Œæš´éœ²ç»™ Domain Layer çš„ä¹Ÿæ˜¯ä¸€ä¸ª<strong>æŠ½è±¡ç±»</strong>ï¼ˆé‡è¦ï¼Œè¿™æ ·å¯¹ Domain Layer å±è”½äº†åº•å±‚çš„å®ç°ï¼šç½‘ç»œã€æ•°æ®åº“ã€æœ¬åœ°ç¼“å­˜ï¼‰ï¼Œå…·ä½“çš„å®ä¾‹åˆ™é€šè¿‡ DI æ’å…¥ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç çš„è¯¦ç»†åˆ†æå¯ä»¥å‚è€ƒä½œè€…çš„æ–‡ç« <a href="https://fernandocejas.com/2018/05/07/architecting-android-reloaded/" target="_blank" rel="noopener noreferrer">ã€Šæ„å»º Android...é‡è£…ä¸Šé˜µã€‹</a>ï¼Œè¿™é‡Œç®€è¦åˆ†æä¸€ä¸‹ï¼š</p>
<p>é€šè¿‡ä½¿ç”¨ Clean Architectureï¼Œæˆ‘ä»¬å°† Android APP åˆ†ä¸º UI Layerï¼ŒDomain Layerï¼ŒData Layer ä¸‰éƒ¨åˆ†ï¼Œå…¶ä¸­ Domain Layer æ˜¯ APP çš„ä¸»è¦ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ–äºå…¶ä»–éƒ¨åˆ†ï¼Œå’Œ Android API æ— å…³ï¼Œå¯ç§»æ¤ï¼Œæ˜¯ APP çš„ä¸­å¿ƒï¼Œè€Œ UI Layer ä¸“æ³¨å¤„ç†ä¸ç”¨æˆ·çš„äº¤äº’ï¼Œè€Œ Data Layer åˆ™å®é™…è´Ÿè´£æ•°æ®è¯»å†™ï¼Œè¿™éƒ¨åˆ†çš„å®ç°å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚</p>
<h2> æ€»ç»“</h2>
<p>ä» MVCã€MVPï¼Œåˆ° MVVMã€MVIï¼Œå†åˆ°ç»“åˆ Clean Architectureï¼Œéšç€ Android å¼€å‘æ¶æ„çš„æ¼”è¿›ï¼Œä»£ç å±‚çº§è¶Šå¤šï¼ŒæŠ½è±¡è¶Šæ·±ï¼Œå¸¦æ¥çš„æ˜¯ä¸åŒå±‚çº§ä¹‹é—´è€¦åˆé™ä½ï¼Œå„ä¸ªå±‚çº§çš„å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œæ›´å®¹æ˜“æµ‹è¯•å’Œç»´æŠ¤ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p>ã€ŠAndroid æ¶æ„æŒ‡å—ã€‹<a href="https://developer.android.com/topic/architecture" target="_blank" rel="noopener noreferrer">https://developer.android.com/topic/architecture</a></p>
<p>ã€ŠThe Clean Architectur uncle-bobã€‹<a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html" target="_blank" rel="noopener noreferrer">https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html</a></p>
<p>ã€ŠHow to architect Android apps: a deep dive into principles, not rules å¦‚ä½•æ„å»º Android åº”ç”¨ç¨‹åºï¼šæ·±å…¥æ¢è®¨åŸåˆ™ï¼Œè€Œä¸æ˜¯è§„åˆ™ã€‹<a href="https://proandroiddev.com/how-to-architect-android-apps-a-deep-dive-into-principles-not-rules-2f1eb7f26402" target="_blank" rel="noopener noreferrer">https://proandroiddev.com/how-to-architect-android-apps-a-deep-dive-into-principles-not-rules-2f1eb7f26402</a></p>
<p>ã€Šå¹²å‡€çš„æ¶æ„åˆå­¦è€…æŒ‡å—ã€‹<a href="https://betterprogramming.pub/the-clean-architecture-beginners-guide-e4b7058c1165" target="_blank" rel="noopener noreferrer">https://betterprogramming.pub/the-clean-architecture-beginners-guide-e4b7058c1165</a></p>
<p>ã€ŠArchitecting Android...The clean way?ã€‹<a href="https://fernandocejas.com/blog/engineering/2014-09-03-architecting-android-the-clean-way/" target="_blank" rel="noopener noreferrer">https://fernandocejas.com/blog/engineering/2014-09-03-architecting-android-the-clean-way/</a></p>
<p>ã€ŠAndroid Clean Architecture Kotlinã€‹<a href="https://github.com/android10/Android-CleanArchitecture-Kotlin" target="_blank" rel="noopener noreferrer">https://github.com/android10/Android-CleanArchitecture-Kotlin</a></p>
<p>ã€Šæ„å»º Android é‡è£…ä¸Šé˜µã€‹<a href="https://fernandocejas.com/2018/05/07/architecting-android-reloaded/" target="_blank" rel="noopener noreferrer">https://fernandocejas.com/2018/05/07/architecting-android-reloaded/</a></p>
<p>ã€ŠGoogle æ¨èä½¿ç”¨ MVI æ¶æ„ï¼Ÿå·èµ·æ¥äº†~ã€‹<a href="https://juejin.cn/post/7048980213811642382" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/7048980213811642382</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/blog/android_architecture/android_architecture_0.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter åŠ¨ç”»åˆ†æä¹‹ CustomPaint</title>
      <link>https://jixiaoyong.github.io/blog/posts/adf541c0.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/adf541c0.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter åŠ¨ç”»åˆ†æä¹‹ CustomPaint</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 29 Aug 2022 12:57:16 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡è®¨è®ºçš„ Flutter åŠ¨ç”»ä¸»è¦é™å®šåœ¨ï¼š<em>éšç€æ¯ä¸€å¸§çš„å˜åŒ–ï¼Œä¿®æ”¹ Flutter Widget çš„å¤§å°ã€é¢œè‰²ã€ä½ç½®ç­‰å±æ€§ï¼Œä½¿ä¹‹çœ‹èµ·æ¥ä»ä¸€ç§çŠ¶æ€æ¸å˜ä¸ºå¦å¤–ä¸€ç§çŠ¶æ€</em> è¿™ä¸€èŒƒå›´ã€‚</p>
</blockquote>
<p>æ ¹æ®ä¹‹å‰çš„åˆ†æï¼Œå…³äº Flutter ä¸­çš„ Widget åŠ¨ç”»ï¼Œå¤§ä½“å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p>
<ul>
<li>
<p><strong>éšå¼åŠ¨ç”»</strong>ï¼Œä»¥ ImplicitlyAnimatedWidget åŠå…¶å­ç±»ä¸ºä»£è¡¨ã€‚ç‰¹ç‚¹æ˜¯å½“æ¶‰åŠåˆ°çš„å±æ€§å˜åŒ–åï¼Œè¿™äº› Widget ä¼š <em>è‡ªåŠ¨æ¸å˜åˆ°æ–°çš„å±æ€§</em>ï¼Œä½¿ç”¨è€…åªèƒ½è®¾ç½®åŠ¨ç”»çš„ Durationã€Tweenã€Curve ç­‰ï¼Œè€Œæ— æ³•ä¸»åŠ¨ç»ˆæ­¢ã€åå‘æ‰§è¡ŒåŠ¨ç”»ã€‚</p>
<p>æ¶‰åŠåˆ°çš„ç±»ä¸»è¦æœ‰ TweenAnimationBuilder ä»¥åŠä¸€ç³»åˆ—ä»¥ AnimatedFoo å‘½åçš„ç±»ã€‚</p>
</li>
<li>
<p><strong>æ˜¾å¼åŠ¨ç”»</strong>ï¼Œä»¥ AnimatedWidget åŠå…¶å­ç±»ä¸ºä»£è¡¨ï¼Œéœ€è¦é…åˆ AnimationController ä½¿ç”¨ã€‚ç‰¹ç‚¹æ˜¯ <em>å½“ AnimationController çš„å€¼å˜åŒ–æ—¶ï¼ŒWidget ä¸­å¯¹åº”çš„å±æ€§ä¹Ÿä¼šéšä¹‹å˜åŒ–</em>ã€‚</p>
<p>æ¶‰åŠåˆ°çš„ç±»ä¸»è¦æœ‰ AnimationBuilder/AnimatedWidget ä»¥åŠä¸€ç³»åˆ— FooTransition å‘½åçš„ç±»ã€‚</p>
</li>
<li>
<p><strong>è‡ªå®šä¹‰åŠ¨ç”»</strong>ï¼Œå¦‚æœä¸Šè¿°ä¸¤ç§æ–¹å¼è¿˜æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ CustomPaint + CustomPainter + Listenableï¼ˆæ¯”å¦‚ AnimationControllerï¼‰å®ç°åŠ¨ç”»ï¼Œç‰¹ç‚¹æ˜¯å®ç°æ–¹å¼çµæ´»ï¼Œä½†åŒæ—¶ä¹Ÿæ¯”ä¸Šè¿°ä¸¤è€…éš¾åº¦é«˜ä¸€äº›ã€‚</p>
</li>
</ul>
<p>Flutter ä¸­è¿™äº›ä¸åŠ¨ç”»æœ‰å…³çš„ç±»å¦‚ä½•é€‰æ‹©ï¼ŒFlutter å®˜æ–¹ç»™äº†ä¸€å¼ å›¾ä»¥ä¾›å‚è€ƒï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_select.png" alt="å¦‚ä½•å®ç° Flutter ä¸­çš„åŠ¨ç”»" tabindex="0" loading="lazy"><figcaption>å¦‚ä½•å®ç° Flutter ä¸­çš„åŠ¨ç”»</figcaption></figure>
<br>
<p>æœ¬æ–‡å°†ç€é‡åˆ†æ<strong>ä½¿ç”¨ CustomPaint å®ç°è‡ªå®šä¹‰åŠ¨ç”»</strong>ï¼Œæ¶‰åŠåˆ°çš„ç±»ä»¥åŠä»–ä»¬çš„å…³ç³»å›¾å¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/paint/flutter_paint_class_struct.png" alt="CustomPaint è‡ªå®šä¹‰åŠ¨ç”»" tabindex="0" loading="lazy"><figcaption>CustomPaint è‡ªå®šä¹‰åŠ¨ç”»</figcaption></figure>
<h2> æºç åˆ†æ</h2>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªä½¿ç”¨ CustomPaint å®ç°çš„åŠ¨ç”»ï¼ˆåŠ¨ç”»çš„å†…å®¹æ˜¯ä¸€ä¸ªåå¤å˜å¤§åˆç¼©å°çš„è“è‰²å°çƒï¼‰ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç æ˜¯æˆ‘ä»¬ä½¿ç”¨ CustomPaint å®ç°è‡ªå®šä¹‰åŠ¨ç”»çš„å¸¸è§ç”¨æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€ä¸€åˆ†æä¸Šè¿°æ¶‰åŠåˆ°çš„ç±»çš„ä½œç”¨ã€‚</p>
<h3> CustomPaint</h3>
<blockquote>
<p>A widget that provides a canvas on which to draw during the paint phase.</p>
</blockquote>
<p>CustomPaint ç»§æ‰¿è‡ª SingleChildRenderObjectWidgetï¼Œå…¶å†…éƒ¨æŒæœ‰ CustomPainter å¹¶å°†å…¶ä¼ å…¥åˆ›å»º RenderCustomPaint ä»¥è·å– Canvas ç”¨äºç»˜åˆ¶å†…å®¹ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ° CustomPaint å†…éƒ¨å¹¶æ²¡æœ‰å¤ªå¤šé€»è¾‘ï¼Œæ§åˆ¶ CustomPainter ç»˜åˆ¶çš„ä¸»è¦é€»è¾‘éƒ½åœ¨ RenderCustomPaint ä¸­ã€‚</p>
<h3> RenderCustomPaint</h3>
<blockquote>
<p>Provides a canvas on which to draw during the paint phase.</p>
</blockquote>
<p>ä½œä¸º RenderObject çš„ RenderCustomPaintï¼Œè´Ÿè´£å®é™…è®¡ç®— sizeã€åœ¨ Flutter æ¡†æ¶ paint é˜¶æ®µå®‰æ’ painterã€foregroundPainter ä»¥åŠ child çš„ç»˜åˆ¶ã€‚</p>
<p>ä»¥ CustomPaint ä¼ å…¥çš„ CustomPainter? painter ä¸ºä¾‹ï¼Œåœ¨ RenderCustomPaint çš„æ„é€ æ–¹æ³•ä¸­å®ƒè¢«èµ‹å€¼ç»™_painterï¼Œéšåå½“ attach åˆ° RenderObject Tree æ—¶ï¼Œå¯¹ CustomPainter æ·»åŠ äº†ç›‘å¬ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒRenderCustomPaint å¯¹ CustomPainter æ·»åŠ ç›‘å¬ï¼Œåªè¦å€¼å˜åŒ–å°±æ‰§è¡Œ markNeedsPaintï¼›</p>
<p>è€Œå¦‚æœæ˜¯æ›´æ–°äº† CustomPainterï¼Œåˆ™ä¼šæ‰§è¡Œ RenderCustomPainter.painter æ–¹æ³•ï¼Œæœ€ç»ˆåœ¨_didUpdatePainter æ–¹æ³•ä¸­é‡å†™å¯¹æ–°çš„ CustomPainter æ·»åŠ ç›‘å¬ä»¥è§¦å‘ markNeedsPaintï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä¸¤ç§æ–¹æ³•æœ€ç»ˆéƒ½ä¼šç›´æ¥è§¦å‘ paint é˜¶æ®µï¼ˆè·³è¿‡äº† build å’Œ layout é˜¶æ®µï¼‰ï¼Œæœ€ç»ˆç”± Flutter Framework è°ƒç”¨ RenderCustomPainter.paint æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±æ˜¯ RenderCustomPaint ä½¿ç”¨ CustomPainter å®ç°ç»˜åˆ¶çš„è¿‡ç¨‹ï¼Œå¤§ä½“åˆ†ä¸º 3 éƒ¨åˆ†ï¼š</p>
<ul>
<li>åœ¨ attach æ–¹æ³•ä¸­ç›‘å¬ä» CustomPaint ä¼ å…¥çš„ CustomPainterï¼Œä¸€æ—¦å…¶æœ‰å˜åŒ–å°±æ‰§è¡Œ markNeedsPaint æ–¹æ³•ï¼Œå¼•å¯¼ Flutter æ¡†æ¶é‡æ–°ç»˜åˆ¶å†…å®¹ã€‚</li>
<li>å¦‚æœä¸­é—´é€šè¿‡ RenderCustomPainter.painter/foregroundPaint æ›´æ”¹ CustomPainterï¼Œåˆ™ä¼šé‡æ–°ç›‘å¬ä»¥è§¦å‘ markNeedsPaintã€‚</li>
<li>å½“ Flutter æ¡†æ¶æ‰§è¡Œé‡ç»˜æ—¶ï¼Œä¼šé€šè¿‡ RenderCustomPaint.paint æ–¹æ³•æœ€ç»ˆè°ƒç”¨ CustomPainter.paint æ–¹æ³•ç»˜åˆ¶å†…å®¹ã€‚</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒRenderCustomPainter è¿˜é€šè¿‡ computeMinIntrinsicWidth/computeMaxIntrinsicHeight ç­‰æ–¹æ³•è®¡ç®—åˆé€‚çš„ Sizeï¼Œä»¥åŠä½¿ç”¨ hitTestChildren/hitTestSelf ç­‰å¤„ç†ç‚¹å‡»äº‹ä»¶ç­‰ç­‰ã€‚</p>
<h3> CustomPainter</h3>
<blockquote>
<p>The interface used by <em>CustomPaint</em> (in the widgets library) and <em>RenderCustomPaint</em> (in the rendering library).</p>
</blockquote>
<p>CustomPainter æä¾› paint æ–¹æ³•è®©ä½¿ç”¨è€…ä½¿ç”¨ Canvas ç»˜åˆ¶å†…å®¹ï¼›ç»§æ‰¿è‡ª Listenableï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ addListener/removeListener æ–¹æ³•ç›‘å¬ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CustomPainter æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š</p>
<ul>
<li>
<p><strong>ç»§æ‰¿è‡ª CustomPainter</strong>ï¼ˆæ¨èï¼‰ï¼Œå¯ä»¥ä¼ å…¥ Listenableï¼Œè¿™æ · RenderCustomPaint ç›‘å¬çš„ä¾¿æ˜¯è¿™ä¸ª Listenable å¯¹è±¡ã€‚</p>
</li>
<li>
<p><strong>ç»§æ‰¿ Listenable æˆ–å…¶å­ç±»ï¼Œå¹¶å®ç° CustomPainter æ¥å£</strong>ï¼ˆ<em>Dart è¯­è¨€ç‰¹æ€§ï¼Œä¼šè¦æ±‚å®ç°å…¶æ‰€æœ‰æ–¹æ³•å±æ€§</em>ï¼‰ï¼Œè¿™æ ·ç›‘å¬çš„ä¾¿æ˜¯è¿™ä¸ªå®ç°ç±»å¯¹è±¡æœ¬èº«ã€‚</p>
</li>
</ul>
<p>å½“é€šçŸ¥ listener æ—¶ä¼šé€šè¿‡ RenderCustomPaint æ‰§è¡Œ markNeedsPaintï¼Œè§¦å‘ Flutter Framework é‡æ–°å®‰æ’ç»˜åˆ¶ï¼Œæœ€ç»ˆæ‰§è¡Œ CustomPainter.paint æ–¹æ³•é‡æ–°ç»˜åˆ¶å†…å®¹ã€‚</p>
<p>æ— è®ºå“ªç§å®ç°æ–¹å¼ï¼Œéƒ½å¿…é¡»å®ç° shouldRepaint å’Œ paint ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<ul>
<li>
<p><code>bool shouldRepaint(covariant CustomPainter oldDelegate)</code> æ¯å½“æ–°çš„ CustomPainter æä¾›ç»™ RenderCustomPaint æ—¶éƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå†åˆ¤æ–­æ˜¯å¦è°ƒç”¨ paint æ–¹æ³•ã€‚</p>
<p>å¦‚æœå‰å CustomPainter çš„ä¿¡æ¯ä¸åŒå½±å“åˆ°ç»˜åˆ¶ï¼Œåˆ™åº”è¯¥è¿”å› trueï¼›å¦åˆ™è¿”å› false åˆ™å¯èƒ½å¯¼è‡´ paint æ–¹æ³•è¢«çœç•¥ã€‚</p>
<p>å³ä½¿æ­¤æ–¹æ³•è¿”å› falseï¼Œpaint ä¹Ÿå¯èƒ½ä¼šè¢«å›è°ƒï¼ˆListenable è°ƒç”¨ listener è§¦å‘ï¼‰ï¼›å¦‚æœ size å˜åŒ–ç­‰æƒ…å†µä¸‹ä¼šç›´æ¥è°ƒç”¨ paint æ–¹æ³•ã€‚</p>
</li>
<li>
<p><code>void paint(Canvas canvas, Size size)</code> æ¯å½“å¯¹è±¡éœ€è¦ paint çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ã€‚</p>
<p>ä¼ å…¥çš„ Canvas çš„åæ ‡ç³»ä»¥å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ŒèŒƒå›´æ— é™å¤§ï¼Œä½† box çš„å¤§å°ä¸º sizeï¼Œç»˜åˆ¶çš„å†…å®¹åº”å½“åœ¨ size èŒƒå›´å†…ï¼Œå¦åˆ™å¯èƒ½æœ‰æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥åœ¨æœ€å¼€å§‹ä½¿ç”¨ Canvas.clipRect é™åˆ¶ç»˜åˆ¶èŒƒå›´ã€‚</p>
</li>
</ul>
<h3> Canvas</h3>
<blockquote>
<p>An interface for recording graphical operations.</p>
</blockquote>
<p>å½“ä½¿ç”¨ PaintingContext.canvas æ–¹æ³•è·å– Canvas æ—¶ï¼Œï¼ˆå¦‚æœ canvas ä¸º nullï¼‰ä¼šåˆ›å»º ui.PictureRecorder() å¹¶ä»¥æ­¤åˆ›å»º Canvasã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>PictureRecorder ä½¿ç”¨ Canvas è®°å½•å›¾å½¢æ“ä½œçš„æ¥å£ï¼Œåœ¨<code>PictureRecorder.endRecording</code>æ–¹æ³•ä¸­ä½¿ç”¨å…¶åˆ›å»º Pictureï¼Œåè€…è¢« SceneBuilder ç”¨æ¥åœ¨<code>SceneBuilder.build()</code>æ–¹æ³•ä¸­åˆ›å»º Sceneã€‚<br>
æœ€ç»ˆåœ¨<code>FlutterView.render</code>æ–¹æ³•ä¸­ï¼ŒScene è¢« GPU ç»˜åˆ¶åœ¨å±å¹•ä¸Šã€‚</p>
</blockquote>
<p>Canvas æœ‰å¸¸ç”¨çš„æ–¹æ³•ï¼š</p>
<ul>
<li>
<p><code>save()</code> å°†å½“å‰çš„ transform å’Œ clip ç­‰çš„å¤åˆ¶ä¿å­˜åœ¨ save stack ä¸Šé¢ï¼Œå¿…é¡»ä½¿ç”¨ <code>restore()</code>æ–¹æ³•æ¢å¤</p>
</li>
<li>
<p><code>saveLayer()</code>ï¼Œä¸ <code>save()</code>æ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯æ‰§è¡Œä»¥åï¼Œåç»­æ“ä½œéƒ½æ˜¯åœ¨ä¸€ä¸ªæ–°çš„ layer ä¸Šé¢è¿›è¡Œï¼Œç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„å›¾å±‚ã€‚</p>
<p>å¯ä»¥é€šè¿‡ Paint.colorFilterã€Paint.blendMode ç­‰å±æ€§é…ç½®å…¶ä¸ä¹‹å‰å›¾å±‚çš„å åŠ æ–¹å¼ã€‚<br>
<strong>æ¯”è¾ƒè€—æ€§èƒ½</strong>ï¼Œå¥½å¤„æ˜¯å¯ä»¥å¯¹åç»­æ“ä½œç»˜åˆ¶çš„å†…å®¹ç»Ÿä¸€å¤„ç†ï¼ˆ<em>æ¯”å¦‚ï¼Œå•ç‹¬ç”»ä¸¤ä¸ªåœ†ï¼Œç„¶åæŠ—é”¯é½¿ä¼šåˆ†åˆ«æ‰§è¡Œä¸¤æ¬¡ï¼Œå¯èƒ½ä¼šå‡ºç°æ¯›åˆºï¼Œè€Œä½¿ç”¨ saveLayer åè¿™ä¸¤ä¸ªåœ†ç›¸å½“äºä¸€ä¸ªæ•´ä½“ï¼Œä½¿ç”¨æŠ—é”¯é½¿æ•ˆæœä¼šå¾ˆå¥½</em>ï¼‰ã€‚</p>
</li>
<li>
<p><code>restore()</code>ï¼Œpop æ‰å½“å‰çš„ save stackï¼Œsave å’Œ saveLayer æ–¹æ³•ä¸æ­¤æ–¹æ³•ä¸€ä¸€å¯¹åº”ã€‚saveLayer åˆ›å»ºçš„ layer ä¼šå’Œä¹‹å‰çš„ layer åˆå¹¶ã€‚</p>
</li>
<li>
<p><code>translate/scale/rotate</code> å¯¹ç”»å¸ƒè¿›è¡Œå¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬æ“ä½œ</p>
</li>
<li>
<p><code>clipRect/clipRRect/clipPath</code> è£å‰ªç”»å¸ƒçš„ç»˜åˆ¶èŒƒå›´</p>
</li>
<li>
<p><code>drawColor/drawLine/drawRRect/drawRect...</code> ç­‰ç­‰ç»˜åˆ¶å„ç§å½¢çŠ¶</p>
<p>ç»˜åˆ¶æ–‡å­—åº”è¯¥ä½¿ç”¨ TextPainterï¼Œä¸æ¨èä½¿ç”¨ drawParagraph</p>
</li>
<li>
<p><code>skew/transform</code> å€¾æ–œ/å˜æ¢ç”»å¸ƒ</p>
</li>
</ul>
<h3> å°ç»“</h3>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬å·®ä¸è¿‡åˆ†æäº†åˆšå¼€å§‹çš„ demo æ¶‰åŠåˆ°çš„ç±»ï¼Œæ€»ç»“ä¸€ä¸‹ä»–ä»¬å„è‡ªçš„è§’è‰²ï¼š</p>
<ul>
<li>
<p>AnimationController å¯¹è±¡ï¼ˆä¹Ÿå³ Listenable å¯¹è±¡ï¼‰ï¼Œç”¨æ¥ç›‘å¬ Flutter Framework çš„å¸§åˆ·æ–°ï¼Œæ ¹æ®è®¾å®šçš„æ—¶é•¿ã€æ›²çº¿ç­‰é€šçŸ¥ listenerï¼Œä»¥è¾¾åˆ°æ§åˆ¶åŠ¨ç”»çš„æ•ˆæœã€‚</p>
</li>
<li>
<p>CustomPaintï¼Œä½œä¸º SingleChildRenderObjectWidgetï¼Œä¸»è¦ä½œç”¨æ˜¯å°† CustomPainterã€Widget child ç­‰å„ç±»å‚æ•°ä¼ é€’ç»™ RenderCustomPaintã€‚</p>
</li>
<li>
<p>RenderCustomPainterï¼Œä½œä¸º RenderProxyBoxï¼Œä¼˜å…ˆä»¥ Widget child çš„å¤§å°ä¸ºå‡†ï¼Œä¼šç›‘å¬ä¼ å…¥çš„ CustomPainter å¯¹è±¡ï¼Œå¹¶åœ¨å…¶å˜åŒ–æ—¶è§¦å‘ Flutter Framework å®‰æ’é‡æ–°ç»˜åˆ¶ï¼ˆè·³è¿‡ build å’Œ layout é˜¶æ®µï¼Œç›´æ¥è¿›å…¥ paint é˜¶æ®µï¼‰ï¼›</p>
<p>å½“éœ€è¦ç»˜åˆ¶æ—¶ï¼Œä¼šä¾æ¬¡å®‰æ’èƒŒæ™¯ã€childã€å‰æ™¯çš„ç»˜åˆ¶ã€‚è€Œè¿™é‡Œçš„èƒŒæ™¯å’Œå‰æ™¯éƒ½ç”±ä¼ å…¥çš„ CustomPainter è´Ÿè´£å®é™…ç»˜åˆ¶ã€‚</p>
</li>
<li>
<p>CustomPainterï¼Œæœ¬èº«æ˜¯ Listenable çš„å­ç±»ï¼Œå¯ä»¥è¢« RenderCustomPaint ç›‘å¬ï¼Œå…¶ paint æ–¹æ³•å®é™…è´Ÿè´£ç»˜åˆ¶å†…å®¹ã€‚</p>
<p>ä½¿ç”¨æ˜¯å¯ä»¥ç»§æ‰¿æ­¤ç±»ï¼ˆæ¨èï¼‰ï¼Œä¹Ÿå¯ä»¥å½“åšæ¥å£å®ç°æ‰€æœ‰æ–¹æ³•ã€‚</p>
</li>
<li>
<p>Canvasï¼ŒPaint åˆ™æ˜¯è´Ÿè´£å®é™…ç»˜åˆ¶ã€‚</p>
</li>
</ul>
<h2> æ€»ç»“</h2>
<p>åˆ°æœ¬æ–‡ä¸ºæ­¢ï¼Œæˆ‘ä»¬åˆ†æäº† Flutter åŠ¨ç”»å®ç°çš„å„ç§æ–¹å¼åŠå…¶åŸç†ï¼š</p>
<p>Flutter Widget åŠ¨ç”»ï¼Œæ˜¯<a href="https://jixiaoyong.github.io/blog/posts/6ec43bd8.html" target="_blank" rel="noopener noreferrer">AnimationController</a>é€šè¿‡ Ticker ç›‘å¬ Flutter å±å¹•åˆ·æ–°ï¼Œç„¶åæ ¹æ®<a href="https://jixiaoyong.github.io/blog/posts/820d6240.html" target="_blank" rel="noopener noreferrer">Tween/Curve</a>/Duration ç­‰ä¸€ç³»åˆ—å‚æ•°è®¡ç®—å‡ºå®æ—¶çš„å€¼ï¼ŒFlutter çš„ Widget åˆ™æ ¹æ®è¿™äº›å€¼è®¡ç®—ã€ä¿®æ”¹å¯¹åº”å±æ€§ä»è€Œå®ç°åŠ¨ç”»æ•ˆæœã€‚</p>
<p>Flutter å†…ç½®çš„åŠ¨ç”»åˆ†ä¸º<a href="https://jixiaoyong.github.io/blog/posts/47c43abe.html" target="_blank" rel="noopener noreferrer">éšå¼åŠ¨ç”»å’Œæ˜¾å¼åŠ¨ç”»</a>ä¸¤ç§ï¼Œå¦‚æœè¿™äº›åŠ¨ç”»è¿˜æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ CustomPaint å®ç°è‡ªå®šä¹‰åŠ¨ç”»ï¼ˆæœ¬æ–‡å†…å®¹ï¼‰ã€‚</p>
<blockquote>
<p>Flutter ä¸­çš„<a href="https://jixiaoyong.github.io/blog/posts/62beedda.html" target="_blank" rel="noopener noreferrer">Hero åŠ¨ç”»</a>ä¾¿æ˜¯ä½¿ç”¨æ˜¾å¼åŠ¨ç”»ä¸­çš„ AnimationBuilderã€Tween ç­‰å®ç°çš„ã€‚</p>
</blockquote>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://api.flutter.dev/flutter/widgets/CustomPaint-class.html" target="_blank" rel="noopener noreferrer">CustomPaint api.flutter.dev</a></p>
<p><a href="https://api.flutter.dev/flutter/dart-ui/Canvas-class.html" target="_blank" rel="noopener noreferrer">Canvas api.flutter.dev</a></p>
<p><a href="https://stackoverflow.com/a/59650400/8389461" target="_blank" rel="noopener noreferrer">What is Canvas.save and Canvas.restore? stackoverflow.com</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_select.png" type="image/png"/>
    </item>
    <item>
      <title>å…³äº</title>
      <link>https://jixiaoyong.github.io/blog/about.html</link>
      <guid>https://jixiaoyong.github.io/blog/about.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">å…³äº</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 06 Jun 2016 06:06:06 GMT</pubDate>
      <content:encoded><![CDATA[<img src="https://jixiaoyong.github.io/images/20191026161934.png" class="full-image">
<h1 align="center">Hi ğŸ‘‹, I'm JI,XIAOYONG <img src="https://img.shields.io/github/followers/jixiaoyong?style=social"></h1>
<h3 align="center">A developer. <br>A man who love the world.</h3>
<h3 align="left">Keep touch with me:</h3>
<p align="left">
<a href="mailto:jixiaoyong1995@gmail.com" target="_blank" rel="noopener noreferrer">
<img src="https://img.shields.io/badge/gamil-jixiaoyong1995-31aa52?logo=Gmail"></a>
&nbsp;<a href="https://jixiaoyong.github.io/" target="_blank" rel="noopener noreferrer"><img src="https://badgen.net/badge/ğŸŒ/jixiaoyong.github.io/cyan"></a>
&nbsp;<a href="https://leetcode.com/jixiaoyong/" target="_blank" rel="noopener noreferrer">
&nbsp;<img src="https://img.shields.io/badge/LeetCode-jixiaoyong-ffa725?logo=LeetCode"></a>
&nbsp;<img src="https://komarev.com/ghpvc/?username=jixiaoyong&amp;label=Profile views&amp;color=0e75b6&amp;style=flat" alt="jixiaoyong">
</p>
<h3 align="left">Languages and Tools:</h3>
<p><img src="https://s3.bmp.ovh/imgs/2022/04/23/145404445e75d358.webp" alt="flutter" width="auto" height="75">&nbsp;<img src="https://s3.bmp.ovh/imgs/2022/04/23/97ce58509314acd3.webp" alt="android" width="auto" height="70">&nbsp;<img src="https://s3.bmp.ovh/imgs/2022/04/23/d26f3568e7f51be1.webp" alt="dart" width="auto" height="75">&nbsp;<img src="https://s3.bmp.ovh/imgs/2022/04/23/00f2c6fdf1695763.webp" alt="java" width="auto" height="75">&nbsp;<img src="https://s3.bmp.ovh/imgs/2022/04/23/5f6b77b74970f139.webp" alt="kotlin" width="auto" height="75"></p>
<br>
<p>å­¦ä¹ çš„è¿‡ç¨‹éœ€è¦ä¸æ–­çš„æ¢ç´¢ã€ç´¯ç§¯ï¼Œæ›´éœ€è¦æœ‰æ¡ç†çš„æ€»ç»“ï¼Œæˆ‘ä¼šæŠŠå¹³æ—¶å­¦ä¹ çš„å¿ƒå¾—ä½“ä¼šã€ç»éªŒæ€»ç»“æ”¾åˆ°è¿™é‡Œï¼Œä¸»è¦æ˜¯ä¸ºäº†è‡ªå·±èƒ½å¤Ÿåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æœ‰è®¡åˆ’çš„æ€»ç»“å­¦ä¹ åˆ°çš„çŸ¥è¯†ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿ä¹‹åæŸ¥é˜…ã€‚</p>
<p>æˆ‘çš„é‚®ç®±æ˜¯ï¼šaml4aWFveW9uZzE5OTVAZ21haWwuY29tCg==</p>
<h1> 2018-02-27 update</h1>
<p>åœ¨æˆ‘å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œäº’è”ç½‘ç»™äº†æˆ‘è«å¤§çš„æ”¯æŒä¸å¸®åŠ©ã€‚ä½†ä¸å¯å¦è®¤çš„æ˜¯ï¼Œä¸­æ–‡äº’è”ç½‘å­˜åœ¨ç€å¾ˆå¤šâ€œç›¸äº’å€Ÿé‰´â€çš„èµ„æ–™ï¼Œå…¶ä¸­ä¸å¯é¿å…æœ‰å¾ˆå¤šæœªç»æŸ¥å®çš„èµ„æ–™ï¼Œå…¶å±å®³ä¸å°ã€‚</p>
<p>ä»Šå¤©å°±å› ä¸ºè¿™ç§é—®é¢˜ï¼Œç™½ç™½è€½æäº†ä¸€æ™šä¸Šçš„æ—¶é—´ã€‚è€Œè¿™è¿˜æ˜¯æˆ‘å·²ç»å‘ç°çš„æœ‰æ˜æ˜¾è°¬è®ºçš„åœ°æ–¹ï¼Œå…¶ä»–æ²¡æœ‰å‘ç°çš„æ›´æ˜¯ä¸çŸ¥å‡ å¤šã€‚</p>
<p>å¾ˆé—æ†¾åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘è‡ªå·±ä¹Ÿå†™è¿‡ä¸å°‘è¿™æ ·æ¬ ç¼ºæ€è€ƒï¼Œç›´æ¥â€œæ‹¿æ¥ä¸»ä¹‰â€çš„æ–‡ç« ï¼ŒçœŸæ˜¯æƒ­æ„§ã€‚ä»Šæ—¥èµ·ï¼ŒæŠ€æœ¯ç±»æ–‡ç« åŠ¡å¿…è‡ªå·±ç†è§£äº†ï¼Œç†é¡ºäº†æ‰å†™ï¼ŒåŠ¡å¿…æ¯ä¸ªè§‚ç‚¹éƒ½æœ‰å¯¹åº”çš„å‚è€ƒä¾æ®ã€‚å®å¯å°‘å†™ï¼Œä¹Ÿä¸èƒ½ä¹±å†™çå†™ã€‚ä¹‹å‰çš„æ–‡ç« ï¼Œä¹Ÿè¦æ…¢æ…¢çš„ä¿®æ­£ã€‚</p>
<p>å“å‘€ï¼Œä¸€ä¸å°å¿ƒç«‹äº†ä¸ª Flagï¼Œåƒä¸‡ä¸è¦æ‰“è„¸ (ï¿£ Îµ(#ï¿£)â˜†â•°â•®(ï¿£ â–½ ï¿£///)ã€‚</p>
<h1> 2019-03-25 update</h1>
<p>ä»Šåå†™åšå®¢ï¼Œå°½é‡é¿å…å†™ä¸€äº›å£æ°´æ–‡ï¼ŒåŸºç¡€æ•™ç¨‹ä¹‹ç±»çš„æ–‡ç« ï¼Œè¿™ç±»æ–‡ç« åœ¨æˆ‘çš„å­¦ä¹ è¿‡ç¨‹ä¸­å¯¹æˆ‘æœ‰å¾ˆå¤§çš„å¸®åŠ©ï¼Œä½†ç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šæ­¥éª¤æ›´åŠ å…·ä½“ï¼Œå†…å®¹æ›´åŠ å®Œå–„çš„æ–‡ç« ï¼Œå®åœ¨æ²¡æœ‰å¿…è¦å†èŠ±è´¹æ—¶é—´åœ¨è¿™é‡Œäº†ã€‚æ—¥åé€æ¸æ·±å…¥æºç ï¼Œæ¢ç©¶å¹³å¸¸ç”¨æ³•èƒŒåçš„å®ç°åŸç†ï¼Œå¸Œæœ›ä»¥æ­¤è®°å½•è‡ªå·±æå‡æŠ€æœ¯èƒ½åŠ›çš„è¿‡ç¨‹ã€‚</p>
<h1> 2023-04-06</h1>
<p>å¦‚ä½ æ‰€è§ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‰˜ç®¡åœ¨ <a href="https://github.com" target="_blank" rel="noopener noreferrer">GitHub</a> ä¸Šé¢çš„åšå®¢ï¼ŒåŸºäº<a href="https://v2.vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer">vuepress 2.0</a>çš„<a href="https://theme-hope.vuejs.press/zh/" target="_blank" rel="noopener noreferrer">hope</a>ä¸»é¢˜ï¼Œæ„Ÿè°¢æ‰€æœ‰ä¸ºä»¥ä¸Šæåˆ°çš„é¡¹ç›®æœ‰è¿‡ä»˜å‡ºçš„äººï¼Œæ²¡æœ‰ä»–ä»¬çš„è¯è¿™ä¸ªå°ç«™ä¸ä¼šå­˜åœ¨ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæœ¬åšå®¢ä½¿ç”¨äº†å¤§çº¦äº”å…­å¹´çš„ä¸»é¢˜æ˜¯åŸºäº<a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a>çš„<a href="https://github.com/theme-next/hexo-theme-next" target="_blank" rel="noopener noreferrer">NexT</a>ä¸»é¢˜ï¼Œåœ¨æˆ‘å¯¹ç¼–ç¨‹å°šä¸”æ‡µæ‡‚ä¹‹é™…ï¼Œä¸ºæˆ‘æä¾›äº†ä¸€ä¸ªå°šä¸”ä¸é”™çš„åšå®¢ï¼Œæ„Ÿè°¢ä»¥ä¸Šå„ä½æœ‹å‹ã€‚</p>
<h1> TODO List</h1>
<ul>
<li>é€‰å¥½æ–¹å‘</li>
<li>å¹¿æ³›é˜…è¯»</li>
<li>æ·±å…¥æ€è€ƒ</li>
<li>åŠæ—¶æ€»ç»“</li>
<li>å®šæ—¶è¾“å‡º</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Android å¼€å‘å¸¸ç”¨è®¾ç½®</title>
      <link>https://jixiaoyong.github.io/blog/posts/1c56d6b9.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/1c56d6b9.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android å¼€å‘å¸¸ç”¨è®¾ç½®</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 27 Aug 2017 15:25:05 GMT</pubDate>
      <content:encoded><![CDATA[<h2> Android Studio</h2>
<ul>
<li>
<p>å›½å†…è¾ƒå¿«çš„ä»“åº“ï¼š</p>
<p>maven {url'<a href="http://maven.aliyun.com/nexus/content/groups/public/" target="_blank" rel="noopener noreferrer">http://maven.aliyun.com/nexus/content/groups/public/</a>'}</p>
</li>
<li>
<p>RecyclerView æ·»åŠ ä¾èµ–<br>
æ³¨æ„ RecyclerView çš„ç‰ˆæœ¬å·è¦å’Œå½“å‰å·¥ç¨‹ä¸­å…¶ä»– android.support åŒ…ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œå¦åˆ™è™½ç„¶å¯¼å…¥äº†å¯¹åº”çš„åŒ…ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚</p>
<p>compile 'com.android.support:recyclerview-v7:26+'</p>
</li>
<li>
<p>è®¾ç½®ï¼š<br>
è‡ªåŠ¨æ·»åŠ ä¾èµ–ï¼šinsert imports on paste: None<br>
è‡ªåŠ¨åˆ é™¤æ— ç”¨ä¾èµ–ï¼šOptimize imports on the fly</p>
</li>
</ul>
<h2> Linux</h2>
<ul>
<li>
<p>è®¾ç½® ndk ç¯å¢ƒå˜é‡ /etc/profile</p>
<p>#set ndk env<br>
NDKROOT=/home/jixiaoyong/AndroidDev/Sdk/ndk-bundle<br>
export PATH=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>K</mi><mi>R</mi><mi>O</mi><mi>O</mi><mi>T</mi><mo>:</mo></mrow><annotation encoding="application/x-tex">NDKROOT:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.07153em;">DK</span><span class="mord mathnormal" style="margin-right:0.13889em;">ROOT</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>PATH</p>
</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Android11 æ–‡ä»¶åˆ†åŒºå­˜å‚¨åœ¨å›¾ç‰‡è¯»å†™çš„é€‚é…</title>
      <link>https://jixiaoyong.github.io/blog/posts/12cb887a.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/12cb887a.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android11 æ–‡ä»¶åˆ†åŒºå­˜å‚¨åœ¨å›¾ç‰‡è¯»å†™çš„é€‚é…</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 01 Jun 2021 06:34:25 GMT</pubDate>
      <content:encoded><![CDATA[<h2> è¯´æ˜</h2>
<p>å½“ APP ç›®æ ‡ç‰ˆæœ¬æ˜¯ Android 10ï¼ˆAPI 29ï¼‰åŠä»¥åæ—¶ï¼Œç”±äº Android å¼•å…¥äº†åˆ†åŒºå­˜å‚¨ï¼ŒAPP ä¸èƒ½ç›´æ¥é€šè¿‡è·¯å¾„è®¿é—®æ–‡ä»¶ï¼Œè®¿é—®å¤–éƒ¨å­˜å‚¨ç©ºé—´ä¸­çš„åª’ä½“æ–‡ä»¶é™¤äº†éœ€è¦<code>READ_EXTERNAL_STORAGE</code> æˆ– <code>WRITE_EXTERNAL_STORAGE</code> æƒé™ä¹‹å¤–ï¼Œéœ€è¦é€šè¿‡å…¶ä»– APP åˆ†äº«çš„<code>Uri</code>è¯»å†™æ–‡ä»¶ï¼ŒåŒç†è¦ç»™å…¶ä½™ APP åˆ†äº«æ–‡ä»¶ä¹Ÿè®¸è¦é€šè¿‡<code>FileProvider</code>ç”Ÿæˆ<code>Uri</code>å¹¶èµ‹äºˆå¯¹åº”çš„æƒé™ã€‚</p>
<p>æœ¬æ–‡ä»¥ä»ç›¸å†Œä¸­è·å–å›¾ç‰‡ã€è¯·æ±‚ç³»ç»Ÿè£å‰ªå¹¶è¿”å›å›¾ç‰‡ä¸ºä¾‹å±•ç¤ºå¯¹åº”çš„é€‚é…æ–¹æ³•ã€‚</p>
<h2> å®é™…æ“ä½œ</h2>
<p>1.<strong>ä»ç›¸å†Œä¸­è·å–å›¾ç‰‡</strong></p>
<p>ä»ç›¸å†Œä¸­è·å–åˆ°çš„å›¾ç‰‡<code>Uri</code>ä¸€èˆ¬å¦‚ï¼š<code>content://raw//storage/emulated/0/DCIM/Camera/IMG_20210531_183008.HEIC</code></p>
<p>app å†…éƒ¨è¦è¯»å–å…¶å†…å®¹çš„è¯ï¼Œå¯ä»¥é€šè¿‡<code>context.getContentResolver().openInputStream(imageUri)</code></p>
<p>æˆ–è€…</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç­‰æ–¹å¼è¯»å–ï¼Œæ“ä½œè¯¥å›¾ç‰‡ã€‚</p>
<p>2.<strong>å°†å¤–éƒ¨æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°å¹¶è·å– Uri</strong></p>
<p>ç”±äºä¸Šè¿°æ–¹å¼è·å–åˆ°çš„<code>Uri</code>åªå¯¹æœ¬ APP èµ‹äºˆäº†æƒé™ï¼Œè¦æ˜¯å¸Œæœ›å°†æ­¤å›¾ç‰‡åˆ†äº«ç»™ç¬¬ä¸‰æ–¹ APP è¿›ä¸€æ­¥åŠ å·¥å¤„ç†ï¼Œåˆ™å¯èƒ½å‡ºç°ç¬¬ä¸‰æ–¹ APP æ²¡æœ‰è¯»å†™æƒé™è€Œå¯¼è‡´æ“ä½œå¤±è´¥çš„æƒ…å†µï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥å°†è·å–åˆ°çš„å›¾ç‰‡ç¼“å­˜åˆ° APP ç§æœ‰ç›®å½•ï¼Œå¹¶ä¸”é‡æ–°ç”Ÿæˆ<code>Uri</code>å¹¶èµ‹äºˆå°†è¦å¤„ç†è¯¥å›¾çš„ç¬¬ä¸‰æ–¹ APP å¯¹åº”æƒé™ã€‚</p>
<p>å°†å¤–éƒ¨æ–‡ä»¶ç¼“å­˜æœ¬åœ°çš„æ­¥éª¤å‚è€ƒç¬¬ä¸€æ­¥æ“ä½œå³å¯è‡ªè¡Œå®Œæˆï¼Œä¸»è¦è®²è§£ä¸€ä¸‹å¦‚ä½•å°†å¯¹å¤–åˆ†äº«çš„<code>Uri</code>èµ‹äºˆè¯»å†™æƒé™ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªæ–¹æ³•åœ¨ä¸åŒç³»ç»Ÿåˆ†åˆ«é‡‡ç”¨ä¸åŒæ–¹å¼è·å–æ–‡ä»¶å¯¹åº”çš„<code>Uri</code>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<code>com.your.app.packagename.fileprovider</code>æ˜¯<a href="https://developer.android.google.cn/reference/androidx/core/content/FileProvider" target="_blank" rel="noopener noreferrer"><code>FileProvider</code></a>çš„<code>authorities</code>ã€‚</p>
<p>è¦ä½¿ç”¨<code>FileProvider</code>å¯ä»¥å‚è€ƒ<a href="https://developer.android.google.cn/reference/androidx/core/content/FileProvider#ProviderDefinition" target="_blank" rel="noopener noreferrer">å®šä¹‰ FileProvider</a>æ“ä½œï¼Œä¸€èˆ¬åªéœ€è¦ä¿®æ”¹<code>authorities</code>å³å¯ï¼ŒåŒæ—¶å¦‚æœæ˜¯å¼€å‘ Android åº“ï¼Œä¸ºäº†é¿å…ä¸ä¸»å·¥ç¨‹å·²æœ‰çš„<code>FileProvider</code>å†²çªï¼Œå¯ä»¥ç»§æ‰¿<code>FileProvider</code>ç±»å¹¶ä¿®æ”¹ä¸‹æ–‡ä¸­<code>name</code>å­—æ®µã€‚</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ—¶ï¼Œä¸ºäº†å®šä¹‰æ­¤<code>FileProvider</code>å¯ä»¥ä½¿ç”¨çš„æ–‡ä»¶ç›®å½•èŒƒå›´ï¼Œå¯ä»¥åœ¨<code>res/xml</code>æ–‡ä»¶å¤¹ä¸­æ–°å»º<code>file_paths.xml</code>å¹¶åšå¦‚ä¸‹é…ç½®ï¼Œä¹Ÿå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–è€…<a href="https://www.jianshu.com/p/6192f04eca11" target="_blank" rel="noopener noreferrer">Android N 7.0 FileProvider å…¼å®¹é€‚é… åŸç†è§£æ</a>ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.<strong>å¯¹å¤–åˆ†äº«æœ‰æƒé™çš„ Uri</strong></p>
<p>å¯¹äºä¸Šè¿°æ­¥éª¤è·å–åˆ°çš„å›¾ç‰‡ Uri èµ‹äºˆæƒé™æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<p>ç¬¬ä¸€ç§ï¼Œé€šè¿‡<code>Intent</code>ä¼ é€’å‡ºå»çš„<code>imgUri</code>ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯è¿™ç§åªé€‚ç”¨äºä¸»åŠ¨åˆ†äº«å‡ºå»çš„æ–‡ä»¶ï¼Œåœ¨è°ƒç”¨ç¬¬ä¸‰æ–¹ APP è£å‰ªçš„åœºæ™¯ä¸­ï¼Œä¸€èˆ¬è¿˜éœ€è¦ä¸€ä¸ª<code>outPutUri</code>ç”¨äºä¿å­˜è£å‰ªä¹‹åçš„å›¾ç‰‡ï¼Œå¯¹äºè¿™ç§åœºæ™¯ï¼Œå¯ä»¥æŸ¥è¯¢å¯èƒ½ä¼šè°ƒç”¨çš„ APP å¹¶èµ‹äºˆå…¶è®¿é—®æƒé™ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ä¸ç®¡æ˜¯åˆ†äº«å‡ºå»çš„åŸå›¾ï¼Œè¿˜æ˜¯è£å‰ªä¹‹åä¿å­˜çš„å›¾ç‰‡éƒ½ç»™ç¬¬ä¸‰æ–¹ APP èµ‹äºˆäº†æƒé™ï¼Œä¿è¯å…¶å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</p>
<h2> å‚è€ƒæ–‡çŒ®</h2>
<p><a href="https://developer.android.google.cn/reference/androidx/core/content/FileProvider" target="_blank" rel="noopener noreferrer">https://developer.android.google.cn/reference/androidx/core/content/FileProvider</a></p>
<p><a href="https://www.jianshu.com/p/6192f04eca11" target="_blank" rel="noopener noreferrer">Android N 7.0 FileProvider å…¼å®¹é€‚é… åŸç†è§£æ</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android AlarmManager è®¾ç½®é‡å¤ä»»åŠ¡</title>
      <link>https://jixiaoyong.github.io/blog/posts/5754fcd2.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/5754fcd2.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android AlarmManager è®¾ç½®é‡å¤ä»»åŠ¡</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 06 Dec 2019 10:18:18 GMT</pubDate>
      <content:encoded><![CDATA[<p>è¿‘æœŸæœ‰ä¸€ä¸ªå®ç°å®šæ—¶å¯åŠ¨ APP æé†’ç”¨æˆ·çš„éœ€æ±‚ï¼Œä¸€ç•ªæ¯”è¾ƒä¹‹åè§‰å¾—ç”¨é—¹é’Ÿ<code>AlarmManager</code>å®ç°æ¯”è¾ƒåˆé€‚ï¼Œæœ¬æ–‡æ˜¯å¯¹æ­¤è¿‡ç¨‹çš„æ¢³ç†ï¼Œå±äºæ¯”è¾ƒåŸºç¡€æ€§çš„å†…å®¹ã€‚</p>
<h2> éœ€æ±‚</h2>
<p>éœ€æ±‚éœ€è¦å®ç°</p>
<blockquote>
<p>"æ¯å¤©åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…ï¼Œå¾ªç¯æç¤ºç”¨æˆ·ç›´åˆ°æ»¡è¶³æŒ‡å®šçš„æ¡ä»¶"</p>
</blockquote>
<p>æ‹†åˆ†éœ€æ±‚ï¼š</p>
<ol>
<li>æ¯å¤©éƒ½è¦æé†’</li>
<li>åœ¨æ—¶é—´èŒƒå›´å†…ä¸€ç›´å¾ªç¯</li>
<li>æ»¡è¶³æ¡ä»¶åç»“æŸå½“å¤©å¾ªç¯</li>
</ol>
<h2> æ–¹æ¡ˆé€‰æ‹©</h2>
<p>Android ä¸­å¯ä»¥ç”¨åˆ°çš„å¾ªç¯ä»»åŠ¡å®ç°æœ‰<code>Handler</code>ã€<code>Timer</code>ã€<code>ScheduledExecutorService</code>ï¼ˆè¿™ä¸‰ä¸ªå¯ä»¥çœ‹<a href="https://blog.csdn.net/qq_27489007/article/details/79220609" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ï¼‰ï¼Œè¿˜æœ‰æœ€è¿‘çš„<a href="https://developer.android.google.cn/topic/libraries/architecture/workmanager" target="_blank" rel="noopener noreferrer"><code>WorkManager</code></a>å’Œæˆ‘ä»¬è¦ç”¨åˆ°çš„<a href="https://developer.android.google.cn/training/scheduling/alarms" target="_blank" rel="noopener noreferrer"><code>AlarmManager</code></a>ã€‚</p>
<blockquote>
<p>WorkManager offers a backwards compatible (API level 14+) API leveraging <a href="https://developer.android.google.cn/reference/android/app/job/JobScheduler" target="_blank" rel="noopener noreferrer"><code>JobScheduler</code></a> API (API level 23+) and above to help optimize battery life and batch jobs and a combination of <a href="https://developer.android.google.cn/reference/android/app/AlarmManager" target="_blank" rel="noopener noreferrer"><code>AlarmManager</code></a> &amp; <a href="https://developer.android.google.cn/reference/android/app/BroadcastReceiver" target="_blank" rel="noopener noreferrer"><code>BroadcastReceiver</code></a> on lower devices.</p>
</blockquote>
<p>è¿™å‡ ä¸ªæ–¹æ¡ˆä¸­ï¼Œå‰ä¸‰è€…éƒ½éœ€è¦ APP åœ¨å‰å°è¿è¡Œï¼Œ<code>WorkManager</code>å’Œ<code>AlarmManager</code>åˆ™åœ¨ APP é€€å‡ºä¹‹åä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œç”šè‡³åœ¨ä½ç‰ˆæœ¬ä¸Š<code>WorkManager</code>åº•å±‚ä¹Ÿæ˜¯é€šè¿‡<code>AlarmManager</code>å®ç°çš„ã€‚</p>
<p><code>WorkManager</code>ä¸»è¦å€¾å‘äºä¿è¯ä»»åŠ¡åœ¨ APP é€€å‡ºï¼Œç”šè‡³è®¾å¤‡å…³æœºé‡å¯ç­‰æƒ…å†µä¸‹ä¹Ÿä¼šè¢«æ‰§è¡Œï¼Œè™½ç„¶ä¹Ÿæä¾›å¾ªç¯ä»»åŠ¡çš„ï¼Œä½†æ˜¯æ— æ³•ç¡®ä¿åœ¨ç²¾ç¡®çš„æ—¶é—´å¾—åˆ°æ‰§è¡Œï¼Œä¸”æœ€å°é—´éš” 15minã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>AlarmManager</code>å¯ä»¥ç¡®ä¿ä»»åŠ¡åœ¨æŒ‡å®šæ—¶é—´ï¼ˆç²¾ç¡®çš„æ—¶é—´ï¼‰å¾—åˆ°æ‰§è¡Œï¼Œå¹¶ä¸”å¯¹äºå¾ªç¯çš„é—´éš”ä¹Ÿæ›´åŠ çµæ´»ã€‚</p>
<figure><img src="https://developer.android.google.cn/images/guide/background/bg-job-choose.svg" alt="Android æ¨èé€‰æ‹©æ–¹æ¡ˆ" tabindex="0" loading="lazy"><figcaption>Android æ¨èé€‰æ‹©æ–¹æ¡ˆ</figcaption></figure>
<h2> åˆ†æ</h2>
<p>æ® Android å®˜ç½‘ä»‹ç»ï¼Œé—¹é’Ÿä¸»è¦ç”¨äºåœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸä¹‹å¤–è¿›è¡Œå®šæ—¶æ“ä½œã€‚</p>
<p>é—¹é’Ÿå…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<blockquote>
<ul>
<li>å®ƒä»¬å¯è®©æ‚¨æŒ‰è®¾å®šçš„æ—¶é—´å’Œ/æˆ–é—´éš”è§¦å‘ intentã€‚</li>
<li>æ‚¨å¯ä»¥å°†å®ƒä»¬ä¸å¹¿æ’­æ¥æ”¶å™¨ç»“åˆä½¿ç”¨ï¼Œä»¥å¯åŠ¨æœåŠ¡ä»¥åŠæ‰§è¡Œå…¶ä»–æ“ä½œã€‚</li>
<li>å®ƒä»¬åœ¨åº”ç”¨å¤–éƒ¨è¿è¡Œï¼Œå› æ­¤å³ä½¿åº”ç”¨æœªè¿è¡Œï¼Œæˆ–è®¾å¤‡æœ¬èº«å¤„äºä¼‘çœ çŠ¶æ€ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è§¦å‘äº‹ä»¶æˆ–æ“ä½œã€‚</li>
<li>å®ƒä»¬å¯ä»¥å¸®åŠ©æ‚¨æœ€å¤§é™åº¦åœ°é™ä½åº”ç”¨çš„èµ„æºè¦æ±‚ã€‚æ‚¨å¯ä»¥å®‰æ’å®šæœŸæ‰§è¡Œæ“ä½œï¼Œè€Œæ— éœ€ä¾èµ–å®šæ—¶å™¨æˆ–æŒç»­è¿è¡Œåå°æœåŠ¡ã€‚</li>
</ul>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒAndroid ä¸ºäº†é¿å…é‡å¤é—¹é’Ÿå¯èƒ½å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œæ¨èä½¿ç”¨ä¸æ˜¯å¾ˆç²¾ç¡®çš„<code>setInexactRepeating()</code>ï¼Œè€Œä¸æ˜¯ç²¾ç¡®çš„<code>setRepeating()</code>ï¼Œå¹¶ä¸”åœ¨<code>API19+</code>ä¹‹åçš„æ‰€æœ‰çš„é‡å¤é—¹é’Ÿéƒ½ä¸æ˜¯ç²¾ç¡®çš„ï¼Œå¦‚æœéœ€è¦ç²¾ç¡®é—¹é’Ÿéœ€è¦ä½¿ç”¨ <code>setWindow(int, long, long, android.app.PendingIntent)</code> æˆ–<code>setExact(int, long, android.app.PendingIntent)</code>ã€‚é‡å¤é—¹é’Ÿå…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<blockquote>
<ul>
<li>é—¹é’Ÿç±»å‹ã€‚è¦äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…<a href="https://developer.android.google.cn/training/scheduling/alarms#type" target="_blank" rel="noopener noreferrer">é€‰æ‹©é—¹é’Ÿç±»å‹</a>ã€‚</li>
<li>è§¦å‘æ—¶é—´ã€‚å¦‚æœæ‚¨æŒ‡å®šçš„è§¦å‘æ—¶é—´ä¸ºè¿‡å»çš„æ—¶é—´ï¼Œåˆ™é—¹é’Ÿä¼šç«‹å³è§¦å‘ã€‚</li>
<li>é—¹é’Ÿçš„é—´éš”ã€‚ä¾‹å¦‚ï¼Œæ¯å¤©ä¸€æ¬¡ã€æ¯å°æ—¶ä¸€æ¬¡ã€æ¯ 5 åˆ†é’Ÿä¸€æ¬¡ï¼Œç­‰ç­‰ã€‚</li>
<li>é—¹é’Ÿè§¦å‘çš„å¾…å®š intentã€‚å½“æ‚¨è®¾ç½®äº†ä½¿ç”¨åŒä¸€å¾…å®š intent çš„ç¬¬äºŒä¸ªé—¹é’Ÿæ—¶ï¼Œå®ƒä¼šæ›¿æ¢åŸå§‹é—¹é’Ÿã€‚</li>
</ul>
</blockquote>
<h3> é—¹é’Ÿç±»å‹</h3>
<p>é—¹é’Ÿæœ‰ä¸¤ä¸ªç±»å‹ï¼š</p>
<ol>
<li>
<p>è·ç¦»ç³»ç»Ÿå¯åŠ¨åçš„æ—¶é—´ï¼Œä¸»è¦ç”¨äºâ€œé—´éš”å¤šä¹…é‡å¤ä¸€æ¬¡â€è¿™æ ·çš„éœ€æ±‚</p>
<p><code>ELAPSED_REALTIME</code> è·ç¦»å¼€æœºæ—¶é—´å¤šä¹…åå¯ç”¨é—¹é’Ÿï¼Œå¦‚æœç³»ç»Ÿåœ¨ä¼‘çœ ä¸­åˆ™ä¸ä¼šå”¤é†’</p>
<p><code>ELAPSED_REALTIME_WAKEUP</code> åœ¨ç³»ç»Ÿä¼‘çœ æ—¶ä¹Ÿä¼šå”¤é†’ç³»ç»Ÿ</p>
</li>
<li>
<p>ç²¾ç¡®çš„æ—¶é—´ UTCï¼Œä¸»è¦ç”¨äºâ€œåœ¨å½“å¤©ä¸‹åˆ 8 ç‚¹æ•´å¼€å§‹â€ç­‰è¿™æ ·çš„éœ€æ±‚</p>
<p><code>RTC</code> åœ¨æŒ‡å®šçš„æ—¶é—´è§¦å‘é—¹é’Ÿï¼Œä¸ä¼šå”¤é†’æœºå™¨</p>
<p><code>RTC_WAKEUP</code> åœ¨æŒ‡å®šæ—¶é—´è§¦å‘é—¹é’Ÿï¼Œå¹¶ä¸”å”¤é†’è®¾å¤‡</p>
</li>
</ol>
<h3> è§¦å‘æ—¶é—´</h3>
<p>é—¹é’Ÿè§¦å‘çš„æ—¶é—´ï¼Œåˆ†ä¸ºä»è®¾å¤‡ä¸Šæ¬¡å¯åŠ¨æ—¶é—´å’Œç²¾å‡†æ—¶é—´ä¸¤ç§ã€‚</p>
<p>å¦‚æœè§¦å‘çš„æ—¶é—´æ—©äºå½“å‰ç³»ç»Ÿæ—¶é—´çš„è¯ï¼Œç³»ç»Ÿä¼šæ ¹æ®è¿‡å»çš„æ—¶é—´å’Œé‡å¤é—´éš”é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ—¶é—´æ¥è§¦å‘ï¼ˆæœ‰å‡ åˆ†é’Ÿå†…çš„è¯¯å·®ï¼‰ã€‚</p>
<p>ä»å®é™…è¿è¡Œæ¥çœ‹ï¼Œä½¿ç”¨<code>ELAPSED_*</code>çš„åŸºæœ¬ä¸Šä¼šç«‹å³ï¼ˆå‡ ç§’é’Ÿï¼‰è§¦å‘è¯¥é—¹é’Ÿï¼Œå¹¶ä¸”æ¯æ¬¡å¾ªç¯é—´éš”æœ‰å‡ æ¯«ç§’çš„è¯¯å·®ã€‚</p>
<p>ä½¿ç”¨<code>RTC_*</code>åˆ™ä¼šåœ¨åˆšå¼€å§‹çš„ä¸¤ä¸‰æ¬¡å‡ºç°é—´éš”æ—¶é—´å°äºæŒ‡å®šæ—¶é—´çš„æƒ…å†µï¼ŒåæœŸç¨³å®šï¼š</p>
<p>è®¾ç½®çš„é—¹é’Ÿé—´éš”ä¸º 10 åˆ†é’Ÿï¼Œé—¹é’Ÿå¼€å§‹æ—¶é—´æ—©äºå½“å‰æ—¶é—´ï¼Œå”¤é†’ç»“æœå¦‚ä¸‹</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> é—´éš”æ—¶é—´</h3>
<p>é—´éš”æ—¶é—´æœ‰ä¸¤ç§ï¼š</p>
<ol>
<li><code>AlarmManager interval</code> å¦‚æœè®¾ç½®çš„æ˜¯<code>setInexactRepeating()</code>ï¼Œåˆ™éœ€è¦è®¾ç½®<code>AlarmManager </code>æŒ‡å®šçš„å‡ ç§é—´éš”æ—¶é—´ã€‚</li>
<li>ä»»æ„æ—¶é—´ <code>setRepeating()</code>æ–¹æ³•å¯ä»¥ä½¿ç”¨ä»»æ„æ—¶é—´</li>
</ol>
<h3> å¾…å®šçš„ intent</h3>
<blockquote>
<p>å½“æ‚¨è®¾ç½®äº†ä½¿ç”¨åŒä¸€å¾…å®š intent çš„ç¬¬äºŒä¸ªé—¹é’Ÿæ—¶ï¼Œå®ƒä¼šæ›¿æ¢åŸå§‹é—¹é’Ÿ</p>
</blockquote>
<p>å¾…å®šçš„<code>Intent</code>æ˜¯ä¸€ä¸ª<code>PendingIntent</code>ï¼Œå¯ä»¥ç”¨æ¥æ‰“å¼€<code>Service</code>ï¼Œ<code>Activity</code>ï¼Œ<code>Broadcast</code>ç­‰ç­‰ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„è¿™é‡Œçš„<code>requestCode</code>ï¼Œå½“ä¸éœ€è¦è¯¥é—¹é’Ÿæ—¶å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥å–æ¶ˆã€‚</p>
<h3> å–æ¶ˆé—¹é’Ÿ</h3>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3> åœ¨é‡å¯æ—¶æ¢å¤é—¹é’Ÿ</h3>
<p>ç”±äºé—¹é’Ÿä¼šåœ¨è®¾å¤‡å…³æœºçš„æ—¶å€™è¢«å–æ¶ˆï¼Œæ‰€ä»¥éœ€è¦ç›‘å¬è®¾å¤‡å¼€æœºå¹¿æ’­ï¼ˆ<code>android.intent.action.BOOT_COMPLETED</code>ï¼‰ï¼Œå¹¶ä¸”æ¢å¤é—¹é’Ÿã€‚</p>
<h2> å…·ä½“å®ç°</h2>
<h3> è®¾ç½®ä¸€ä¸ªæ¯å¤©æŒ‡å®šæ—¶é—´å¾ªç¯çš„é—¹é’Ÿ</h3>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ¯å¤©æŒ‡å®šæ—¶é—´åˆ°äº†ä¹‹åï¼Œå¼€å§‹è®¾ç½®ä¸€ä¸ªé—´éš” 10 åˆ†é’Ÿå”¤é†’ä¸€æ¬¡çš„é—¹é’Ÿï¼Œç›´åˆ°è¶…æ—¶æˆ–è€…æ»¡è¶³æŒ‡å®šçš„æ¡ä»¶åå–æ¶ˆè¯¥é—¹é’Ÿã€‚</p>
<h3> ç›‘å¬æ¯æ—¥å¾ªç¯çš„é—¹é’Ÿ</h3>
<p>ç›‘å¬å…¶å‘é€çš„å¹¿æ’­<code>BROADCAST_ACTION_REPEAT</code>ã€‚</p>
<p>å¯ç”¨å½“æ—¥å¾ªç¯é—¹é’Ÿï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¹¿æ’­æ¥æ”¶å™¨ä¸­æ”¶å¬åˆ°<code>BROADCAST_ACTION_START</code>åå»å¼€å¯ä»»åŠ¡</p>
<h3> æ¡ä»¶æ»¡è¶³åå…³é—­å½“æ—¥å¾ªç¯é—¹é’Ÿ</h3>
<p>åœ¨æ”¶åˆ°<code>BROADCAST_ACTION_START</code>åæ£€æµ‹åˆ°å·²ç»è¶…æ—¶æˆ–å…¶ä»–æ»¡è¶³å–æ¶ˆæ¡ä»¶çš„æƒ…å†µï¼Œåˆ™å–æ¶ˆä»»åŠ¡ã€‚</p>
<p>æˆ–è€…å¯ä»¥å†è®¢ä¸€ä¸ªç»“æŸæ—¶é—´çš„é—¹é’Ÿï¼Œåˆ°æ—¶é—´åå–æ¶ˆå½“æ—¥å¾ªç¯é—¹é’Ÿã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„è¿™é‡Œçš„<code>pIntent</code>éœ€è¦ä¸è®¾ç½®é—¹é’Ÿæ—¶çš„<code>PendingIntent</code>ä¸€è‡´ (æ»¡è¶³<code>Intent.filterEquals()</code>çš„æ¡ä»¶)ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://blog.csdn.net/qq_27489007/article/details/79220609" target="_blank" rel="noopener noreferrer">Android å®šæ—¶ä»»åŠ¡åŠå¾ªç¯ä»»åŠ¡åŸºç¡€å¤§é›†åˆ</a></p>
<p><a href="https://developer.android.google.cn/training/scheduling/alarms" target="_blank" rel="noopener noreferrer">å®‰æ’é‡å¤é—¹é’Ÿ Android å®˜ç½‘</a></p>
]]></content:encoded>
      <enclosure url="https://developer.android.google.cn/images/guide/background/bg-job-choose.svg" type="image/svg+xml"/>
    </item>
    <item>
      <title>Android äº‹ä»¶åˆ†å‘</title>
      <link>https://jixiaoyong.github.io/blog/posts/c0fefed0.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/c0fefed0.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android äº‹ä»¶åˆ†å‘</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 24 Apr 2018 12:25:33 GMT</pubDate>
      <content:encoded><![CDATA[<p>Android äº‹ä»¶åˆ†å‘ï¼ŒæŒ‡æ‰‹æŒ‡ç‚¹å‡»å±å¹•åï¼Œä» Activityã€ViewGroup åˆ° View çš„ä¸€ç³»åˆ—è¿‡ç¨‹ã€‚</p>
<h2> ç®€ä»‹</h2>
<p>Android ç³»ç»Ÿçš„çª—å£æœºåˆ¶å¦‚ä¸‹å›¾ï¼š</p>
<p>Activity å†…æœ‰ä¸€ä¸ª Window å¯¹è±¡ï¼Œå…¶å®ç°ç±»æ˜¯ PhoneWindowï¼›</p>
<p>DecorView ä¸ºé¡¶å±‚ Viewï¼ŒDecorView æ˜¯ä¸€ä¸ª FrameLayoutï¼Œå…¶ä¸­æœ‰ TitleView å’Œ ContentViewï¼›</p>
<figure><img src="https://jixiaoyong.github.io/images/blog/2018-04/AndroidDispatchTouchEvent.png" alt="Android ç³»ç»Ÿçª—å£ç®¡ç†æœºåˆ¶" tabindex="0" loading="lazy"><figcaption>Android ç³»ç»Ÿçª—å£ç®¡ç†æœºåˆ¶</figcaption></figure>
<p>TitleView ä¸ºæ ‡é¢˜æ ï¼ŒContentView å°±æ˜¯å¹³æ—¶åœ¨ Activity çš„ onCreate() æ–¹æ³•ä¸­è®¾ç½®çš„è§†å›¾ï¼ŒTitleView å¯ä»¥ç”¨<code>this.requestWindowFeature(Window.FEATURE_NO_TITLE);</code>éšè—æ‰ï¼Œä½†æ˜¯å¿…é¡»æ³¨æ„è¦åœ¨ setContentView() ä¹‹å‰ï¼ŒåŸå› å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ç‚¹å‡»äº‹ä»¶ Activity --&gt; ViewGroup</h2>
<p>ç‚¹å‡»äº‹ä»¶å‘ç”Ÿåï¼Œé¦–å…ˆè¢«è°ƒç”¨çš„æ˜¯<code>Activity.dispatchTouchEvent()</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å†…éƒ¨å…ˆè°ƒç”¨äº†<code>getWindow().superDispatchTouchEvent(ev)</code>è¿™ä¸ªæ–¹æ³•ï¼ŒgetWindow() è¿”å›çš„ mWindow æ˜¯ PhoneWindow çš„å¯¹è±¡ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å†çœ‹çœ‹ PhoneWindow.superDispatchTouchEvent() æ–¹æ³•ï¼Œæ˜¾ç„¶åˆè°ƒç”¨äº† DecorView çš„ superDispatchTouchEvent() æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº† FrameLayout.dispatchKeyEvent(event)ï¼Œæ­¤æ—¶<strong>ç‚¹å‡»äº‹ä»¶ä» Activity è½¬åˆ°äº† ViewGroup ä¸­</strong>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ç‚¹å‡»äº‹ä»¶ ViewGroup --&gt; View</h2>
<p>ViewGroup ä¸äº‹ä»¶åˆ†å‘çš„æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š</p>
<ul>
<li><code>dispatchTouchEvent()</code> åˆ†å‘äº‹ä»¶ï¼Œæ¯æ¬¡éƒ½ä¼šè¢«è°ƒç”¨</li>
<li><code>onInterceptTouchEvent()</code> æ‹¦æˆªäº‹ä»¶ï¼Œå¦‚æœå½“å‰ ViewGroup å·²ç»å†³å®šæ‹¦æˆªäº‹ä»¶ï¼Œé‚£ä¹ˆä¸ä¼šå†è°ƒç”¨</li>
<li><code>onTouchEvent()</code> å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œå¦‚æœè®¾ç½®äº†<code>mOnTouchListener</code>çš„è¯ï¼Œåˆ™ä¸ä¼šå›è°ƒæœ¬æ–¹æ³•</li>
</ul>
<p>è¿™ä¸‰ä¸ªä¸»è¦æ–¹æ³•å…³ç³»å¦‚ä¸‹ï¼ˆä¼ªä»£ç ï¼Œæ¥è‡ªã€ŠAndroid å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ï¼‰ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ ViewGroup.dispatchTouchEvent() è¢«è°ƒç”¨åï¼Œä¼šé€šè¿‡ä¸€ç³»åˆ—æ¡ä»¶åˆ¤æ–­æ˜¯ç”± ViewGroup æ‹¦æˆªè¯¥äº‹ä»¶ï¼Œè¿˜æ˜¯ç”±å­ View æ¶ˆè€—è¯¥äº‹ä»¶ã€‚</p>
<p>ä¸»è¦æµç¨‹åˆ†ä¸ºä¸¤éƒ¨åˆ†</p>
<p><strong>1.æ£€æŸ¥æ˜¯å¦éœ€è¦æ‹¦æˆª</strong></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>æ¯æ¬¡ ACTION_DOWN äº‹ä»¶éƒ½éœ€è¦è°ƒç”¨<code>onInterceptTouchEvent()</code>æ–¹æ³•åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆª</li>
<li>å…¶ä»– MotionEvent äº‹ä»¶ï¼Œå¦‚æœæœ‰èƒ½å¤„ç†ç‚¹å‡»äº‹ä»¶çš„å­ Viewï¼ˆ<code>mFirstTouchTarget != null</code>ï¼‰ä¸”<code>disallowIntercept</code>ä¸º false ä¹Ÿéœ€è¦è°ƒç”¨<code>onInterceptTouchEvent()</code>æ–¹æ³•åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªï¼Œå¦åˆ™ä¸éœ€è¦æ‹¦æˆª</li>
<li>å…¶ä½™æƒ…å†µéƒ½éœ€è¦æ‹¦æˆªï¼ˆæ²¡æœ‰å¯ä»¥å¤„ç†ç‚¹å‡»äº‹ä»¶çš„å­ Viewï¼Œå¹¶ä¸”ä¸æ˜¯ ACTION_DOWN äº‹ä»¶ï¼‰</li>
</ul>
<p>å¦‚æœ ViewGroup åˆ¤æ–­è¦æ‹¦æˆªè¯¥äº‹ä»¶ï¼Œåˆ™ä¼šè°ƒç”¨<code>dispatchTransformedTouchEvent()</code>ï¼ˆåé¢ä¼šå†è®²åˆ°ï¼‰é€šè¿‡ä»–è°ƒç”¨ç»§æ‰¿è‡ª View çš„<code>dispatchTouchEvent(MotionEvent event)</code>æ–¹æ³•ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦åˆ™å°±éœ€è¦éå†å…¶å­ View</p>
<p><strong>2.éå† ViewGroup çš„æ‰€æœ‰å­ Viewï¼Œå¯»æ‰¾ä¸€ä¸ªå¯ä»¥å¤„ç†ç‚¹å‡»äº‹ä»¶çš„å­ View</strong></p>
<ul>
<li><code>dispatchTransformedTouchEvent()</code> è°ƒç”¨äº†å­ View çš„<code>dispatchTouchEvent()</code></li>
<li><code>addTouchTarget()</code> å¯¹<code>mFirstTouchTarget </code>è¿›è¡Œæ›´æ–°</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>dispatchTransformedTouchEvent() æ–¹æ³•å¦‚ä¸‹ï¼Œç”±äº<code>child != null</code>å…¶å†…éƒ¨è°ƒç”¨<code>child.dispatchTouchEvent(event)</code>æ–¹æ³•ï¼Œå¦‚æ­¤å¾ªç¯ç›´åˆ°å­ View æ˜¯ä¸€ä¸ª Viewï¼ˆå•å°± ViewGroup å’Œ View è€Œè®ºï¼‰å³<strong>å°†ç‚¹å‡»äº‹ä»¶ä» ViewGroup åˆ†å‘åˆ°äº† View</strong>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæœ‰å­ View å¯ä»¥å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œåœ¨<code>addTouchTarget()</code>æ–¹æ³•å†…éƒ¨å¯¹<code>mFirstTouchTarget</code>è¿›è¡Œæ›´æ–°</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ç‚¹å‡»äº‹ä»¶ View å†…éƒ¨</h2>
<p>View çš„ç‚¹å‡»äº‹ä»¶åˆ†å‘ä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>dispatchTouchEvent()</code></li>
<li><code>onTouchEvent()</code></li>
</ul>
<p>å…¶ç‚¹å‡»äº‹ä»¶åˆ†å‘ç”¨ä¼ªä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ View çš„ dispatchTouchEvent() æ–¹æ³•ä¸­ï¼Œå¦‚æœ View æ³¨å†Œäº† OnTouchListener åˆ™ä¼šå…ˆæ‰§è¡Œ<code>mOnTouchListener.onTouch()</code>æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å› false æ‰ä¼šæ‰§è¡Œ<code>onTouchEvent()</code>ã€‚</p>
<p>åœ¨çœ‹ onTouchEvent() æ–¹æ³•ï¼š</p>
<ul>
<li>å¦‚æœ View å¤„äº<strong>ä¸å¯ç”¨çŠ¶æ€</strong>ä¸‹ï¼Œä¹Ÿä¼šæ¶ˆè€—ç‚¹å‡»äº‹ä»¶ï¼Œåªä¸è¿‡æ²¡æœ‰ååº”</li>
<li>å¦‚æœæ³¨å†Œäº† OnClickListener ä¼šåœ¨ ACTION_UP çš„æ—¶å€™è°ƒç”¨<code>mOnClickListener.onClick(this)</code></li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æ€»ç»“</h2>
<p>æ•´ä¸ª Android çš„æ—¶é—´åˆ†å‘å§‹äº Activityï¼Œç»è¿‡ PhoneWindowã€DecorView åˆ°è¾¾ ViewGroupï¼Œå†é€å±‚åˆ†å‘åˆ° View ä¸­ã€‚</p>
<p>å¦‚æœåº•å±‚æ²¡æœ‰å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œåˆ™åˆä¸€å±‚å±‚å‘ä¸Šè¿”å›ï¼Œç›´åˆ°æœ€é¡¶å±‚æ¶ˆè€—æ‰ç‚¹å‡»äº‹ä»¶ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p>ã€ŠAndroid å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹</p>
<p><a href="http://androidxref.com" target="_blank" rel="noopener noreferrer">Android æºä»£ç </a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/blog/2018-04/AndroidDispatchTouchEvent.png" type="image/png"/>
    </item>
    <item>
      <title>Android 5.x ä»¥ä¸‹åŠ è½½ MultiDex ç™½å±çš„å¤„ç†ä¼˜åŒ–</title>
      <link>https://jixiaoyong.github.io/blog/posts/caa169b7.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/caa169b7.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android 5.x ä»¥ä¸‹åŠ è½½ MultiDex ç™½å±çš„å¤„ç†ä¼˜åŒ–</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 10 Aug 2019 03:39:00 GMT</pubDate>
      <content:encoded><![CDATA[<p>å½“ APP çš„ minSdkVersion ä½äº Android 5 æ—¶ï¼Œåœ¨æ–¹æ³•æ•°å¤§äº 65536 æ—¶ï¼Œéœ€è¦å°† APP æ‰“åŒ…ä¸ºå¤šä¸ª DEX æ–‡ä»¶ï¼Œæ­¤æ—¶éœ€è¦æ·»åŠ  MultiDex ä¾èµ–ã€‚</p>
<p>å®˜æ–¹æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p>1.<code>build.gradle</code></p>
<div class="language-groovy line-numbers-mode" data-ext="groovy"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.<code>MyApplication</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼Œä¸ºäº†é¿å…ä¸€äº›å¯åŠ¨æœŸé—´éœ€è¦çš„ä»»ä½•ç±»æœªåœ¨ä¸» DEX æ–‡ä»¶ä¸­æä¾›è€Œå¯¼è‡´<code>java.lang.NoClassDefFoundError</code>ï¼Œè¿˜éœ€è¦å‘Šè¯‰ AS å°†è¿™äº›ç±»æ·»åŠ åˆ°ä¸» DEX æ–‡ä»¶ä¸­ï¼š</p>
<p>3.<code>build.gradle</code></p>
<div class="language-groovy line-numbers-mode" data-ext="groovy"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯åœ¨å®é™…è¿è¡Œä¸­ï¼ŒAndroid 4.x çš„ç³»ç»Ÿä¼šåœ¨ APP å®‰è£…åç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œåœ¨<code>MultiDex.install(this)</code>æ–¹æ³•ä¸­è¿›è¡Œ DEX æ–‡ä»¶åˆå¹¶ä¼˜åŒ–ç­‰è€—æ—¶æ“ä½œï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œå¾€å¾€ä¼šæŒç»­æ•°åç§’ä»¥ä¸Šï¼Œä»è€Œå¯¼è‡´ APP ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶é•¿æ—¶é—´ç™½å±ï¼Œååˆ†å½±å“ä½“éªŒã€‚</p>
<p>æŸ¥é˜…ç›¸åº”çš„èµ„æ–™åå¤§ä½“æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆ</p>
<ol>
<li>
<p>è®¾ç½®ä¸» Activity çš„èƒŒæ™¯ä¸ºé€æ˜è‰²</p>
<p>è¿™æ ·å½“ç”¨æˆ·ç‚¹å‡» APP å›¾æ ‡å¯åŠ¨ APP æ—¶ï¼Œåœ¨ä¸» Activity å¯åŠ¨ä¹‹å‰çœ‹åˆ°çš„ä¸€ç›´æ˜¯æ¡Œé¢çš„æ ·å­è€Œéç™½å±ï¼Œä½†è¿™åªæ˜¯ä¸€ç§éšœçœ¼æ³•ï¼Œç”¨æˆ·å¯èƒ½ä¼šä»¥ä¸ºç³»ç»Ÿå¡é¡¿ï¼Œä½“éªŒå¹¶ä¸å¥½ã€‚</p>
</li>
<li>
<p>åœ¨ Application ä¸­æ£€æµ‹åˆ°æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨çš„è¯ï¼Œæ–°å¼€ä¸€ä¸ªè¿›ç¨‹å¹¶åœ¨å…¶ä¸­è¿›è¡Œ<code>MultiDex.install(this)</code></p>
<p>è¿™ç§æ–¹æ³•åœ¨ä¸»è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œæ£€æµ‹åˆ°å°šæœªè¿›è¡Œ MultidexOptï¼Œåˆ™é˜»å¡å½“å‰è¿›ç¨‹ï¼Œæ–°å¼€ä¸€ä¸ªè¿›ç¨‹ï¼Œåœ¨å…¶ä¸­åŠ è½½ä¸€ä¸ª Activityï¼Œå¹¶åœ¨åå°è¿›ç¨‹è¿è¡Œ<code>MultiDex.install(this)</code>ï¼Œå½“ MultidexOpt å®Œæˆåå†å…³é—­å½“å‰è¿›ç¨‹ï¼Œè¿”å›ä¸»è¿›ç¨‹ç»§ç»­æ­£å¸¸å¼€å¯ APPã€‚</p>
<p>ç”±äºä¸»è¿›ç¨‹è¢«é˜»å¡çš„åŒæ—¶æˆä¸ºäº†åå°è¿›ç¨‹ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šè§¦å‘ ANRï¼Œæ­¤å¤–å­è¿›ç¨‹ä¸­çš„è¿‡æ¸¡ Activity ä¹Ÿåªç”¨åˆ°äº†åŸºæœ¬çš„ç±»ï¼Œæ‰€ä»¥åŸºæœ¬ä¸ç”¨æ‹…å¿ƒä¼šè§¦å‘<code>java.lang.NoClassDefFoundError</code>ï¼Œè€Œä¸”è¿‡æ¸¡ Activity å¯ä»¥å±•ç¤ºè¿›åº¦ã€æç¤ºç­‰ç”¨æˆ·å‹å¥½çš„é¡µé¢ï¼Œç›¸å¯¹æ¥è¯´ä½“éªŒä¹Ÿå¥½äº†å¾ˆå¤šã€‚</p>
</li>
</ol>
<p>ä½†æ˜¯è¿™ç§æ–¹æ³•ä»å­è¿›ç¨‹è¿”å›ä¸»è¿›ç¨‹æ¶‰åŠåˆ°è¿›ç¨‹é—´é€šä¿¡ï¼Œä»¥åŠä¸»è¿›ç¨‹çš„ä¸» Activity å¯åŠ¨æ—¶ç”Ÿå‘½å‘¨æœŸä¼šå‡ºç°å¼‚å¸¸ (å¼‚å¸¸ (<code>onCreate()</code> -&gt; <code>onStart()</code> -&gt; <code>onResume()</code> -&gt; <code>onPause()</code>-&gt;<code>onResume()</code>)ï¼Œä»ç„¶ä¸æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹æ³•ã€‚</p>
<p>ç»“åˆä¸Šè¿°çš„åˆ†æåï¼Œå¯ä»¥çœ‹åˆ°è¿™ç§é—®é¢˜çš„ä¼˜åŒ–æ€è·¯ä¸»è¦åœ¨äºå¦‚ä½•åœ¨é¿å…<code>java.lang.NoClassDefFoundError</code>çš„åŒæ—¶ï¼Œåœ¨åå°å¯é çš„é€šè¿‡<code>MultiDex.install(this)</code>æ‰§è¡Œ MultidexOpt æ“ä½œã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šæ–¹æ¡ˆ 1 å’Œ 2 çš„ç»“åˆï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæ¯”è¾ƒå®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>æ–¹æ¡ˆ 2 ä¸­åœ¨è¿‡æ¸¡ Activity çš„åå°çº¿ç¨‹è¿›è¡Œ MultidexOpt æ“ä½œæ€è·¯æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯ä¸éœ€è¦å†å•ç‹¬å¼€ä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å°†å…¶å½“åšä¸»è¿›ç¨‹çš„ç¬¬ä¸€ä¸ª Activityï¼Œç­‰å¾… MultidexOpt æ“ä½œå®Œæˆåå†è·³è½¬åˆ°ä¸» Activity å¹¶ finish æ‰æœ¬ Activityï¼Œè¿™æ ·ä¸» Activity çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿä¸ä¼šå—å½±å“ã€‚</li>
<li>è¿™ç§æƒ…å†µä¸‹åœ¨éƒ¨åˆ†ä½ç«¯æœºä¸Šï¼Œè¿‡æ¸¡ Activity åˆ°ä¸» Activity è·³è½¬æ—¶ä¼šå‡ºç°çŸ­æš‚é»‘å±ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿‡æ¸¡é¡µé¢å°† Activity åˆ‡æ¢åŠ¨ç”»è®¾ç½®ä¸ºæ¸å˜æ•ˆæœï¼Œå¹¶å°†ä¸» Activity èƒŒæ™¯è®¾ç½®ä¸ºé€æ˜ï¼Œå¾…ä¸» Activity å®Œå…¨åŠ è½½å¥½åå†å°†èƒŒæ™¯åˆ‡æ¢ä¸ºæ™®é€šæ¨¡å¼ã€‚</li>
</ol>
<p>ç»¼ä¸Šå¤„ç†ï¼Œæˆ‘ä»¬çš„ Application æ— éœ€æ”¹åŠ¨ï¼Œç”šè‡³ä¸» Activity ä¹Ÿå¯ä»¥ä¸åšæ”¹åŠ¨ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ªè¿‡æ¸¡é¡µé¢ä¸ºå¯åŠ¨ Activityï¼Œåœ¨å…¶ä¸­åå°è¿›è¡Œ MultidexOptï¼Œç­‰ DEX æ–‡ä»¶å¤„ç†å®Œæ¯•åå†åŠ è½½ä¸» Activityã€‚å¯¹é¡¹ç›®æ”¹åŠ¨å°‘å¹¶ä¸”é€»è¾‘è¾ƒä¸ºç®€å•ã€‚</p>
<p>æ³¨ï¼š</p>
<ol>
<li>MultiDexOpt å³æ‰§è¡Œ<code>MultiDex.install(getApplication());</code>æ–¹æ³•ï¼›</li>
<li>éœ€è¦æ³¨æ„è¿‡æ¸¡ Activity å°½é‡å°‘çš„ä½¿ç”¨ç±»ï¼Œå¹¶ä¸”è¦ç¡®ä¿è¿‡æ¸¡ Activity å¯èƒ½ä¼šè°ƒç”¨åˆ°çš„ç±»åŠ è½½åˆ°äº†ä¸» dex æ–‡ä»¶ä¸­ã€‚</li>
</ol>
<h2> å‚è€ƒæ–‡æ¡£</h2>
<p><a href="https://developer.android.google.cn/studio/build/multidex.html?hl=zh-CN" target="_blank" rel="noopener noreferrer">é…ç½®æ–¹æ³•æ•°è¶…è¿‡ 64K çš„åº”ç”¨</a></p>
<p><a href="https://www.jianshu.com/p/c2d7b76ff063" target="_blank" rel="noopener noreferrer">Android MultiDex åˆæ¬¡å¯åŠ¨ APP ä¼˜åŒ–æ–¹æ¡ˆä¼˜é›…çš„å®ç°</a></p>
<p><a href="https://www.zybuluo.com/946898963/note/1219741" target="_blank" rel="noopener noreferrer">MultiDex æ·±å…¥å­¦ä¹ </a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android paint ç»˜åˆ¶ text</title>
      <link>https://jixiaoyong.github.io/blog/posts/e5860bb5.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/e5860bb5.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android paint ç»˜åˆ¶ text</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 07 Apr 2020 14:05:20 GMT</pubDate>
      <content:encoded><![CDATA[<p>Android ä¸­ç»˜åˆ¶æ–‡å­—çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<code>y</code>æ˜¯<strong>æ–‡å­— baseline çš„ y åæ ‡</strong>ã€‚</p>
<p>ä¸‹å›¾è¡¨ç¤º<code>Paint.FontMetrics</code>ä¸­å­˜å‚¨çš„æ–‡å­—çš„å„ç§ä¿¡æ¯ï¼ˆæ¥æºï¼š<a href="https://www.jianshu.com/p/c1575636741e" target="_blank" rel="noopener noreferrer">ç®€ä¹¦</a>ï¼‰ï¼š<br>
<img src="https://jixiaoyong.github.io/images/20200407220410.png" alt="" loading="lazy"></p>
<p>æˆ‘ä»¬æ²¡æ³•ç›´æ¥è·å–åˆ°<code>baselineçš„åæ ‡</code>ï¼Œæ‰€ä»¥åªèƒ½ä»å¦å¤–ä¸€ä¸ªè§’åº¦è€ƒè™‘ï¼š<br>
å› ä¸ºåœ¨ç»˜åˆ¶æ–‡å­—æ—¶ï¼Œæ–‡å­—çš„ä¸Šä¸‹ä¸­å¿ƒï¼ˆå³ä¸Šå›¾ä¸­çš„<code>center</code>ï¼‰æ˜¯ç¡®å®šçš„ï¼Œæˆ‘ä»¬åªè¦è®¡ç®—å‡º<code>center</code>åˆ°<code>baseline</code>ä¹‹é—´çš„åç§»é‡ï¼Œå°±å¯ä»¥è®¡ç®—å‡º<code>baselineçš„yåæ ‡</code>ã€‚</p>
<p>åˆæ ¹æ®è¿™ä¸ª<a href="http://www.imooc.com/article/277490?block_id=tuijian_wz" target="_blank" rel="noopener noreferrer">æ–‡ç« </a>ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p><code>(descent + ascent) / 2</code>æ˜¯ä¸­çº¿ center çš„å€¼ï¼Œè€Œæ ¹æ®ä¸Šå›¾å¯çŸ¥<code>(descent + ascent) / 2 - descent</code>çš„å€¼å°±æ˜¯ baseline åˆ° center çš„è·ç¦»ã€‚</p>
</blockquote>
<p>æ‰€ä»¥</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>è¿™ä¸ª<code>center.y</code>æ ¹æ®åœºæ™¯ä¸åŒå¯ä»¥æ˜¯ä¸€è¡Œçš„è¡Œä¸­å¿ƒï¼ˆæ–‡å­—åœ¨ä¸€è¡Œå±…ä¸­æ˜¾ç¤ºï¼‰ï¼Œæˆ–è€…æ§ä»¶çš„ä¸Šä¸‹ä¸­å¿ƒï¼ˆæ–‡å­—åœ¨æ§ä»¶ä¸Šä¸‹å±…ä¸­ï¼‰</p>
</blockquote>
<p>å¾—å‡ºç»“è®ºï¼š</p>
<p>ç”±äº android ç»˜åˆ¶æ–‡å­—æ—¶ï¼Œ<strong>å¹¶ä¸æ˜¯ä»æ–‡å­—é«˜åº¦çš„ä¸­é—´å¼€å§‹ç»˜åˆ¶ï¼Œè€Œæ˜¯ä» baseline å¼€å§‹ç»˜åˆ¶</strong>ã€‚æ‰€ä»¥åœ¨ç»˜åˆ¶æ–‡å­—æ—¶ï¼Œä¸ºäº†ä½¿æ–‡å­—é«˜åº¦å±…ä¸­ï¼ˆåœ¨æ‰€æŒ‡å®šçš„ç©ºé—´å†…å±…ä¸­ï¼Œæ¯”å¦‚æŸä¸€è¡Œï¼Œå°±åœ¨è¯¥è¡Œé™å®šçš„é«˜åº¦å†…å±…ä¸­æ˜¾ç¤ºï¼›æŸä¸€æ§ä»¶ï¼Œåˆ™æ•´ä¸ªæ§ä»¶çš„ä¸Šä¸‹ä¸­é—´æ˜¾ç¤ºï¼‰ï¼Œéœ€è¦åœ¨è®¡ç®—å‡ºæ¥çš„<strong>æ–‡å­—ä¸Šä¸‹ä¸­å¿ƒçš„ y åæ ‡åŸºç¡€ä¸ŠåŠ ä¸Š baseline åˆ°æ–‡å­—ä¸­çº¿çš„åç§»é‡</strong>ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ç±»æ¯”å¾—åˆ°ï¼š<code>baseline.y = center.y + (bottom.y - top.y) / 2 - bottom.y</code></p>
<blockquote>
<p>åŸºçº¿ï¼ˆbaeselineï¼‰ï¼Œå¡é¡¶ï¼ˆascenterï¼‰,å¡åº•ï¼ˆdescenterï¼‰</p>
<p>ä¸Šå¡åº¦ï¼ˆascentï¼‰ï¼Œä¸‹å¡åº¦ï¼ˆdescentï¼‰</p>
<p>è¡Œé—´è·ï¼ˆleadingï¼‰ï¼šå¡åº•åˆ°ä¸‹ä¸€è¡Œå¡é¡¶çš„è·ç¦»</p>
<p>å­—ä½“çš„é«˜åº¦ï¼ä¸Šå¡åº¦ï¼‹ä¸‹å¡åº¦ï¼‹è¡Œé—´è·</p>
<p><a href="https://blog.csdn.net/hanyongbai/article/details/84418369" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/hanyongbai/article/details/84418369</a></p>
</blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<br>
<a href="https://www.jianshu.com/p/c1575636741e" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/c1575636741e</a><br>
<a href="https://blog.csdn.net/hanyongbai/article/details/84418369" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/hanyongbai/article/details/84418369</a><br>
<a href="http://www.imooc.com/article/277490?block_id=tuijian_wz" target="_blank" rel="noopener noreferrer">http://www.imooc.com/article/277490?block_id=tuijian_wz</a><br>
<a href="https://blog.csdn.net/xuxingxing002/article/details/50971606" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/xuxingxing002/article/details/50971606</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20200407220410.png" type="image/png"/>
    </item>
    <item>
      <title>AndroidService ç›¸å…³çŸ¥è¯†</title>
      <link>https://jixiaoyong.github.io/blog/posts/ad4c562c.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/ad4c562c.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">AndroidService ç›¸å…³çŸ¥è¯†</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 13 Jan 2018 17:10:01 GMT</pubDate>
      <content:encoded><![CDATA[<h3> å¯åŠ¨ä¸€ä¸ª Service</h3>
<ul>
<li>
<p>MyServices.java</p>
<p>å¿…é¡»ç»§æ‰¿è‡ª Serviceï¼Œæˆ–è€…å¦‚ IntentService æœ¬èº«å°±æ˜¯ç­‰å…¶å­ç±»</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>AndroidManifest.xml</p>
<p>æ³¨å†Œ MyServices</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>MainActivity.java</p>
<p>åœ¨ java ä¸­è°ƒç”¨ Serviceï¼Œéœ€è¦<code>ServiceConnection</code>ç±»</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>bindService()</code>å’Œ<code>startService()</code>çš„åŒºåˆ«åœ¨äºï¼š</p>
<p>** <code>bindService()</code>å°† service å’Œå½“å‰çš„ activity ç»‘å®šåœ¨ä¸€èµ·ï¼Œactivity é”€æ¯æ—¶ï¼Œservice ä¹Ÿä¼šè¢«é”€æ¯ï¼›</p>
<p>** <code>startService()</code>åˆ™åªæ˜¯â€œå¯åŠ¨â€serviceï¼Œåœ¨æ­¤å service çš„æ´»åŠ¨å’Œ activity æ— å…³ï¼Œå¹¶ä¸€ç›´å­˜æ´»ã€‚</p>
</li>
</ul>
<h2> Service å…·ä½“åˆ†æ</h2>
<p>Service åœ¨ AndroidManifest.xml ä¸­çš„å±æ€§ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service é»˜è®¤è¿è¡Œåœ¨åˆ›å»ºä»–çš„çº¿ç¨‹ä¸­ï¼Œè¦æ˜¯è¿›è¡Œè€—æ—¶æ“ä½œï¼Œæœ€å¥½åœ¨ service ä¸­å•ç‹¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å­å¯ä»¥åœ¨å­çº¿ç¨‹å·¥ä½œï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°å·¥ä½œè¿›åº¦ã€‚</p>
<p>Service ä¸­çš„æ–¹æ³•ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<code>onStartCommand()</code>æ–¹æ³•çš„è¿”å›å€¼æ„ä¹‰å¦‚ä¸‹ï¼š</p>
<p><code>START_STICKY </code>:service åœ¨å†…å­˜ä¸è¶³è¢«æ€æ­»åï¼Œå†…å­˜ç©ºé—²æ—¶ç³»ç»Ÿä¼šé‡æ–°åˆ›å»º serviceï¼Œä¸€æ—¦æˆåŠŸåˆ›å»ºä¼šå›è°ƒ<code>onStartCommand()</code>æ–¹æ³•ï¼Œæ­¤æ—¶ intent æ˜¯ nullï¼Œé™¤éæ˜¯æŒ‚èµ·çš„ intent å¦‚ pendingintentï¼Œæ— é™æœŸè¿è¡Œ</p>
<p><code>START_NOT_STICKY</code>ï¼šservice å› å†…å­˜ä¸è¶³è¢«æ€æ­»ï¼Œå†…å­˜å†æ¬¡ç©ºé—²ç³»ç»Ÿä¹Ÿä¸ä¼šå†é‡æ–°åˆ›å»ºæœåŠ¡ï¼Œæœ€å®‰å…¨</p>
<p><code>START_REDELIVER_INTENT</code>ï¼šservice å› å†…å­˜ä¸è¶³è¢«æ€æ­»ï¼Œä¼šé‡å»ºæœåŠ¡å¹¶ä¼ é€’ç»™æœ€åä¸€ä¸ª intentï¼ˆæœ€åä¸€æ¬¡è°ƒç”¨<code>startService()</code> æ—¶çš„ intentï¼‰ï¼Œç”¨äºè¿ç»­ä½œä¸šï¼Œå¦‚ä¸‹è½½ç­‰</p>
<h3> Service ç»‘å®šæœåŠ¡çš„ä¸‰ç§æ–¹å¼</h3>
<h4> 1.æ‹“å±• Binder ç±»</h4>
<p><strong>è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡åœ¨åŒä¸€åº”ç”¨çš„åŒä¸€è¿›ç¨‹å†…</strong>ã€‚å®¢æˆ·ç«¯é€šè¿‡å…¶è®¿é—® service ä¸­çš„å…¬å…±æ–¹æ³•ã€‚</p>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»º BindService æœåŠ¡ç«¯ï¼Œåœ¨ç±»ä¸­åˆ›å»ºä¸€ä¸ªå®ç°äº† IBinder æ¥å£çš„å®åŠ›å¯¹è±¡å¹¶æä¾›å…¬å…±æ–¹æ³•ç»™å®¢æˆ·ç«¯ä½¿ç”¨</li>
<li>åœ¨ onBind() å›è°ƒæ–¹æ³•è¿”å›æ­¤ Binder å®ä¾‹</li>
<li>åœ¨å®¢æˆ·ç«¯çš„ onServiceConnected() æ–¹æ³•æ¥æ”¶ Binderï¼Œä½¿ç”¨æä¾›çš„æ–¹æ³•ç»‘å®šæœåŠ¡</li>
</ol>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> 2.Messenger</h4>
<p><strong>service ä¸ä¸åŒè¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰</strong> ã€‚</p>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>Service å®ç°ä¸€ä¸ª Handlerï¼Œæ¥æ”¶å®¢æˆ·ç«¯æ¯ä¸ªè°ƒç”¨çš„å›è°ƒ</li>
<li>ç”¨ Handler åˆ›å»º Messenger å¯¹è±¡</li>
<li>ç”¨ Messenger åˆ›å»º IBinder å¯¹è±¡ï¼Œå¹¶é€šè¿‡ onBind() è¿”å›å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯ä½¿ç”¨ IBinder å®ä¾‹åŒ– Messengerï¼Œç”¨å…¶å°† Message å¯¹è±¡å‘é€ç»™ Service</li>
<li>Service åœ¨ Handler æ¥æ”¶å¹¶å¤„ç† Message</li>
</ol>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ service è¦åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æœåŠ¡ä¸å®¢æˆ·ç«¯åŒå‘é€šä¿¡</strong></p>
<p>æœåŠ¡ç«¯ï¼Œä¿®æ”¹ IncomingHandlerï¼Œå›å¤å®¢æˆ·ç«¯æ¶ˆæ¯</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯ï¼Œå¢åŠ  Messenger å’Œ Handler å¤„ç†æœåŠ¡ç«¯å›å¤</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼Œåœ¨å‘é€æ¶ˆæ¯æ˜¯éœ€è¦å°†æ¥æ”¶æœåŠ¡ç«¯å›å¤çš„ Messenger é€šè¿‡ Message çš„ replyTo ä¼ é€’ç»™æœåŠ¡ç«¯</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> 3.AIDL</h4>
<p>ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒ<a href="https://jixiaoyong.github.io/blog/posts/f931e8ae/" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç« </a></p>
<h2> ç»‘å®šæœåŠ¡æ—¶çš„æ³¨æ„äº‹é¡¹</h2>
<ul>
<li>å¤šä¸ªå®¢æˆ·ç«¯å¯è¿æ¥ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯ç»‘å®šæ—¶æ‰ä¼šè°ƒç”¨æœåŠ¡<code>onBind()</code>æ–¹æ³•æ¥æ£€ç´¢ IBinderï¼Œæ­¤åæ— éœ€è°ƒç”¨å°±å¯å°†åŒä¸€ä¸ª IBinder ä¼ é€’ç»™å…¶ä»–å®¢æˆ·ç«¯</li>
<li><code>bindService()</code> ç»‘å®šæœåŠ¡æ˜¯å¼‚æ­¥è¿›è¡Œçš„</li>
<li>ä¸€èˆ¬åœ¨ activity å¯è§ç”Ÿå‘½å‘¨æœŸå†…ç»‘å®š - å–æ¶ˆæœåŠ¡ï¼Œä¸è¦åœ¨<code>onResume()</code>ã€<code>onPause()</code>æœŸé—´æ‰§è¡Œç»‘å®š/è§£ç»‘</li>
</ul>
<h2> Service ç»‘å®šå’Œå¯åŠ¨è½¬æ¢</h2>
<table>
<thead>
<tr>
<th>é¡ºåº</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td>å…ˆç»‘å®šåå¯åŠ¨ service</td>
<td>å¯åŠ¨ service</td>
</tr>
<tr>
<td>å…ˆå¯åŠ¨åç»‘å®š service</td>
<td>ä¼šç»‘å®šå®¿ä¸»ï¼Œä½†æ˜¯å®¿ä¸»æ­»åä»æŒ‰ç…§å¯åŠ¨ service æ–¹å¼å­˜æ´»</td>
</tr>
</tbody>
</table>
<h2> å‰å°æœåŠ¡å’Œé€šçŸ¥</h2>
<blockquote>
<ul>
<li><strong>startForeground(int id, Notification notification)</strong><br>
è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠå½“å‰æœåŠ¡è®¾ç½®ä¸ºå‰å°æœåŠ¡ï¼Œå…¶ä¸­ id å‚æ•°ä»£è¡¨å”¯ä¸€æ ‡è¯†é€šçŸ¥çš„æ•´å‹æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æä¾›ç»™ startForeground() çš„æ•´å‹ ID ä¸å¾—ä¸º 0ï¼Œè€Œ notification æ˜¯ä¸€ä¸ªçŠ¶æ€æ çš„é€šçŸ¥ã€‚</li>
<li><strong>stopForeground(boolean removeNotification)</strong><br>
è¯¥æ–¹æ³•æ˜¯ç”¨æ¥ä»å‰å°åˆ é™¤æœåŠ¡ï¼Œæ­¤æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦ä¹Ÿåˆ é™¤çŠ¶æ€æ é€šçŸ¥ï¼Œtrue ä¸ºåˆ é™¤ã€‚æ³¨æ„è¯¥æ–¹æ³•å¹¶ä¸ä¼šåœæ­¢æœåŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨æœåŠ¡æ­£åœ¨å‰å°è¿è¡Œæ—¶å°†å…¶åœæ­¢ï¼Œåˆ™é€šçŸ¥ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</li>
</ul>
</blockquote>
<p>æ–‡ç« å‚è€ƒï¼š</p>
<p><a href="http://blog.csdn.net/javazejian/article/details/52709857#t3" target="_blank" rel="noopener noreferrer">å…³äº Android Service çœŸæ­£çš„å®Œå…¨è¯¦è§£ï¼Œä½ éœ€è¦çŸ¥é“çš„ä¸€åˆ‡ - CSDN åšå®¢</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android å¼‚æ­¥æ¶ˆæ¯æœºåˆ¶ Handlerã€Messageã€Looper</title>
      <link>https://jixiaoyong.github.io/blog/posts/5962504e.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/5962504e.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android å¼‚æ­¥æ¶ˆæ¯æœºåˆ¶ Handlerã€Messageã€Looper</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 01 Apr 2018 12:08:08 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æ­¤æ–‡ä¸ºé¸¿æ´‹åšå®¢é˜…è¯»ç¬”è®°ï¼Œé…åˆåŸæ–‡é£Ÿç”¨å£å‘³æ›´ä½³ã€‚</p>
<p><a href="https://blog.csdn.net/lmj623565791/article/details/38377229" target="_blank" rel="noopener noreferrer">Android å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶ è®©ä½ æ·±å…¥ç†è§£ Looperã€Handlerã€Message ä¸‰è€…å…³ç³» - CSDN åšå®¢</a></p>
</blockquote>
<h2> å¯¼å›¾</h2>
<figure><img src="https://jixiaoyong.github.io/images/20200429160005.png" alt="20200429160005" tabindex="0" loading="lazy"><figcaption>20200429160005</figcaption></figure>
<h2> è¿‡ç¨‹åˆ†æ</h2>
<h3> Looper</h3>
<h4> <strong>Looper.perpare()</strong></h4>
<p><code>Looper.perpare()</code>æ–¹æ³•åˆ›å»º<code>Looperå¯¹è±¡</code>ï¼ˆåŒæ—¶åˆ›å»º<code>MessageQueueå¯¹è±¡</code>ï¼‰ï¼Œå¹¶ä¸å½“å‰çº¿ç¨‹å…³è”ä¿å­˜åœ¨<code>sThreadLocal</code>ä¸­ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> <strong>Looper.loop()</strong></h4>
<p><code>Looper.loop()</code>æ–¹æ³•è·å–ä¿å­˜çš„<code>Looperå¯¹è±¡</code>å¹¶ç”±æ­¤è·å–åˆ°<code>MessageQueueå¯¹è±¡</code>ã€‚</p>
<p>é€šè¿‡<code>forå¾ªç¯</code>ï¼Œä¸åœçš„é€šè¿‡<code>mQueue</code>è·å–åˆ°<code>msg</code>ï¼Œå¹¶è°ƒç”¨<code>msg.target.dispatchMessage(msg)</code>æ‰§è¡Œ msg å¯¹åº”çš„å¤„ç†æ–¹æ³•ã€‚</p>
<p>æœ€åé€šè¿‡<code>msg.recycle()</code>å›æ”¶ä½¿ç”¨å®Œçš„ msgã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> <strong>Looper.myLooper()</strong></h4>
<p><code>myLooper()</code>å†…éƒ¨è°ƒç”¨<code>sThreadLocal</code>è·å–å·²æœ‰çš„<code>Looperå¯¹è±¡</code></p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Android çš„ Activity é»˜è®¤åœ¨ UI çº¿ç¨‹è°ƒç”¨äº† Looper çš„<code>prepare()</code>å’Œ<code>loop()</code>æ–¹æ³•</strong></p>
<h3> Handler</h3>
<h4> handler.sendMessage()</h4>
<p>Handler æ„é€ æ–¹æ³•ä¼šè·å–åˆ°<code>mLooper</code>å’Œ<code>mQueue</code>ä»¥åŠ<code>mCallback</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>sendMessage()</code>æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨<code>sendMessageAtTime()</code>æ–¹æ³•ï¼Œåœ¨å…¶å†…éƒ¨è°ƒç”¨<code>enqueueMessage()</code>æ–¹æ³•ï¼Œå°† handler èµ‹äºˆ msg.targetï¼Œå¹¶å°† msg å‹å…¥ mQueue ä¸­</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> handler.dispatchMessage()</h4>
<p>Handler çš„<code>dispatchMessage()</code>æ–¹æ³•ä¼šåœ¨<code>Looper.loop()</code>ä¸­è¢«è°ƒç”¨</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­æ‰§è¡Œé¡ºåºæ˜¯ï¼š<code>msg.callback</code> &gt; <code>mCallback</code> &gt; <code>handleMessage()</code></p>
<h4> handler.post()</h4>
<p><code>handler.post(new Runnable())</code>è°ƒç”¨äº†<code>getPostMessage(r)</code>æ–¹æ³•å°† r èµ‹äºˆ msg.callback</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åä¹Ÿæ˜¯åœ¨<code>sendMessageDelayedæ–¹æ³•</code>ä¸­è°ƒç”¨<code>sendMessageAtTime()æ–¹æ³•</code>å°† msg å‹å…¥ MessageQueue ä¸­</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> msg çš„è·å–</h3>
<ul>
<li><code>Message.obtain();</code> å¤ç”¨ MessageMessage æ± ä¸­å·²æœ‰çš„å¯¹è±¡ï¼Œé¿å…å‡ºç°åˆ†é…å†…å­˜ <strong>æ¨è</strong></li>
<li><code>new Message();</code></li>
</ul>
<h2> æ€»ç»“</h2>
<p><strong>Looper</strong>åœ¨**<code>perfare()</code>**æ–¹æ³•ä¸­åˆ›å»º<code>LooperåŠMessageQueueå¯¹è±¡</code>å¹¶ä¿å­˜åœ¨<code>sThreadLocal</code>ä¸­ï¼Œ</p>
<p>åœ¨**<code>loop()</code>**æ–¹æ³•ä¸­é€šè¿‡<code>myLooper()</code>ä»<code>sThreadLocal</code>ä¸­å–å‡º<code>mLooper</code>ï¼Œå¹¶ç”±æ­¤è·å¾—<code>mQueue</code>ï¼Œåœ¨ for å¾ªç¯ä¸­é€šè¿‡<code>mQueue.next()</code>è·å–<code>msg</code>ï¼Œç”¨<code>msg.target.dispatchMessage()</code>æ–¹æ³•å›è°ƒ<code>handlerä¸­çš„msgå¤„ç†æ–¹æ³•</code>ã€‚</p>
<p><strong>Handler</strong>åœ¨**<code>æ„é€ å‡½æ•°</code>**ä¸­é€šè¿‡<code>Looper.myLooper()</code>è·å–åˆ°<code>å½“å‰çº¿ç¨‹çš„Looperå’ŒMessageQueue</code>ï¼›</p>
<p>**<code>sendMessage()</code>**æ–¹æ³•æœ€ç»ˆé€šè¿‡<code>sendMessageAtTime()</code>è°ƒç”¨<code>enqueueMessage()</code>æ–¹æ³•<code>å°†msgå‹å…¥åˆ°MessageQueue</code>ä¸­ã€‚</p>
<p>è‡³æ­¤å°†<em>Looper å’Œ Handler é€šè¿‡ MessageQueue è”ç³»åœ¨ä¸€èµ·</em>ï¼Œå¹¶å…±åŒå‚ä¸å¤„ç† Messageã€‚</p>
<p>æ­¤å¤–**<code>handler.post(runnable)</code><strong>ä¹Ÿæ˜¯é€šè¿‡åœ¨</strong><code>post()</code>**å†…éƒ¨è°ƒç”¨<code>getPostMessage()</code>æ–¹æ³•å°†<code>runnableèµ‹äºˆmsg.callback</code>ï¼Œå¹¶åœ¨<code>post()</code>ä¸­é€šè¿‡<code>sendMessageDelayed()</code>æ–¹æ³•è°ƒç”¨<code>sendMessageAtTime()æ–¹æ³•</code>å°†<code>msgå‹å…¥MessageQueue</code>ä¸­</p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20200429160005.png" type="image/png"/>
    </item>
    <item>
      <title>Android ä¸­ AIDL çš„ä½¿ç”¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/f931e8ae.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/f931e8ae.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ä¸­ AIDL çš„ä½¿ç”¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 07 Aug 2018 13:15:39 GMT</pubDate>
      <content:encoded><![CDATA[<p>AIDLï¼ˆAndroid Interface Definition Languageï¼ŒAndroid æ¥å£å®šä¹‰è¯­è¨€ï¼‰ç”¨äº Android IPCï¼Œé€‚ç”¨äº<strong>å¤§é‡å¹¶å‘</strong>è¯·æ±‚ã€‚</p>
<p>ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<ol>
<li>æœåŠ¡ç«¯ åˆ›å»º Service ç›‘å¬ Client çš„è¯·æ±‚ï¼Œé€šè¿‡åˆ›å»º AIDL å°†æ¥å£æš´éœ²ç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯ ç»‘å®šåˆ°æœåŠ¡ç«¯è·å– BInder å¯¹è±¡ï¼Œå°†å…¶è½¬åŒ–ä¸ºå¯¹åº” AIDLï¼Œå¹¶è°ƒç”¨æ¥å£å¯¹åº”æ–¹æ³•ã€‚</li>
</ol>
<p>ä¸¤è€…çš„è¿çº¿å°±æ˜¯ AIDLï¼Œå› æ­¤ä¸¤ä¸ª APP çš„ AIDL å¿…é¡»ä¸€è‡´ï¼Œå¯ä»¥å°† AIDL æ–‡ä»¶æ”¾åˆ°ä¸€ä¸ª Android Library ä¸­ï¼Œæˆ–è€…æ‰“æˆ aar æ–‡ä»¶ä¾›äºŒè€…ä¾èµ–ã€‚</p>
<p>ä¹Ÿå¯ä»¥å°† AIDL æ¶‰åŠåˆ°çš„ AIDL æ–‡ä»¶ã€java éƒ½æ”¾åˆ° AIDL æ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶ååœ¨ build.gradle çš„<code>android{...}</code>ä¸­æ·»åŠ </p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å³æ·»åŠ ä¸€ä¸ª java è·¯å¾„</p>
<h2> AIDL æ–‡ä»¶ç‰¹ç‚¹</h2>
<h3> æ”¯æŒçš„æ•°æ®æ ¼å¼</h3>
<p>åŸºæœ¬æ•°æ®ç±»å‹ã€Listï¼ˆArrayListï¼‰ã€Mapï¼ˆHashMapï¼‰ä»¥åŠå®ç°äº† Parcelable æ¥å£çš„å¯¹è±¡ã€AIDL æ¥å£ã€‚</p>
<h3> æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>è‡ªå®šä¹‰çš„ Parcelable å¯¹è±¡ã€AIDL å¯¹è±¡å¿…é¡»æ˜¾ç¤º importã€‚</li>
<li>AIDL ä¸­ç”¨åˆ°çš„ Parcelable å¯¹è±¡å¿…é¡»æ–°å»ºä¸€ä¸ªåŒå AIDL æ¥å£ï¼Œå£°æ˜å…¶ä¸º Parcelable ç±»å‹ã€‚</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>AIDL ä¸­é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå…¶ä»–çš„å‚æ•°å¿…é¡»æ ‡è®°æ–¹å‘ï¼ˆin,out,inoutï¼‰ã€‚</li>
<li>AIDL ä¸æ”¯æŒæ–¹æ³•é‡è½½ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½æœ‰ä¸¤ä¸ªåŒåçš„æ–¹æ³•ï¼ˆå³ä½¿å‚æ•°ç±»å‹ã€ä¸ªæ•°ä¸åŒä¹Ÿä¸è¡Œï¼‰ã€‚</li>
<li>AIDL ä¸­åªæ”¯æŒæ–¹æ³•ï¼Œä¸æ”¯æŒé™æ€å˜é‡ã€‚</li>
</ul>
<h2> AIDL ç”¨æ³•</h2>
<h3> AIDL</h3>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> æœåŠ¡ç«¯</h3>
<p>æ³¨æ„ MService åœ¨ AndroidManife.xml ä¸­é…ç½®ï¼š</p>
<p><code>android:exported="true"android:enabled="true"android:process=":people"</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼š</p>
<ol>
<li>
<p>è¿™é‡Œç”¨æ¥æ³¨å†Œç›‘å¬çš„ç±»æ˜¯ RemoteCallbackList</p>
<p>æˆ‘ä»¬çŸ¥é“è·¨è¿›ç¨‹çš„ä¸¤ä¸ª listener æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œé‚£ä»–æ˜¯æ€ä¹ˆä¿è¯è·¨è¿›ç¨‹æ³¨å†Œã€æ³¨é”€çš„æ˜¯æŒ‡å®šçš„ listener å‘¢ï¼Ÿ</p>
<p>è¿™æ˜¯å› ä¸ºè™½ç„¶ä¸¤ä¸ª listener å¯¹è±¡ä¸åŒï¼Œä½†æ˜¯ä»–ä»¬åº•å±‚çš„ Binder å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œåœ¨ RemoteCallbackList ä¸­æœ‰ä¸€ä¸ªä»¥ Binder å¯¹è±¡ä¸º KEY çš„ map æ¥å­˜æ”¾è¿™äº› listener å¯¹è±¡ï¼Œå½“è¦æ³¨é”€æ—¶ï¼Œåªéœ€è¦æŒ‰å½“å‰å¾…æ³¨é”€çš„ listener çš„ Binder å¯¹è±¡æ‰¾åˆ°å·²ç»æ³¨å†Œäº†çš„ listener å¹¶åˆ é™¤æ‰å³å¯ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼ŒRemoteCallbackList å¯ä»¥åœ¨å®¢æˆ·ç«¯æ­»äº¡çš„æ—¶å€™è‡ªåŠ¨æ³¨é”€æ‰å¯¹åº”çš„ listenerï¼Œè¿™æ˜¯å› ä¸ºä»–åœ¨æ³¨å†Œçš„åŒæ—¶ä¹Ÿå¯¹ Binder çš„æ­»äº¡å°±è¡Œäº†ç›‘å¬ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>æ–¹æ³•è¿è¡Œçš„çº¿ç¨‹</p>
<p><strong>å¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿è¡Œåœ¨åŒä¸€è¿›ç¨‹</strong>ï¼šå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯å’ŒæœåŠ¡ç«¯å›è°ƒå®¢æˆ·ç«¯æ–¹æ³•ï¼ˆRemoteCallbackListï¼Œä¸‹åŒï¼‰éƒ½ä¼šè¿è¡Œåœ¨åŒä¸€çº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯æ—¶æ‰€åœ¨çš„çº¿ç¨‹ï¼Œé»˜è®¤ä¸ºä¸»çº¿ç¨‹</p>
<p><strong>å¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿è¡Œåœ¨ä¸åŒè¿›ç¨‹</strong>ï¼šå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ°æœåŠ¡ç«¯æ–¹æ³•åœ¨ Binder çº¿ç¨‹æ± ä¸­è¿è¡Œå®Œæ¯•ï¼Œè¿™ç§æƒ…å†µä¸‹æœåŠ¡ç«¯å¯ä»¥æ‰§è¡Œè€—æ—¶æ“ä½œè€Œæ— éœ€å¦å»ºçº¿ç¨‹ï¼›æœåŠ¡ç«¯å›è°ƒå®¢æˆ·ç«¯æ–¹æ³•è¿è¡Œåœ¨å®¢æˆ·ç«¯ä¸»çº¿ç¨‹ (ä¸å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯æ–¹æ³•åœ¨åŒä¸€çº¿ç¨‹)</p>
<p>é€šè¿‡ä¸Šè¿°åˆ†æï¼Œå¯ä»¥æ³¨æ„åˆ°ä¸€ä¸ªç»†èŠ‚ï¼š<strong>è™½ç„¶åœ¨æœåŠ¡ç«¯ä¸­å›è°ƒå®¢æˆ·ç«¯çš„æ–¹æ³•æ˜¯åœ¨æœåŠ¡ç«¯çš„ Binder çº¿ç¨‹ï¼Œä½†æ˜¯åœ¨å®¢æˆ·ç«¯ä¸­è¢«å›è°ƒçš„æ–¹æ³•å´æ˜¯å’Œå®¢æˆ·ç«¯ä¸­ä¸»åŠ¨è°ƒç”¨æœåŠ¡ç«¯æ–¹æ³•çš„çº¿ç¨‹ä¸€è‡´</strong>ã€‚</p>
</li>
</ol>
<h3> å®¢æˆ·ç«¯</h3>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ç›‘å¬å¹¶å¤„ç† Binder æ­»äº¡äº‹ä»¶</h3>
<p>å½“æœåŠ¡ç«¯è¿›ç¨‹æ„å¤–æ­»äº¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©é‡æ–°è¿æ¥æœåŠ¡ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>binderDied åœ¨å®¢æˆ·ç«¯çš„ Binder çº¿ç¨‹æ± ä¸­</li>
<li>onServiceDisconnected åœ¨å®¢æˆ·ç«¯ UI çº¿ç¨‹</li>
</ol>
<h3> AIDL çš„æƒé™éªŒè¯</h3>
<p>å¯ä»¥åœ¨æœåŠ¡çš„ onBind(Intent intent) æˆ–è€… onTransact() æ–¹æ³•ä¸­åšéªŒè¯</p>
<p>åšéªŒè¯çš„æ‰‹æ®µæœ‰ï¼š1.permission éªŒè¯ï¼›2.Uidï¼ŒPid ç­‰åšéªŒè¯</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p>ã€ŠAndroid å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹</p>
]]></content:encoded>
    </item>
    <item>
      <title>Android ä¸­ AIDL ç›¸å…³çŸ¥è¯†</title>
      <link>https://jixiaoyong.github.io/blog/posts/2270057c.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/2270057c.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ä¸­ AIDL ç›¸å…³çŸ¥è¯†</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 20 Mar 2019 11:37:40 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p><code>AIDL</code>æ˜¯ Android ä¸­ç”¨äº IPC çš„è¯­è¨€ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥å‚è§<a href="https://jixiaoyong.github.io/blog/posts/f931e8ae/" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç« </a>ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æƒ³æ€»ç»“ä¸€ä¸‹<code>AIDL</code>å…·ä½“ä¸ºæˆ‘ä»¬åšäº†ä»€ä¹ˆå·¥ä½œï¼Œä¸»è¦å‚è€ƒä¹¦ç›®ã€ŠAndroid å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ã€‚</p>
<p>åœ¨ Android ä¸­ï¼Œé™¤äº†<code>Socket</code>ã€<code>Intent</code>ä¸­ä½¿ç”¨<code>Bundle</code>ã€æœ¬åœ°æ–‡ä»¶å…±äº«ï¼Œ<code>ContentProvider</code>ç­‰ç­‰ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç‹¬æœ‰çš„ IPC æ–¹å¼å³<code>Binder</code>ã€‚åœ¨æ—¥å¸¸ç¼–ç¨‹ä¸­ä½¿ç”¨<code>Binder</code>çš„ä¸»è¦æœ‰<code>AIDL</code>å’Œ<code>Messenger</code>ä¸¤ç§æ–¹å¼ï¼Œè€Œ<code>Messenger</code>ä¹Ÿæ˜¯ç”¨<code>AIDL</code>æ¥å®ç°çš„ã€‚</p>
<h2> å‡†å¤‡</h2>
<ol>
<li>æ–°å»ºä¸€ä¸ª AIDL æ–‡ä»¶</li>
</ol>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2">
<li>ç”¨ AndroidStudio è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª Binder ç±»</li>
</ol>
<p>ä½¿ç”¨<code>Build</code>-&gt;<code>Make Project</code>ï¼Œä¼šåœ¨<code>app/build/generated/aidl_source_output_dir/debug/compileDebugAidl/out</code>ç›®å½•ä¸‹ç”Ÿæˆ<code>IBookManager.java</code>ã€‚</p>
<h2> åˆ†æ</h2>
<p>AIDL ä»å®¢æˆ·ç«¯ (Client) å‘èµ·è¯·æ±‚è‡³æœåŠ¡ç«¯ (Server) ç›¸åº”çš„å·¥ä½œæµç¨‹æ¦‚è§ˆï¼Œå›¾ç‰‡æ¥æº (<a href="https://blog.csdn.net/qian520ao/article/details/78074983" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qian520ao/article/details/78074983</a>)</p>
<figure><img src="https://jixiaoyong.github.io/images/20190320205619.png" alt="AIDL ä»å®¢æˆ·ç«¯ (Client) å‘èµ·è¯·æ±‚è‡³æœåŠ¡ç«¯ (Server) çš„æµç¨‹" tabindex="0" loading="lazy"><figcaption>AIDL ä»å®¢æˆ·ç«¯ (Client) å‘èµ·è¯·æ±‚è‡³æœåŠ¡ç«¯ (Server) çš„æµç¨‹</figcaption></figure>
<p>ä¸‹é¢æˆ‘ä»¬å¯¹<code>IBookManager.java</code>è¿™ä¸ªæ–‡ä»¶ç®€å•åˆ†æä¸€ä¸‹</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://blog.csdn.net/qian520ao/article/details/78074983" target="_blank" rel="noopener noreferrer">Android æ·±å…¥æµ…å‡º AIDLï¼ˆäºŒï¼‰</a></p>
<p><a href="https://blog.csdn.net/qian520ao/article/details/78089877" target="_blank" rel="noopener noreferrer">Android Binder ä¹‹åº”ç”¨å±‚æ€»ç»“ä¸åˆ†æ</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20190320205619.png" type="image/png"/>
    </item>
    <item>
      <title>Android ä¸­ View ç›¸å…³çŸ¥è¯†</title>
      <link>https://jixiaoyong.github.io/blog/posts/1b0362b.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/1b0362b.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ä¸­ View ç›¸å…³çŸ¥è¯†</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 24 Mar 2019 04:43:21 GMT</pubDate>
      <content:encoded><![CDATA[<p>æœ¬æ–‡ä¸ºç¬”è®°æ€§è´¨ï¼Œå°šæœªæˆæ–‡ã€‚</p>
<h2> View çš„åæ ‡</h2>
<p>Android ä¸­çš„åæ ‡ï¼Œä»¥å±å¹•å·¦ä¸Šè§’é¡¶ç‚¹ä¸ºåŸç‚¹ (0,0)ï¼Œä»¥æ¨ªè½´ä¸º x è½´ï¼Œç«–è½´ä¸º y è½´ï¼Œæ•°å€¼ä¾æ¬¡é€’å¢ã€‚</p>
<p>View çš„åæ ‡ä¿¡æ¯æœ‰ä»¥ä¸‹å‡ ç§ï¼Œå…¶åæ ‡éƒ½æ˜¯ä»¥çˆ¶ View çš„å·¦ä¸Šè§’é¡¶ç‚¹ä¸ºåŸç‚¹ï¼š</p>
<ul>
<li>
<p>xï¼Œy æ˜¯ View çš„å·¦ä¸Šè§’åæ ‡ã€‚</p>
</li>
<li>
<p>translationXï¼ŒtranslationY æ˜¯ View å·¦ä¸Šè§’é¡¶ç‚¹ä¸çˆ¶å®¹å™¨å·¦ä¸Šè§’é¡¶ç‚¹çš„åç§»é‡ï¼Œé»˜è®¤ä¸º 0ã€‚</p>
</li>
<li>
<p>leftï¼Œtop æ˜¯åˆ†åˆ«æ˜¯ View å·¦ä¸Šè§’é¡¶ç‚¹çš„ x è½´ï¼Œy è½´åæ ‡ã€‚</p>
<p>rightï¼Œbottom åˆ†åˆ«æ˜¯ View å³ä¸‹è§’é¡¶ç‚¹çš„ x è½´ï¼Œy è½´åæ ‡ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ³¨æ„</p>
</blockquote>
<p>x = translationX + leftï¼›</p>
<p>y = translationY + topï¼›</p>
<p>æ”¹å˜ translationX/Y çš„å€¼ä¾¿å¯ä»¥æ›´æ”¹<strong>View çš„ä½ç½®</strong>ã€‚å½“ View å¹³ç§»çš„æ—¶å€™ï¼Œä»£è¡¨åŸå§‹ä½ç½®ä¿¡æ¯çš„ leftï¼Œrightï¼Œtopï¼Œbottom çš„å€¼å¹¶ä¸ä¼šå˜åŒ–ã€‚</p>
<p>åœ¨ OnTouch äº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä» event å¾—åˆ°ä¸¤ç§å€¼ï¼š</p>
<p>event.rawX,event.rawY ä»£è¡¨ ç›¸å¯¹äºæ‰‹æœºå±å¹•åŸç‚¹çš„åæ ‡</p>
<p>event.X,event.Y ä»£è¡¨ ç›¸å¯¹äºå½“å‰ View å·¦ä¸Šè§’çš„åæ ‡</p>
<p>TouchSlop åˆ™ä»£è¡¨è®¤ä¸ºæ»‘åŠ¨å¼€å§‹çš„æœ€å°è·ç¦»</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2> æ»‘åŠ¨</h2>
<p>mScroller.startScroll() æ–¹æ³•å¯ä»¥å®ç°å¹³æ»‘çš„æ»‘åŠ¨</p>
<p>scrollX,scrollY è¡¨ç¤ºçš„æ˜¯<em>view çš„ Xï¼ŒY åæ ‡å‡å» view å†…å®¹çš„ Xï¼ŒY åæ ‡</em>ã€‚</p>
<p>æ‰€ä»¥ scrollX&gt;0ï¼Œåˆ™è¡¨ç¤º view å†…å®¹å‘å·¦ç§»åŠ¨ï¼ŒscrollX&lt;0 è¡¨ç¤º view å†…å®¹å‘å³ç§»åŠ¨ã€‚ç±»ä¼¼äºçª—æˆ· (view) ä½ç½®ä¸å˜ï¼Œæ™¯è‰² (view å†…å®¹) çš„ scrollX&gt;0 å³æ™¯è‰²å‘å³ç§»åŠ¨ï¼Œåˆ™åœ¨çª—æˆ·ä¸­çœ‹åˆ°çš„æ•ˆæœæ˜¯æ™¯è‰²å‘çª—æˆ·å·¦è¾¹ç§»åŠ¨ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Scroller ä¸èƒ½ä½¿ View æ»‘åŠ¨ï¼Œè€Œåªèƒ½é…åˆ View çš„ computeScroll() æ–¹æ³•å®ç°æ˜¯<strong>View çš„å†…å®¹æ»‘åŠ¨</strong>çš„æ•ˆæœã€‚</p>
<ul>
<li>mScroller.startScroll() è®°å½•ä¸‹è¦æ»‘åŠ¨çš„æ•°æ®ï¼Œè€Œ invalidate() é€šçŸ¥ View é‡ç»˜ï¼›</li>
<li>æ¯æ¬¡é‡ç»˜éƒ½ä¼šè°ƒç”¨ computeScroll() æ–¹æ³•ï¼Œåˆ©ç”¨ mScroller è®¡ç®—å‡ºæ¥ä¸‹æ¥è¦ scrollTo() çš„å…·ä½“å€¼å¹¶æ‰§è¡Œï¼Œå†æ¬¡ postInvalidate() é€šçŸ¥ View é‡ç»˜ï¼›</li>
<li>å¦‚æ­¤åå¤ç›´åˆ°ç»˜åˆ¶æ»‘åŠ¨å®Œæ¯•ã€‚</li>
</ul>
<p>ä¸Šè¿°æ— è®ºæ˜¯ translationX è¿˜æ˜¯ scrollX ç­‰å¼•èµ·çš„ view å˜åŒ–ï¼Œéƒ½ä¸èƒ½æ”¹å˜ View çš„å®šä½ï¼ˆleftï¼Œrightï¼Œtopï¼Œbottom å€¼ï¼‰ï¼Œè€Œå¦‚æœ<strong>æ›´æ”¹ margin çš„å€¼ï¼Œåˆ™å¯ä»¥æ›´æ”¹ View çš„å®šä½</strong>ã€‚</p>
<h2> Window å’Œ WindowManager</h2>
<p>WindowManager.LayoutParams.flags æœ‰ä¸‰ä¸ªå¸¸ç”¨é€‰é¡¹ï¼š</p>
<ul>
<li>WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL // åªå¤„ç† Window åŒºåŸŸå†…çš„ç‚¹å‡»äº‹ä»¶ï¼Œä¹‹å¤–çš„äº¤ç»™å…¶ä»– Window å¤„ç†</li>
<li>WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE // ä¸æ¥å—è¾“å…¥äº‹ä»¶ï¼Œä¸è·å–ç„¦ç‚¹ï¼ŒåŒæ—¶ä¼šå¼€å¯ FLAG_NOT_TOUCH_MODALï¼Œæœ€ç»ˆäº‹ä»¶ä¼šä¼ é€’ç»™ä¸‹å±‚å…·æœ‰ç„¦ç‚¹çš„ Window</li>
<li>WindowManager.LayoutParams.FLAG_SHOW_WHEN_LOCKED // è®© Window æ˜¾ç¤ºåœ¨é”å±ç•Œé¢ä¸Š</li>
</ul>
<p>WindowManager.LayoutParams.type ä»£è¡¨ Window çš„ç±»å‹ (ä¸‰ä¸ª)ï¼š</p>
<ul>
<li>åº”ç”¨ Window å¯¹åº”ä¸€ä¸ª Activityã€‚<code>z-ordered</code>:1~99</li>
<li>å­ Window ä¸èƒ½å•ç‹¬å­˜åœ¨ï¼Œé™„å±åœ¨ç‰¹å®šçš„çˆ¶ Window ä¸­ï¼Œå¦‚ Dialogã€‚<code>z-ordered</code>:1000~1999</li>
<li>ç³»ç»Ÿ Window éœ€è¦ç³»ç»Ÿæƒé™ï¼Œå¦‚ Toastï¼ŒçŠ¶æ€æ ç­‰ã€‚<code>z-ordered</code>:2000~2999</li>
</ul>
<p><code>z-ordered</code>å€¼å¤§çš„ Window ä¼šè¦†ç›–æ‰ä½å€¼çš„ Windowã€‚</p>
<h2> TODO</h2>
<p>recycleview æ»‘åŠ¨<br>
ItemTouchHelper æºç åˆ†æ <a href="https://www.jianshu.com/p/130fdd755471" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/130fdd755471</a><br>
åµŒå¥—æ»‘åŠ¨ <a href="https://blog.csdn.net/qq_15807167/article/details/51637678" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_15807167/article/details/51637678</a><br>
<a href="https://www.cnblogs.com/dasusu/p/9159904.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/dasusu/p/9159904.html</a><br>
<s>æ»‘åŠ¨å±•ç¤ºåˆ é™¤æŒ‰é’®</s> <a href="https://www.jianshu.com/p/9bfed6e127cc" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/9bfed6e127cc</a> &gt;&gt; å¯¹åº”çš„ demoï¼š<a href="https://github.com/jixiaoyong/DiyWidget/blob/master/diy-widget/src/main/java/cf/android666/applibrary/SwipeRecyclerView.kt" target="_blank" rel="noopener noreferrer">https://github.com/jixiaoyong/DiyWidget/blob/master/diy-widget/src/main/java/cf/android666/applibrary/SwipeRecyclerView.kt</a></p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://blog.csdn.net/Holmofy/article/details/53959511" target="_blank" rel="noopener noreferrer">View æ»‘åŠ¨æ•ˆæœå¸¸ç”¨å±æ€§è¯¦è§£ï¼šscrollã€translationã€LayoutParams</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android ä¸­ WebView ä½¿ç”¨çš„ä¸€äº›é—®é¢˜</title>
      <link>https://jixiaoyong.github.io/blog/posts/b35fe0f7.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/b35fe0f7.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ä¸­ WebView ä½¿ç”¨çš„ä¸€äº›é—®é¢˜</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 07 Feb 2018 16:11:13 GMT</pubDate>
      <content:encoded><![CDATA[<h2> é—®é¢˜æè¿°ï¼šWebView åœ¨ fragment ä¸­ä¸æ˜¾ç¤º</h2>
<p>è§£å†³ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤ä»£ç åŒæ ·å¼ºåˆ¶åœ¨ webview ä¸­æ‰“å¼€å¯¹åº”çš„ç½‘é¡µ</p>
]]></content:encoded>
    </item>
    <item>
      <title>Android ä¸­çš„ Messenger æºç è¯¦è§£</title>
      <link>https://jixiaoyong.github.io/blog/posts/b0dc2559.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/b0dc2559.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ä¸­çš„ Messenger æºç è¯¦è§£</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 21 Mar 2019 02:26:32 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>Messenger æ˜¯ Android ä¸­ç”¨äº IPC çš„æ–¹å¼ä¹‹ä¸€ï¼Œä½¿ç”¨ Handler å‘é€æœ‰åºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œåº•å±‚æ˜¯é€šè¿‡ AIDL è°ƒç”¨ Binder å®ç°ã€‚</p>
<p>Messenger åªç”¨äºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸²è¡Œçš„ä¼ é€’æ¶ˆæ¯ï¼Œå¦‚æœå¤§é‡å¹¶å‘æˆ–è€…è·¨è¿›ç¨‹è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•ï¼Œå°±éœ€è¦è€ƒè™‘ AIDL è€Œé Messengerã€‚</p>
<p>Messenger çš„ä½¿ç”¨å¯ä»¥å‚è€ƒ<a href="https://jixiaoyong.github.io/blog/posts/ad4c562c/" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç« </a>,æœ¬æ–‡ä¸»è¦æ¢ç´¢ä¸€ä¸‹ Messenger æºç å®ç°ã€‚</p>
<p>ä¸»è¦ä½¿ç”¨åˆ°çš„æ–‡ä»¶ï¼š</p>
<p><a href="http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/os/IMessenger.aidl" target="_blank" rel="noopener noreferrer">IMessenger.aidl</a></p>
<p><a href="http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/os/Messenger.java" target="_blank" rel="noopener noreferrer">Messenger.java</a></p>
<p><a href="http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/os/Handler.java" target="_blank" rel="noopener noreferrer">Handler.java</a></p>
<h2> è§£æ</h2>
<p>ä¸€ä¸ªå…¸å‹çš„ Messenger æœåŠ¡å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ Handler åˆ›å»ºä¸€ä¸ª Messengerï¼Œè¿›å…¥åˆ°æºç çœ‹ä¸€ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä¸ç»™å®šçš„ Handler ç»‘å®šåœ¨ä¸€èµ·çš„ Messengerï¼Œå†çœ‹çœ‹<code>getIMessenger()</code>æ–¹æ³•ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>getIMessenger()</code>æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ª MessengerImpl å¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡</p>
<p>å®ç°äº†<code>send()</code>æ–¹æ³•ï¼Œä¹Ÿè¯å®äº†æˆ‘ä»¬ä¹‹å‰çš„ä¸€ä¸ªè§‚ç‚¹â€”â€”Messenger åº•å±‚æ˜¯ä½¿ç”¨ Handler å‘é€æ¶ˆæ¯ã€‚</p>
<p>åŒæ—¶ï¼Œçœ‹åˆ° MessengerImpl ç»§æ‰¿çš„ IMessenger.Stub ç±»æˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°è¿™é‡Œåº”è¯¥æœ‰ä¸€ä¸ª AIDL å®ç°ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p><code>oneway</code> å…³é”®å­—ç”¨äºä¿®æ”¹è¿œç¨‹è°ƒç”¨çš„è¡Œä¸ºã€‚ä½¿ç”¨è¯¥å…³é”®å­—æ—¶ï¼Œè¿œç¨‹è°ƒç”¨ä¸ä¼šé˜»å¡ï¼›å®ƒåªæ˜¯å‘é€äº‹åŠ¡æ•°æ®å¹¶ç«‹å³è¿”å›ã€‚æ¥å£çš„å®ç°æœ€ç»ˆæ¥æ”¶æ­¤è°ƒç”¨æ—¶ï¼Œæ˜¯ä»¥æ­£å¸¸è¿œç¨‹è°ƒç”¨å½¢å¼å°†å…¶ä½œä¸ºæ¥è‡ª <code>Binder</code> çº¿ç¨‹æ± çš„å¸¸è§„è°ƒç”¨è¿›è¡Œæ¥æ”¶ã€‚å¦‚æœ <code>oneway</code> ç”¨äºæœ¬åœ°è°ƒç”¨ï¼Œåˆ™ä¸ä¼šæœ‰ä»»ä½•å½±å“ï¼Œè°ƒç”¨ä»æ˜¯åŒæ­¥è°ƒç”¨</p>
<p><a href="https://developer.android.google.cn/guide/components/aidl?hl=zh-cn" target="_blank" rel="noopener noreferrer">https://developer.android.google.cn/guide/components/aidl?hl=zh-cn</a></p>
</blockquote>
<p>è¿™ä¹Ÿå°±è§£é‡Šäº†åœ¨æœåŠ¡çš„<code>onBind(intent: Intent?)</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨<code>messenger.binder</code>è·å–åˆ° Binder å¯¹è±¡çš„åŸå› ã€‚</p>
<p>å†çœ‹çœ‹ Messenger å®¢æˆ·ç«¯çš„å®ç°ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥æ³¨æ„åˆ°åœ¨å®¢æˆ·ç«¯é€šè¿‡<code>Messenger(IBinder target)</code>å–å¾—æœåŠ¡ç«¯çš„ Messengerï¼Œè€Œè¿™é‡Œçš„ IBinder å¯¹è±¡åˆ™æ˜¯é€šè¿‡æœåŠ¡ç«¯çš„ Messenger çš„<code>getBinder()</code>è·å–çš„ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Stub.asInterface()</code>æ–¹æ³•æˆ‘ä»¬åœ¨<a href="http://jixiaoyong.github.io/blog/posts/88d0bcd1/" target="_blank" rel="noopener noreferrer">ä¹‹å‰çš„æ–‡ç« </a>ä¸­ä»‹ç»è¿‡ï¼Œä»–ä¼šæ ¹æ®å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯å¦åœ¨åŒä¸€è¿›ç¨‹è€Œå†³å®šè¿”å› Stub å®ä¾‹è¿˜æ˜¯ Proxy ç±»å®ä¾‹ä»¥å®ç°è·¨è¿›ç¨‹é€šä¿¡ã€‚</p>
<p>è€Œé€šè¿‡æ¯”è¾ƒ <code>Messenger(IBinder target)</code>å’Œ<code>Messenger(Handler target)</code>ä¸¤ä¸ªæ„é€ æ–¹æ³•æˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½åªæ˜¯ç”¨æ¥åˆå§‹åŒ–äº†<code>IMessenger mTarget</code>å¯¹è±¡ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä¸¤ä¸ªä¸åŒçš„æ„é€ æ–¹æ³•è·å–åˆ°æœ‰åŒæ ·åŠŸèƒ½çš„ Messengerã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p>ã€ŠAndroid å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹</p>
<p><a href="https://developer.android.google.cn/guide/components/aidl?hl=zh-cn" target="_blank" rel="noopener noreferrer">Android æ¥å£å®šä¹‰è¯­è¨€ (AIDL)</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android ä¸­çš„ SpareArray å’Œ ArrayMap å®ç°åˆ†æ</title>
      <link>https://jixiaoyong.github.io/blog/posts/c2f123c.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/c2f123c.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ä¸­çš„ SpareArray å’Œ ArrayMap å®ç°åˆ†æ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 22 Dec 2019 01:35:37 GMT</pubDate>
      <content:encoded><![CDATA[<p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¸¸ç”¨çš„å­˜å‚¨é”®å€¼å¯¹çš„æ•°æ®ç»“æ„æ˜¯<code>HashMap</code>ï¼Œæ ¹æ®<a href="https://jixiaoyong.github.io/blog/posts/ff927bd4.html" target="_blank" rel="noopener noreferrer">Java ç¬”è®°ä¹‹ HashMap ä¿å­˜æ•°æ®</a>å’Œ<a href="https://jixiaoyong.github.io/blog/posts/b0793c74.html" target="_blank" rel="noopener noreferrer">Java ç¬”è®°ä¹‹è®¡ç®— Java å¯¹è±¡çš„å¤§å°åŠå…¶åº”ç”¨</a>å¯ä»¥çŸ¥é“ï¼Œ<code>HashMap</code>å­˜å‚¨<strong>é”®å€¼å¯¹</strong>ä¼šå ç”¨æ¯”è¾ƒå¤šçš„å†…å­˜æ§ä»¶ï¼Œè€Œå¯¹äºå†…å­˜é™åˆ¶è¾ƒå¤§çš„ Android å¹³å°æ¥è¯´ï¼Œä¸ºäº†é¿å…è¿™ç§æµªè´¹ï¼Œå®˜æ–¹æ¨èæˆ‘ä»¬ä½¿ç”¨<code>SpareArray</code>å’Œ<code>ArrayMap</code>ï¼Œæœ¬æ–‡å¯¹è¿™ä¸¤ä¸ªç±»çš„å®ç°è¿›è¡Œåˆ†ææ¯”è¾ƒã€‚</p>
<p><strong><code>SpareArray</code>ä»¥åŠä»–çš„è¡ç”Ÿç±»</strong>éƒ½æ˜¯ä»¥<strong>åŸºæœ¬ç±»å‹</strong>ä¸º<code>key</code>ï¼Œå› ä¸ºé¿å…äº†<em>è‡ªåŠ¨è£…ç®±</em>ï¼Œå¹¶ä¸”<strong>ç”¨æ•°ç»„ç›´æ¥ä¿å­˜ keyã€value</strong>ï¼ˆè€Œéåƒ<code>HashMap</code>é‚£æ ·å°†å…¶å°è£…ä¸º<code>Node</code>å¯¹è±¡åå†ä¿å­˜ï¼‰ï¼Œå› è€ŒèŠ‚çœäº†å†…å­˜ã€‚</p>
<p><strong><code>ArrayMap</code><strong>åˆ™æ”¯æŒ</strong>æ‰€æœ‰ç±»å‹çš„ key</strong>ï¼Œä»–æ˜¯<strong>å°†<code>key</code>å’Œ<code>value</code>å…¨éƒ¨ä¿å­˜åœ¨ä¸€ä¸ªæ•°ç»„ä¸­</strong>ï¼ˆ<code>n</code>ä½ä¸º<code>key</code>ï¼Œ<code>n+1</code>ä½ä¸º<code>value</code>ï¼‰ï¼Œé¿å…äº†å°†å…¶å°è£…ä¸º<code>Node</code>å¯¹è±¡å¸¦æ¥çš„å†…å­˜æ¶ˆè€—ã€‚</p>
<p><strong>å½“è¦ä¿å­˜çš„æ•°æ®é‡æ¯”è¾ƒå°ï¼ˆå°äºå‡ åƒä¸ªï¼‰çš„æ—¶å€™ï¼Œå¦‚æœ KEY æ˜¯åŸºæœ¬ç±»å‹ï¼Œæ¨èä½¿ç”¨<code>SparseArray</code>åŠå…¶è¡ç”Ÿç±»ä»¥èŠ‚çœå†…å­˜ï¼Œå¦‚æœ KEY æ˜¯å…¶ä»–ç±»å‹åˆ™ä½¿ç”¨<code>ArrayMap</code>;å¦åˆ™ä½¿ç”¨<code>HashMap</code>æ›´åŠ é«˜æ•ˆ</strong>ã€‚</p>
<h2> SpareArray</h2>
<p><code>SpareArray</code>ä»¥åŠä»–çš„è¡ç”Ÿç±»ä¸»è¦ç”¨äº<strong>ä»¥<code>åŸºæœ¬ç±»å‹</code>ä¸º<code>key</code>ä¿å­˜éå¤§é‡æ•°æ®çš„åœºæ™¯</strong>ã€‚</p>
<p>ç›¸æ¯”<code>HashMap</code>è€Œè¨€ï¼Œä»–çš„ä¼˜ç‚¹ä¸»è¦åœ¨äº<strong>æ²¡æœ‰å¯¹ä¿å­˜çš„æ•°æ®äºŒæ¬¡å°è£…</strong>ï¼Œæ²¡æœ‰å¯¹åŸºæœ¬ç±»å‹çš„æ•°æ®<strong>è‡ªåŠ¨è£…ç®±</strong>ï¼Œå­˜å‚¨å•ä¸ªæ•°æ®çš„æˆæœ¬å°ï¼Œä¹Ÿæ²¡æœ‰<code>hash</code>è®¡ç®—ã€‚</p>
<p>ä½†ä»–åœ¨æ·»åŠ æ•°æ®æ—¶éœ€è¦æ‰©å±•æ•°ç»„ (æ¶‰åŠåˆ°æ–°å»ºã€å¤åˆ¶æ•°ç»„ï¼Œ<code>gc()</code>ç­‰)ï¼Œ<s>åœ¨åˆ é™¤æ•°æ®æ—¶éœ€è¦ç¼©å‡æ•°ç»„</s> (æŸ¥çœ‹<code>gc()</code>ç­‰æºç å‘ç°ä»–çš„æ•°ç»„åªä¼šå¢åŠ ï¼Œä¸ä¼šç¼©å‡)ï¼Œä»¥åŠé€šè¿‡äºŒåˆ†æ³•æŸ¥æ‰¾ç´¢å¼•éƒ½ä¼šæ¶ˆè€—æ€§èƒ½ã€‚</p>
<blockquote>
<p>ä¸ºäº†é¿å…æ¯æ¬¡åˆ é™¤æ—¶éƒ½éœ€è¦ç¼©å‡æ•°ç»„ï¼Œ<code>SpareArray</code>åœ¨åˆ é™¤æ•°ç»„æ—¶åªä¼šå°†å…¶èµ‹å€¼ä¸º<code>DELETED</code>ï¼Œåœ¨ä¸‹æ¬¡è°ƒç”¨å…¶<code>private void gc()</code>æ–¹æ³•æ—¶ä¸¢å¼ƒæ‰è¿™äº›æ•°æ®</p>
</blockquote>
<p>å…ˆçœ‹ä¸€ä¸‹<code>SpareArray</code>çš„ç»“æ„ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> void put(int key, E value)</h3>
<p>æ·»åŠ æ–¹æ³•å…ˆç”¨<strong>äºŒåˆ†æ³•</strong>æŸ¥æ‰¾<code>key</code>å¯¹åº”çš„ä½ç½®ï¼š</p>
<ul>
<li>å¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥è¦†ç›–</li>
<li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™<strong>å–å</strong>å¾—åˆ°åº”è¯¥<code>æ’å…¥çš„ä½ç½®</code>ï¼Œå¹¶åˆ†åˆ«æ’å…¥<code>key</code>å’Œ<code>value</code></li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> E get(int key)</h3>
<p>è·å–æ•°æ®ï¼Œå…ˆç”¨<strong>äºŒåˆ†æ³•</strong>æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°å°±è¿”å›<code>å¯¹åº”çš„å€¼</code>ï¼Œå¦åˆ™è¿”å›<code>null</code>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> void remove(int key)</h3>
<p>åˆ é™¤<code>key</code>ä»¥åŠ<code>å¯¹åº”çš„æ•°æ®</code>ã€‚</p>
<p>åŒæ ·å…ˆç”¨<strong>äºŒåˆ†æ³•</strong>æŸ¥æ‰¾<code>å¯¹åº”ä½ç½®</code>ï¼Œæœ‰çš„è¯åˆ™æ ‡è®°ä¸º<code>DELETED</code>ï¼Œ<strong>ç­‰å¾…ä¸‹æ¬¡<code>gc()</code>æ—¶ä¸¢å¼ƒ</strong>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> gc()</h3>
<p>åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œåˆ é™¤æ•°æ®æ—¶ï¼Œ<code>mGarbage</code>è¢«æ ‡è®°ä¸º<code>true</code>ï¼Œè¿™æ ·å½“ä¸‹ä¸€æ¬¡è¿›è¡Œ<code>put/valueAt/append/size</code>ç­‰æ¶‰åŠåˆ°æ•°ç»„å¤§å°æŸ¥è¯¢ã€æ”¹åŠ¨ç­‰æ—¶ï¼Œå°±å‡ºè§¦å‘<code>gc()</code>ä»¥ä¾¿æ•´ç†æ•°ç»„ç»“æ„ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> HashMap ä¸ SpareArray åŠå…¶è¡ç”Ÿç±»å¯¹åº”å…³ç³»</h3>
<p>å‚è€ƒ<a href="https://android.jlelse.eu/app-optimization-with-arraymap-sparsearray-in-android-c0b7de22541a" target="_blank" rel="noopener noreferrer">ä¸‹å›¾</a></p>
<figure><img src="https://jixiaoyong.github.io/images/20191222131219.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2> ArrayMap</h2>
<p><code>ArrayMap</code>å®ç°äº†<code>Map&lt;K, V&gt;</code>æ¥å£ï¼Œä»–çš„ API å’Œ<code>HashMap</code>ç›¸å·®æ— å‡ ï¼Œä½†æ˜¯ç”±äº<strong>æ²¡æœ‰å¯¹æ•°æ®å†åŒ…è£…</strong>ï¼Œ<strong>åŠ¨æ€è°ƒæ•´æ•°ç»„çš„å¤§å°</strong>ï¼Œä¸€å®šèŒƒå›´å†…ä»–æ¯”<code>HashMap</code>å†…å­˜æ•ˆç‡é«˜ã€‚</p>
<p>ä½†æ˜¯å¦‚æœä¿å­˜å¤§é‡æ•°æ®ï¼ˆè¶…è¿‡åƒä½ï¼‰æ—¶ï¼Œç”±äºä»–éœ€è¦<strong>äºŒåˆ†æ³•æŸ¥æ‰¾</strong>çš„å½±å“ä¼šæ¯”<code>HashMap</code>æ…¢å¾ˆå¤šã€‚</p>
<blockquote>
<p><strong><code>ArrayMap</code>ç‰¹æ®Šä¹‹å¤„åœ¨äºå°†<code>key</code>ï¼Œ<code>value</code>ä¿å­˜åˆ°äº†åŒä¸€ä¸ªæ•°ç»„ mArray ä¸­ï¼ˆn ä½ä¿å­˜ keyï¼Œn+1 ä½ä¿å­˜ value</strong>ï¼‰ã€‚</p>
</blockquote>
<p>å…ˆçœ‹ä¸€ä¸‹<code>ArrayMap</code>çš„ç»“æ„ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä½¿ç”¨æ—¶ï¼š</p>
<ol>
<li>
<p>è®¡ç®—<code>key</code>çš„<code>hashå€¼</code>ï¼Œ</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p>ç„¶åä½¿ç”¨<code>indexOf()</code>åœ¨<code>mHashes</code>ä¸­è¿›è¡ŒäºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”çš„<code>index</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>indexOf()</code>æ–¹æ³•ä¼šå…ˆç”¨<strong>äºŒåˆ†æ³•</strong>æŸ¥æ‰¾<code>hash</code>å¯¹åº”çš„<code>index</code>,å¦‚æœ<code>index&lt;0</code>åˆ™è¿”å›<code>index</code>ï¼›å¦åˆ™åœ¨å¯¹æ¯”<code>mArray</code>ä¸­å¯¹åº”ä½ç½®<code>mArray[index&lt;&lt;1]</code>çš„<code>key</code>ä¸è¦<code>æŸ¥è¯¢çš„key</code>ï¼š</p>
<ul>
<li>ä¸¤è€…ä¸€è‡´ï¼šè¿”å›<code>index</code></li>
<li>ä¸¤è€…ä¸ä¸€è‡´ï¼šä»<code>index</code>å¼€å§‹ï¼Œ<strong>å…ˆå‘åï¼Œå†å‘å‰</strong>æŸ¥è¯¢æ˜¯å¦æœ‰ç›¸åŒçš„<code>key</code>,å¦‚æœæœ‰è¿”å›<code>å¯¹åº”index</code></li>
<li>ä»¥ä¸Šéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼š<strong>å¯¹<code>mHashes</code>ä¸­<code>æœ€åä¸€ä¸ªä¸keyçš„hashä¸€è‡´çš„åä¸€ä½index</code>å–å</strong>ï¼Œå¹¶è¿”å›</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ol>
<h3> V put(K key, V value)</h3>
<p>å½“æ·»åŠ <code>item</code>æ—¶ï¼ŒæŒ‰ç…§å‰è¿°è§„åˆ™ï¼Œå…ˆåœ¨<code>mArray</code>ä¸­æŸ¥æ‰¾<code>key</code>å¯¹åº”çš„<code>ç´¢å¼•index</code>ï¼š</p>
<ul>
<li>
<p><code>index &gt;= 0</code> ï¼šå·²ç»æœ‰é”®ä¸º<code>key</code>çš„æ•°æ®ï¼Œç›´æ¥è¦†ç›–æ—§å€¼å¹¶è¿”å›</p>
</li>
<li>
<p><code>index &lt; 0 </code>ï¼šæ²¡æœ‰é”®ä¸º<code>key</code>çš„æ•°æ®ï¼Œå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œå¹¶ä¿å­˜å¯¹åº”æ•°æ®</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ul>
<h3> V get(Object key)</h3>
<p><code>get()</code>æ–¹æ³•å°±æ¯”è¾ƒç®€å•äº†ï¼Œå…ˆæŸ¥æ‰¾<code>key</code>çš„ç´¢å¼•ï¼Œç„¶åå–å‡º<code>å¯¹åº”çš„æ•°æ®value</code>å¹¶è¿”å›å³å¯ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> V remove(Object key)</h3>
<p><code>remove()</code>æ–¹æ³•ä¹Ÿä¼šå…ˆä½¿ç”¨<code>indexOfKey()</code>è®¡ç®—<code>keyçš„index</code>ï¼Œç„¶ååˆ é™¤<code>å¯¹åº”ä½ç½®çš„æ•°æ®</code>ã€‚</p>
<p>æ­¤å¤–ï¼Œå¦‚æœ<code>mHashes.length &gt; (BASE_SIZE*2) &amp;&amp; mSize &lt; mHashes.length/3</code>çš„è¯ï¼Œè¿˜ä¼šç¼©å‡<code>æ•°ç»„çš„å¤§å°</code>ä¸º<code>osize &gt; (BASE_SIZE*2) ? (osize + (osize&gt;&gt;1)) : (BASE_SIZE*2)</code>ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://android.googlesource.com/platform/frameworks/base.git/+/master/core/java/com/android/internal/util/GrowingArrayUtils.java" target="_blank" rel="noopener noreferrer">GrowingArrayUtils.java æºç </a></p>
<p><a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/util/SparseArray.java" target="_blank" rel="noopener noreferrer">SparseArray.java æºç </a></p>
<p><a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/util/ArrayMap.java" target="_blank" rel="noopener noreferrer">ArrayMap.java æºç </a></p>
<p><a href="https://android.jlelse.eu/app-optimization-with-arraymap-sparsearray-in-android-c0b7de22541a" target="_blank" rel="noopener noreferrer">App optimization with ArrayMap &amp; SparseArray in Android</a></p>
<p><a href="https://jixiaoyong.github.io/blog/posts/ff927bd4.html" target="_blank" rel="noopener noreferrer">Java ç¬”è®°ä¹‹ HashMap ä¿å­˜æ•°æ®</a></p>
<p><a href="https://jixiaoyong.github.io/blog/posts/b0793c74.html" target="_blank" rel="noopener noreferrer">Java ç¬”è®°ä¹‹è®¡ç®— Java å¯¹è±¡çš„å¤§å°åŠå…¶åº”ç”¨</a></p>
<p><a href="https://extremej.itscoder.com/sparsearray_source_analyse/" target="_blank" rel="noopener noreferrer">SparseArray çš„ä½¿ç”¨åŠå®ç°åŸç†</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20191222131219.png" type="image/png"/>
    </item>
    <item>
      <title>Android ä»Šæ—¥å¤´æ¡å±å¹•é€‚é…æ–¹æ¡ˆçš„åŸç†æ¢³ç†</title>
      <link>https://jixiaoyong.github.io/blog/posts/76d69fc6.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/76d69fc6.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ä»Šæ—¥å¤´æ¡å±å¹•é€‚é…æ–¹æ¡ˆçš„åŸç†æ¢³ç†</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 13 Oct 2020 03:13:18 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>æœ€è¿‘åœ¨é¡¹ç›®é‡Œé¢é‡åˆ°äº†å±å¹•é€‚é…çš„é—®é¢˜ï¼ŒUI è¦æ±‚ APP åœ¨ä¸åŒæ‰‹æœºä¸Šå±•ç¤ºæ•ˆæœå’Œè®¾è®¡ç¨¿ä¿æŒâ€œåƒç´ çº§â€åŒæ­¥ï¼Œåœ¨å¯¹æ¯”äº†å‡ ç§å±å¹•é€‚é…æ–¹æ¡ˆä¹‹åï¼Œé€‰æ‹©äº†åŸºäºä»Šæ—¥å¤´æ¡çš„<a href="https://github.com/JessYanCoding/AndroidAutoSize" target="_blank" rel="noopener noreferrer">AndroidAutoSize</a>é€‚é…æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡ä¸»è¦ç®€å•åˆ†æå…¶é€‚é…åŸç†ï¼Œä»¥åŠåœ¨å®é™…ä½¿ç”¨ä¸­é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦æ›´æ·±å…¥äº†è§£åŸç†å¯ä»¥é˜…è¯»æ–‡æœ«å‚è€ƒæ–‡çŒ®ã€‚</p>
<h2> æ­£æ–‡</h2>
<p>UI ç»™çš„è®¾è®¡ç¨¿ä¸€èˆ¬éƒ½æ˜¯ä»¥åƒç´  px ä¸ºå•ä½ï¼Œè€Œåœ¨ Android å¼€å‘ä¸­å®˜æ–¹æ¨èçš„ä½¿ç”¨çš„å•ä½æ˜¯ dpã€‚</p>
<blockquote>
<p>dp æ˜¯ä¸€ä¸ªè™šæ‹Ÿåƒç´ å•ä½ï¼Œ1 dp çº¦ç­‰äºä¸­å¯†åº¦å±å¹•ï¼ˆ160dpiï¼›â€œåŸºå‡†â€å¯†åº¦ï¼‰ä¸Šçš„ 1 åƒç´ ã€‚å¯¹äºå…¶ä»–æ¯ä¸ªå¯†åº¦ï¼ŒAndroid ä¼šå°†æ­¤å€¼è½¬æ¢ä¸ºç›¸åº”çš„å®é™…åƒç´ æ•°ã€‚</p>
<p>â€”â€” Android Developer</p>
</blockquote>
<p>æ ¹æ® Android å®˜æ–¹çš„å®šä¹‰ï¼Œdp åœ¨å±å¹•ä¸Šå®é™…å¯¹åº”çš„åƒç´  px è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ä¸­ dpi è¡¨ç¤ºï¼š<strong>å±å¹•æ¯å¹³æ–¹è‹±å¯¸æœ‰å¤šå°‘åƒç´ </strong>ï¼Œå¯ä»¥é€šè¿‡å±å¹•å¯¹è§’çº¿çš„åƒç´ æ•° px/å±å¹•å°ºå¯¸ inch è®¡ç®—ã€‚</p>
<p>è€Œ<code>DisplayMetrics.density</code> å­—æ®µè¡¨ç¤ºæ ¹æ®å½“å‰åƒç´ å¯†åº¦æŒ‡å®šå°† <code>dp</code> å•ä½è½¬æ¢ä¸ºåƒç´ æ—¶æ‰€å¿…é¡»ä½¿ç”¨çš„ç¼©æ”¾ç³»æ•°ï¼Œå³ä¸Šè¿°æ–¹ç¨‹ç­‰ä»·äºï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œåœ¨ dpi ä¸º 160 çš„å±å¹•ä¸Š 1dp å  1pxï¼Œåœ¨ dpi ä¸º 320 çš„å±å¹•ä¸Šå  2pxï¼Œé‚£ä¹ˆå°±èƒ½ä¿è¯åŒä¸€ dp çš„åœ¨ä¸åŒ dpi ä¸Šå å¾—åƒç´ æ˜¯ç­‰æ¯”ä¾‹å˜åŒ–çš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­é¢å¯¹åƒå˜ä¸‡åŒ–çš„ Android å±å¹•ï¼Œæ ¹æ® Jessyan çš„æ–‡ç« å¯çŸ¥ç”±äºæ¯ç§å±å¹•å®½/é«˜å¯¹åº”çš„æ€» dp æ•°ä¸ä¸€å®šéƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å³ä½¿ä½¿ç”¨äº† dp ä½œä¸ºå•ä½ï¼Œè¿˜æ˜¯ä¼šå‡ºç°åŒä¸€ dp åœ¨æœ‰äº›å±å¹•ä¸Šåˆšå¥½å æ»¡å…¨å±ï¼Œåœ¨æœ‰çš„å±å¹•ä¸Šä¼šæ— æ³•å æ»¡å…¨å±æˆ–è¶…å‡ºå±å¹•èŒƒå›´ã€‚</p>
<blockquote>
<p><strong>density</strong> åœ¨æ¯ä¸ªè®¾å¤‡ä¸Šéƒ½æ˜¯å›ºå®šçš„ï¼Œ<strong>DPI / 160 = density</strong>ï¼Œ<strong>å±å¹•çš„æ€» px å®½åº¦ / density = å±å¹•çš„æ€» dp å®½åº¦</strong></p>
<ul>
<li>è®¾å¤‡ 1ï¼Œå±å¹•å®½åº¦ä¸º <strong>1080px</strong>ï¼Œ<strong>480DPI</strong>ï¼Œå±å¹•æ€» <strong>dp</strong> å®½åº¦ä¸º <strong>1080 / (480 / 160) = 360dp</strong></li>
<li>è®¾å¤‡ 2ï¼Œå±å¹•å®½åº¦ä¸º <strong>1440px</strong>ï¼Œ<strong>560DPI</strong>ï¼Œå±å¹•æ€» <strong>dp</strong> å®½åº¦ä¸º <strong>1440 / (560 / 160) = 411dp</strong></li>
</ul>
<p>â€”â€”Jessyan</p>
</blockquote>
<p>é‚£ä¹ˆè¯¥æ€ä¹ˆé€‚é…å‘¢ï¼Œå†çœ‹ä¸€çœ¼ä¸Šè¿°çš„å…¬å¼ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»¥é€‚é…<strong>å±å¹•å®½åº¦</strong>ä¸ºä¾‹ï¼Œè¦ä½¿å¾— dp åœ¨ä¸åŒå±å¹•ä¸Šå¯¹åº”çš„åƒç´ ç­‰æ¯”ä¾‹å˜åŒ–ï¼Œå°±è¦<strong>ä¿è¯å±å¹•çš„æ€» dp å®½åº¦ä¸€è‡´</strong>ï¼Œè€Œå±å¹•çš„æ€» px å®½åº¦æ˜¯ç‰©ç†æ¡ä»¶æ— æ³•æ›´æ”¹ï¼Œé‚£ä¹ˆå°±åªèƒ½<strong>æ›´æ”¹ density</strong>ã€‚</p>
<p>ä»¥æˆ‘ä»¬ä½¿ç”¨çš„è®¾è®¡ç¨¿å®½åº¦ä¸º 375dp ä¸ºä¾‹ï¼š</p>
<p>åœ¨åˆ†è¾¨ç‡ä¸º 2160*1080ã€å°ºå¯¸ä¸º 5.99 è‹±å¯¸çš„å±å¹•ä¸Šï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è€Œåœ¨åˆ†è¾¨ç‡ä¸º 2400*1176ã€å°ºå¯¸ä¸º 6.53 è‹±å¯¸çš„å±å¹•ä¸Šï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ ·å°±ä¿è¯äº†ï¼Œä¸ç®¡åœ¨ä»€ä¹ˆæ ·çš„å±å¹•ä¸Šï¼Œ375dp å§‹ç»ˆéƒ½èƒ½å¤Ÿå æ»¡å±å¹•å®½åº¦ï¼Œä¿è¯äº†å¸ƒå±€åœ¨ä¸åŒå¤§å°çš„å±å¹•ä¸Šï¼Œåœ¨å±å¹•å®½åº¦ä¸Šçš„æ¯”ä¾‹ä¸€è‡´æ€§ï¼Œä¹Ÿå°±è§£å†³å±å¹•é€‚é…çš„é—®é¢˜ã€‚</p>
<h2> è·å–çŠ¶æ€æ é«˜åº¦çš„é—®é¢˜</h2>
<p>ä¸Šè¿°çš„å±å¹•é€‚é…æ–¹æ¡ˆä½¿ç”¨ç®€å•ï¼Œä¸”ä¾µå…¥å°ï¼Œåœ¨ä½¿ç”¨åˆ°é¡¹ç›®ä¸­ä¹‹åï¼Œé™¤äº†éƒ¨åˆ†å­—ä½“ç­‰æ˜¾ç¤ºéœ€è¦å¾®è°ƒå¤–ï¼Œå…¶ä½™å†…å®¹åŸºæœ¬ä¸Šéƒ½å®Œç¾è¿˜åŸäº†è®¾è®¡ç¨¿çš„å†…å®¹ã€‚</p>
<p>ä½†æ˜¯åœ¨åç»­ä½¿ç”¨åˆ°çŠ¶æ€æ ç›¸å…³ä»£ç çš„æ—¶å€™å‘ç°<strong>è·å–åˆ°çš„çŠ¶æ€æ é«˜åº¦å’Œå®é™…é«˜åº¦ä¸ä¸€è‡´</strong>ï¼Œå¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸ï¼Œè€Œä½¿ç”¨<a href="http://blankj.com" target="_blank" rel="noopener noreferrer">Blankj</a>çš„å·¥å…·ç±» <code>BarUtils.getStatusBarHeight()</code>å´å¯ä»¥è·å–åˆ°æ­£ç¡®çš„é«˜åº¦ã€‚</p>
<p>å¯¹æ¯”ä¸¤ç§ä»£ç å‘ç°è·å–çŠ¶æ€æ é«˜åº¦çš„ä»£ç é€»è¾‘å‡ ä¹ä¸€æ ·ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸åŒçš„æ˜¯ï¼Œä¸¤ç§æ–¹æ³•ä½¿ç”¨åˆ°çš„ resources ä¸€ä¸ªæ˜¯ APP çš„ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿçš„</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡åˆ†åˆ«æ‰“å°è¿™ä¸¤ç§ resources å¯ä»¥å‘ç°ï¼ŒäºŒè€…çš„ density å€¼ä¸ä¸€æ ·ï¼ˆä»¥ 2160*1080ã€å°ºå¯¸ä¸º 5.99 è‹±å¯¸çš„å±å¹•ä¸ºä¾‹ï¼‰ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ˜¯ç”±äºä½¿ç”¨äº†<a href="https://github.com/JessYanCoding/AndroidAutoSize" target="_blank" rel="noopener noreferrer">AndroidAutoSize</a>é€‚é…æ–¹æ¡ˆåï¼ŒAPP å†…éƒ¨çš„ density å·²ç»è¢«æ”¹æˆäº† 2.88ï¼Œè€Œç³»ç»Ÿå®é™…çš„ density æ˜¯ 2.7ã€‚</p>
<p>åˆçŸ¥é“ android ä¸­å°†åƒç´ å’Œ dp ç­‰å•ä½è½¬åŒ–çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†æå¯çŸ¥ï¼Œé€šè¿‡ getStatusBarHeight() è·å–åˆ°çš„çŠ¶æ€æ æ˜¯ç³»ç»Ÿçš„çŠ¶æ€æ  69pxï¼ˆå³ 25dpï¼‰ï¼Œä½†å½“ä½¿ç”¨ APP å†…éƒ¨çš„ density=2.88 è®¡ç®—æ—¶å°±ä¼šåªæœ‰ 24dpï¼Œå’Œå®é™…çš„çŠ¶æ€æ é«˜åº¦ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ä½¿ç”¨çŠ¶æ€æ é«˜åº¦æ¥æ§åˆ¶å¸ƒå±€çš„æ—¶å€™å°±ä¼šå±•ç¤ºå¼‚å¸¸ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="http://jessyan.me/autosize-introduce/" target="_blank" rel="noopener noreferrer">éªšå¹´ä½ çš„å±å¹•é€‚é…æ–¹å¼è¯¥å‡çº§äº†!-ä»Šæ—¥å¤´æ¡é€‚é…æ–¹æ¡ˆâ€”â€”jessyan</a></p>
<p><a href="https://mp.weixin.qq.com/s/d9QCoBP6kV9VSWvVldVVwA" target="_blank" rel="noopener noreferrer">ä¸€ç§æä½æˆæœ¬çš„ Android å±å¹•é€‚é…æ–¹å¼â€”â€”å­—èŠ‚è·³åŠ¨</a></p>
<p><a href="https://developer.android.google.cn/training/multiscreen/screendensities#top_of_page" target="_blank" rel="noopener noreferrer">æ”¯æŒä¸åŒçš„åƒç´ å¯†åº¦â€”â€”Android Developers</a></p>
<p><a href="https://mp.weixin.qq.com/s/X-aL2vb4uEhqnLzU5wjc4Q" target="_blank" rel="noopener noreferrer">Android ç›®å‰ç¨³å®šé«˜æ•ˆçš„ UI é€‚é…æ–¹æ¡ˆâ€”â€”æ‹‰ä¸å´</a></p>
<p><a href="https://github.com/JessYanCoding/AndroidAutoSize" target="_blank" rel="noopener noreferrer">AndroidAutoSize</a></p>
<p><a href="https://github.com/gyf-dev/ImmersionBar/issues/298" target="_blank" rel="noopener noreferrer">è¯·é—®ä¸¤ç§è·å–å±å¹•å¯†åº¦çš„æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæœ›è§£ç­”å¤šè°¢</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android å¤šæ¸ é“æ‰“åŒ…çŸ¥è¯†</title>
      <link>https://jixiaoyong.github.io/blog/posts/a3a3dc4c.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/a3a3dc4c.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android å¤šæ¸ é“æ‰“åŒ…çŸ¥è¯†</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 25 Mar 2018 14:17:57 GMT</pubDate>
      <content:encoded><![CDATA[<p>å›½å†… Android åº”ç”¨å¸¸å¸¸è¦åˆ†å‘åˆ°å¤šä¸ªåº”ç”¨å•†åº—ï¼Œä½¿ç”¨ Android Studio æ­£ç¡®é…ç½® build.gradle ä¸ AndroidManifest.xml æ–‡ä»¶å¯ä»¥<strong>ä¸€æ­¥æ‰“åŒ…å¤šä¸ªæ¸ é“</strong>ã€‚</p>
<p>æœ¬æ–‡å®ç°çš„å¤šæ¸ é“æ‰“åŒ…å¯å®ç°ä¸åŒæ¸ é“ï¼š</p>
<ul>
<li>æœ‰ä¸åŒçš„é¡¹ç›® idï¼ˆapplicationIdï¼‰</li>
<li>ä¸åŒ App åç§°ï¼ˆandroid:labelï¼‰</li>
<li>ä¸åŒ App å›¾æ ‡ï¼ˆandroid:iconï¼‰</li>
<li>ç­‰ç­‰</li>
</ul>
<h2> 1.å‹ç›Ÿé…ç½®</h2>
<p>*å…·ä½“é…ç½®è¯·å‚è€ƒ UMeng å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>ä½œä¸ºç¬¬ä¸‰æ–¹ç»Ÿè®¡å¹³å°ï¼Œå›½å†…å¾ˆå¤šè½¯ä»¶éƒ½ä½¿ç”¨çš„æ˜¯ Umeng çš„äº§å“ï¼Œæ•…è€Œå¤§å¤šæ•°è½¯ä»¶å¤šæ¸ é“æ‰“åŒ…é…ç½®å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ·»åŠ ä¾èµ–</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>ä¿®æ”¹ AndroidManifest.xml</li>
</ul>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>ä¿®æ”¹ build.gradle</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ç¼–è¯‘å®Œä¹‹åï¼Œé€šè¿‡é€šè¿‡ build&gt;Generate Signed APK...ä¾¿å¯ä»¥æ‰“åŒ…ä¸åŒæ¸ é“çš„ apkï¼Œåœ¨å‹ç›Ÿç»Ÿè®¡å¹³å°ä¸Šç»Ÿè®¡å„ä¸ªæ¸ é“çš„ App ä¿¡æ¯äº†ã€‚</p>
<h2> 2.Android Studio å®ç°å¤šæ¸ é“æ‰“åŒ…</h2>
<p>æ–¹æ³• 1 è¦æ±‚ä¾èµ– umeng æ¨¡å—ï¼Œä½¿ç”¨åœºæ™¯éš¾å…æœ‰äº›å—é™ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®ç°å¤šæ¸ é“æ‰“åŒ…ï¼Œæ–¹æ³• 1 ä½¿ç”¨çš„åº”è¯¥ä¹Ÿæ˜¯æ­¤åŸç†ã€‚</p>
<ul>
<li>AndroidManifest.xml</li>
</ul>
<p>åœ¨éœ€è¦æ ¹æ®æ¸ é“ä¸åŒè€Œå˜åŒ–çš„åœ°æ–¹ä½¿ç”¨<code>${KEY}</code>å½¢å¼æ›¿æ¢æ‰åŸå…ˆçš„å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>app/build.gradle</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>åœ¨ java ä¸­è·å–<code>meta-data</code>ï¼ˆéå¿…é¡»ï¼‰</li>
</ul>
<blockquote>
<p>ã€ŠAndroid è·å– Manifest ä¸­&lt;meta-data&gt;å…ƒç´ çš„å€¼ã€‹ - CSDN åšå®¢ <a href="https://blog.csdn.net/zhang31jian/article/details/29868235" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/zhang31jian/article/details/29868235</a></p>
</blockquote>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> 3.ç”Ÿæˆå¤šä¸ªæ¸ é“æ–‡ä»¶å¤¹</h2>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡åœ¨é¡¹ç›®ä¸­ç”Ÿæˆå¤šä¸ªæ¸ é“çš„æ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢æ›¿æ¢å¯¹åº”çš„èµ„æºæ–‡ä»¶ï¼Œä»è€Œå®ç°å¤šæ¸ é“æ‰“åŒ…ä¸åŒé¡¹ç›®åï¼Œä¸åŒ icon ç­‰ç­‰</p>
<ul>
<li>
<p>åœ¨../app/src/ç›®å½•ä¸‹æ–°å»ºå¯¹åº”æ¸ é“æ–‡ä»¶å¤¹ï¼Œå’Œ main åŒçº§</p>
</li>
<li>
<p>åœ¨è¯¥æ¸ é“ç›®å½•ä¸‹æ–°å»ºå¯¹åº”çš„èµ„æºç›®å½•ï¼Œåœ¨æ‰“åŒ…æ—¶è‡ªåŠ¨æ›¿æ¢å¯¹åº”èµ„æº</p>
<p>â€‹</p>
<p>ç›®å½•æ ‘å¦‚ä¸‹</p>
</li>
</ul>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> 4.More</h2>
<p>æ­¤å¤–è¿˜æœ‰ç¾å›¢çš„å¤šæ¸ é“æ‰“åŒ…æŠ€æœ¯ç­‰</p>
<p>å…·ä½“å¯å‚è€ƒæ–‡ç« ï¼š<a href="https://tech.meituan.com/mt-apk-packaging.html" target="_blank" rel="noopener noreferrer">ç¾å›¢ Android è‡ªåŠ¨åŒ–ä¹‹æ—…â€”ç”Ÿæˆæ¸ é“åŒ…</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android å®ç°å¯æŠ˜å  toolbar</title>
      <link>https://jixiaoyong.github.io/blog/posts/b4832cd1.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/b4832cd1.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android å®ç°å¯æŠ˜å  toolbar</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 22 Feb 2018 07:01:10 GMT</pubDate>
      <content:encoded><![CDATA[<p>ä½¿ç”¨åˆ°çš„ç±»æœ‰ï¼š</p>
<ul>
<li>android.support.design.widget.CoordinatorLayout</li>
<li>android.support.design.widget.AppBarLayout</li>
<li>android.support.design.widget.CollapsingToolbarLayout</li>
<li>android.support.v7.widget.Toolbar</li>
</ul>
<h2> æ•ˆæœé¢„è§ˆ</h2>
<p>å¦‚å›¾ï¼š</p>
<figure><img src="http://jixiaoyong.github.io/blog/images/default/2018-02-22/coordinatorlayout.gif" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2> ç®€è¦è¯´æ˜</h2>
<p>CoordinatorLayout ç±»ï¼Œåè°ƒè€…å¸ƒå±€ï¼Œé€šè¿‡ Behavior å°†ä¸€ä¸ªå­ viewï¼ˆ<code>child</code>ï¼‰çš„è¡Œä¸ºå’Œå¦ä¸€ä¸ªå­ viewï¼ˆ<code>dependency</code>ï¼‰çš„æ´»åŠ¨è”ç»“èµ·æ¥ï¼Œä»è€Œå®ç°å­ view ä¹‹é—´çš„è”åŠ¨ã€‚</p>
<p>AppBarLayout ç±»ï¼Œæ˜¯ä¸€ä¸ªå®ç°äº†ææ–™è®¾è®¡çš„é»˜è®¤å‚ç›´å¸ƒå±€çš„ ViewGroupï¼Œå½“å…¶æ˜¯ CoordinatorLayout ç±»çš„ç›´æ¥å­ view æ—¶ï¼Œå¦å¤–ä¸€ä¸ª CoordinatorLayout çš„å­ view æŒ‡å®šäº† behavior ä¸º AppBarLayout.ScrollingViewBehavior çš„å®ä¾‹ï¼ˆ<code>app:layout_behavior="@string/appbar_scrolling_view_behavior"</code>ï¼‰,ä¸”è¯¥å­ view éœ€è¦æ˜¯ NestedScrollingChild çš„å®ç°ç±»ã€‚</p>
<p>CollapsingToolbarLayout ç±»ï¼Œæä¾›ä¸€ä¸ªå¯ä»¥æŠ˜å çš„ toolbar å¸ƒå±€ï¼Œå¯ä»¥åœ¨è¿™ä¸ªå¸ƒå±€é‡Œé¢ï¼Œè®¾ç½® toolbar ä»¥åŠå’Œ toolbar ä¸€èµ·è”åŠ¨çš„å­ viewï¼Œæœ¬æ¡ˆä¾‹ä¸­æ˜¯ä¸€å¼ å›¾ç‰‡ã€‚</p>
<p>Toolbar ç±»ï¼Œå®ç° toolbar çš„æ•ˆæœã€‚</p>
<h2> å…·ä½“å®ç°</h2>
<p>æºç ï¼š<a href="https://github.com/jixiaoyong/AndroidNote/tree/master/code/2018-02-22" target="_blank" rel="noopener noreferrer">github</a></p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol>
<li>CoordinatorLayout åœ¨æœ€å¤–å±‚ï¼Œæ³¨æ„å…¶ç›´æ¥å­ view å¿…é¡»å°±æ˜¯è¦å®ç°è”åŠ¨çš„ viewï¼Œå¦åˆ™è”åŠ¨å¤±æ•ˆã€‚</li>
<li>CollapsingToolbarLayout å¿…é¡»è®¾ç½® layout_scrollFlagsï¼Œå…¶ä½™å±æ€§å¯é€‰ã€‚</li>
</ol>
<blockquote>
<p>layout_scrollFlags è¯´æ˜å¦‚ä¸‹ï¼š</p>
<p><strong>scroll</strong>ï¼šæ‰€æœ‰æƒ³æ»šåŠ¨å‡ºå±å¹•çš„ view éƒ½éœ€è¦è®¾ç½®è¿™ä¸ª flagï¼Œæ²¡æœ‰è®¾ç½®è¿™ä¸ª flag çš„ view å°†è¢«å›ºå®šåœ¨å±å¹•é¡¶éƒ¨ã€‚</p>
<p><strong>enterAlways</strong>ï¼šè¿™ä¸ª flag è®©ä»»æ„å‘ä¸‹çš„æ»šåŠ¨éƒ½ä¼šå¯¼è‡´è¯¥ view å˜ä¸ºå¯è§ï¼Œå¯ç”¨å¿«é€Ÿâ€œè¿”å›æ¨¡å¼â€ã€‚</p>
<p><strong>enterAlwaysCollapsed</strong>ï¼šå‡è®¾ä½ å®šä¹‰äº†ä¸€ä¸ªæœ€å°é«˜åº¦ï¼ˆminHeightï¼‰åŒæ—¶ enterAlways ä¹Ÿå®šä¹‰äº†ï¼Œé‚£ä¹ˆ view å°†åœ¨åˆ°è¾¾è¿™ä¸ªæœ€å°é«˜åº¦çš„æ—¶å€™å¼€å§‹æ˜¾ç¤ºï¼Œå¹¶ä¸”ä»è¿™ä¸ªæ—¶å€™å¼€å§‹æ…¢æ…¢å±•å¼€ï¼Œå½“æ»šåŠ¨åˆ°é¡¶éƒ¨çš„æ—¶å€™å±•å¼€å®Œã€‚</p>
<p><strong>exitUntilCollapsed</strong>ï¼šå½“ä½ å®šä¹‰äº†ä¸€ä¸ª minHeightï¼Œæ­¤å¸ƒå±€å°†åœ¨æ»šåŠ¨åˆ°è¾¾è¿™ä¸ªæœ€å°é«˜åº¦çš„æ—¶å€™æŠ˜å ã€‚</p>
<p><strong>snap</strong>ï¼šå½“ä¸€ä¸ªæ»šåŠ¨äº‹ä»¶ç»“æŸï¼Œå¦‚æœè§†å›¾æ˜¯éƒ¨åˆ†å¯è§çš„ï¼Œé‚£ä¹ˆå®ƒå°†è¢«æ»šåŠ¨åˆ°æ”¶ç¼©æˆ–å±•å¼€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè§†å›¾åªæœ‰åº•éƒ¨ 25% æ˜¾ç¤ºï¼Œå®ƒå°†æŠ˜å ã€‚ç›¸åï¼Œå¦‚æœå®ƒçš„åº•éƒ¨ 75% å¯è§ï¼Œé‚£ä¹ˆå®ƒå°†å®Œå…¨å±•å¼€ã€‚</p>
<p>ä½œè€…ï¼šå°¹ star</p>
<p>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/5287d090e777" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/5287d090e777</a></p>
</blockquote>
<ol>
<li>CollapsingToolbarLayout çš„å­ view éœ€è¦æŒ‡å®š layout_collapseModeï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€æ³¨æ„ï¼š<strong>å’Œ toolbar è”åŠ¨çš„å­ view é«˜åº¦éœ€å¤§äº toolbar é«˜åº¦ï¼Œå¦åˆ™æ— æ•ˆæœã€‚</strong></li>
<li>ViewPager å°±æ˜¯æœ¬æ¡ˆä¾‹ä¸­è§¦å‘å­ view è”åŠ¨æ•ˆæœçš„<code>dependency</code>ï¼Œéœ€è¦æŒ‡å®šå…¶ behaviorï¼š</li>
</ol>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶å®é™…å¯¹åº”äº android.support.design.widget.AppBarLayout$ScrollingViewBehaviorï¼Œè¿™ä¸ªæ˜¯ç³»ç»Ÿå®ç°çš„ä¸€ä¸ª behaviorï¼Œç”¨äºå’ŒåµŒå¥—æ»‘åŠ¨äº‹ä»¶ç»‘å®šï¼Œ<strong>æŒ‡å®šè¯¥ behavior çš„å­ view éœ€è¦æ˜¯ NestedScrollingChild çš„å®ç°ç±»</strong>ï¼ˆç³»ç»Ÿæä¾›äº† 4 ä¸ªå®ç°ç±»ï¼šNavigationMenuViewã€NestedScrollViewã€RecyclerViewã€SwipleRefreshLayoutï¼‰ï¼Œæ‰€ä»¥ viewPager ä¸­é¡µé¢æœ‰ä¸Šè¿° 4 ä¸ªç±»æˆ–å…¶å­ç±»æ—¶ï¼Œæ‰èƒ½å®ç°ç»‘å®šæ•ˆæœã€‚</p>
<h2> å»¶ä¼¸</h2>
<p><strong>è‡ªå®šä¹‰ Behavior</strong></p>
<p>è‡ªå®šä¹‰ Behavior æœ‰ä¸¤ä¸ªç›®çš„ï¼š</p>
<ol>
<li>å°†ä¸¤ä¸ªæˆ–å¤šä¸ªå­ view ç»‘å®šï¼›</li>
<li>å°†ä¸€ä¸ªå­ view ä¸å¦ä¸€ä¸ªå­ view çš„æ»‘åŠ¨äº‹ä»¶ç»‘å®šåœ¨ä¸€èµ·</li>
</ol>
<p>ä¸¤è€…çš„å·®å¼‚åœ¨äºåœ¨å®ç°<code>CoordinatorLayout.Behavior&lt;T&gt;</code> ç±»æ—¶å€™å…·ä½“é‡å†™çš„æ–¹æ³•ä¸ä¸€æ ·ã€‚</p>
<p><strong>ç›®çš„ 1</strong>ï¼šéœ€è¦é‡å†™çš„æ–¹æ³•æœ‰ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç›®çš„ 2</strong>ï¼šéœ€è¦é‡å†™çš„æ–¹æ³•æœ‰ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<h1> è‡ªå®šä¹‰ Behavior çš„æ€»ç»“</h1>
<ol>
<li>ç¡®å®š CoordinatorLayout ä¸­ View ä¸ View ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œé€šè¿‡ layoutDependsOn() æ–¹æ³•ï¼Œè¿”å›å€¼ä¸º true åˆ™ä¾èµ–ï¼Œå¦åˆ™ä¸ä¾èµ–ã€‚</li>
<li>å½“ä¸€ä¸ªè¢«ä¾èµ–é¡¹ dependency å°ºå¯¸æˆ–è€…ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¾èµ–æ–¹ä¼šé€šè¿‡ Byhavior è·å–åˆ°ï¼Œç„¶ååœ¨ onDependentViewChanged ä¸­å¤„ç†ã€‚å¦‚æœåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ child å°ºå¯¸æˆ–è€…ä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™éœ€è¦ return trueã€‚</li>
<li>å½“ Behavior ä¸­çš„ View å‡†å¤‡å“åº”åµŒå¥—æ»‘åŠ¨æ—¶ï¼Œå®ƒä¸éœ€è¦é€šè¿‡ layoutDependsOn() æ¥è¿›è¡Œä¾èµ–ç»‘å®šã€‚åªéœ€è¦åœ¨ onStartNestedScroll() æ–¹æ³•ä¸­é€šè¿‡è¿”å›å€¼å‘ŠçŸ¥ ViewParentï¼Œå®ƒæ˜¯å¦å¯¹åµŒå¥—æ»‘åŠ¨æ„Ÿå…´è¶£ã€‚è¿”å›å€¼ä¸º true æ—¶ï¼Œåç»­çš„æ»‘åŠ¨äº‹ä»¶æ‰èƒ½è¢«å“åº”ã€‚</li>
<li>åµŒå¥—æ»‘åŠ¨åŒ…æ‹¬æ»‘åŠ¨ (scroll) å’Œ å¿«é€Ÿæ»‘åŠ¨ (fling) ä¸¤ç§æƒ…å†µã€‚å¼€å‘è€…æ ¹æ®å®é™…æƒ…å†µè¿ç”¨å°±å¥½äº†ã€‚</li>
<li>Behavior é€šè¿‡ 3 ç§æ–¹å¼ç»‘å®šï¼š1. xml å¸ƒå±€æ–‡ä»¶ã€‚2. ä»£ç è®¾ç½® layoutparamã€‚3. è‡ªå®šä¹‰ View çš„æ³¨è§£ã€‚</li>
</ol>
<p>æ¥æºï¼š<a href="http://blog.csdn.net/briblue/article/details/73076458" target="_blank" rel="noopener noreferrer">é’ˆå¯¹ CoordinatorLayout åŠ Behavior çš„ä¸€æ¬¡ç»†èŠ‚è¾ƒçœŸ - frank çš„ä¸“æ  - CSDN åšå®¢</a></p>
</blockquote>
<h2> å‚è€ƒæ–‡çŒ®</h2>
<ul>
<li><a href="http://blog.csdn.net/briblue/article/details/73076458" target="_blank" rel="noopener noreferrer">é’ˆå¯¹ CoordinatorLayout åŠ Behavior çš„ä¸€æ¬¡ç»†èŠ‚è¾ƒçœŸ - frank çš„ä¸“æ  - CSDN åšå®¢</a></li>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2016/0824/6565.html" target="_blank" rel="noopener noreferrer">CoordinatorLayout è‡ªå®šä¹‰ Behavior å¹¶ä¸éš¾ï¼Œç”±ç®€åˆ°éš¾æ‰‹æŠŠæ‰‹å¸¦ä½ æ’¸ä¸‰æ¬¾ï¼ - æ³¡åœ¨ç½‘ä¸Šçš„æ—¥å­</a></li>
<li><a href="https://www.jianshu.com/p/8c92d0a1e591" target="_blank" rel="noopener noreferrer">ä¸€æ­¥ä¸€æ­¥æ·±å…¥ç†è§£ CoordinatorLayout - ç®€ä¹¦</a></li>
<li><a href="https://www.jianshu.com/p/5287d090e777" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ CoordinatorLayout æ‰“é€ ä¸€ä¸ªç‚«é…·çš„è¯¦æƒ…é¡µ - ç®€ä¹¦</a></li>
</ul>
]]></content:encoded>
      <enclosure url="http://jixiaoyong.github.io/blog/images/default/2018-02-22/coordinatorlayout.gif" type="image/gif"/>
    </item>
    <item>
      <title>Android æ§ä»¶ç»„</title>
      <link>https://jixiaoyong.github.io/blog/posts/3b69424a.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/3b69424a.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android æ§ä»¶ç»„</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 20 Sep 2017 15:25:05 GMT</pubDate>
      <content:encoded><![CDATA[<p>è¿™å‡ å¤©çš„å·¥ä½œä¸­ç”¨åˆ°äº†æ§ä»¶ç»„æ¥å®ç°å¤æ‚å¸ƒå±€ï¼Œæ•ˆæœä¸é”™ï¼Œè®°å½•ä¸‹æ¥å¤‡ç”¨ã€‚</p>
<h2> 1. å®šä¹‰æ§ä»¶ç»„å¸ƒå±€ xxx_layout.xml</h2>
<p>åœ¨è¿™é‡Œå®šä¹‰è¦ä½¿ç”¨çš„æ§ä»¶ç»„å¸ƒå±€ï¼Œè¿™é‡Œçš„å¸ƒå±€å†³å®šäº†å¸ƒå±€æ˜¾ç¤ºçš„æ ·å­ã€‚</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> 2.æ–°å»ºè‡ªå®šä¹‰å±æ€§æ–‡ä»¶ attr.xmlï¼ˆå¯é€‰ï¼‰</h2>
<ul>
<li>
<p>åœ¨<code>values/attr.xml</code>ä¸‹æ–°å»ºå¯¹åº”æ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¯¹äºè‡ªå®šä¹‰å±æ€§ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ activity å¸ƒå±€æ–‡ä»¶é‡Œé¢ä½¿ç”¨åˆ°è¯¥ä»¶ç»„æ—¶è‡ªå®šä¹‰æ§ä¸€äº›å±æ€§ã€‚</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>åœ¨è¯¥è‡ªå®šä¹‰æ§ä»¶çš„ç±» xxx.java ä¸­ï¼Œé€šè¿‡å¦‚ä¸‹è¯­å¥è·å–ä»ç”¨æˆ·ä½¿ç”¨æ—¶èµ‹ç»™è¿™äº›å±æ€§çš„å€¼ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹</p>
</li>
<li>
<p>ç”¨æˆ·åŠ¨æ€ç»™è¿™äº›å±æ€§èµ‹å€¼ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œè¿™é‡Œå†™çš„æ˜¯<code>app:</code>è€Œé<code>android:</code>ã€‚</p>
<p>â€‹</p>
</li>
</ul>
<h2> 3. æ–°å»ºç»„åˆæ§ä»¶çš„ç±» XXX.java</h2>
<ul>
<li>
<p>æ–°å»º XXX.javaï¼Œç»§æ‰¿è‡ªå¸ƒå±€æ–‡ä»¶çš„çˆ¶å¸ƒå±€ LinearLayout</p>
</li>
<li>
<p>æ›´æ”¹å‚æ•°å°‘çš„æ„é€ æ–¹æ³•çš„<code>super(a1,a2,a3)</code>ä¸º<code>this(a1,a2,a3)</code>ï¼Œå…¶ä¸­<code>this()</code>ä¸­çš„å‚æ•°ä¸ªæ•°ä¸ºå‚æ•°æœ€å¤šçš„æ„é€ æ–¹æ³•çš„å‚æ•°æ•°ã€‚</p>
<p><strong>æ³¨æ„</strong> ï¼šä¸€å®šè¦åšè¿™ä¸€æ­¥ï¼Œå¦åˆ™åœ¨ä½¿ç”¨è¯¥è‡ªå®šä¹‰æ§ä»¶ç»„æ—¶ï¼Œæ–°å»ºè¯¥ç±»çš„å¯¹è±¡ä¼šæç¤ºå‡ºé”™</p>
</li>
<li>
<p>åœ¨æœ€ç»ˆä¼šè¢«è°ƒç”¨çš„æ„é€ æ–¹æ³•é‡Œé¢å°† xml é‡Œé¢å®šä¹‰çš„å¸ƒå±€åŠ è½½è¿›æ¥ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>ä½¿ç”¨è‡ªå®šä¹‰å±æ€§ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>ç»™æ§ä»¶ç»„å†…éƒ¨æ§ä»¶æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬ï¼š</p>
<ul>
<li>
<p>xxx.java è¦å®ç°ç‚¹å‡»äº‹ä»¶ç›‘å¬æ¥å£ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p>è‡ªå®šä¹‰æ¥å£ï¼Œä¾›ä½¿ç”¨ xxx.java ç±»æ—¶å®ç°å¯¹ç›‘å¬äº‹ä»¶çš„å¤„ç†ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>å¯¹è¦ç›‘å¬ç‚¹å‡»äº‹ä»¶çš„æ§ä»¶è®¾ç½®ç›‘å¬ï¼Œå¹¶è°ƒç”¨<code>listener.onClick()</code>æ–¹æ³•ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ul>
</li>
</ul>
<h2> 4. ä½¿ç”¨è‡ªå®šä¹‰æ§ä»¶ç»„ xxx.java</h2>
<ul>
<li>
<p>åœ¨å¸ƒå±€æ–‡ä»¶ main_activity.xml ä¸­æ·»åŠ è¯¥æ§ä»¶</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹</p>
</li>
<li>
<p>åœ¨ java ä¸­ä½¿ç”¨è¯¥æ§ä»¶ï¼Œè®¾ç½®ç›‘å¬äº‹ä»¶</p>
</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> 5.æ•ˆæœé¢„è§ˆ</h2>
<figure><img src="http://upload-images.jianshu.io/upload_images/120748-48d0cbbf03ded7f4.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240" alt="æ•ˆæœé¢„è§ˆ" tabindex="0" loading="lazy"><figcaption>æ•ˆæœé¢„è§ˆ</figcaption></figure>
<h2> 6.æºç </h2>
<p>demo çš„ github é“¾æ¥ï¼š<a href="https://github.com/jixiaoyong/my_application_on_deepin/tree/master/weightgroup" target="_blank" rel="noopener noreferrer">github</a></p>
]]></content:encoded>
      <enclosure url="http://upload-images.jianshu.io/upload_images/120748-48d0cbbf03ded7f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" type="image/"/>
    </item>
    <item>
      <title>Android ç¬”è®°ä¹‹ Xfermode</title>
      <link>https://jixiaoyong.github.io/blog/posts/104c9058.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/104c9058.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ç¬”è®°ä¹‹ Xfermode</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 15 Apr 2020 06:05:03 GMT</pubDate>
      <content:encoded><![CDATA[<p><code>Xfermode</code>æ˜¯ Android ä¸­ç”¨æ¥æŒ‡ç¤º<code>Paint</code>ç»˜åˆ¶çš„å†…å®¹ä¸ View ä¸­å·²æœ‰å†…å®¹çš„æ··åˆè®¡ç®—æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥ç¡®å®šå›¾å½¢ç»˜åˆ¶åˆ°ç›®æ ‡å›¾å½¢çš„æ—¶å€™ï¼Œå¦‚ä½•å¤„ç†ä¸¤ä¸ªå›¾å½¢é‡åˆéƒ¨åˆ†çš„é¢œè‰²å˜åŒ–ã€‚å…± 18 ä¸ªï¼Œåˆ†ä¸º Alpha åˆæˆå’Œæ··åˆä¸¤ç§ã€‚</p>
<p>è®¾è¦ç»˜åˆ¶çš„å›¾å½¢ä¸º<code>src</code>ï¼Œå·²ç»ç»˜åˆ¶å¥½çš„å›¾å½¢ä¸º<code>dst</code>ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›å›¾ç‰‡é™¤äº†è¦ç»˜åˆ¶çš„å›¾å½¢æœ‰ç€è‰²ä¹‹å¤–ï¼Œå…¶ä»–éƒ¨åˆ†è¦ä¸ºé€æ˜ï¼Œå¹¶ä¸”<strong>åŒ…æ‹¬é€æ˜åŒºåŸŸåœ¨å†…çš„å›¾ç‰‡å¤§å°ï¼ˆå®½é«˜ï¼‰è¦èƒ½å®Œå…¨è¦†ç›–å¦å¤–ä¸€å¼ å›¾ç‰‡çš„å›¾å½¢åŒºåŸŸ</strong>ï¼Œå¦åˆ™ç»˜åˆ¶å‡ºçš„å›¾å½¢å¯èƒ½ä¸é¢„è®¾çš„æ•ˆæœä¸ä¸€è‡´</p>
</blockquote>
<p>æŒ‰ç…§å®˜æ–¹çš„å®šä¹‰ï¼Œä¸åŒ<code>Xfermode</code>ç»˜åˆ¶ç»“æœå¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20200415211144.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2> æ³¨æ„äº‹é¡¹</h2>
<p>è¦å®ç°å¦‚ä¸Šæ•ˆæœï¼Œéœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>
<p><code>src</code>å’Œ<code>dst</code>ç¬¦åˆè¦æ±‚ï¼ˆè¦æœ‰åˆé€‚çš„é€æ˜åŒºåŸŸï¼‰</p>
<p>è¿™æ˜¯å› ä¸º<code>xfermode</code>çš„æ•ˆæœï¼Œä½¿ç”¨é€æ˜éƒ¨åˆ†çš„åƒç´ ä¸å·²æœ‰å›¾å½¢å¯¹åº”ä½ç½®äº¤å‰ä½œç”¨ï¼Œå¾—å‡ºæ‰€éœ€è¦çš„æ•ˆæœï¼Œå¦‚æœé€æ˜åŒºåŸŸè¿‡å°ï¼Œåˆ™æ— æ³•ä½œç”¨åˆ°å¯¹åº”çš„å›¾å½¢ã€‚ä¸‹é¢è¿™ä¸ªæ¥è‡ª <a href="http://Hencoder.com" target="_blank" rel="noopener noreferrer">Hencoder.com</a> çš„å›¾å¯ä»¥å¾ˆå½¢è±¡çš„è§£é‡Šï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20200416213802.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
</li>
<li>
<p>åœ¨æ–°çš„å›¾å±‚ç»˜åˆ¶ï¼ˆåœ¨æ–°çš„å›¾å±‚æŒ‰ç…§<code>xfermode</code>è§„åˆ™ç»˜åˆ¶ï¼Œç„¶åå†å°†å…¶ç»˜åˆ¶åˆ°åŸæœ‰å›¾å±‚ï¼‰ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>å…³é—­ç¡¬ä»¶åŠ é€Ÿï¼ˆå¯é€‰ï¼‰</p>
<p>ç¡¬ä»¶åŠ é€Ÿçš„æœ¬è´¨æ˜¯æŠŠä¸€éƒ¨åˆ† CPU è®¡ç®—çš„å·¥ä½œé‡äº¤ç»™ GPU å®Œæˆï¼Œå¯ä»¥åŠ é€Ÿç»˜åˆ¶é€Ÿåº¦ã€‚</p>
<p>ä½†æ˜¯ç”±äºç¡¬ä»¶åŠ é€Ÿä¸æ”¯æŒ<code>canvas.drawXXX()</code>çš„éƒ¨åˆ†æ–¹æ³•ï¼Œä¸ºäº†é¿å…åœ¨æŸäº›æœºå‹ä¸Šé¢æ— æ³•ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥å…³é—­ç¡¬ä»¶åŠ é€Ÿï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…³äºç¡¬ä»¶åŠ é€Ÿæ›´è¯¦ç»†çš„è¯´æ˜å¯ä»¥å‚è€ƒè¿™é‡Œï¼š<a href="https://hencoder.com/ui-1-8/" target="_blank" rel="noopener noreferrer">HenCoder Android è‡ªå®šä¹‰ View 1-8 ç¡¬ä»¶åŠ é€Ÿ</a></p>
</li>
</ul>
<h2> Xfermode åˆ†ç±»</h2>
<p><a href="https://hencoder.com/ui-1-2/" target="_blank" rel="noopener noreferrer">HenCoder.com</a>å…³äº<code>PorterDuff.Mode.DST_IN</code>çš„åŠ¨ç”»è§£é‡Šï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20200416214402.gif" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>Xfermode</code>çš„æœ¬è´¨æ˜¯å¤„ç†<code>dst</code>ä¸<code>src</code><strong>é‡åˆä¸æœªé‡åˆéƒ¨åˆ†</strong>çš„å±•ç¤ºä¸å¦ï¼Œä»¥åŠé¢œè‰²å˜åŒ–ã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„â€œé‡åˆéƒ¨åˆ†â€ä¸â€œæœªé‡åˆéƒ¨åˆ†â€ï¼Œå…¶å®ä¹ŸåŒ…æ‹¬äº†å„ä¸ªå›¾å½¢çš„é€æ˜éƒ¨åˆ†ï¼Œå°†<code>dst</code>ä¸<code>src</code>çš„é€æ˜ä¸ä¸é€æ˜é¢œè‰²ç›¸äº’ä½œç”¨ï¼Œæ‰ä¼šå‡ºç°ä¸‹è¿°æ•ˆæœã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CLEAR</code></td>
<td>æ¸…é™¤æ‰€æœ‰å†…å®¹</td>
</tr>
<tr>
<td><code>DST</code></td>
<td>åªç»˜åˆ¶<code>DST</code></td>
</tr>
<tr>
<td><code>DST_ATOP</code></td>
<td>å…ˆç»˜åˆ¶<code>SRC</code>ï¼Œå†åœ¨é¡¶éƒ¨ç»˜åˆ¶<code>DST</code>ä¸<code>SRC</code>é‡åˆçš„éƒ¨åˆ†</td>
</tr>
<tr>
<td><code>DST_IN</code></td>
<td>åªç»˜åˆ¶<code>DST</code>ä¸<code>SRC</code>é‡åˆéƒ¨åˆ†</td>
</tr>
<tr>
<td><code>DST_OUT</code></td>
<td>åªç»˜åˆ¶<code>DST</code>ä¸<code>SRC</code>æœªé‡åˆéƒ¨åˆ†</td>
</tr>
<tr>
<td><code>DST_OVER</code></td>
<td>å°†<code>DST</code>ç»˜åˆ¶åœ¨<code>SRC</code>ä¸Šé¢</td>
</tr>
<tr>
<td><code>SRC</code></td>
<td>åªç»˜åˆ¶<code>SRC</code></td>
</tr>
<tr>
<td><code>SRC_ATOP</code></td>
<td>å…ˆç»˜åˆ¶<code>DST</code>ï¼Œå†åœ¨é¡¶éƒ¨ç»˜åˆ¶<code>SRC</code>ä¸<code>DST</code>é‡åˆçš„éƒ¨åˆ†</td>
</tr>
<tr>
<td><code>SRC_IN</code></td>
<td>åªç»˜åˆ¶<code>SRC</code>ä¸<code>DST</code>é‡åˆéƒ¨åˆ†</td>
</tr>
<tr>
<td><code>SRC_OUT</code></td>
<td>åªç»˜åˆ¶<code>SRC</code>ä¸<code>DST</code>æœªé‡åˆéƒ¨åˆ†</td>
</tr>
<tr>
<td><code>SRC_OVER</code></td>
<td>å°†<code>SRC</code>ç»˜åˆ¶åœ¨<code>DST</code>ä¸Šé¢</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><code>XOR</code></td>
<td></td>
</tr>
<tr>
<td><code>ADD</code></td>
<td></td>
</tr>
<tr>
<td><code>DARKEN</code></td>
<td></td>
</tr>
<tr>
<td><code>LIGHTEN</code></td>
<td></td>
</tr>
<tr>
<td><code>MULTIPLY</code></td>
<td></td>
</tr>
<tr>
<td><code>OVERLAY</code></td>
<td></td>
</tr>
<tr>
<td><code>SCREEN</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>å„ä¸ªæ•ˆæœå¦‚ä¸‹ (æºç åŠä½¿ç”¨è§<a href="https://github.com/jixiaoyong/library/commit/71864b6546460acfaae6299890a0cf76da76b7d7" target="_blank" rel="noopener noreferrer">github</a>)ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20200415211144.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2> å‚è€ƒæ–‡çŒ®</h2>
<p><a href="https://hencoder.com/ui-1-2/" target="_blank" rel="noopener noreferrer">HenCoder Android å¼€å‘è¿›é˜¶ï¼šè‡ªå®šä¹‰ View 1-2 Paint è¯¦è§£</a></p>
<p><a href="https://hencoder.com/ui-1-8/" target="_blank" rel="noopener noreferrer">HenCoder Android è‡ªå®šä¹‰ View 1-8 ç¡¬ä»¶åŠ é€Ÿ</a></p>
<p><a href="https://developer.android.google.cn/reference/android/graphics/PorterDuff.Mode.html" target="_blank" rel="noopener noreferrer">PorterDuff.Mode</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20200415211144.png" type="image/png"/>
    </item>
    <item>
      <title>Android ç¬”è®°ä¹‹è·¨è¿›ç¨‹é€šä¿¡</title>
      <link>https://jixiaoyong.github.io/blog/posts/7e97a976.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/7e97a976.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ç¬”è®°ä¹‹è·¨è¿›ç¨‹é€šä¿¡</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 26 Dec 2019 10:52:54 GMT</pubDate>
      <content:encoded><![CDATA[<p>Android ä¸­çš„è·¨è¿›ç¨‹é€šä¿¡ IPC ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li>BroadcastReceiver</li>
<li>ContentProvider</li>
<li>AIDL</li>
<li>Messenger</li>
<li>Socket</li>
<li>æ–‡ä»¶</li>
</ul>
<p>Linux å·²ç»æä¾›äº†ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜å’Œ Socket ç­‰ IPC æœºåˆ¶</p>
<p><strong>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</strong></p>
<h2> ä¸€äº›åŸºç¡€çŸ¥è¯†</h2>
<p>ä»¥ä¸‹å†…å®¹æ¥è‡ªï¼š</p>
<p>ä½œè€…ï¼šSylvanasSun<br>
é“¾æ¥ï¼š<a href="https://juejin.im/post/59f8691b51882534af254317" target="_blank" rel="noopener noreferrer">https://juejin.im/post/59f8691b51882534af254317</a><br>
æ¥æºï¼šæ˜é‡‘<br>
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<p>Linux ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªå•ç‹¬çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚<strong>è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†ä¸ºå†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´</strong>ï¼Œç”¨æˆ·ç©ºé—´åŒ…æ‹¬ä»£ç ã€æ•°æ®ã€å †ã€å…±äº«åº“ä»¥åŠæ ˆï¼Œå†…æ ¸ç©ºé—´åŒ…æ‹¬å†…æ ¸ä¸­çš„ä»£ç å’Œæ•°æ®ç»“æ„ï¼Œå†…æ ¸ç©ºé—´çš„æŸäº›åŒºåŸŸè¢«æ˜ å°„åˆ°æ‰€æœ‰è¿›ç¨‹å…±äº«çš„ç‰©ç†é¡µé¢ã€‚Linux ä¹Ÿå°†ä¸€ç»„è¿ç»­çš„è™šæ‹Ÿé¡µé¢ï¼ˆå¤§å°ç­‰äºå†…å­˜æ€»é‡ï¼‰æ˜ å°„åˆ°ç›¸åº”çš„ä¸€ç»„è¿ç»­çš„ç‰©ç†é¡µé¢ï¼Œè¿™ç§åšæ³•ä¸ºå†…æ ¸æä¾›äº†ä¸€ç§ä¾¿åˆ©çš„æ–¹æ³•æ¥è®¿é—®ç‰©ç†å†…å­˜ä¸­ä»»ä½•ç‰¹å®šçš„ä½ç½®ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20200422114446.png" alt="ç¤ºæ„å›¾æ¥è‡ª https://juejin.im/post/59f8691b51882534af254317" tabindex="0" loading="lazy"><figcaption>ç¤ºæ„å›¾æ¥è‡ª <a href="https://juejin.im/post/59f8691b51882534af254317" target="_blank" rel="noopener noreferrer">https://juejin.im/post/59f8691b51882534af254317</a></figcaption></figure>
<p>Linux é€šè¿‡å°†ä¸€ä¸ªè™šæ‹Ÿå†…å­˜åŒºåŸŸä¸ä¸€ä¸ªç¡¬ç›˜ä¸Šçš„æ–‡ä»¶å…³è”èµ·æ¥ï¼Œä»¥åˆå§‹åŒ–è¿™ä¸ªè™šæ‹Ÿå†…å­˜åŒºåŸŸçš„å†…å®¹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>å†…å­˜æ˜ å°„</strong>ï¼ˆmemory mappingï¼‰ã€‚è¿™ç§å°†è™šæ‹Ÿå†…å­˜ç³»ç»Ÿé›†æˆåˆ°æ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•å¯ä»¥ç®€å•è€Œé«˜æ•ˆåœ°æŠŠç¨‹åºå’Œæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p>
<p><strong>æ™®é€šæ–‡ä»¶æ˜ å°„å°±æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶ä¸ä¸€å—å†…å­˜å»ºç«‹èµ·æ˜ å°„å…³ç³»ï¼Œå¯¹è¯¥æ–‡ä»¶è¿›è¡Œ IO æ“ä½œå¯ä»¥ç»•è¿‡å†…æ ¸ç›´æ¥åœ¨ç”¨æˆ·æ€å®Œæˆï¼ˆç”¨æˆ·æ€åœ¨è¯¥è™šæ‹Ÿåœ°å€åŒºåŸŸè¯»å†™å°±ç›¸å½“äºè¯»å†™è¿™ä¸ªæ–‡ä»¶ï¼‰</strong>ã€‚åŒ¿åæ–‡ä»¶æ˜ å°„ä¸€èˆ¬åœ¨ç”¨æˆ·ç©ºé—´éœ€è¦åˆ†é…ä¸€æ®µå†…å­˜æ¥å­˜æ”¾æ•°æ®æ—¶ï¼Œç”±å†…æ ¸åˆ›å»ºåŒ¿åæ–‡ä»¶å¹¶ä¸å†…å­˜è¿›è¡Œæ˜ å°„ï¼Œä¹‹åç”¨æˆ·æ€å°±å¯ä»¥é€šè¿‡æ“ä½œè¿™æ®µè™šæ‹Ÿåœ°å€æ¥æ“ä½œå†…å­˜äº†ã€‚åŒ¿åæ–‡ä»¶æ˜ å°„æœ€ç†Ÿæ‚‰çš„åº”ç”¨åœºæ™¯å°±æ˜¯åŠ¨æ€å†…å­˜åˆ†é…ï¼ˆmalloc() å‡½æ•°ï¼‰ã€‚</p>
<p><strong>å†…å­˜æ˜ å°„æä¾›äº†å…±äº«å¯¹è±¡çš„æœºåˆ¶ï¼Œæ¥é¿å…å†…å­˜èµ„æºçš„æµªè´¹ã€‚ä¸€ä¸ªå¯¹è±¡è¢«æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜çš„ä¸€ä¸ªåŒºåŸŸï¼Œè¦ä¹ˆæ˜¯ä½œä¸ºå…±äº«å¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯ä½œä¸ºç§æœ‰å¯¹è±¡çš„ã€‚</strong> è¿›ç¨‹å¯¹å…±äº«å¯¹è±¡çš„å†™æ“ä½œå¯¹äºå…¶ä»–ä¹Ÿä½¿ç”¨åˆ°è¯¥å…±äº«å¯¹è±¡çš„è¿›ç¨‹æ˜¯å¯è§çš„ã€‚</p>
<p>CPU è·å–åˆ°è™šæ‹Ÿåœ°å€ï¼Œç„¶åé€šè¿‡ MMUï¼ˆå†…å­˜ç®¡ç†å•å…ƒï¼‰å°†å…¶ç¿»è¯‘ä¸ºç‰©ç†åœ°å€ã€‚</p>
<h2> linux IPC</h2>
<p>ä¼˜ç¼ºç‚¹å‚è€ƒï¼š</p>
<blockquote>
<ol>
<li>ç®¡é“ï¼šåœ¨åˆ›å»ºæ—¶åˆ†é…ä¸€ä¸ª page å¤§å°çš„å†…å­˜ï¼Œç¼“å­˜åŒºå¤§å°æ¯”è¾ƒæœ‰é™ï¼›</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šä¿¡æ¯å¤åˆ¶ä¸¤æ¬¡ï¼Œé¢å¤–çš„ CPU æ¶ˆè€—ï¼›ä¸åˆé€‚é¢‘ç¹æˆ–ä¿¡æ¯é‡å¤§çš„é€šä¿¡ï¼›</li>
<li>å…±äº«å†…å­˜ï¼šæ— é¡»å¤åˆ¶ï¼Œå…±äº«ç¼“å†²åŒºç›´æ¥ä»˜é™„åŠ åˆ°è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé€Ÿåº¦å¿«ï¼›ä½†è¿›ç¨‹é—´çš„åŒæ­¥é—®é¢˜æ“ä½œç³»ç»Ÿæ— æ³•å®ç°ï¼Œå¿…é¡»å„è¿›ç¨‹åˆ©ç”¨åŒæ­¥å·¥å…·è§£å†³ï¼›</li>
<li>å¥—æ¥å­—ï¼šä½œä¸ºæ›´é€šç”¨çš„æ¥å£ï¼Œä¼ è¾“æ•ˆç‡ä½ï¼Œä¸»è¦ç”¨äºä¸é€šæœºå™¨æˆ–è·¨ç½‘ç»œçš„é€šä¿¡ï¼›</li>
<li>ä¿¡å·é‡ï¼šå¸¸ä½œä¸ºä¸€ç§é”æœºåˆ¶ï¼Œé˜²æ­¢æŸè¿›ç¨‹æ­£åœ¨è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿè®¿é—®è¯¥èµ„æºã€‚å› æ­¤ï¼Œä¸»è¦ä½œä¸ºè¿›ç¨‹é—´ä»¥åŠåŒä¸€è¿›ç¨‹å†…ä¸åŒçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ‰‹æ®µã€‚</li>
<li>ä¿¡å·ï¼šä¸é€‚ç”¨äºä¿¡æ¯äº¤æ¢ï¼Œæ›´é€‚ç”¨äºè¿›ç¨‹ä¸­æ–­æ§åˆ¶ï¼Œæ¯”å¦‚éæ³•å†…å­˜è®¿é—®ï¼Œæ€æ­»æŸä¸ªè¿›ç¨‹ç­‰ï¼›</li>
</ol>
<p>ä½œè€…ï¼šGityuan<br>
é“¾æ¥ï¼š<a href="https://www.zhihu.com/question/39440766/answer/89210950" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/39440766/answer/89210950</a></p>
</blockquote>
<ul>
<li>ç®¡é“ Pipe</li>
</ul>
<p><a href="https://zh.wikipedia.org/wiki/%E7%AE%A1%E9%81%93_(Unix)" target="_blank" rel="noopener noreferrer">ç®¡é“</a> æ˜¯å°†æ ‡å‡†è¾“å…¥è¾“å‡ºè¿æ¥èµ·æ¥çš„è¿›ç¨‹ã€‚ <strong>æ•°æ®å¤åˆ¶ 2 æ¬¡ï¼Œæœ‰é•¿åº¦é™åˆ¶</strong></p>
<figure><img src="https://jixiaoyong.github.io/images/20200422114721.jpg" alt="ç¤ºæ„å›¾æ¥è‡ª https://pic002.cnblogs.com/images/2012/426620/2012110216160766.jpg" tabindex="0" loading="lazy"><figcaption>ç¤ºæ„å›¾æ¥è‡ª <a href="https://pic002.cnblogs.com/images/2012/426620/2012110216160766.jpg" target="_blank" rel="noopener noreferrer">https://pic002.cnblogs.com/images/2012/426620/2012110216160766.jpg</a></figcaption></figure>
<p>å¦‚å›¾ï¼Œè¿›ç¨‹ 1 å°†æ•°æ®<strong>å†™å…¥</strong>åˆ°ç®¡é“ï¼ˆå†…å­˜ç¼“å­˜åŒºï¼‰ï¼Œè¿›ç¨‹ 2 ä»ç®¡é“ä¸­<strong>è¯»å–</strong>æ•°æ®ã€‚æ•°æ®ä»å†™ç«¯æµå…¥ç®¡é“ï¼Œä»è¯»ç«¯æµå‡ºï¼Œè¿™æ ·å°±å®ç°äº†è¿›ç¨‹é—´é€šä¿¡</p>
<p>æ¯ä¸ªè¿›ç¨‹çš„è¾“å‡ºè¢«å½“åšä¸‹ä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ã€‚</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><a href="https://www.cnblogs.com/biyeymyhjob/archive/2012/11/03/2751593.html" target="_blank" rel="noopener noreferrer">Linux è¿›ç¨‹é—´é€šä¿¡ä¹‹ç®¡é“ (pipe)ã€å‘½åç®¡é“ (FIFO) ä¸ä¿¡å· (Signal)</a><br>
<a href="https://blog.csdn.net/skyroben/article/details/71513385" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/skyroben/article/details/71513385</a></p>
<ul>
<li>æ¶ˆæ¯é˜Ÿåˆ— Message</li>
</ul>
<p>æ˜¯ä¸€ä¸²å¯ä»¥æœ‰ä¸åŒç±»å‹çš„æ¶ˆæ¯å—çš„é“¾è¡¨ï¼Œå¯ä»¥é¿å…é˜»å¡ã€‚<strong>æ•°æ®å¤åˆ¶ 2 æ¬¡ï¼Œæœ‰é•¿åº¦é™åˆ¶</strong>ï¼Œç¼“å†²å°ã€‚</p>
<p><a href="https://www.ibm.com/developerworks/cn/linux/l-ipc/part3/index.html" target="_blank" rel="noopener noreferrer">https://www.ibm.com/developerworks/cn/linux/l-ipc/part3/index.html</a></p>
<ul>
<li>å…±äº«å†…å­˜</li>
</ul>
<p>å¤šä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®ä¸€ä¸ªå…¬ç”¨çš„å†…å­˜ç©ºé—´ã€‚æ•ˆç‡æœ€é«˜çš„ IPCã€‚<strong>æ•°æ®å†…å­˜å¤åˆ¶ 0 æ¬¡ï¼Œä½†æ˜¯æ²¡æœ‰åŒæ­¥äº’æ–¥æœºåˆ¶</strong></p>
<ul>
<li>å¥—æ¥å­— Socket</li>
</ul>
<p>ä¼ è¾“æ•ˆç‡ä½ï¼Œ<strong>æ•°æ®å¤åˆ¶ 2 æ¬¡</strong></p>
<ul>
<li>ä¿¡å·é‡ semaphore</li>
</ul>
<p>ä¸ç®¡é“ä¸åŒï¼Œä¿¡å·é‡æ˜¯ä¸ºäº†ä¿æŠ¤è¿›ç¨‹å…±äº«èµ„æºåœ¨åŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹è®¿é—®ã€‚è§£å†³åŒæ­¥å’Œäº’æ–¥é—®é¢˜ã€‚</p>
<p>svï¼šä¿¡å·å˜é‡</p>
<p>å¯¹ä¿¡å·é‡çš„æ“ä½œåªæœ‰ä¸€ä¸‹ P(sv) å’Œ V(sv) ä¸¤ä¸ªåŸå­æ“ä½œï¼š</p>
<ol>
<li>è¿›ç¨‹ 1 è®¿é—®èµ„æºæ—¶å¯¹ä¿¡å·é‡è¿›è¡Œç­‰å¾…æ“ä½œ P(sv)ï¼ˆå¦‚æœ sv&gt;0 åˆ™æ“ä½œèµ„æºå¹¶å°†ä¿¡å·é‡ -1ï¼Œå¦åˆ™æŒ‚èµ·è¿›ç¨‹ç­‰å¾…ï¼‰ï¼›</li>
<li>å½“è¯¥è¿›ç¨‹ 1 å¯¹èµ„æºæ‰§è¡Œå®Œæ“ä½œåï¼Œå¯¹ä¿¡å·é‡è¿›è¡Œå‘é€æ“ä½œ V(sv)ï¼ˆæ­¤æ—¶å¦‚æœæœ‰è¿›ç¨‹ 2 ç­‰å¾… sv è€ŒæŒ‚èµ·ï¼Œåˆ™æ¢å¤è¿›ç¨‹ 2ï¼Œå¦åˆ™å°±ç»™ sv+1ï¼‰</li>
</ol>
<p><a href="https://blog.csdn.net/skyroben/article/details/72513985" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/skyroben/article/details/72513985</a></p>
<ul>
<li>ä¿¡å· Signal</li>
</ul>
<p>ä¿¡å·æ˜¯è¿›ç¨‹é—´é€šä¿¡ä¸­å”¯ä¸€çš„å¼‚æ­¥é€šä¿¡æœºåˆ¶ï¼Œé€šçŸ¥æ¥æ”¶ä¿¡å·çš„è¿›ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ã€‚è€Œè¿›ç¨‹æ¥å—åˆ°ä¿¡å·åå¯ä»¥å¿½ç•¥ï¼Œæ•è·å¤„ç†ï¼Œæˆ–è€…ä½¿ç”¨ç³»ç»Ÿé»˜è®¤æ“ä½œã€‚</p>
<p><a href="https://www.ibm.com/developerworks/cn/linux/l-ipc/part2/index1.html" target="_blank" rel="noopener noreferrer">https://www.ibm.com/developerworks/cn/linux/l-ipc/part2/index1.html</a></p>
<p>åªèƒ½æ‰¿è½½å¾ˆå°çš„ä¿¡æ¯é‡ï¼Œä¸»è¦ç”¨åœ¨è¿›ç¨‹çš„ä¸­æ–­æ§åˆ¶</p>
<h2> Binder</h2>
<p>æ•°æ®æ‹·è´ 1 æ¬¡ï¼Œæœ‰æƒé™æ ¡éªŒï¼ˆä¸ºå‘é€æ–¹æ·»åŠ äº† UID/PID èº«ä»½ï¼‰</p>
<figure><img src="https://jixiaoyong.github.io/images/20200422115508.gif" alt="å‚ä¸ Binder é€šä¿¡çš„æ‰€æœ‰è§’è‰² å›¾ç‰‡æ¥è‡ª https://blog.csdn.net/universus/article/details/6211589" tabindex="0" loading="lazy"><figcaption>å‚ä¸ Binder é€šä¿¡çš„æ‰€æœ‰è§’è‰² å›¾ç‰‡æ¥è‡ª <a href="https://blog.csdn.net/universus/article/details/6211589" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/universus/article/details/6211589</a></figcaption></figure>
<p>æ—¶åºå›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20200422115253.png" alt="20200422115253" tabindex="0" loading="lazy"><figcaption>20200422115253</figcaption></figure>
<p>ç†è®ºä¸Šçš„ Binder é€»è¾‘ï¼š</p>
<blockquote>
<p>SMgr æä¾›çš„ Binder æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒæ²¡æœ‰åå­—ä¹Ÿä¸éœ€è¦æ³¨å†Œï¼Œå½“ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ BINDER_SET_CONTEXT_MGR å‘½ä»¤å°†è‡ªå·±æ³¨å†Œæˆ SMgr æ—¶ Binder é©±åŠ¨ä¼šè‡ªåŠ¨ä¸ºå®ƒåˆ›å»º Binder å®ä½“ï¼ˆè¿™å°±æ˜¯é‚£åªé¢„å…ˆé€ å¥½çš„é¸¡ï¼‰ã€‚å…¶æ¬¡è¿™ä¸ª Binder çš„å¼•ç”¨åœ¨æ‰€æœ‰ Client ä¸­éƒ½å›ºå®šä¸º 0 è€Œæ— é¡»é€šè¿‡å…¶å®ƒæ‰‹æ®µè·å¾—ã€‚</p>
<p>åœ¨æ•°æ®ä»å‘é€æ–¹å‘æ¥æ”¶æ–¹æ‹·è´æ—¶ï¼Œé©±åŠ¨ä¼šæ ¹æ®å‘é€æ•°æ®åŒ…çš„å¤§å°ï¼Œä½¿ç”¨æœ€ä½³åŒ¹é…ç®—æ³•ä»ç¼“å­˜æ± ä¸­æ‰¾åˆ°ä¸€å—å¤§å°åˆé€‚çš„ç©ºé—´ï¼Œ<strong>å°†æ•°æ®ä»å‘é€ç¼“å­˜åŒºå¤åˆ¶è¿‡æ¥</strong>ã€‚</p>
<p>ä¸ºäº†å®ç°ç”¨æˆ·ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ï¼ŒBinder é©±åŠ¨çš„ mmap() åˆ†é…çš„å†…å­˜é™¤äº†æ˜ å°„è¿›äº†æ¥æ”¶æ–¹è¿›ç¨‹é‡Œï¼Œè¿˜æ˜ å°„è¿›äº†å†…æ ¸ç©ºé—´ã€‚æ‰€ä»¥è°ƒç”¨ copy_from_user() å°†æ•°æ®æ‹·è´è¿›å†…æ ¸ç©ºé—´ä¹Ÿç›¸å½“äºæ‹·è´è¿›äº†æ¥æ”¶æ–¹çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™å°±æ˜¯ Binder åªéœ€ä¸€æ¬¡æ‹·è´çš„â€˜ç§˜å¯†â€™ã€‚</p>
<p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸º CSDN åšä¸»ã€Œuniversusã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA</p>
<p>ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚<br>
åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/universus/article/details/6211589" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/universus/article/details/6211589</a></p>
</blockquote>
<p>ä¸»è¦å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/universus/article/details/6211589" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/universus/article/details/6211589</a></p>
<p><a href="https://blog.csdn.net/freekiteyu/article/details/70082302" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/freekiteyu/article/details/70082302</a></p>
<p>Binder é€šä¿¡ä¸»è¦æ¶‰åŠä¸€ä¸‹å¯¹è±¡ï¼š</p>
<ul>
<li>Server</li>
<li>Client</li>
<li>ServerManager</li>
<li>Binder é©±åŠ¨</li>
</ul>
<p>é¦–å…ˆè¦çŸ¥é“ï¼ŒServerï¼ŒClient ä»¥åŠ ServerManager ä¸€èˆ¬éƒ½åœ¨ä¸åŒçš„è¿›ç¨‹ä¹‹ä¸­ï¼Œé‚£ä¹ˆ Serverï¼ŒClient å¦‚ä½•ä¸ ServerManager é€šä¿¡å¹¶æ³¨å†Œ/æŸ¥è¯¢æ‰€éœ€çš„æœåŠ¡å‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦ç”¨åˆ°<strong>0 å·å¼•ç”¨ Binder</strong>ã€‚</p>
<p><strong>0 å·å¼•ç”¨ Binder</strong> æ˜¯ ServerManager å†…éƒ¨åˆ›å»ºåŒ¿å Binderï¼Œæ‰€æœ‰çš„ Clientï¼ˆç›¸å¯¹äº ServerManager æ¥è¯´å…¶ä»–å’Œä»–äº¤äº’çš„éƒ½æ˜¯ Clientï¼‰éƒ½é»˜è®¤æŒæœ‰è¿™ä¸ª Binder çš„å¼•ç”¨ã€‚</p>
<p>æ‰€ä»¥ä¸€ä¸ªå®Œæ•´çš„ AIDL é€šä¿¡è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>Server åˆ›å»ºä¸€ä¸ª Binder å’Œå¯¹åº”åå­—</li>
<li>Server é€šè¿‡æŒæœ‰çš„ 0 å·å¼•ç”¨ Binder å’Œ ServerManager é€šä¿¡ã€‚<br>
å°†ç”Ÿæˆçš„ Binder å’Œå¯¹åº”åå­—å‘é€åˆ° Binder é©±åŠ¨ï¼ŒBinder é©±åŠ¨ä¼šä¸ºè¿™ä¸ª Binder åœ¨å†…æ ¸ç©ºé—´åˆ›å»ºå¯¹åº”å®ä½“èŠ‚ç‚¹åŠå…¶å¼•ç”¨ï¼ˆ<strong>å¤åˆ¶äº†ä¸€æ¬¡</strong>ï¼‰ï¼Œå¹¶é€šè¿‡ 0 å·å¼•ç”¨å°†å…¶å‘ç»™ ServerManagerã€‚</li>
<li>ServerManager æ”¶åˆ°å†…æ ¸ä¸­çš„ Binder å¯¹è±¡å¼•ç”¨åŠåå­—åå°†å…¶ä¿å­˜åˆ°æŸ¥æ‰¾è¡¨ä¸­ã€‚</li>
<li>Client é€šè¿‡ 0 å·å¼•ç”¨ Binder å’Œ ServerManager é€šä¿¡ã€‚<br>
Client å°†éœ€è¦çš„ Binder çš„åå­—å‘ç»™ ServerManagerï¼ŒServerManager æŸ¥è¯¢åˆ°å·²ç»æ³¨å†Œçš„å†…æ ¸ Binder å¼•ç”¨å¹¶å°†å…¶å‘ç»™ Clientã€‚</li>
<li>Client è·å–åˆ°å†…æ ¸ Binder çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚</li>
</ol>
<p>å†æ¥çœ‹çœ‹ä¸€ä¸ªå®Œæ•´çš„æµç¨‹ï¼š</p>
<p>åœ¨ Service ä¸­ï¼Œæˆ‘ä»¬ä¼šå…ˆåˆ›å»ºä¸€ä¸ª mIBinder å¯¹è±¡å¹¶ä¸”åœ¨<code>public IBinder onBind(Intent intent)</code>æ–¹æ³•è¿”å›ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿½è¸ª onBind æ–¹æ³•ï¼Œæˆ‘ä»¬ä¼šå‘ç°<code>mIBinder</code>çš„å¯¹è±¡ä¼šåœ¨ ActivityThread ä¸­çš„<code>private void handleBindService(BindServiceData data)</code>æ–¹æ³•ä¸­è¢«ä¼ å…¥åˆ° IActivityManager çš„ publishService æ–¹æ³•ä¸­ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ActivityManager.getService() æ–¹æ³•æ˜¯é€šè¿‡ IPC è·å–åˆ° ActivityManager çš„å¼•ç”¨</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œæ ¹æ®<a href="https://www.jianshu.com/p/91c97710976a" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç« </a>ï¼Œè¿™ä¸ª binder æœ€ç»ˆä¼šè¢«ä¼ è¾“åˆ°ç»‘å®šè¿™ä¸ªæœåŠ¡æ—¶æ‰€ç”¨çš„ ServiceConnection å¯¹è±¡çš„<code>onServiceConnected</code>æ–¹æ³•ä¸­ï¼ˆ<strong>å³ mIBinder é€šè¿‡ ServerManager ä» Service ä¼ é€’åˆ°äº† Client</strong>ï¼‰ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ®<a href="https://blog.csdn.net/zhangyongfeiyong/article/details/51953300" target="_blank" rel="noopener noreferrer">Android æœåŠ¡ä¹‹ bindService æºç åˆ†æ</a>mConnection ä¼šé€šè¿‡<code>context.bindService(intent, mConnection, Context.BIND_AUTO_CREATE);</code>æœ€ç»ˆåœ¨ ActivityManagerService é€šè¿‡ Binder é©±åŠ¨ç¨‹åºè°ƒç”¨ ActivityThread ç±»ä¸­çš„ scheduleBindService æ–¹æ³•ä¼ é€’åˆ° Service æ‰€åœ¨è¿›ç¨‹ä¸­ï¼Œå¹¶æ ¹æ® Service çš„çŠ¶æ€ä¸åŒè€Œè¢«è°ƒç”¨å¯¹åº”æ–¹æ³•ï¼ˆ<strong>å³ mConnection é€šè¿‡ ServerManager ä» Client ä¼ é€’åˆ°äº† Service</strong>ï¼‰ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20200422115031.jpg" alt="å›¾ç‰‡æ¥è‡ª https://img-blog.csdn.net/20160719100800917?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" tabindex="0" loading="lazy"><figcaption>å›¾ç‰‡æ¥è‡ª <a href="https://img-blog.csdn.net/20160719100800917?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" target="_blank" rel="noopener noreferrer">https://img-blog.csdn.net/20160719100800917?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center</a></figcaption></figure>
<p>åœ¨è¿™å…¶ä¸­æˆ‘ä»¬ç”¨åˆ°äº†ä¸¤ä¸ªæ¶‰åŠåˆ° AIDL æ–‡ä»¶ï¼š</p>
<ul>
<li>private IBinder mIBinder = new AidlBinderInterface.Stub() {}</li>
<li>mServiceInterface = AidlBinderInterface.Stub.asInterface(service);</li>
</ul>
<p>å†æ¥çœ‹çœ‹æˆ‘ä»¬å†™çš„å¯¹åº”çš„ AIDL æ–‡ä»¶ï¼š</p>
<div class="language-aidl line-numbers-mode" data-ext="aidl"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„æ–¹æ³•ï¼Œç³»ç»Ÿè‡ªåŠ¨å¸®æˆ‘ä»¬å®ç°äº†æ›´è¯¦ç»†çš„å†…å®¹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯çŸ¥<code>mRemote</code>ä¾¿æ˜¯æŒ‡å‘ AMS æœåŠ¡çš„<code>BinderProxy</code>å¯¹è±¡ <a href="https://www.diycode.cc/topics/384" target="_blank" rel="noopener noreferrer">https://www.diycode.cc/topics/384</a></p>
<p><a href="https://www.cnblogs.com/a284628487/p/3187320.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/a284628487/p/3187320.html</a></p>
<figure><img src="https://jixiaoyong.github.io/images/20200422114923.jpg" alt="å›¾ç‰‡æ¥è‡ª https://images0.cnblogs.com/blog/391137/201307/12211553-49c477a875e84b2aae764c67f38f26b2.jpg" tabindex="0" loading="lazy"><figcaption>å›¾ç‰‡æ¥è‡ª <a href="https://images0.cnblogs.com/blog/391137/201307/12211553-49c477a875e84b2aae764c67f38f26b2.jpg" target="_blank" rel="noopener noreferrer">https://images0.cnblogs.com/blog/391137/201307/12211553-49c477a875e84b2aae764c67f38f26b2.jpg</a></figcaption></figure>
<h3> others</h3>
<p>å¦‚æœåœ¨ BroadcastReceiver çš„ onReceive æ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå½“è¯¥æ–¹æ³•è¿”å›æ—¶ï¼ŒAndroid ç³»ç»Ÿå°±ä¼šè®¤ä¸ºè¯¥ BroadcastReceiver å·²ç»å®Œæˆä»»åŠ¡äº†ï¼Œä»è€Œä¼šåœ¨éœ€è¦å›æ”¶å†…å­˜æ—¶æ€æ­»è¿›ç¨‹ä»¥åŠå…¶ä¸­çš„ Threadã€‚åˆ›å»ºä¸€ä¸ª<a href="https://developer.android.google.cn/reference/android/app/job/JobService.html?hl=zh-cn" target="_blank" rel="noopener noreferrer">JobService</a>å¯ä»¥é¿å…è¿™ä¸ªæƒ…å†µã€‚</p>
<blockquote>
<p>So, the system may kill the process at any time to reclaim memory, and in doing so, it terminates the spawned thread running in the process.</p>
<p><a href="https://developer.android.google.cn/guide/components/activities/process-lifecycle?hl=zh-cn" target="_blank" rel="noopener noreferrer">https://developer.android.google.cn/guide/components/activities/process-lifecycle?hl=zh-cn</a></p>
</blockquote>
<p><a href="https://blog.csdn.net/universus/article/details/6211589" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/universus/article/details/6211589</a></p>
<p><a href="https://www.jianshu.com/p/429a1ff3560c" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/429a1ff3560c</a></p>
<p><a href="https://www.cnblogs.com/a284628487/p/3187320.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/a284628487/p/3187320.html</a></p>
<p><a href="http://hoyouly.fun/2019/07/17/Android-AIDL/" target="_blank" rel="noopener noreferrer">http://hoyouly.fun/2019/07/17/Android-AIDL/</a></p>
<p><a href="https://juejin.im/entry/59c9cd59f265da065754e6f1" target="_blank" rel="noopener noreferrer">https://juejin.im/entry/59c9cd59f265da065754e6f1</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20200422114446.png" type="image/png"/>
    </item>
    <item>
      <title>Android ç³»ç»Ÿæ¶æ„ç®€ä»‹</title>
      <link>https://jixiaoyong.github.io/blog/posts/e3bb9a54.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/e3bb9a54.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ç³»ç»Ÿæ¶æ„ç®€ä»‹</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 23 Feb 2018 14:35:14 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>è¯´æ˜ï¼šæœ¬æ–‡åŸºäº<a href="http://gityuan.com/android/" target="_blank" rel="noopener noreferrer">Android ç³»ç»Ÿå¼€ç¯‡ - Gityuan åšå®¢ | è¢è¾‰è¾‰åšå®¢</a> çš„å­¦ä¹ ç¬”è®°æ•´ç†</p>
</blockquote>
<p>Android ç³»ç»Ÿå¤§ä½“åˆ†ä¸º 4 ä¸ªæ¨¡å—ï¼Œä»åº•å±‚å¼€å§‹ä¾æ¬¡æ˜¯ 1.linux å†…æ ¸ã€2.ç³»ç»Ÿåº“+Android è¿è¡Œæ—¶ã€3.æ¡†æ¶å±‚ã€4.åº”ç”¨å±‚ã€‚</p>
<figure><img src="https://raw.githubusercontent.com/jixiaoyong/jixiaoyong.github.io/master/images/blog/2018-02/AndroidSystemArchitecture.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>ä¸‹å›¾æè¿°äº† Android ç³»ç»Ÿä»å¼€æœºåˆ° Apk è¿è¡Œçš„æ•´ä¸ªæµç¨‹ã€‚</p>
<figure><img src="https://raw.githubusercontent.com/jixiaoyong/jixiaoyong.github.io/master/images/blog/2018-02/androidBoot.jpg" alt="ç³»ç»Ÿå¯åŠ¨æ¡†æ¶å›¾ï¼Œæ¥è‡ª gityuan.com" tabindex="0" loading="lazy"><figcaption>ç³»ç»Ÿå¯åŠ¨æ¡†æ¶å›¾ï¼Œæ¥è‡ª <a href="http://gityuan.com" target="_blank" rel="noopener noreferrer">gityuan.com</a></figcaption></figure>
<p>æµç¨‹å¦‚ä¸‹ï¼š<code>Loader</code> -&gt; <code>Kernel</code> -&gt; <code>Native</code>-&gt; <code>Framework</code> -&gt; <code>App</code></p>
<p><strong>Loader å±‚</strong></p>
<ol>
<li>Boot ROMï¼šå¼€æœºæ—¶ï¼Œå¼•å¯¼èŠ¯ç‰‡ä» ROM è¯»å–è¯»å–åˆå§‹åŒ–ä»£ç ï¼ŒåŠ è½½å¼•å¯¼ç¨‹åºåˆ° RAM ä¸­ã€‚</li>
<li>Boot Loaderï¼šæ˜¯å¯åŠ¨ Android ç³»ç»Ÿä¹‹å‰çš„å¼•å¯¼ç¨‹åºï¼Œæ£€æŸ¥ RAMã€åˆå§‹åŒ–ç¡¬ä»¶å‚æ•°ç­‰ã€‚</li>
</ol>
<p><strong>Kernel å±‚</strong>ï¼ˆå³ Android å†…æ ¸å±‚ï¼Œè¿›å…¥ Android ç³»ç»Ÿï¼‰</p>
<ol>
<li>swapper è¿›ç¨‹ï¼ˆpid=0ï¼‰ï¼šBoot Loader å¯åŠ¨ swapperï¼ˆidleï¼‰è¿›ç¨‹ï¼Œæ˜¯ç”±å†…æ ¸åˆ›å»ºçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œç”¨æ¥åˆå§‹åŒ–è¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ã€é©±åŠ¨ç­‰ç­‰ã€‚</li>
<li>kthreadd è¿›ç¨‹ï¼ˆpid=2ï¼‰ï¼šæ˜¯ Linux ç³»ç»Ÿçš„å†…æ ¸è¿›ç¨‹ï¼Œ<strong>æ˜¯æ‰€æœ‰å†…æ ¸è¿›ç¨‹çš„é¼»ç¥–</strong>ã€‚</li>
</ol>
<hr>
<p><strong>Syscall</strong>ï¼Œåœ¨ Native å’Œ Kernel ä¹‹é—´çš„ç³»ç»Ÿè°ƒç”¨å±‚ã€‚</p>
<hr>
<p><strong>Native å±‚</strong></p>
<ol>
<li>init è¿›ç¨‹ï¼ˆpid=1ï¼‰ï¼šç”± swapper è¿›ç¨‹åˆ›å»ºï¼Œ<strong>æ˜¯æ‰€æœ‰ç”¨æˆ·è¿›ç¨‹é¼»ç¥–</strong></li>
<li>init è¿›ç¨‹å­µåŒ–å‡ºç”¨æˆ·å®ˆæŠ¤è¿›ç¨‹ã€å¯åŠ¨ ServiceManager ç®¡ç†ç³»ç»ŸæœåŠ¡ï¼Œå¯åŠ¨å¼€æœºåŠ¨ç”» Bootnaimã€‚</li>
</ol>
<hr>
<p><strong>JNI</strong>ï¼ŒJava å±‚å’Œ Nativeï¼ˆC/C++ï¼‰å±‚ä¹‹é—´ã€‚</p>
<hr>
<p><strong>Framework å±‚</strong></p>
<ol>
<li>Zygote è¿›ç¨‹ï¼šç”± init è¿›ç¨‹ fork ç”Ÿæˆï¼Œæ˜¯<strong>Android ç³»ç»Ÿç¬¬ä¸€ä¸ª java è¿›ç¨‹ï¼Œæ˜¯æ‰€æœ‰ java è¿›ç¨‹çš„çˆ¶è¿›ç¨‹</strong></li>
<li>SystemServer è¿›ç¨‹ï¼šç”± Zygote è¿›ç¨‹ fork è€Œæ¥ï¼Œ<strong>æ˜¯ Zygote å­µåŒ–çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹</strong>ï¼Œè´Ÿè´£å¯åŠ¨å’Œç®¡ç†æ•´ä¸ª<strong>java framework</strong>ï¼Œå¦‚ ActivityManagerã€PowerManager...</li>
<li>MediaServer è¿›ç¨‹ï¼šç”± init è¿›ç¨‹ fork è€Œæ¥ï¼Œè´Ÿè´£å¯åŠ¨å’Œç®¡ç†æ•´ä¸ª<strong>C++ framework</strong></li>
</ol>
<p><strong>APP å±‚</strong></p>
<ol>
<li>Launcherï¼š<strong>Zygote è¿›ç¨‹å­µåŒ–çš„ç¬¬ä¸€ä¸ª App è¿›ç¨‹</strong>ï¼Œæ¡Œé¢ Appã€‚</li>
<li>å…¶ä»–ç”± Zygote è¿›ç¨‹å­µåŒ–çš„ç³»ç»Ÿè¿›ç¨‹ï¼ˆBrowserã€Phone...ï¼‰å’Œéç³»ç»Ÿ app è¿›ç¨‹ã€‚</li>
</ol>
<p>æ‰¼è¦å†…å®¹å¦‚å›¾ï¼š</p>
<figure><img src="https://raw.githubusercontent.com/jixiaoyong/jixiaoyong.github.io/master/images/blog/2018-02/AndroidBootImg.png" alt="ç³»ç»Ÿå¯åŠ¨ç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>ç³»ç»Ÿå¯åŠ¨ç¤ºæ„å›¾</figcaption></figure>
<p>Android å¸¸ç”¨çš„é€šä¿¡æ–¹å¼</p>
<ol>
<li>Binder</li>
<li>Socket</li>
<li>Handler</li>
</ol>
<p><strong>Binder/Socket ç”¨äºè¿›ç¨‹é—´ï¼ˆéƒ½å…·æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼‰é€šä¿¡ï¼Œè€Œ Handler æ¶ˆæ¯æœºåˆ¶ç”¨äºåŒè¿›ç¨‹çš„çº¿ç¨‹é—´ï¼ˆå…±äº«å†…å­˜ç©ºé—´ï¼‰é€šä¿¡</strong></p>
<p>åœ¨ Android ç³»ç»Ÿä¸­ï¼š</p>
<ul>
<li>Zygote è¿›ç¨‹ --&gt; Socket æœºåˆ¶</li>
<li>SystemServerã€MediaServerã€App ä¹‹é—´ --&gt; Binder IPC</li>
<li>åŒä¸€è¿›ç¨‹ä¸åŒçº¿ç¨‹é—´ --&gt; Handler</li>
</ul>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/jixiaoyong/jixiaoyong.github.io/master/images/blog/2018-02/AndroidSystemArchitecture.png" type="image/png"/>
    </item>
    <item>
      <title>Android ç¬”è®°ä¹‹è´å¡å°”æ›²çº¿çš„åº”ç”¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/5c023044.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/5c023044.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android ç¬”è®°ä¹‹è´å¡å°”æ›²çº¿çš„åº”ç”¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 10 Apr 2020 01:49:03 GMT</pubDate>
      <content:encoded><![CDATA[<p><a href="https://baike.baidu.com/item/%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF" target="_blank" rel="noopener noreferrer">è´å¡å°”æ›²çº¿</a>æ˜¯ç”¨èŠ‚ç‚¹å’Œæ§åˆ¶ç‚¹ç»˜åˆ¶çš„é«˜ç²¾åº¦æ›²çº¿ï¼ŒAndroid ä¸­å¸¸ç”¨çš„æœ‰äºŒé˜¶ã€ä¸‰é˜¶è´å¡å°”æ›²çº¿ã€‚æœ¬æ–‡ä»‹ç»ä½¿ç”¨è´å¡å°”æ›²çº¿ç»˜åˆ¶æŠ˜çº¿å›¾ï¼Œå¹¶å®ç°åŠ¨ç”»æ•ˆæœã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20200413215502.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>æœ¬æ–‡ä»£ç é“¾æ¥ï¼š<a href="https://github.com/jixiaoyong/library/blob/master/library/src/main/java/cf/android666/applibrary/view/BezierViewAnim.kt" target="_blank" rel="noopener noreferrer">https://github.com/jixiaoyong/library/blob/master/library/src/main/java/cf/android666/applibrary/view/BezierViewAnim.kt</a></p>
<h2> è´å¡å°”æ›²çº¿ä»‹ç»</h2>
<p>ä¸‹å›¾æ˜¯äºŒé˜¶è´å¡å°”æ›²çº¿ç»˜åˆ¶æ–¹æ³•ä»‹ç»ï¼Œåªè¦å„ä¸ªç‚¹æ»¡è¶³æ¡ä»¶ï¼šAD/AB = BE/BC = DF/DEï¼Œé‚£ä¹ˆå½“æ²¿ç€å½“å‰çº¿æ®µç§»åŠ¨ Dã€E ç‚¹æ—¶ï¼ŒF ç‚¹çš„è¿åŠ¨è½¨è¿¹å°±æ˜¯ä¸€ä¸ªè´å¡å°”æ›²çº¿ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20200413215622.png" alt="å›¾ç‰‡æ¥è‡ªï¼šhttps://www.cnblogs.com/wjtaigwh/p/6647114.html" tabindex="0" loading="lazy"><figcaption>å›¾ç‰‡æ¥è‡ªï¼š<a href="https://www.cnblogs.com/wjtaigwh/p/6647114.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/wjtaigwh/p/6647114.html</a></figcaption></figure>
<p>åŠ¨å›¾ç¤ºæ„å¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20200413222352.webp" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>å¯ä»¥åœ¨ä¸‹é¢çš„ä¸¤ä¸ªç½‘ç«™åœ¨çº¿ä½“éªŒè´å¡å°”æ›²çº¿ï¼š</p>
<p><a href="https://aaaaaaaty.github.io/bezierMaker.js/playground/playground.html" target="_blank" rel="noopener noreferrer">https://aaaaaaaty.github.io/bezierMaker.js/playground/playground.html</a></p>
<p><a href="https://bezier.method.ac/" target="_blank" rel="noopener noreferrer">https://bezier.method.ac/</a></p>
<h2> è®¡ç®—æ§åˆ¶ç‚¹åæ ‡</h2>
<p>åœ¨ç»˜åˆ¶æŠ˜çº¿å›¾æ—¶ï¼Œæˆ‘ä»¬è·å–çš„æ•°æ®å¯ä»¥å½“åšè´å¡å°”æ›²çº¿çš„ç«¯ç‚¹ï¼ŒAndroid ä¸ºæˆ‘ä»¬æä¾›äº†ç»˜åˆ¶äºŒé˜¶å’Œä¸‰é˜¶è´å¡å°”æ›²çº¿çš„æ–¹æ³•ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥<code>Path.cubicTo()</code>æ–¹æ³•ä¸ºä¾‹ï¼Œåœ¨ç»˜åˆ¶ä¸‰é˜¶è´å¡å°”æ›²çº¿æ—¶ï¼Œèµ·ç‚¹å’Œç»ˆç‚¹å·²çŸ¥ï¼Œå‰©ä¸‹å·¥ä½œå°±æ˜¯è®¡ç®—ä¸¤ä¸ªæ§åˆ¶ç‚¹çš„åæ ‡ã€‚</p>
<h3> æ–¹æ³• 1</h3>
<p>æŒ‰ç…§è´å¡å°”æ›²çº¿çš„å®šä¹‰ï¼Œè®¡ç®—å„ä¸ªç‚¹å¯¹åº”æ§åˆ¶ç‚¹çš„åæ ‡ï¼Œå…·ä½“çš„è®¡ç®—åŸç†æˆ‘ä»¬å¯ä»¥å‚è€ƒ<a href="https://wenku.baidu.com/view/c790f8d46bec0975f565e211.html" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç« </a></p>
<p>å‡è®¾èµ·ç‚¹ã€ç»ˆç‚¹åˆ†åˆ«ä¸º<code>startPoint</code>ï¼Œ<code>endPoint</code>ï¼Œèµ·ç‚¹å‰ä¸€ä¸ªç‚¹ä¸º<code>beforePointF</code>ï¼Œç»ˆç‚¹åä¸€ä¸ªç‚¹ä¸º<code>afterPoint</code>ï¼Œé‚£ä¹ˆç»ˆæ­¢ç‚¹ 1ã€2ï¼ˆ<code>controlPoint1</code>ã€<code>controlPoint2</code>ï¼‰çš„åæ ‡æ»¡è¶³ï¼ˆå…¶ä¸­ a,b ä¸ºä»»æ„æ­£æ•°ï¼Œæ¯”å¦‚ 1/6ï¼‰ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>è¿™é‡Œè¦å¤„ç†ç‰¹æ®Šæƒ…å†µï¼šç¬¬ä¸€ä¸ªç‚¹ P<sub>0</sub>çš„å‰ä¸€ä¸ªä»ç„¶ä¸º P<sub>0</sub>ï¼Œæœ€åä¸€ä¸ªç‚¹ P<sub>n</sub>çš„åä¸€ä¸ªç‚¹ä»ä¸º P<sub>n</sub></p>
</blockquote>
<p>ä½†è¿™ç§æƒ…å†µç»˜åˆ¶å‡ºæ¥çš„è´å¡å°”æ›²çº¿å¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20200413220840.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>å¯ä»¥çœ‹åˆ°é™¤äº† P<sub>0</sub>å’Œ P<sub>n</sub>å¤–ï¼Œå…¶ä»–ç‚¹çš„æ›²çº¿åæ ‡å’Œå¯¹åº”çš„ç‚¹åæ ‡ä¸ä¸€è‡´ã€‚</p>
<h3> æ–¹æ³• 2</h3>
<p>ä¸ºäº†è§£å†³æ–¹æ³• 1 å­˜åœ¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬äººä¸ºçš„åœ¨ä¸¤ä¸ªç‚¹ä¹‹é—´åŠ å…¥ä¸¤ä¸ªæ§åˆ¶ç‚¹ï¼Œè¿™æ ·åœ¨<code>startPoint</code>ï¼Œ<code>endPoint</code>ä¹‹é—´çš„è´å¡å°”æ›²çº¿é¦–å°¾ç‚¹çš„åæ ‡å¿…å®šè½åœ¨èµ·ç‚¹å’Œç»ˆç‚¹ä¸Šï¼ˆæ€è·¯æ¥è‡ª<a href="https://blog.csdn.net/laizuling/article/details/51162011" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸¤ä¸ªæ§åˆ¶ç‚¹çš„åæ ‡ä¸ºï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ç»˜åˆ¶å‡ºæ¥çš„æ›²çº¿æ¯”è¾ƒç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œæœ€ç»ˆè´å¡å°”æ›²çº¿ path è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ç»™ Path æ·»åŠ æ¸å˜èƒŒæ™¯</h2>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>Paint.setShader(Shader shader)</code>æ–¹æ³•ï¼Œåœ¨ç»˜åˆ¶ Path çš„æ—¶å€™ç»˜åˆ¶æ¸å˜èƒŒæ™¯ã€‚</p>
<p>æ¸å˜èƒŒæ™¯ä½¿ç”¨ Shader å®ç°ã€‚</p>
<p>ä¸ºäº†ç¡®ä¿ç»˜åˆ¶æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Path è®¡ç®—å®Œæˆåï¼Œå°†å…¶é—­åˆï¼Œä»¥ç¡®ä¿ç»˜åˆ¶çš„èƒŒæ™¯åœ¨æˆ‘ä»¬éœ€è¦çš„èŒƒå›´å†…ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ç»™ Path æ·»åŠ åŠ¨ç”»</h2>
<p>ä¸ºäº†è®© Path çœ‹èµ·æ¥æ˜¯ä»èµ·ç‚¹æ…¢æ…¢ç»˜åˆ¶åˆ°ç»ˆç‚¹å»çš„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè®¡ç®— path çš„æ€»é•¿åº¦ï¼Œç„¶åç»“åˆ<code>ValueAnimator</code>å®æ—¶è·å¾—å¯¹åº”é•¿åº¦çš„ path å¹¶ç»˜åˆ¶ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨<code>onDraw()</code>æ–¹æ³•ä¸­ç»˜åˆ¶å¯¹åº”çš„ pathï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://jixiaoyong.github.io/images/20200413222302.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2> æ³¨æ„äº‹é¡¹</h2>
<ul>
<li>
<p>ä½¿ç”¨ canvas ç»˜åˆ¶åæ ‡æ—¶ï¼Œéœ€è¦æ³¨æ„ android çš„åæ ‡åŸç‚¹ä½äºå±å¹•å·¦ä¸Šè§’ã€‚æ‰€ä»¥åœ¨ç»˜åˆ¶æ›²çº¿å›¾æ—¶å¯ä»¥å…ˆå°†åæ ‡åŸç‚¹å‘ä¸‹å¹³ç§»ä¸€æ®µè·ç¦»ï¼Œå†ç»˜åˆ¶å¯¹åº”åæ ‡ï¼ˆå¯ä»¥ç»˜åˆ¶å®é™…çš„ y åæ ‡è´Ÿå€¼ï¼‰</p>
</li>
<li>
<p>åœ¨æ‹¼æ¥è´å¡å°”æ›²çº¿çš„ path æ—¶å€™æ³¨æ„ï¼Œ<code>path.moveTo()</code>æ–¹æ³•ä¼šå°† path åˆ‡æ–­</p>
</li>
</ul>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://wenku.baidu.com/view/c790f8d46bec0975f565e211.html" target="_blank" rel="noopener noreferrer">https://wenku.baidu.com/view/c790f8d46bec0975f565e211.html</a><br>
<a href="https://blog.csdn.net/laizuling/article/details/51162011" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/laizuling/article/details/51162011</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20200413215502.jpg" type="image/jpeg"/>
    </item>
    <item>
      <title>Android è‡ªå®šä¹‰ View å®ç°è”ç³»äººåˆ—è¡¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/a2c96aac.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/a2c96aac.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android è‡ªå®šä¹‰ View å®ç°è”ç³»äººåˆ—è¡¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 03 Sep 2017 15:25:05 GMT</pubDate>
      <content:encoded><![CDATA[<h2> è‡ªå®šä¹‰çš„ view</h2>
<ul>
<li>LetterIndex.java extends View</li>
<li>ContactsListView.java extends RecyclerView #åˆ†æ</li>
<li>è”ç³»äººåˆ—è¡¨æœ‰ä¸¤ä¸ªè¦ç‚¹
<ul>
<li>å­—æ¯å¯¼èˆªæ <br>
é€šè¿‡è‡ªå®šä¹‰ View ç”»å‡º 26 ä¸ªå­—æ¯ï¼Œè®¾ç½®æ»‘åŠ¨ç›‘å¬äº‹ä»¶ï¼Œæ ¹æ®ä¸Šä¸‹æ»‘åŠ¨çš„è·ç¦»åˆ¤æ–­å½“å‰é€‰ä¸­çš„å­—æ¯ï¼Œå¹¶ç›¸åº”æ›´æ–°ç•Œé¢ã€‚</li>
<li>åˆ—è¡¨ä¸­çš„å­—æ¯æ ‡é¢˜<br>
é’ˆå¯¹ item ä¸­çš„è”ç³»äººå§“åé¦–å­—æ¯å¯¹åº”çš„ tag ä½œæ¯”è¾ƒï¼Œè‹¥ä¸å‰ä¸€ä¸ªç›¸åŒåˆ™ä¸æ˜¾ç¤º titleï¼Œå¦åˆ™æ˜¾ç¤ºã€‚</li>
</ul>
</li>
<li>äº‹ä»¶è”åŠ¨
<ul>
<li>å½“æ»‘åŠ¨å­—æ¯å¯¼èˆªæ æ—¶ï¼Œé™¤äº†å¤„ç†æœ¬èº«çš„å˜åŒ–å¤–ï¼Œè¿˜è¦ç•™å‡ºæ¥å£ï¼Œä»¥ä¾¿å…¶ä»–æ§ä»¶è·å–å½“å‰é€‰ä¸­çš„å­—æ¯ã€‚</li>
<li>è”ç³»äººåˆ—è¡¨æ»‘åŠ¨æ—¶ï¼Œé™¤äº†å¤„ç†æœ¬èº«å˜åŒ–å¤–ï¼ŒåŒæ ·è¦ç•™å‡ºæ¥å£ä»¥ä¾¿è·å–å½“å‰ç½®é¡¶çš„ item å¯¹åº”çš„å­—æ¯</li>
<li>å­—æ¯å¯¼èˆªæ è¦ç•™å‡ºæ–¹æ³•ï¼Œä»¥ä¾¿å…¶ä»–æ§ä»¶æŒ‡å®šé€‰ä¸­çš„å­—æ¯ï¼Œå¹¶æ›´æ–°ç•Œé¢</li>
</ul>
</li>
</ul>
<h2> å…·ä½“ä»£ç </h2>
<p><strong>ContactsListView.java</strong><br>
é‡å†™è¯¥ç±»ä¸»è¦æ˜¯ä¸ºäº†å®ç° ItemDecoration æ ¹æ®ä¸åŒçš„ item å˜åŒ–ï¼ŒåŒæ—¶å¯ä»¥ä» xml å¸ƒå±€æ–‡ä»¶ä¸­è·å– ItemDecoration çš„è‡ªå®šä¹‰å±æ€§ã€‚<br>
ä¸»è¦ä»£ç ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ•…è€Œåœ¨å…¶å†…éƒ¨è‡ªå®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿è‡ª ItemDecoratio å¾—é™æ€å†…éƒ¨ç±» Decorationn ç±»ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>LetterIndex.java</strong><br>
è¯¥ç±»ç”¨æ¥ç”»å‡ºå­—æ¯å¯¼èˆªæ ï¼Œå¹¶ä¸”æä¾›æ–¹æ³•è·å–/è®¾ç½®å½“å‰é€‰ä¸­çš„å­—æ¯</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åé‡å†™<code>onTouchEvent(MotionEvent event)</code>æ–¹æ³•ï¼Œåœ¨ ACTION_DOWNã€ACTION_MOVEã€ACTION_UP æ—¶è°ƒç”¨å¯¹åº”çš„æ–¹æ³•å³å¯ã€‚</p>
<p>é‡å†™ onDraw() æ–¹æ³•ï¼Œç”»å‡ºå¯¹åº”çš„ç•Œé¢</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æºç </h2>
<p>æºä»£ç åœ¨æˆ‘çš„ Githubï¼Œ<a href="https://github.com/jixiaoyong/my_application_on_deepin/tree/master/contactsdemo/src/main" target="_blank" rel="noopener noreferrer">ç‚¹è¿™é‡Œ</a>å¯ä»¥æ‰¾åˆ°ã€‚</p>
<h2> é¢„è§ˆå¦‚ä¸‹</h2>
<figure><img src="http://upload-images.jianshu.io/upload_images/120748-183eea3cad2b42ac.gif?imageMogr2/auto-orient/strip" alt="é¢„è§ˆ.gif" tabindex="0" loading="lazy"><figcaption>é¢„è§ˆ.gif</figcaption></figure>
]]></content:encoded>
      <enclosure url="http://upload-images.jianshu.io/upload_images/120748-183eea3cad2b42ac.gif?imageMogr2/auto-orient/strip" type="image/"/>
    </item>
    <item>
      <title>Android è‡ªå®šä¹‰ view çš„ä¸€äº›çŸ¥è¯†ç‚¹</title>
      <link>https://jixiaoyong.github.io/blog/posts/e41787ec.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/e41787ec.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android è‡ªå®šä¹‰ view çš„ä¸€äº›çŸ¥è¯†ç‚¹</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 19 Feb 2018 13:59:28 GMT</pubDate>
      <content:encoded><![CDATA[<h2> View çš„ç»˜åˆ¶</h2>
<p>View çš„ç»˜åˆ¶åˆ†ä¸º 3 éƒ¨åˆ†ï¼š</p>
<ol>
<li>
<p>measure</p>
<p>æµ‹é‡ï¼Œå†³å®šäº† View çš„æµ‹é‡å®½ã€é«˜ã€‚å‡ ä¹æ‰€æœ‰æƒ…å†µä¸‹éƒ½ç­‰åŒäº View çš„æœ€ç»ˆå®½ã€é«˜ï¼ˆå¦‚æœ View éœ€è¦å¤šæ¬¡ measure æ‰èƒ½ç¡®å®šå¤§å°ï¼Œæˆ–è€…é‡å†™äº†<code>layout()</code>æ–¹æ³•ï¼Œå¹¶ä¿®æ”¹äº†ä¼ å…¥çš„å€¼çš„è¯åˆ™ä¸ä¼šç›¸ç­‰ï¼‰ã€‚</p>
</li>
<li>
<p>layout</p>
<p>å¸ƒå±€ï¼Œå†³å®š View çš„å››ä¸ªé¡¶ç‚¹åæ ‡å’Œå®é™…çš„å®½ã€é«˜ã€‚</p>
</li>
<li>
<p>draw</p>
<p>ç»˜åˆ¶ï¼Œå†³å®šäº† View çš„å…·ä½“æ˜¾ç¤ºå†…å®¹ã€‚</p>
</li>
</ol>
<p>å…¶ä¸­é€šè¿‡ ViewRootImpl ç±»çš„<code>performTraversals()</code>ä¾æ¬¡è°ƒç”¨<code>performXXX()</code>æ–¹æ³•ã€‚</p>
<h2> MeasureSpec</h2>
<p>MeasureSpec æ˜¯ä¸€ä¸ª 32 ä½ int å€¼ï¼Œé«˜ 2 ä½è¡¨ç¤º SpecModeï¼Œä½ 30 ä½è¡¨ç¤º SpecSizeã€‚</p>
<p>SpecMode æœ‰ 3 ç§å¯èƒ½å€¼ï¼š</p>
<ul>
<li>UNSPECIFIED çˆ¶å®¹å™¨æ²¡æœ‰é™å®š View å¤§å°ï¼Œå¯ä»¥æ˜¯ä»»æ„éœ€è¦çš„å¤§å°</li>
<li>EXACTLY çˆ¶ç±»æŒ‡å®šäº† View çš„å…·ä½“å¤§å°ï¼ŒView çš„æœ€ç»ˆå¤§å°å°±æ˜¯è¿™ä¸ªå€¼ (match_parent æˆ–è€…å…·ä½“æ•°å€¼)</li>
<li>AT_MOST View å¯ä»¥æ˜¯è¿™ä¸ªå€¼ä»¥å†…çš„ä»»æ„å¤§å° (wrap_content)</li>
</ul>
<p>æˆ‘ä»¬æŒ‡å®šçš„ View çš„ LayoutParams å’Œçˆ¶å®¹å™¨ï¼ˆDecorView åˆ™æ˜¯çª—å£çš„å°ºå¯¸ï¼Œæ™®é€š View æ˜¯çˆ¶å®¹å™¨çš„ MeasureSpecï¼‰ä¸€èµ·å†³å®šäº† View çš„ MeasureSpecï¼Œè¿›è€Œå†³å®šäº† View çš„å®½é«˜ã€‚</p>
<p>SpecSize å†³å®šäºçˆ¶å®¹å™¨çš„å°ºå¯¸ã€ä»¥åŠ View çš„ margin å’Œ paddingã€‚</p>
<h2> View ç»˜åˆ¶æµç¨‹</h2>
<p>final ç±»å‹çš„<code>measure()</code>æ–¹æ³•è°ƒç”¨<code>onMeasure()</code>æ–¹æ³•ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>onMeasure()</code>è°ƒç”¨äº†<code>setMeasuredDimension()</code>æ–¹æ³•è®¾ç½®äº† View å®½ã€é«˜çš„æµ‹é‡å€¼ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>getSuggestedMinimumXXX()</code>çš„å€¼ï¼š</p>
<p>å¦‚æœ View æ²¡æœ‰èƒŒæ™¯ï¼Œåˆ™è¿”å›çš„æ˜¯ View çš„<code>android:miniWidth</code>æŒ‡å®šçš„å€¼ï¼›</p>
<p>å¦‚æœ View æœ‰èƒŒæ™¯ï¼Œåˆ™è¿”å›çš„æ˜¯èƒŒæ™¯çš„<code>minimumWidth</code>çš„å€¼å’Œ<code>android:miniWidth</code>æŒ‡å®šçš„å€¼ä¸­æœ€å¤§çš„ä¸€ä¸ªå€¼ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±æ­¤ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœç›´æ¥ç»§æ‰¿è‡ª View çš„æ§ä»¶å¿…é¡»é‡å†™<code>onMeasure()</code>æ–¹æ³•ï¼Œè®¾ç½® wrap_content æ—¶å€™æ§ä»¶çš„å¤§å°ã€‚è¿™æ˜¯å› ä¸ºï¼š</p>
<p>wrap_content å¯¹åº”çš„ specMode æ˜¯ AT_MOST æ¨¡å¼ï¼Œå…¶å®½é«˜ç­‰äº<code>specSize</code>ã€‚</p>
<p>æ ¹æ® ViewGroup çš„<code>getChildMeasureSpec()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“æ­¤æ—¶çš„<code>specSize</code>æ˜¯çˆ¶å®¹å™¨ç›®å‰å¯ä»¥ç”¨çš„å¤§å°ï¼Œå³è¿™ç§æƒ…å†µä¸‹ wrap_content çš„æ•ˆæœå’Œ match_parent çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>è¦é¿å…è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦é‡å†™<code>onMeasure()</code>æ–¹æ³•ï¼Œåœ¨é‡Œé¢ä¸“é—¨æŒ‡å®š wrap_content æ—¶ View å¯¹åº”çš„å¤§å°ã€‚</p>
<h2> è·å– View çš„å®½é«˜</h2>
<p>ç”±äº View çš„ç»˜åˆ¶å’Œ Activity çš„ç”Ÿå‘½å‘¨æœŸä¸åŒæ­¥ï¼Œæ‰€ä»¥åœ¨<code>onCreate()/onStart()/onResume()</code>ä¸­éƒ½æ— æ³•æœ‰æ•ˆè·å– View çš„å®½é«˜ã€‚ä½¿ç”¨ä»¥ä¸‹æ–¹å¼åˆ™å¯ä»¥æ­£å¸¸è·å– View çš„å®½é«˜ï¼š</p>
<ol>
<li>
<p>Activity/View#onWindowFocusChanged()</p>
<p>å½“å‰çš„ Window è·å–æˆ–å¤±å»ç„¦ç‚¹çš„æ—¶å€™è°ƒç”¨ï¼Œæ­¤æ—¶ View å·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼Œå¯ä»¥è·å–å®½ã€é«˜ã€‚</p>
<p>Activity çª—å£ç„¦ç‚¹å˜åŒ– (onPause/onResume) æ—¶ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚</p>
</li>
<li>
<p>View#post(runnable)</p>
<p>è¯¥ runnable åœ¨ view çš„æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼Œè¢«æ‰§è¡Œæ—¶ View å·²ç»åˆå§‹åŒ–å¥½äº†ï¼Œå¯ä»¥åœ¨è¿™é‡Œè·å–å®½é«˜ã€‚</p>
</li>
<li>
<p>ViewTreeObserver</p>
<p>æ³¨å†Œ onGlobalLayoutListenerï¼Œå½“ View æ ‘çš„çŠ¶æ€å˜æ›´ï¼Œæˆ–è€… View æ ‘å†…éƒ¨ View å¯è§æ€§å‘ç”Ÿå˜åŒ–å°±ä¼šè¢«å›è°ƒã€‚</p>
<p>å½“ View æ ‘çš„çŠ¶æ€å˜æ›´å¯èƒ½è¢«è°ƒç”¨å¤šæ¬¡ã€‚</p>
</li>
<li>
<p>View#measure()</p>
<p>æ‰‹åŠ¨è°ƒç”¨<code>measure()</code>æ–¹æ³•è·å–å®½é«˜ã€‚</p>
</li>
</ol>
<h2> draw è¿‡ç¨‹</h2>
<p>ç»˜åˆ¶è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>ç»˜åˆ¶èƒŒæ™¯ <code>background.draw(canvas);</code></li>
<li>ç»˜åˆ¶è‡ªèº« <code>onDraw(canvas);</code></li>
<li>ç»˜åˆ¶ children <code>dispatchDraw(canvas);</code></li>
<li>ç»˜åˆ¶è£…é¥° <code>onDrawForeground(canvas);</code></li>
</ol>
<p><code>setWillNotDraw()</code>è¡¨ç¤ºå½“å‰çš„ ViewGroup ä¸éœ€è¦ç»˜åˆ¶ä»»ä½•å†…å®¹ï¼Œç³»ç»Ÿä¼šå¯¹æ­¤è¿›è¡Œä¼˜åŒ–ï¼ˆé»˜è®¤å¯ç”¨ï¼‰ã€‚å¦‚æœ ViewGroup éœ€è¦ç»˜åˆ¶å†…å®¹æ—¶ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨å…³é—­è¿™ä¸ªæ ‡å¿—ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ç»˜åˆ¶ä¸¤ä¸ªå›¾å½¢é‡å éƒ¨åˆ†</h2>
<p>android è‡ªå®šä¹‰ view æ—¶ä¸¤ä¸ªå›¾å½¢é‡å éƒ¨åˆ†çš„ç»˜åˆ¶æ–¹å¼ï¼Œä¸€å®šè¦è°ƒç”¨<code>canvas.saveLayer()</code> ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>paint.setXfermode()</code>å¯ä»¥è®¾ç½®çš„å€¼å‚è€ƒä¸‹å›¾ï¼š</p>
<figure><img src="http://jixiaoyong.github.io/images/20190408175100.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>å‚è€ƒè‡ª<a href="https://www.cnblogs.com/DarkMaster/p/4618872.html" target="_blank" rel="noopener noreferrer">ã€åŸã€‘ä½¿ç”¨ Xfermode æ­£ç¡®çš„ç»˜åˆ¶å‡ºé®ç½©æ•ˆæœ - sky0014 - åšå®¢å›­ </a></p>
<h2> é€‚é…è‡ªå®šä¹‰ view å®½é«˜ï¼Œè®¾ç½®é»˜è®¤å€¼</h2>
<p>ä»¥å…¶å®½åº¦ä¸ºä¾‹ï¼Œåœ¨<code>onMeasure(int widthMeasureSpec, int heightMeasureSpec)</code>æ–¹æ³•ä¸­ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æ–™</h2>
<p>ã€ŠAndroid å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹</p>
]]></content:encoded>
      <enclosure url="http://jixiaoyong.github.io/images/20190408175100.png" type="image/png"/>
    </item>
    <item>
      <title>Android è‡ªå®šä¹‰é€æ˜èƒŒæ™¯çš„ Dialog</title>
      <link>https://jixiaoyong.github.io/blog/posts/f20627c9.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/f20627c9.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android è‡ªå®šä¹‰é€æ˜èƒŒæ™¯çš„ Dialog</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 26 Jan 2018 07:09:40 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€ä»‹</h2>
<p>é€šè¿‡è‡ªå®šä¹‰ Dialog ç±»ï¼Œä½¿ç”¨ Styleã€AnimationDrawable ç­‰å®ç°ä¸€ä¸ªé€æ˜èƒŒæ™¯çš„ã€å¸¦è¿›åº¦æ›´æ–°çš„å¼¹çª—ã€‚</p>
<p>ä¸»è¦æ¶‰åŠ Style è‡ªå®šä¹‰ä»¥åŠ AnimationDrawable çš„ä½¿ç”¨ã€‚</p>
<h2> ä»£ç </h2>
<ul>
<li><strong>å¸ƒå±€æ–‡ä»¶</strong></li>
</ul>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><strong>èµ„æºæ–‡ä»¶</strong></li>
</ul>
<p>1ï¼‰ä¸‹è½½å¯¹åº”è¿›åº¦æ¡çš„å›¾ç‰‡èµ„æºï¼Œæ”¾åˆ° drawable ç›®å½•ä¸‹</p>
<p>2ï¼‰åœ¨ drawable ä¸‹æ–°å»º dialog_progress.xml</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰dialog åœ†è§’èƒŒæ™¯ï¼ˆéå¿…é¡»ï¼‰</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ï¼‰è‡ªå®šä¹‰ dialog çš„ style</p>
<p><code>windowBackground</code>ä½¿èƒŒæ™¯é€æ˜</p>
<p><code>backgroundDimEnabled</code>åˆ™å¯ä»¥å»é™¤åŠé€æ˜é®ç½©æ•ˆæœ</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><strong>DIYDialog.java</strong></li>
</ul>
<p>ç»§æ‰¿è‡ª<code>Dialog.java</code> ï¼Œå¹¶ç”¨æ„é€ å‡½æ•°è°ƒç”¨<code>initView()</code>æ–¹æ³•åˆå§‹åŒ– dialog æ ·å¼ï¼Œæœ‰å…¶ä»–éœ€æ±‚å¯ä»¥å†è‡ªå·±å®ç°ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æºç </h2>
<p><a href="https://github.com/jixiaoyong/AndroidNote/tree/master/code/2018-1-26/DIY_Dialog" target="_blank" rel="noopener noreferrer">github æºç è·¯å¾„</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android è¿è¡Œæ—¶æƒé™</title>
      <link>https://jixiaoyong.github.io/blog/posts/a2863875.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/a2863875.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android è¿è¡Œæ—¶æƒé™</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 25 Nov 2018 05:10:08 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€ä»‹</h2>
<p>æœ¬æ–‡ä»‹ç»äº† Android è¿è¡Œæ—¶æƒé™çš„ä¸€äº›å¤„ç†æµç¨‹ã€‚</p>
<p>Android è¿è¡Œæ—¶æƒé™æ˜¯ Android6 ä¹‹åå‡ºç°çš„å¤„ç†æƒé™çš„æ–°æ–¹å¼ï¼Œæ­¤å‰å¼€å‘è€…åªéœ€è¦åº”ç”¨éœ€è¦çš„æƒé™åœ¨ AndroidManifest.xml æ–‡ä»¶ä¸­å£°æ˜å³å¯ï¼Œç°åœ¨åˆ™éœ€è¦åœ¨ä½¿ç”¨åˆ°å¯¹åº”æƒé™æ—¶æ£€æµ‹æ˜¯å¦æœ‰è¯¥æƒé™å¹¶ä½œå‡ºç›¸åº”å¤„ç†ã€‚</p>
<h2> æ­£æ–‡</h2>
<h3> ä¸€èˆ¬æµç¨‹</h3>
<ol>
<li>
<p>åœ¨<code>AndroidManifest.xml</code>ä¸­å£°æ˜æ‰€éœ€æƒé™</p>
</li>
<li>
<p>åœ¨ä½¿ç”¨ä¹‹å‰æ£€æŸ¥æ˜¯å¦æœ‰è¯¥æƒé™<code>checkSelfPermission()</code>,å¦‚æœæœ‰åˆ™ç»§ç»­ç›¸åº”æ“ä½œ</p>
</li>
<li>
<p>å¦‚æœæ²¡æœ‰æƒé™åˆ™æ£€æµ‹æ˜¯å¦éœ€è¦å‘ç”¨æˆ·è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦è¯¥æƒé™<code>ActivityCompat.shouldShowRequestPermissionRationale()</code>ï¼Œå†å†³å®šå¦‚ä½•ç”³è¯·æƒé™<code>requestPermissions()</code></p>
</li>
</ol>
<blockquote>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒshouldShowRequestPermissionRationale() åœ¨ç¬¬ä¸€æ¬¡ç”³è¯·è¯¥æƒé™æ—¶ä¼šè¿”å› falseï¼Œç¬¬äºŒæ¬¡ç”³è¯·æ—¶è¿”å› trueï¼›ueï¼›</p>
<p>ä½†æ˜¯å¦‚æœç”¨æˆ·é€‰æ‹©äº†<em>ä¸å†æé†’</em> åˆ™ä¼šä¸€ç›´è¿”å› falseã€‚æ‰€ä»¥å¦‚æœåˆ¤æ–­å½“å‰å¹¶éç¬¬ä¸€æ¬¡ç”³è¯·è¯¥æƒé™ï¼Œå¹¶ä¸”è¿”å›ç»“æœä¸º falseï¼Œå°±è¯´æ˜ç”¨æˆ·é€‰æ‹©äº†ä¸å†æç¤ºï¼Œä¸€èˆ¬å°±éœ€è¦æç¤ºç”¨æˆ·åˆ°è®¾ç½®ä¸­å¼€å¯å¯¹åº”æƒé™ã€‚</p>
</blockquote>
<ol start="4">
<li>ç”³è¯·æƒé™çš„ç»“æœåœ¨<code>onRequestPermissionsResult()</code>æ–¹æ³•ä¸­è¿”å›ï¼Œæ ¹æ®ç”¨æˆ·å¯¹æƒé™çš„å¤„ç†ç»“æœå†³å®šæ¥ä¸‹æ¥çš„æ“ä½œ</li>
</ol>
<h3> ä»£ç </h3>
<p><code>onCreate()</code>æ–¹æ³•ä¸­è°ƒç”¨å¯¹åº”æ–¹æ³•</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>checkCameraDeviceAndPremissions()</code>å…·ä½“å†…å®¹</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹ç”³è¯·ç»“æœè¿›è¡Œå¤„ç†ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>safeRequestCameraPermission()</code>çš„å†…å®¹ï¼Œè¿™é‡Œæ‰æ˜¯å¤„ç†ç”³è¯·æƒé™çš„ç›¸å…³ä»£ç </p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> é™„å½•</h2>
<p>æ ·ä¾‹ä»£ç ï¼š <a href="https://github.com/jixiaoyong/Notes-Files/commit/f41afa99c24cde1dab619462754435f2a2afc64e#diff-67ccb5e5c6c34760486a1071b23338a2" target="_blank" rel="noopener noreferrer">Github</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android é€šè¿‡ Hook å¯åŠ¨æœªæ³¨å†Œ Activity</title>
      <link>https://jixiaoyong.github.io/blog/posts/26eab50a.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/26eab50a.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android é€šè¿‡ Hook å¯åŠ¨æœªæ³¨å†Œ Activity</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 15 Jan 2018 16:10:41 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€ä»‹</h2>
<p>hook æ˜¯é’©å­çš„æ„æ€ï¼Œhook çš„è¿‡ç¨‹æ˜¯é€šè¿‡åå°„ã€ä»£ç†ç­‰æ”¹å˜ç³»ç»ŸåŸæœ‰çš„è¡Œä¸ºä»¥è¾¾åˆ°è‡ªå·±çš„ç›®çš„ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦æ˜¯é€šè¿‡ hook android ä¸­çš„ ActivityManagerService å’Œ Handler.CallBackï¼Œæ¬ºéª—ç³»ç»Ÿè°ƒèµ· activity çš„è¿‡ç¨‹ï¼Œåœ¨è°ƒç”¨ startActivity æ—¶å°† targetIntent é€šè¿‡ proxy ä¼ªè£…ä¸º proxyIntentï¼Œç­‰åˆ°é€šè¿‡ç³»ç»ŸéªŒè¯ï¼Œæ­£å¼å¯åŠ¨ activity æ—¶ï¼Œå†è®² proxyIntent æ¢å¤ä¸º targetIntentï¼Œä»è€Œå®ç°è°ƒç”¨æœªåœ¨ AndroidManifest.xml ä¸­æ³¨å†Œçš„ activityã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„ï¼Œæœ¬æ–¹æ³•åªåœ¨ Api&lt;26 ä¸‹æœ‰æ•ˆã€‚å…·ä½“åŸå› è§åé¢ã€‚</p>
</blockquote>
<h2> å…·ä½“å®ç°</h2>
<h3> 1.æ–°å»º Activity ç­‰</h3>
<p><code>IndexActivity.java</code>ç”¨äºå¯åŠ¨<code>targetIntent</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>TargetActivity.java</code> å’Œ<code>ProxyActivity.java</code> åˆ†åˆ«è®¾ç½®å¯¹åº”é¡µé¢å¸ƒå±€<code>setContentView(R.layout.activity_xxx);</code></p>
<p><code>HookApplication.java</code> ç”¨äºè°ƒç”¨ hook æ–¹æ³•</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>AndroidManifest.xml</code>ä¸­æ³¨å†Œ<code>IndexActivity</code>å’Œ<code>ProxyActivity</code>ï¼ŒApplication ä½¿ç”¨<code>HookApplication</code>ã€‚</p>
<h3> 2.Utils.java å®ç° hook å…·ä½“é€»è¾‘</h3>
<p><code>Utils.hookAms()</code> å®ç°æ‹¦æˆª targetIntent å¹¶å‘èµ· proxyIntentï¼Œæ¬ºéª—ç³»ç»Ÿå¯¹ activity æ˜¯å¦å·²æ³¨å†Œçš„éªŒè¯ï¼Œå…¶ä¸­ proxyIntent é€šè¿‡<code>proxyIntent.putExtra(TARGET_KEY, targetIntent);</code> æ–¹æ³•æºå¸¦ targetIntentã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>MAmsInvocationHandler</code> é‡Œé¢å®ç° targetIntent å’Œ proxy çš„è½¬æ¢</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‡³æ­¤ï¼Œå·²ç»å¯¹ activity.startActivity åšäº†æ‹¦æˆªï¼Œæ‰€æœ‰çš„ targetIntent éƒ½ä¼šè¢«æ‹¦æˆªï¼Œå­˜å‚¨åœ¨ proxyIntent ä¸­ï¼Œä»¥é€šè¿‡ç³»ç»Ÿçš„æ£€æŸ¥ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡ç³»ç»Ÿæ£€æŸ¥åï¼Œ<code>hookHandle()</code>é€šè¿‡é‡å†™ Handler.CallBackï¼Œå¯¹å¯åŠ¨ proxyIntent äº‹ä»¶åšæ‹¦æˆªï¼Œä½¿ä¹‹å¯åŠ¨ targetIntent å¯¹åº”çš„ Activityã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<code>ActivityThreadHandlerCallBack</code> å°†è¿”å›æˆ‘ä»¬è‡ªå®šä¹‰çš„ CallBack ä»¥æ›¿æ¢ç³»ç»Ÿçš„ï¼Œå®ç°å¯åŠ¨ targetIntent è€Œé proxyIntentã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ°è¿™é‡Œï¼Œå°±å®ç°äº†å¯åŠ¨é€šè¿‡å·²ç»æ³¨å†Œäº†çš„ ProxyActivity å¯åŠ¨æœªæ³¨å†Œ TargetActivity çš„å…¨è¿‡ç¨‹ã€‚</p>
<p>ä¸»è¦æ€æƒ³æ˜¯æ‰¾åˆ°ç³»ç»Ÿå®ç°è¯¥è¿‡ç¨‹çš„é€»è¾‘ï¼Œåœ¨å¯¹åº”åœ°æ–¹é€šè¿‡åå°„è·å–åˆ°å¯¹åº”å˜é‡ï¼Œæ’å…¥è‡ªå·±çš„é€»è¾‘ï¼Œä»è€Œè¾¾åˆ°ç›®çš„ã€‚</p>
<h2> é™„å½•</h2>
<p>ä¸Šé¢æ¶‰åŠåˆ°çš„ä»£ç è·¯å¾„ï¼š</p>
<p><a href="https://github.com/jixiaoyong/AndroidNote/tree/master/code/AndroidHook/20180116" target="_blank" rel="noopener noreferrer">github æºä»£ç è·¯å¾„</a></p>
<p>å‚è€ƒäº†å‡ ç¯‡æ–‡ç« ï¼Œå…¶ä¸­è¾ƒä¸ºå®Œæ•´çš„ä¸€ç¯‡å¦‚ä¸‹ï¼š</p>
<p><a href="https://www.jianshu.com/p/69bfbda302df" target="_blank" rel="noopener noreferrer">Android æ’ä»¶åŒ–ç³»åˆ—ç¬¬ï¼ˆä¸€ï¼‰ç¯‡---Hook æŠ€æœ¯ä¹‹ Activity çš„å¯åŠ¨è¿‡ç¨‹æ‹¦æˆª</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Android é˜…è¯»ç¬”è®°</title>
      <link>https://jixiaoyong.github.io/blog/posts/aacd75ab.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/aacd75ab.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Android é˜…è¯»ç¬”è®°</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 22 Feb 2018 11:29:48 GMT</pubDate>
      <content:encoded><![CDATA[<h3> layout_weight</h3>
<p>layout_weight é‡è¦æ€§ï¼Œé»˜è®¤çš„æ˜¯ 0,0 ç­‰çº§æœ€é«˜ï¼Œè¦æ˜¾ç¤ºï¼Œæ•°å­—è¶Šå¤§é‡è¦æ€§è¶Šä½ã€‚</p>
<p>ä¾‹ï¼šaï¼Œb çš„å®½åº¦ä¸º 0ï¼Œlayout_weight åˆ†åˆ«ä¸º 1ã€2ï¼Œåˆ™ aï¼Œb å®½åº¦åˆ†åˆ«ä¸ºçˆ¶å®¹å™¨çš„ 2/3ã€1/3ã€‚</p>
<h3> PendingIntent</h3>
<p>PendingIntent æ˜¯å°è£…åçš„ intentï¼Œæœ‰ intent æ‰§è¡Œæ‰€éœ€çš„ contextï¼Œæ‰€ä»¥å³ä½¿è¦æ‰§è¡Œ intent çš„ activity å·²ç»æ¶ˆå¤±æˆ–è€…è¿˜æ²¡ç”Ÿæˆï¼Œå…¶ä»– activity ä¾ç„¶å¯ä»¥é€šè¿‡ PendingIntent æ‰§è¡Œ intentã€‚</p>
<blockquote>
<p>PendingIntent is a description of an Intent and target action to perform with it. Instances of this class are created with <code>getActivity(Context, int, Intent, int)</code>, <code>getActivities(Context, int, Intent[], int)</code>, <code>getBroadcast(Context, int, Intent, int)</code>, and <code>getService(Context, int, Intent, int)</code>; the returned object can be handed to other applications so that they can perform the action you described on your behalf at a later time.</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯æŠŠè‡ªå·±è¦æ‰§è¡Œçš„ intent å’Œæ‰§è¡Œæ‰€éœ€çš„ context å°è£…åç»™åˆ«äººï¼Œè¯·åˆ«äººåœ¨é€‚å½“çš„æ—¶å€™æ‰§è¡Œã€‚</p>
<h3> android æ¨¡æ‹Ÿå™¨è®¿é—®ç”µè„‘ localhost</h3>
<p>ç”µè„‘<code>localhost</code>æˆ–è€…<code>127.0.0.1</code>è®¿é—®æœ¬åœ°ç½‘å€ã€‚</p>
<p>æ¨¡æ‹Ÿå™¨è®¿é—®<code>localhost</code>ä¼šé»˜è®¤è®¿é—®æ‰‹æœºçš„æœ¬åœ°ç½‘å€ï¼Œè¦è®¿é—®ç”µè„‘çš„æœ¬åœ°ç½‘å€åˆ™éœ€è¦è®¿é—®<code>10.0.2.2:8080</code>ï¼Œè®°å¾—åŠ ä¸Šå¯¹åº”çš„ç«¯å£ã€‚</p>
<h3> è·å–å±å¹•ç”»é¢</h3>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> è·å–ç½‘ç»œä¿¡æ¯ï¼Œè¯·æ±‚ç½‘ç»œ</h3>
<p>éœ€è¦è¯·æ±‚æƒé™</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>java ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> LiveData</h2>
<p><code>LiveData</code>å¯ä»¥åœ¨æ•°æ®æœ‰å˜åŒ–çš„æ—¶å€™è°ƒç”¨è®¢é˜…è€…å¹¶æ‰§è¡ŒæŒ‡å®šæ–¹æ³•ã€‚</p>
<p><code>Transformations</code>æœ‰ä¸¤ä¸ªè½¬åŒ–<code>LiveData</code>çš„æ–¹æ³•ï¼š<code>map()</code>å’Œ<code>switchMap()</code>ã€‚</p>
<p><code>map()</code>å¯ä»¥å°†ä¸€ä¸ª<code>LiveData</code>ç»è¿‡å¤„ç†è½¬åŒ–ä¸ºå¦å¤–ä¸€ä¸ª<code>LiveData</code>ã€‚</p>
<p>è€Œ<code>switchMap()</code>åˆ™å¯ä»¥æ ¹æ®ä¸åŒçš„éœ€è¦åˆ‡æ¢ä¸åŒçš„<code>LiveData</code>ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼Œ<code>LiveData</code>çš„å­ç±»<code>MediatorLiveData</code>å¯ä»¥æ·»åŠ å¤šä¸ªç›‘å¬é¡¹ï¼Œæ¯ä¸ªé¡¹ç›®æ”¹å˜éƒ½ä¼šå›è°ƒå¯¹åº”çš„<code>onChange()</code>æ–¹æ³•ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://www.jianshu.com/p/dab2ee97d680" target="_blank" rel="noopener noreferrer">ã€è¯‘ã€‘LiveData ä½¿ç”¨è¯¦è§£</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>AppWidget çš„ä½¿ç”¨ä¹‹ PendingIntent</title>
      <link>https://jixiaoyong.github.io/blog/posts/fcfc830b.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/fcfc830b.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">AppWidget çš„ä½¿ç”¨ä¹‹ PendingIntent</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 24 Apr 2016 22:06:06 GMT</pubDate>
      <content:encoded><![CDATA[<p>è¿™å‡ å¤©å­¦ä¹  AppWidgetï¼Œå¾ˆç®€å•çš„ç»„ä»¶å´èŠ±è´¹äº†ä¸å°‘åŠŸå¤«ï¼Œä»Šå¤©å¯¹ PendingIntent çš„ç”¨æ³•åšäº†ä¸€äº›ç®€å•çš„æ•´ç†ã€‚</p>
<p><strong>PendingIntent</strong></p>
<blockquote>
<p>PandingIntent å°±åƒæ˜¯ä¸€ä¸ªè®¾è®¡å¥½çš„å¤„ç†é¢„æ¡ˆï¼Œå½“è¾¾åˆ°æŸä¸ªç‰¹å®šæ¡ä»¶æ—¶ï¼Œä¾¿ä¼šè°ƒç”¨è¯¥ Intent æ‰€æŒ‡å®šåŠ¨ä½œï¼ˆæ‰“å¼€æœåŠ¡ï¼ŒActivity æˆ–è€…å‘é€å¹¿æ’­ï¼‰ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨è¯¥æ–¹æ³•åœ¨ AppWidget é‡Œé¢ä¸ºæŒ‰é’®æ·»åŠ ç›‘å¬äº‹ä»¶ï¼Œå½“æŒ‰é’®è¢«ç‚¹å‡»çš„æ—¶å€™è§¦å‘ç›¸åº”çš„åŠ¨ä½œ</p>
</blockquote>
<p>AppWidget å’Œåº”ç”¨ç¨‹åºä¸å†åŒä¸€ä¸ªè¿›ç¨‹å½“ä¸­ï¼Œè€Œæ˜¯åœ¨ HomeScreen ä¸Šé¢æ‰§è¡Œï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä¸º AppWidget ä¸­çš„ Button æ·»åŠ ç›‘å¬äº‹ä»¶ï¼Œéœ€è¦ç”¨ <code>remoteViews.setPendingIntent(R.id.widget_button,pendingIntent);</code>æ„æ€æ˜¯å½“æŒ‰ä¸‹æŒ‰é’®çš„æ—¶å€™ pendingIntent ä¸­çš„ Intent å°±ä¼šæ‰§è¡Œ</p>
<p>PendingIntent å½“æŸä¸ªäº‹ä»¶å‡ºç°ä¹‹åæ‰ä¼šæ‰§è¡Œ</p>
<p>RemoteViews å¯¹è±¡ ä»£è¡¨äº†ä¸€ç³»åˆ—çš„ View å¯¹è±¡ï¼Œå’Œä¸»ç¨‹åºä¸åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸º AppWidget æ§ä»¶ç»‘å®šå¤„ç†å™¨</p>
<p><strong>æµç¨‹æ¦‚è¿°ï¼š</strong></p>
<ul>
<li>
<p>æ·»åŠ  appwidget_provider_info.xml åœ¨ res/xml ä¸‹æ–°å»º appwidget_provider_info.xml</p>
<ul>
<li>æè¿° AppWidget çš„åŸºæœ¬ä¿¡æ¯å¦‚æœ€å°é«˜åº¦ã€å®½åº¦ç­‰ï¼Œè¿˜æœ‰å°±æ˜¯è¯¥æŒ‚ä»¶çš„å¸ƒå±€æ–‡ä»¶</li>
</ul>
</li>
<li>
<p>åœ¨ res/layout ä¸‹é¢ä¸ºè¯¥æŒ‚ä»¶è®¾ç½®å…·ä½“çš„å¸ƒå±€æ ·å¼</p>
<ul>
<li>å‘ AppWidget çš„å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª Button</li>
<li>å‘ AppWidget çš„å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª TextView</li>
</ul>
</li>
<li>
<p>æ–°å»º MyAppWidget.java ç»§æ‰¿è‡ª AppWidgetProvider</p>
<p>åœ¨è¯¥ç±»çš„ onUpdate() æ–¹æ³•ä¸­ä¸º Button è®¾ç½®ã€æ·»åŠ ç›‘å¬äº‹ä»¶</p>
<ul>
<li>å»ºç«‹ä¸€ä¸ª Intent å¯¹è±¡</li>
<li>ç”¨è¯¥ Intent å¯¹è±¡åˆ›å»ºä¸€ä¸ª PendingIntent å¯¹è±¡</li>
<li>åˆ›å»ºä¸€ä¸ª RemoteViews å¯¹è±¡</li>
<li>ç”¨è¯¥ RemoveViews å¯¹è±¡ä¸º æŒ‰é’®ç»‘å®šäº‹ä»¶å¤„ç†å™¨</li>
<li>æ›´æ–°æŒ‰é’®</li>
</ul>
</li>
<li>
<p>æ³¨å†Œäº‹ä»¶</p>
</li>
<li>
<p>å¤‡æ³¨ï¼šè¦æ˜¯ä¸º AppWidget ä¸­çš„ Button è®¾ç½®çš„äº‹ä»¶æ˜¯æ‰“å¼€ä¸€ä¸ª TargetActivityï¼Œè¿˜éœ€è¦æ·»åŠ ä¸€ä¸ª TargetActivity ç±»å’Œå¯¹åº”çš„å¸ƒå±€æ–‡ä»¶</p>
</li>
</ul>
<p><strong>ä»¥ä¸‹æ˜¯ä»£ç </strong></p>
<ul>
<li>appwidget_provider_info.xml</li>
</ul>
<p>è¿™ä¸ªå¸ƒå±€æ–‡ä»¶æ˜¯ AppWidget çš„ä¿¡æ¯</p>
<p>æè¿°äº† AppWidget çš„æœ€å°é«˜ï¼Œæœ€å°å®½ä»¥åŠå®ƒçš„å¸ƒå±€æ–‡ä»¶</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>app_widget.xml</li>
</ul>
<p>è¿™ä¸ªå¸ƒå±€æ–‡ä»¶æ˜¯ Widget åœ¨æ¡Œé¢ä¸Šæ˜¾ç¤ºçš„æ ·å¼</p>
<p>å®šä¹‰äº† AppWidget ä¸­å„ä¸ªç»„ä»¶åŠå…¶æ ·å¼</p>
<p>å…¶ä¸­ Button ç”¨æ¥å“åº”ç‚¹å‡»äº‹ä»¶ï¼ŒåŠ å…¥ TargetActivity</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>target_activity.xml</li>
</ul>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>MyAppWidget.java</li>
</ul>
<p>ä¸»è¦æ˜¯ä¿®æ”¹äº† update() æ–¹æ³•ï¼š</p>
<p>å®šä¹‰äº†ä¸€ä¸ªé¢„å…ˆè®¾å®šçš„åŠ¨ä½œâ€”- Intent å¯¹è±¡ï¼›</p>
<p>åˆ©ç”¨è¯¥ Intent è¯»å†™ï¼Œåˆ›å»ºä¸€ä¸ª PendingIntent å¯¹è±¡ï¼›</p>
<p>åˆ›å»ºä¸€ä¸ª RemoteView å¯¹è±¡ï¼Œå¹¶ä¸ºæŒ‰é’®ç»‘å®šç›‘å¬äº‹ä»¶</p>
<p>åˆ·æ–° AppWidgetã€‚</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>TargetActivity.java</li>
</ul>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>AndroidManifest.xml</li>
</ul>
<p>åœ¨ AndroidManifest.xml ä¸­æ³¨å†Œ TargetActivity å’Œ MyAppWidget</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>AsyncTask æºç è§£æ</title>
      <link>https://jixiaoyong.github.io/blog/posts/7ee9086b.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/7ee9086b.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">AsyncTask æºç è§£æ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 19 Apr 2018 14:04:28 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>è¿™æ˜¯ AsyncTask æºç çš„ç®€å•åˆ†æï¼Œä¸»è¦åŸºäºã€ŠAndroid å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ä¸€ä¹¦çš„å†…å®¹ã€‚</p>
</blockquote>
<p>AsyncTask æ˜¯ Android ä¸­å¤šçº¿ç¨‹å¤„ç†æ–¹å¼ä¹‹ä¸€ï¼ˆå…¶ä½™ä¸º 1.HandlerThreadã€2.IntentService ä»¥åŠæ™®é€šçš„çº¿ç¨‹ Threadï¼‰ã€‚</p>
<p>AsyncTask æœ¬è´¨æ˜¯çº¿ç¨‹æ± å’Œ Handler çš„åŒ…è£…ç±»ï¼Œé€‚åˆå®æ—¶æ›´æ–°åå°ä»»åŠ¡è¿›åº¦çš„å·¥ä½œï¼Œç‰¹åˆ«è€—æ—¶çš„å·¥ä½œåº”å½“äº¤ç»™çº¿ç¨‹æ± å¤„ç†ã€‚</p>
<p>AsyncTask å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li>onPreExecute()</li>
<li>doInBackground()</li>
<li>onProgressUpdate()</li>
<li>onPostExecute()</li>
</ul>
<p>AsyncTask æœ‰ä¸€ä¸‹é™åˆ¶ï¼š</p>
<ol>
<li>AsyncTask å¯¹è±¡å¿…é¡»åœ¨ä¸»çº¿ç¨‹ï¼ˆUI çº¿ç¨‹ï¼Œä¸‹åŒï¼‰åˆ›å»º</li>
<li>AsyncTask çš„ execute() å¿…é¡»åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œä¸”åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡</li>
<li>ä¸èƒ½<strong>ç›´æ¥è°ƒç”¨</strong>å…¶ 4 ç§å¸¸ç”¨æ–¹æ³•ï¼ˆè§ä¸Šï¼‰</li>
</ol>
<h2> ä½¿ç”¨</h2>
<ul>
<li>ç»§æ‰¿è‡ª AsyncTaskï¼Œé‡å†™å¯¹åº”æ–¹æ³•ã€‚ï¼ˆæ³¨æ„å¦‚æœéœ€è¦æ›´æ–°è¿›åº¦ï¼Œè¦åœ¨ doInBackground() æ–¹æ³•ä¸­è°ƒç”¨ publishProgress() æ–¹æ³•ï¼‰</li>
<li>åœ¨<strong>UI çº¿ç¨‹</strong>å®ä¾‹åŒ– AsyncTask å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ execute() æ–¹æ³•ï¼Œä¼ å…¥å‚æ•°å¼€å§‹æ‰§è¡Œã€‚ã€‚</li>
</ul>
<h2> æ¦‚è¿°</h2>
<p><strong>åœ¨ execute(params) æ‰§è¡Œåï¼Œå°†å‚æ•° params ä¼ å…¥ mWorker.call() æ–¹æ³•</strong></p>
<p è°ƒç”¨="" doinbackground(params)="" åå°æ‰§è¡Œä»»åŠ¡ï¼ŒåŒæ—¶é€šè¿‡="" postresult()="" æ–¹æ³•å‘é€æ‰§è¡Œç»“æœï¼Œç”±="" internalhandler.handlemessage()="" åˆ¤æ–­è¯¥æ‰§è¡Œ="" finish()="" è¿˜æ˜¯="" onprogressupdate()=""></p>
<p å°†="" mworker="" ä¼ å…¥="" mfuture="" ä¸­ä½œä¸ºå…¶="" callable="" åœ¨="" runandreset()="" æ–¹æ³•ä¸­æ‰§è¡Œ="" c.call()="" æ–¹æ³•ã€‚=""></p>
<p><strong>é€šè¿‡ exec.execute(mFuture) å°†å…¶å‹å…¥ SerialExecutor çº¿ç¨‹æ± ä¸­æ’é˜Ÿï¼Œå¹¶åœ¨ THREAD_POOL_EXECUTOR.execute(mActive) çœŸæ­£æ‰§è¡Œã€‚</strong></p>
<h2> ä»£ç åˆ†æ</h2>
<p>åˆ›å»ºå¯¹è±¡ï¼ˆä»£ç æœ‰èŠ‚ç•¥ï¼Œä¸‹åŒï¼‰</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†çœ‹ FutureTask</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ execute() æ–¹æ³•</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œè°ƒç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œè°ƒç”¨äº†å¸¸ç”¨æ–¹æ³•ä¹‹ä¸€ onPreExecute();</p>
<p>mWorker å’Œ mFuture çš„å…³ç³»å‰æ–‡å·²ç»æè¿°äº†ï¼Œåœ¨çœ‹ä¸€ä¸‹ exec.execute(mFuture) æ‰§è¡Œäº†ä»€ä¹ˆï¼š</p>
<p>exec æ˜¯ execute() ä¼ å…¥çš„ï¼Œå¯¹åº”äº sDefaultExecutorï¼Œå†æŸ¥ä¸‹å»</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†çœ‹çœ‹ SerialExecutor è¿™ä¸ªçº¿ç¨‹æ± </p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†ä»”ç»†çœ‹ä¸€ä¸‹ THREAD_POOL_EXECUTOR</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»‹ç»äº†çº¿ç¨‹å’Œçº¿ç¨‹æ± éƒ¨åˆ†çš„å†…å®¹ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹åœ¨ä¸»çº¿ç¨‹å’Œåå°çº¿ç¨‹ä¹‹é—´æ˜¯å¦‚ä½•ä¾é  handler æœºåˆ¶æ¥ä¼ é€’æ¶ˆæ¯çš„ã€‚</p>
<p>å…³äºæ„é€ å‡½æ•°ï¼Œç”±äºæˆ‘ä»¬å¼€å‘è€…åªèƒ½æ¥è§¦åˆ° AsyncTask() è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæ‰€ä»¥<code>mHandler=getMainHandler()</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†çœ‹ä¸€ä¸‹ InternalHandler ç±»</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å¦‚ï¼Œåœ¨ doInBackground() æ–¹æ³•ä¸­å¯ä»¥ä½¿ç”¨ publishProgress() åœ¨åå°æ›´æ–°è¿›åº¦ï¼Œå³æ˜¯ä½¿ç”¨äº† handler å‘é€æ¶ˆæ¯ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼ŒAsyncTask çš„ finish()</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Compose å±å¹•é€‚é…</title>
      <link>https://jixiaoyong.github.io/blog/posts/e15dda2e.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/e15dda2e.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Compose å±å¹•é€‚é…</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 03 Aug 2021 03:51:32 GMT</pubDate>
      <content:encoded><![CDATA[<h2> Compose å±å¹•é€‚é…</h2>
<p>ä¸€ç§<strong>Compose</strong>ä¸­å±å¹•é€‚é…çš„è§£å†³æ–¹æ¡ˆï¼Œçµæ„Ÿå‚è€ƒ<em>å¤´æ¡å±å¹•é€‚é…</em>ã€<em>AndroidAutoSize</em>ç­‰ï¼Œä»¥è®¾è®¡ç¨¿å®½åº¦å’Œå±å¹•æ°´å¹³æ–¹æ³•å¤§å°ä¸ºå‡†ï¼Œç­‰æ¯”æ‹‰ä¼¸æ§ä»¶å¤§å°ã€‚</p>
<p>åæ–‡é™„æœ‰æœ¬æ–¹æ¡ˆçš„ Kotlin è¯­è¨€å®ç°ï¼Œä½¿ç”¨åªéœ€è¦ä¸¤ä¸ªæ­¥éª¤å³å¯ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ä¸»è¦çš„è®¾è®¡æ€æƒ³</h2>
<p>å‡è®¾å¦‚ä¸‹å˜é‡ï¼šè®¾è®¡ç¨¿æ€»å®½åº¦<code>dpx</code>ï¼Œæ§ä»¶åœ¨è®¾è®¡ç¨¿ä¸­çš„å¤§å°<code>n</code>ï¼Œå±å¹•çš„å®é™…æ°´å¹³ dp å¤§å°<code>rdp</code>ï¼Œä»¥åŠæˆ‘ä»¬éœ€è¦æ±‚å¾—çš„æ§ä»¶åœ¨è®¾å¤‡ä¸­çš„ dp å€¼<code>m</code>ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬ä¸éš¾å¾—åˆ°ä»¥ä¸‹æ–¹ç¨‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¹Ÿå°±å¯ä»¥æ¨å¯¼å‡ºï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸Šè¿°å€¼ä¸­ï¼Œåªæœ‰å±å¹•æ°´å¹³ dp å€¼<code>rdp</code>è¿˜æ˜¯æœªçŸ¥çš„ï¼Œåˆæ ¹æ®**ï¼ˆ<code>density</code> åœ¨æ¯ä¸ªè®¾å¤‡ä¸Šéƒ½æ˜¯å›ºå®šçš„ï¼Œ<code>DPI</code> / 160 = <code>density</code>ï¼Œå±å¹•çš„æ€» px å®½åº¦<code>wpx</code> / <code>density</code> = å±å¹•çš„æ€» dp å®½åº¦<code>rdp</code>ï¼‰**å¯çŸ¥ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ°è¿™é‡Œï¼Œç­‰å¼åé¢çš„æ‰€æœ‰æ•°æ®éƒ½ä¸ºå·²çŸ¥æˆ–è€…åœ¨ app è¿è¡Œæ—¶å¯çŸ¥ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºè®¾è®¡ç¨¿ä¸­çš„æ§ä»¶åœ¨ Compose ä¸­å¯¹åº”çš„ dp å¤§å°ã€‚</p>
<p>ä¸‹é¢æ˜¯ä»¥ä¸Šæ€è·¯çš„ kotlin å®ç°ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒæ–‡ç« </h2>
<p><a href="https://github.com/JessYanCoding/AndroidAutoSize" target="_blank" rel="noopener noreferrer">AndroidAutoSize</a></p>
<p><a href="https://mp.weixin.qq.com/s/d9QCoBP6kV9VSWvVldVVwA" target="_blank" rel="noopener noreferrer">ä¸€ç§æä½æˆæœ¬çš„ Android å±å¹•é€‚é…æ–¹å¼</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Dagger 2 ä» 0 åˆ° 1 ä¹‹æ—…</title>
      <link>https://jixiaoyong.github.io/blog/posts/2822c354.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/2822c354.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Dagger 2 ä» 0 åˆ° 1 ä¹‹æ—…</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 26 Jan 2019 07:16:17 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p><code>Dagger 2</code>æ˜¯ Google ç»´æŠ¤çš„ä¸€æ¬¾å¯ç”¨äº<code>Java</code>å’Œ<code>Android</code>çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦æ˜¯ç®€å•æ¢³ç†<code>Dagger 2</code>ä¸­å„ä¸ªæ³¨è§£çš„ä½œç”¨ï¼Œä»¥åŠå…¶ç®€å•ç”¨æ³•ï¼Œä¸æ¶‰åŠå…·ä½“é¡¹ç›®åº”ç”¨ã€‚</p>
<p>å…ˆè§£é‡Šå‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>
<p><strong><code>ä¾èµ–æ³¨å…¥</code></strong>ï¼šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–é™æ€æ–¹æ³•ï¼‰ç»™å¦ä¸€ä¸ªå¯¹è±¡æä¾›ä¾èµ–çš„æŠ€æœ¯ã€‚</p>
</li>
<li>
<p>**<code>ä¾èµ–</code>**æ˜¯å¯ä»¥ä½¿ç”¨çš„å¯¹è±¡ï¼ˆ<code>Service</code>ï¼‰ï¼Œè€ŒæŠŠä¾èµ–æä¾›ç»™ä½¿ç”¨è¯¥ä¾èµ–çš„å¯¹è±¡ï¼ˆ<code>Client</code>ï¼‰çš„è¿‡ç¨‹å«åš<code>æ³¨å…¥</code>ã€‚</p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢è¿™æ®µä»£ç ä¸­<code>Service</code>å°±æ˜¯<code>Client</code>çš„ä¾èµ–ã€‚ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯å¦‚æœæ¯ä¸ªä¾èµ–éƒ½è¿™æ ·å†™çš„è¯ï¼Œå¦‚æœ<code>Service</code>ç±»çš„æ„é€ æ–¹æ³•æœ‰å˜æ›´ï¼Œå°±éœ€è¦åŒæ—¶ä¹Ÿæ›´æ”¹<code>Client</code>å¯¹åº”çš„æ–¹æ³•ï¼Œè¿™æ ·æ·±è€¦åˆçš„ä»£ç æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚</p>
<p><code>Dagger 2 </code>å°±æ˜¯ä¸ºäº†å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ä½¿ç”¨å®ƒä¹‹åï¼Œ<code>Client</code>ç±»çš„ä»£ç åªéœ€è¦è¿™æ ·å†™æˆç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼ˆç¤ºä¾‹ä»£ç ï¼‰ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ—¶<code>Service</code>çš„å®ä¾‹åŒ–è¿‡ç¨‹è¢«ç§»åˆ°äº†<code>Client</code>çš„å¤–éƒ¨æŸå¤„ï¼Œè¿™æ ·å¦‚æœ<code>Service</code>æ„é€ æ–¹æ³•æœ‰æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ç»Ÿä¸€å»ä¿®æ”¹<code>magicFun()</code>ä¸­å¯¹åº”çš„ä»£ç å³å¯ã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸€åˆ‡<code>Dagger 2</code>åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<h2> Dagger 2 å…·ä½“å®ç°</h2>
<h3> @Inject</h3>
<p>é¦–å…ˆéœ€è¦è¯·å‡ºç¬¬ä¸€ä¸ªä¸»è§’â€”â€”<strong><code>@Inject</code></strong>ã€‚</p>
<p>åœ¨<code>Dagger 2</code>ä¸­ï¼Œ<code>@Inject</code>ä¸»è¦åšä¸¤ä»¶äº‹ â¶ æ ‡è®°ä¾èµ–ç±»çš„æ„é€ æ–¹æ³•ï¼›â· æ ‡è®°éœ€è¦æ¡†æ¶è‡ªåŠ¨å®ä¾‹åŒ–çš„å¯¹è±¡ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·<code>Dagger 2 </code>å°±çŸ¥é“äº†æœ‰ä¸ªå¯¹è±¡éœ€è¦å®ƒæ¥å¸®åŠ©æˆ‘ä»¬æ³¨å…¥ï¼ŒåŒæ—¶ä¹ŸçŸ¥é“äº†æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•æ¥å®ä¾‹åŒ–<code>Service</code>å¯¹è±¡ã€‚ä½†è¿™æ—¶å¦‚ä½•å°†äºŒè€…è”ç³»èµ·æ¥å‘¢ï¼Ÿ</p>
<h3> @Component</h3>
<p>è¿™å°±è¦æåˆ°ç¬¬äºŒä¸ªä¸»è§’â€”â€”<strong><code>@Component</code></strong>ã€‚</p>
<p><code>@Component</code>æ ‡è®°çš„ç±»æ˜¯å°†ä¸€ä¸ªç±»å’Œä»–çš„ä¾èµ–è”ç³»åœ¨ä¸€èµ·çš„æ¡¥æ¢ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª<strong>æŠ½è±¡ç±»æˆ–è€…æ¥å£</strong>ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‡³æ­¤ï¼Œ<code>Client</code>å’Œ<code>Service</code>é€šè¿‡<code>ClientComponent</code>è”ç³»åœ¨ä¸€èµ·ï¼Œåœ¨ä½¿ç”¨æ—¶åªéœ€è¦å°†<code>Client</code>çš„å¼•ç”¨ä¼ å…¥å³å¯ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå®Œæ•´çš„ä»£ç å¯ä»¥å‚è€ƒè¿™é‡Œï¼Œ<a href="https://gist.github.com/jixiaoyong/8abd44901a2816e2b6722566bb8f08d8#file-dagger2_basic_guide_line_part1-kt" target="_blank" rel="noopener noreferrer">è‹¥æ— æ³•æ˜¾ç¤ºå¯ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹</a>ï¼š</p>
<!-- <script src="https://gist.github.com/jixiaoyong/8abd44901a2816e2b6722566bb8f08d8.js"></script> -->
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¯¹äºæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨<code>@Inject</code>æ ‡è®°å…¶æ„é€ æ–¹æ³•ï¼Œç„¶åå†åœ¨ä½¿ç”¨è¯¥ç±»çš„æ—¶å€™ä½¿ç”¨<code>@Inject</code>æ ‡è®°è¯¥å¯¹è±¡ï¼Œåœ¨éœ€è¦ä½¿ç”¨è¯¥å¯¹è±¡çš„åœ°æ–¹é€šè¿‡<code>@Component</code>ç±»ä¼ å…¥ä½¿ç”¨è¯¥ä¾èµ–çš„ç±»çš„å¼•ç”¨å³å¯ã€‚</p>

<p>ä½†æ˜¯å¾ˆæ˜¾ç„¶å®é™…å¼€å‘ä¸­ï¼Œä¸æ˜¯æ‰€æœ‰çš„<code>Service</code>ç±»éƒ½å¯ä»¥è¢«æˆ‘ä»¬éšæ„ä¿®æ”¹ï¼Œå¦‚æœ<code>Service</code>ç±»æ˜¯ç¬¬ä¸‰æ–¹æä¾›çš„ç±»ï¼Œæ˜¾ç„¶æˆ‘ä»¬æ˜¯æ— æ³•ç”¨<code>@Inject</code>ä¿®é¥°å…¶æ„é€ å‡½æ•°çš„ã€‚</p>
<h3> @Module å’Œ@Provides</h3>
<p>ä¸ºäº†è§£å†³ç¬¬ä¸‰æ–¹ä¾èµ–çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¦å¼•å…¥å¦å¤–ä¸¤ä¸ªä¸»è§’â€”â€”<strong><code>@Module</code><strong>å’Œ</strong><code>@Provides</code></strong>ã€‚</p>
<p><code>@Provides</code>ç”¨æ¥æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶å†…éƒ¨å®ä¾‹åŒ–å¹¶è¿”å›<code>Service</code>ç±»ï¼Œè¿™æ ·å­å½“ç”¨åˆ°<code>Service</code>çš„æ—¶å€™ï¼Œ<code>@Component</code>ç±»åªéœ€è¦æ‰¾åˆ°<code>@Provides</code>æä¾›çš„è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶è·å–åˆ°ä»–å®ä¾‹åŒ–å¥½çš„<code>Service</code>å¯¹è±¡æ³¨å…¥åˆ°<code>Client</code>ä¸­å°±å¯ä»¥äº†ã€‚</p>
<p><code>@Module</code>åˆ™æ˜¯æä¾›ä¸€ä¸ª<strong>ç±»</strong>ï¼ˆæ³¨æ„æ˜¯ç±»ï¼Œè€Œéæ¥å£ï¼‰ï¼Œåƒä¸€ä¸ªè¢‹å­ä¸€æ ·æŠŠ<code>@Provides</code>æä¾›çš„æ–¹æ³•â€œè£…â€åˆ°ä¸€èµ·ï¼Œæ‰“åŒ…æä¾›ç»™<code>@Component</code>ç±»ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­çš„<code>@Component(modules = [ClientModule::class])</code>å°†è£…æœ‰å¯ä»¥äº§ç”Ÿä¾èµ–çš„<code>@Provides</code>æ–¹æ³•çš„â€œå¤§è¢‹å­â€<code>@Module</code>å’Œâ€œæ¡¥æ¢â€<code>@Component</code>å…³è”åˆ°äº†ä¸€èµ·ã€‚</p>
<p><code>@Component</code>åœ¨äº§ç”Ÿä¾èµ–çš„æ—¶å€™ä¼šå…ˆåˆ°<code>@Module</code>ç±»ä¸­çš„<code>@Provides</code>æ–¹æ³•ä¸­æŸ¥æ‰¾ï¼›å¦‚æœæ‰¾ä¸åˆ°æ‰ä¼šå†åˆ°<code>@Inject</code>ä¸­æŸ¥æ‰¾ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶<code>Service</code>ç±»çš„<code>@Inject</code>æ„é€ æ–¹æ³•å…¶å®æ˜¯å¤±æ•ˆäº†çš„ï¼Œå®Œå…¨å¯ä»¥æ²¡æœ‰<code>@Inject</code>æ³¨è§£â€”â€”ç¬¬ä¸‰æ–¹ç±»å³æ˜¯å¦‚æ­¤ï¼‰ã€‚</p>
<p>ä¸Šè¿°å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œ<a href="https://gist.github.com/jixiaoyong/35714a6287617260d8578c1b716427cb" target="_blank" rel="noopener noreferrer">è‹¥æ— æ³•æ˜¾ç¤ºå¯ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹</a>ï¼š</p>
<!-- <script src="https://gist.github.com/jixiaoyong/35714a6287617260d8578c1b716427cb.js"></script> -->
<p>è§£å†³äº†ç¬¬ä¸‰æ–¹ä¾èµ–å¼•ç”¨çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜â€”â€”æˆ‘ä»¬ä½¿ç”¨çš„ç»å¤§å¤šæ•°ç±»è‚¯å®šä¸æ­¢ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå‡è®¾ä¾èµ–ç±»<code>Service</code>ç°åœ¨æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µåˆè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¾ˆæ˜æ˜¾ï¼Œè¿™æ—¶å€™<code>@Inject</code>æ³¨è§£å·²ç»æ²¡ç”¨äº†ï¼Œä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•è¢«<code>@Inject</code>ä¿®é¥°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š<code>é”™è¯¯: Types may only contain one @Inject constructor</code>ã€‚</p>
<p>å»æ‰<code>@Inject</code>å<code>Service</code>ç±»å˜æˆå¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å°è¯•åœ¨<code>@Module</code>ä¸­æ·»åŠ å¦å¤–ä¸€ä¸ª<code>@Provides</code>æ–¹æ³•ä½¿ç”¨å¦å¤–ä¸€ä¸ªå¸¦å‚æ„é€ å‡½æ•°ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œæ—¶å‘ç°ä¼šå‡ºé”™ï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥æä¾›<code>Service</code>ï¼Œ<code>@Component</code>äº§ç”Ÿäº†è¿·å¤±ï¼Œä¸çŸ¥é“ç”¨å“ªä¸€ä¸ªå¥½ï¼Œå¯¼è‡´é”™è¯¯ã€‚</p>
<h3> @Named å’Œ@Qualifier</h3>
<p>ä¸ºäº†è§£å†³å¤šä¸ªæ„é€ å‡½æ•°å¯¼è‡´çš„é—®é¢˜ï¼Œè¿™æ—¶å°±éœ€è¦ç¬¬äº”ä¸ªä¸»è§’**<code>@Named</code><strong>ä»¥åŠå¹•åè‹±é›„</strong><code>@Qualifier</code>**</p>
<p>é¦–å…ˆï¼Œä¸Šè¿°é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨å¦å¤–ä¸€ä¸ªæ–¹æ³•ä¸ŠåŠ ä¸€ä¸ªæ³¨è§£<code>@Named</code>ï¼Œè¡¨ç¤ºä»–æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“åœ¨<code>Client</code>ä¸­æƒ³ä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„ä¾èµ–æ—¶ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹<code>@Named</code>æºç ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‘ç°<code>@Qualifier</code>æ‰æ˜¯ä»–å®ç°æ ‡è¯†é™å®šç¬¦æ³¨è§£ï¼ˆIdentifies qualifier annotationsï¼‰çš„åŠ›é‡ä¹‹æºã€‚æŸ¥çœ‹<code>@Qualifier</code>æ³¨è§£å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰åŸºäº<code>@Qualifier</code>çš„æ³¨è§£æ¥å®ç°å’Œ<code>@Named</code>å®Œå…¨ä¸€è‡´çš„åŠŸèƒ½ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>@YourQualifierName</code>æ›¿ä»£<code>@Named</code>å®ç°æ ‡è¯†ä¸åŒæ³¨è§£çš„ä½œç”¨ï¼Œä»è€Œæ”¯æŒæœ‰å¤šä¸ªæ„é€ å‡½æ•°çš„<code>Service</code>ç±»çš„åˆå§‹åŒ–ã€‚</p>
<p>ä¸Šè¿°å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œ<a href="https://gist.github.com/jixiaoyong/fec4426183328346b955f62eb6e9c91a" target="_blank" rel="noopener noreferrer">è‹¥æ— æ³•æ˜¾ç¤ºå¯ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹</a>ï¼šï¼š</p>
<!-- <script src="https://gist.github.com/jixiaoyong/fec4426183328346b955f62eb6e9c91a.js"></script> -->
<p><code>@Component</code>å¯ä»¥æœ‰å¤šä¸ª<code>@Module</code>ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p>

<h3> @Singleton å’Œ@Scope</h3>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æœ‰çš„ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä»è€Œåœ¨ä¸åŒçš„åœ°æ–¹å…±äº«ä¸€äº›æ•°æ®â€”â€”å³å•ä¾‹ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦å¦å¤–ä¸€ä¸ªè§’è‰²<code>@Singleton</code>å’Œä»–çš„å¹•åè‹±é›„<code>@Scope</code>ã€‚</p>
<p>@Singleton æ˜¯ç”¨æ¥æ ‡è®°ç±»åœ¨å…¶èŒƒå›´å†…åªèƒ½è¢«å®ä¾‹åŒ–ä¸€æ¬¡ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡æŸ¥çœ‹å…¶æºç å¯ä»¥çŸ¥é“å…¶èƒŒåæ˜¯<code>@Scope</code>åœ¨èµ·ä½œç”¨ï¼Œ<code>@Scope</code>çš„ä½œç”¨æ˜¯é™å®šå…¶ä¿®é¥°çš„ç±»çš„èŒƒå›´ï¼Œé€‚ç”¨äºæœ‰å¯æ³¨å…¥çš„æ„é€ å‡½æ•°å¹¶ä¸”åŒ…å«æ§åˆ¶ç±»å‹å®ä¾‹å¦‚ä½•é‡ç”¨çš„ç±»ã€‚æ²¡æœ‰<code>@Scope</code>ä¿®é¥°çš„å®ä¾‹åœ¨æ„é€ å®Œæ¯•åå°±ä¼šå¤±å»æ§åˆ¶ï¼Œä¸å†å…³å¿ƒåç»­çš„å‘å±•ï¼ˆ<em>then forgets it</em>ï¼‰ï¼Œè€Œ<code>@Scope</code>ä¿®é¥°çš„ç±»ä¼šåœ¨å®ä¾‹æ„é€ å®Œæ¯•åï¼Œç»§ç»­ä¿ç•™ä¸€éä¸‹ä¸€æ¬¡å¯èƒ½çš„å¤ç”¨ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å®ä¾‹æ—¶ï¼Œä»–çš„å®ç°åº”è¯¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆ<em>itâ€˜s implementation should be thread safe</em>ï¼‰ã€‚</p>
<p>æ­¤å¤–<code>@Component</code>åº”è¯¥å’Œä»–æ‰€åŒ…å«çš„<code>@Module</code>çš„<code>@Provides</code>çš„<code>@Scope</code>èŒƒå›´ä¸€è‡´ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ä¸¤ä¸ªå…³ç³»ä¸º**<code>dependencies</code>**çš„<code>@Component</code>å¯ä»¥åˆ†åˆ«æ‹¥æœ‰ç›¸åŒåç§°çš„<code>@Inject</code>ã€<code>@Module</code>ã€<code>@Provides</code>è€Œä¸ä¼šè¢«<em>merge</em>ï¼Œä¸¤è€…å¯ä»¥ç›¸äº’è®¿é—®ã€‚</p>
<p>è€Œ**<code>subcomponents</code>**åˆ™ä¸èƒ½å’Œ<code>@Component</code>æœ‰ä»¥ä¸Šç›¸åŒçš„é¡¹ã€‚</p>
<blockquote>
<p><code>Subcomponent</code>ä»å®ƒçš„çˆ¶ç±»è®¿é—®æ‰€æœ‰ä¾èµ–</p>
<p><code>@Component</code>åªèƒ½è®¿é—®åœ¨åŸºç±»<code>@Component</code>æ¥å£æš´éœ²çš„å…¬å…±æ€§çš„ä¾èµ–</p>
<p>â€”â€”<a href="https://sinyuk.me/2016/04/11/Subcomponents%E5%92%8CComponent-Dependencies/" target="_blank" rel="noopener noreferrer">Subcomponents å’Œ Component Dependenciesâ€”â€”Sinyuk Blog</a></p>
</blockquote>
<p>ä»–ä»¬ä¹‹é—´çš„å…³ç³»å¯ä»¥è¡¨ç¤ºä¸ºä¸‹å›¾ï¼š</p>

<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://github.com/android-cn/blog/tree/master/java/dependency-injection" target="_blank" rel="noopener noreferrer">android-cnï¼šä¾èµ–æ³¨å…¥â€”â€” Github</a></p>
<p><a href="https://en.wikipedia.org/wiki/Dependency_injection" target="_blank" rel="noopener noreferrer">Dependency Injection â€”â€”wikipedia</a></p>
<p><a href="https://medium.com/@elye.project" target="_blank" rel="noopener noreferrer">Elye çš„ Dagger 2 ç³»åˆ—</a></p>
<p><a href="https://google.github.io/dagger/users-guide" target="_blank" rel="noopener noreferrer">Dagger 2 å®˜æ–¹æ‰‹å†Œ</a></p>
<p><a href="https://www.jianshu.com/p/2cd491f0da01" target="_blank" rel="noopener noreferrer">Android - Dagger2 ä½¿ç”¨è¯¦è§£â€”â€”ç®€ä¹¦</a></p>
<p><a href="https://sinyuk.me/2016/04/11/Subcomponents%E5%92%8CComponent-Dependencies/" target="_blank" rel="noopener noreferrer">Subcomponents å’Œ Component Dependenciesâ€”â€”Sinyuk Blog</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Dagger 2 â¤ï¸ Android</title>
      <link>https://jixiaoyong.github.io/blog/posts/c04fdc6c.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/c04fdc6c.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Dagger 2 â¤ï¸ Android</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 27 Jan 2019 13:23:50 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p><a href="http://jixiaoyong.github.io/blog/posts/2822c354/" target="_blank" rel="noopener noreferrer">ä¸Šç¯‡æ–‡ç« </a>ä»‹ç»äº†<code>Dagger 2</code> çš„åŸºæœ¬ä½¿ç”¨ï¼Œæœ¬æ–‡è·Ÿéš<a href="https://google.github.io/dagger/android" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>å®è·µä¸€ä¸‹<code>Dagger 2 </code>åœ¨<code>Android</code>ä¸­çš„ä½¿ç”¨ï¼Œå¯ä»¥çœ‹åšæ˜¯å®˜æ–¹æ–‡æ¡£çš„ä¸å®Œå…¨ç¿»è¯‘ã€‚</p>
<p>æœ¬æ–‡æœ‰å…³<code>Dagger 2</code>çš„ä½¿ç”¨åˆ†ä¸º<code>Activity</code>å’Œ<code>Fragment</code>ä¸¤éƒ¨åˆ†ï¼ŒäºŒè€…çš„ä½¿ç”¨å‡ ä¹æ²¡æœ‰å·®åˆ«ï¼Œæœ€åä»‹ç»ä¸€ä¸‹åœ¨ Google å®˜æ–¹ Demo ä¸­å­¦åˆ°çš„ä¸€ä¸ªå°æŠ€å·§ï¼Œå¯ä»¥å°†å‡ ä¹æ‰€æœ‰çš„å’Œ<code>Dagger 2</code>çš„é€»è¾‘æ”¾åˆ°ä¸€ä»½ä»£ç é‡Œé¢ï¼Œå¯¹<code>Android</code>å·¥ç¨‹çš„å½±å“æå°ã€‚</p>
<p>é¦–å…ˆè¦æ·»åŠ ç›¸å…³ä¾èµ–ï¼ˆKotlin ç¯å¢ƒï¼‰ï¼š</p>
<div class="language-gradle line-numbers-mode" data-ext="gradle"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> åœ¨ Activity ä¸­çš„ä½¿ç”¨</h2>
<h3> Application èŒƒå›´å†…çš„@Component</h3>
<p>é¦–å…ˆåˆ›å»ºæ•´ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨çš„<code>@Component</code>ï¼Œå¹¶å°†<code>AndroidInjectionModule</code>åŠ å…¥å…¶ä¸­ï¼Œå®ç°<code>Inject</code>æ³¨å…¥å…¥å£ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>AppComponent</code>çš„èŒƒå›´æ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰æ•ˆã€‚</p>
<h3> åˆ›å»ºå•ä¸ª Activity çš„@Subcomponent</h3>
<p>åˆ›å»ºæŸä¸ª<code>Activity</code>ä¸“å±çš„<code>@Subcomponent</code>ï¼Œç”¨äºæä¾›<code>AndroidInjector.Builder</code>ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> åˆ›å»ºå•ä¸ª Activity çš„@Module</h3>
<p>åˆ›å»ºå±äºæ•´ä¸ª<code>Activity</code>çš„<code>@Module</code>ï¼Œæ³¨æ„è¿™é‡Œè¦æŒ‡æ˜<code>@subcomponents</code>ä¸ºåˆšåˆšåˆ›å»ºçš„<code>MainActivitySubComponent</code>ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°åœ¨<code>MainActivityModule</code>ä¸­æä¾›äº†ä¸€ä¸ªæ–¹æ³•åˆ©ç”¨åˆšåˆš<code>MainActivitySubComponent</code>ä¸­æä¾›çš„<code>MainActivitySubComponent.Builder</code>å®ä¾‹ç”Ÿæˆäº†ä¸€ä¸ª<code>AndroidInjector.Factory</code>ï¼Œè€Œè¿™ä¸ª<code>Factory</code>å°±æ˜¯æˆ‘ä»¬åé¢è¦å°†<code>MainActivityModule</code>ä¸­çš„ä¾èµ–å®ä¾‹é€šè¿‡<code>AppComponent</code>ä¼ é€’ç»™<code>MainActivity</code>å®ä¾‹çš„å…³é”®ã€‚</p>
<blockquote>
<p>æ­¤å¤–è¿˜å¯ä»¥çœ‹åˆ°æä¾›è¯¥ Factory çš„æ–¹æ³•æ˜¯æ”¾åˆ°äº†å¦å¤–ä¸€ä¸ªæŠ½è±¡ç±»é‡Œé¢ç„¶åå†å¯¼å…¥ MainActivityModule ä¸­çš„ï¼Œè¿™æ˜¯å› ä¸ºè¯¥æ–¹æ³•çš„æ³¨è§£@Binds è¦æ±‚æ–¹æ³•æ˜¯æŠ½è±¡çš„ï¼Œè€Œ MainActivityModule è¦æ˜¯éœ€è¦ç»™ Activity æä¾›ä¾èµ–å®ä¾‹æ‰€å¿…é¡»çš„@Provides åˆè¦æ±‚ç±»ä¸èƒ½æ˜¯æŠ½è±¡çš„ï¼Œå¦åˆ™å°±è¦æ±‚è¯¥æ–¹æ³•æ˜¯é™æ€çš„ã€‚æƒè¡¡ä¹‹ä¸‹æˆ‘è§‰å¾—è¿™ç§æ–¹å¼æ˜¯æ¯”è¾ƒèƒ½æ¥å—çš„ï¼Œå½“ç„¶ä¹Ÿä¸æ’é™¤æœ‰å…¶ä»–æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œæ¬¢è¿æ<a href="https://github.com/jixiaoyong/jixiaoyong.github.io/issues" target="_blank" rel="noopener noreferrer">Issue</a>å‘ŠçŸ¥ã€‚</p>
</blockquote>
<p>ç„¶åï¼Œå°†<code>MainActivityModule</code>åŠ å…¥åˆ°åº”ç”¨ç¨‹åºçš„<code>@Component</code>â€”â€”<code>AppComponent</code>ä¸­ã€‚</p>
<h3> ä½¿ Application ç»§æ‰¿è‡ª <a href="https://google.github.io/dagger/api/latest/dagger/android/HasActivityInjector.html" target="_blank" rel="noopener noreferrer"><code>HasActivityInjector</code></a></h3>
<p>ä½¿å½“å‰<code>MainApplication</code>ç»§æ‰¿è‡ª<code>HasActivityInjector</code>ï¼Œè¯¥æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç±»æ˜¯ç”¨æ¥ä¸ºç›¸åº”çš„<code>Activity</code>æä¾›ä¸€ä¸ª<code>AndroidInjector</code>ã€‚ç”±äºæˆ‘ä»¬å·²ç»åœ¨<code>AppComponent</code>ä¸­åŒ…æ‹¬äº†<code>AndroidInjectionModule</code>ï¼Œæ‰€ä»¥<code>Dagger 2</code>å·²ç»å¯ä»¥è‡ªåŠ¨ä¸ºæˆ‘ä»¬æ³¨å…¥<code>DispatchingAndroidInjector</code>ä¾èµ–ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>onCreate()</code>æ–¹æ³•ä¸­ä¼ å…¥å½“å‰<code>Application</code>çš„ä¾èµ–ã€‚</p>
<h3> åœ¨ Activity ä¸­ä½¿ç”¨è‡ªåŠ¨æ³¨å…¥ä¾èµ–</h3>
<p>åšå®Œäº†ä»¥ä¸Šæ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<code>Activity</code>ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç å°±å¯ä»¥å®ç°è‡ªåŠ¨æ³¨å…¥ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šæ‰€æœ‰ä»£ç å¦‚ä¸‹ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥<a href="https://gist.github.com/jixiaoyong/db7e5f18b7106ce9cb36b61bf7134340" target="_blank" rel="noopener noreferrer">åœ¨è¿™é‡Œæ‰¾åˆ°</a>ï¼š</p>
<!-- <script src="https://gist.github.com/jixiaoyong/db7e5f18b7106ce9cb36b61bf7134340.js"></script> -->
<h3> è¿™ä¸€åˆ‡æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</h3>
<p>åœ¨<code>Android</code>ç¨‹åºè¿è¡Œæ—¶ï¼Œ<code>AndroidInjection.inject()</code>ä»<code>Application</code>ä¸­çš„<code>activityInjector()</code>æ–¹æ³•è·å–åˆ° <code>DispatchingAndroidInjector&lt;Activity&gt;</code> ï¼Œç„¶åå°†<code>Activity</code>ä¼ å…¥<code>inject(Activity)</code>ã€‚</p>
<p><code>DispatchingAndroidInjector</code> é€šè¿‡<code>AppComponent</code>æ‰¾åˆ°æˆ‘ä»¬åœ¨<code>MainActivityModule</code>æä¾›çš„å¯¹åº”çš„<code>AndroidInjector.Factory</code>ï¼Œç„¶ååˆ›å»ºäº† <code>AndroidInjector</code> â€”â€”è¿™å°±æ˜¯æˆ‘ä»¬å½“å‰<code>Activity</code>å¯¹åº”çš„<code>MainActivitySubComponent</code>ã€‚</p>
<p>æ¥ä¸‹æ¥ä¾¿æŒ‰ç…§ä¹‹å‰çš„é€»è¾‘ï¼Œä»<code>MainActivitySubComponent</code>ä¸­æŸ¥æ‰¾æä¾›<code>waitForInjectClass</code>çš„å®ä¾‹æ–¹æ³•å®Œæˆæ³¨å…¥ã€‚</p>
<h2> åœ¨ Fragment ä¸­çš„ä½¿ç”¨</h2>
<p><code>Dagger 2</code>åœ¨<code>Fragment</code>çš„ä½¿ç”¨å’Œåœ¨<code>Activity</code>ä¸­çš„ä½¿ç”¨ååˆ†ç›¸ä¼¼ã€‚</p>
<p>é€šè¿‡ä¹‹å‰çš„ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå…¶åŸºæœ¬çš„åŸç†ä¾æ—§æ˜¯åˆ©ç”¨<code>@Component</code>å’Œ<code>@subcomponent</code>ï¼Œ<code>@Module</code>ä¹‹é—´çš„å…³è”å…³ç³»å°†<code>Application</code>å’Œ<code>Activity</code>ç­‰çš„ä¾èµ–æ³¨å…¥é€šè¿‡<code>AndroidInjector</code>å…³è”èµ·æ¥çš„ï¼š</p>
<p><code>MainActivitySubComponent</code>é€šè¿‡å°†<code>MainActivityModule</code>åŠ å…¥åˆ°<code>AppComponent</code>ä¹‹ä¸­ï¼Œç„¶åå½“<code>MainActivity</code>ä¹‹ä¸­éœ€è¦ä½¿ç”¨åˆ°<code>MainActivitySubComponent</code>æ—¶ï¼Œåˆé€šè¿‡<code>AndroidInjector</code>ä»<code>AppComponent</code>ä¸­æ‹¿åˆ°<code>MainActivityModule</code>ä¸­çš„<code>AndroidInjector.Factory</code>ï¼Œé€šè¿‡è¯¥<code>Factory</code>å’Œ<code>MainActivitySubComponent</code>ä¸­çš„<code>Builder</code>äº§ç”Ÿå…³è”ï¼Œä»è€Œè·å–åˆ°äº†<code>MainActivitySubComponent</code>çš„å®ä¾‹ä¾›<code>Activity</code>ä½¿ç”¨ã€‚</p>
<p>åœ¨<code>Fragment</code>ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·å¤„ç†ï¼Œåªä¸è¿‡ç”±äº<code>Fragment</code>çš„ç‰¹æ€§ï¼Œä»–çš„<code>@Module</code>ä¸ä»…å¯ä»¥äº¤ç»™<code>Application</code>çš„<code>@Component</code>ï¼Œä¹Ÿå¯ä»¥äº¤ç»™å…¶ä»–<code>Fragment</code>æˆ–è€…<code>Activity</code>çš„<code>@Component</code>ï¼Œè®©å…¶å®ç°<code>HasFragmentInjector</code>å³å¯ï¼Œè¿™å–å†³äºæˆ‘ä»¬æƒ³è¦ç»™<code>Fragment</code>ç»‘å®šçš„ä¾èµ–ã€‚</p>
<p>å…·ä½“çš„å®ç°ä¸€èˆ¬åˆ†ä¸ºä¸‹é¢å‡ æ­¥ï¼š</p>
<ul>
<li>
<p>åˆ›å»º<code>Application</code>çš„<code>@Component</code>å¹¶æ·»åŠ <code>AndroidInjectionModule</code></p>
</li>
<li>
<p>åˆ›å»ºå®ç°äº†<code>AndroidInjector&lt;MainFragment&gt;</code>çš„<code>MainFragmentSubComponent</code>ï¼Œå…¶å†…éƒ¨æœ‰æ–¹æ³•æä¾›<code>AndroidInjector.Builder&lt;MainFragment&gt;</code></p>
</li>
<li>
<p>åˆ›å»ºåŒ…å«äº†æä¾›<code>AndroidInjector.Factory&lt;*&gt;</code>çš„æŠ½è±¡æ–¹æ³•çš„<code>MainFragmentModule</code>ï¼ŒæŒ‡å®šå…¶<code>subcomponents</code>ä¸º<code>MainFragmentSubComponent</code>ï¼›</p>
</li>
<li>
<p>å°†<code>MainFragmentSubComponent</code>åŠ å…¥åˆ°æƒ³è¦åŠ å…¥çš„ç±»çš„<code>@Component</code>ä¸­ï¼Œæ¯”å¦‚<code>AppComponent</code>ç±»</p>
</li>
<li>
<p>åœ¨<code>Application</code>ï¼ˆå¦‚æœä¸Šä¸€æ­¥æ˜¯<code>Activity</code>ï¼Œåˆ™æœ¬æ­¥ä¹Ÿæ˜¯<code>Activity</code>ç­‰ï¼‰ä¸­å‚ç…§åœ¨<code>Activity</code>å®ç°çš„æ­¥éª¤å®ç°<code>HasFragmentInjector</code></p>
<p>ä¸Šè¿°å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥<a href="https://gist.github.com/jixiaoyong/a24e76ca29f4c8062bf5c6a98529d252" target="_blank" rel="noopener noreferrer">åœ¨è¿™é‡Œæ‰¾åˆ°</a>ï¼š</p>
<!-- <script src="https://gist.github.com/jixiaoyong/a24e76ca29f4c8062bf5c6a98529d252.js"></script> -->
</li>
</ul>
<p>å…³äº<code>Fragment</code>åŠ å…¥åˆ°<code>Activity</code>çš„ Demo åœ¨å®˜æ–¹æ–‡æ¡£æœ‰ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œå…¶å®åªè¦æŒæ¡åŸç†ï¼Œå…¶ä»–ç”¨æ³•çš„å®Œå…¨å¯ä»¥è§¦ç±»æ—é€šã€‚</p>
<h2> ä¸€ä¸ªå°æŠ€å·§</h2>
<p>é€šè¿‡è§‚å¯Ÿä¸Šé¢çš„ä¸¤ä»½ä»£ç ï¼Œæˆ‘ä»¬å‘ç°è™½ç„¶è¿™<code>Dagger 2</code>å·²ç»æ›¿æˆ‘ä»¬åšäº†å¥½å¤šäº‹æƒ…ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨éœ€è¦ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„ç±»ä¸­ä½¿ç”¨è¯¸å¦‚<code>AndroidInjection.inject(this)</code>è¿™æ ·çš„ä»£ç å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœ<code>Activity</code>ã€<code>Fragment</code>ç±»è¿‡å¤šçš„æ—¶å€™ï¼Œè¿™æ ·çš„é‡å¤æ€§å·¥ä½œä»ç„¶æ˜¯ä¸ªä¸å°çš„å·¥ä½œé‡ï¼Œä¸‡ä¸€æœ‰æŸå¤„é—å¿˜äº†ä¾¿ä¼šå¯¼è‡´å‡ºé”™ã€‚</p>
<p>è¿™æ—¶å°±å¯ä»¥ç”¨åˆ°æˆ‘åœ¨<a href="https://github.com/googlesamples/android-architecture-components/tree/master/GithubBrowserSample" target="_blank" rel="noopener noreferrer">Google å®˜æ–¹ç¤ºä¾‹ä»£ç </a>ä¸­å­¦åˆ°çš„ä¸€ä¸ªå°æŠ€å·§äº† (é’ˆå¯¹æœ¬æ–‡ä¸­çš„ä¾‹å­åšäº†ä¸€äº›ä¿®æ”¹)ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥<a href="https://gist.github.com/jixiaoyong/9260c3ae2a70555e14f40c4b95364715" target="_blank" rel="noopener noreferrer">åˆ°è¿™é‡ŒæŸ¥çœ‹æºç </a>ï¼š</p>
<!-- <script src="https://gist.github.com/jixiaoyong/9260c3ae2a70555e14f40c4b95364715.js"></script> -->
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://google.github.io/dagger/android" target="_blank" rel="noopener noreferrer">Dagger 2 å®˜æ–¹æ–‡æ¡£ Android ç¯‡</a></p>
<p><a href="https://github.com/googlesamples/android-architecture-components/tree/master/GithubBrowserSample" target="_blank" rel="noopener noreferrer">Google å®˜æ–¹ç¤ºä¾‹ä»£ç â€”â€”GithubBrowserSample</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Dart event loop</title>
      <link>https://jixiaoyong.github.io/blog/posts/db62c118.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/db62c118.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Dart event loop</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 11 Jun 2022 10:25:29 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡åŸºäº Dart 2.17</p>
</blockquote>
<br>
<p>Dart App ä¸­æ‰€æœ‰çš„ä»£ç éƒ½åœ¨ä¸€ä¸ª isolate ä¸­è¿è¡Œï¼ˆå„ä¸ª isolate ä¹‹é—´çš„ä»£ç è¿è¡Œæ—¶æ˜¯éš”ç¦»çš„ï¼‰ï¼Œä¸€ä¸ª isolate æœ‰è‡ªå·±çš„ heapï¼Œç»´æŒæœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ— event_loopï¼Œå¤„ç†ä¸¤ç§æ¶ˆæ¯ï¼š</p>
<ol>
<li><code>event queue</code> æ‰§è¡Œç”¨æˆ·ç‚¹å‡»ã€å±å¹•åˆ·æ–°ã€ç»˜åˆ¶ï¼Œä¸€èˆ¬çš„ Futureã€IOã€Stream æµç­‰ï¼Œæ¯æ¬¡æ‰§è¡Œå®Œæ¯•éƒ½ä¼šå…ˆæ£€æŸ¥æ‰§è¡Œ micro task queue ä¸­çš„ä»»åŠ¡ï¼Œç›´åˆ°å…¶ä¸ºç©ºå†æ‰§è¡Œä¸‹ä¸€ä¸ª event queue</li>
<li><code>microTask queue</code> ä¼˜å…ˆæ‰§è¡Œï¼Œä¸€èˆ¬æ‰§è¡Œè·‘å®Œå³å¼ƒçš„å°ä»»åŠ¡ï¼Œå¦‚ Dart å†…éƒ¨çš„å¾®ä»»åŠ¡</li>
</ol>
<p>ä¸Šè¿°ä¸¤ç§ event ä¼šåœ¨æ™®é€šçš„ Dart åŒæ­¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œï¼Œæ— è®ºæ˜¯ microTask è¿˜æ˜¯æ™®é€šçš„ eventï¼Œä»–ä»¬éƒ½æ˜¯<strong>concurrency å¹¶è¡Œ</strong>æ‰§è¡Œï¼ˆä¹Ÿå°±æ˜¯è¯´å®é™…ä¸Šè¿˜æ˜¯<strong>ä¸Šä¸€ä¸ªæ‰§è¡Œå®Œæ¯•ï¼Œå†æ‰§è¡Œå¦å¤–ä¸€ä¸ª</strong>ï¼‰ï¼Œæ‰€ä»¥å¦‚æœè¿™äº› event ä¸­å­˜åœ¨è€—æ—¶é•¿çš„æ–¹æ³•ï¼Œ<strong>ä¾æ—§ä¼šé˜»å¡å…¶ä»–æ–¹æ³•çš„æ‰§è¡Œ</strong>ï¼Œå¯èƒ½å¯¼è‡´ UI å¡é¡¿ç­‰æƒ…å†µã€‚</p>
<br>
<p>åœ¨ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå„ç§äº‹ä»¶ï¼ˆå¦‚ç”¨æˆ·ç‚¹å‡»ã€å±å¹•åˆ·æ–°ã€futureã€microtask ç­‰ï¼‰éƒ½ä¼šè¢«å½“åšä¸€ä¸ªä¸ª event æ”¾å…¥åˆ° event queue ä¸­ï¼Œç„¶åä¸åœçš„ä» event loop å–å‡ºäº‹ä»¶å¹¶æ‰§è¡Œï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/dart/event_loop/dart_event_loop.png" alt="dart_event_loop" tabindex="0" loading="lazy"><figcaption>dart_event_loop</figcaption></figure>
<p>ä»–ä»¬çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/dart/event_loop/dart_event_loop_sequeue.png" alt="dart_event_loop_sequeue" tabindex="0" loading="lazy"><figcaption>dart_event_loop_sequeue</figcaption></figure>
<p>å¯ä»¥ä»ä¸‹è¿°ä¾‹å­è¯¦ç»†çœ‹ä¸€ä¸‹ä»£ç æ‰§è¡Œçš„æ—¶å€™å„ä¸ªæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/dart/event_loop/dart_test_queue_code.png" alt="dart_test_queue_code" tabindex="0" loading="lazy"><figcaption>dart_test_queue_code</figcaption></figure>
<figure><img src="https://jixiaoyong.github.io/images/dart/event_loop/dart_test_queue_output.png" alt="dart_test_queue_output" tabindex="0" loading="lazy"><figcaption>dart_test_queue_output</figcaption></figure>
<br>
<p>æœ¬æ–‡æ ¹æ® Dart SDK æºç åˆ†æä¸€ä¸‹ event loop çš„å®ç°ã€‚</p>
<p>ä»£ç å‚è€ƒï¼š<a href="https://gist.github.com/jixiaoyong/ac811902db42a51cf97e3290788ade4a" target="_blank" rel="noopener noreferrer">https://gist.github.com/jixiaoyong/ac811902db42a51cf97e3290788ade4a</a></p>
<h2> 1. åŒæ­¥æ–¹æ³•</h2>
<p>åŒæ­¥æ–¹æ³•åŒ…æ‹¬æ™®é€šçš„æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸‹å‡ ç§ä¼šæŒ‰ç…§åŒæ­¥æ–¹æ³•ç«‹å³æ‰§è¡Œçš„æ–¹å¼ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> 2. micro task</h2>
<p>microtask ä¼šåœ¨åŒæ­¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åç«‹å³è¢«æ‰§è¡Œï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡Œâ€œå³æŠ›å‹â€çš„æ–¹æ³•ï¼Œä¸åº”å½“æ‰§è¡Œè€—æ—¶æ–¹æ³•ã€‚microtask åˆ—è¡¨ä¼šä¸€ç›´æ‰§è¡Œï¼Œç›´åˆ° event loop ä¸­æ²¡æœ‰ micro task äº†ï¼Œæ‰ä¼šå»æ‰§è¡Œ Future ç­‰æ™®é€šçš„ eventã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p><code>Future.value([FutureOr&lt;T&gt;? value])</code> æ¯”è¾ƒç‰¹æ®Šï¼Œå¦‚æœ<code>value</code> æ˜¯ futureï¼Œé‚£ä¹ˆä»–ä¼šåœ¨ value æ‰§è¡Œå®Œæ¯•åè¿”å›ä»–çš„å€¼ï¼Œå¦‚æœ<code>value</code>ä¸æ˜¯ futureï¼Œä»–å°±ä¼šç«‹å³æ‰§è¡Œå±äº microtask</p>
</blockquote>
<h3> ä»£ç åˆ†æ</h3>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šè¿°æ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹å‡ºï¼Œ<code>Future.microtask</code>æœ¬è´¨è¿˜æ˜¯è°ƒç”¨<code>scheduleMicrotask</code>å®ç°çš„ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Zone.scheduleMicrotask()</code>æœ€åè°ƒç”¨çš„æ˜¯<code>_RootZone</code>çš„åŒåæ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> _RootZone._scheduleAsyncCallback</h4>
<p>è¿™é‡Œè°ƒç”¨äº†<code>_RootZone._scheduleAsyncCallback</code>æ–¹æ³•ï¼Œå°†ä¼ å…¥çš„ callback å½“åš microtask æ‰§è¡Œã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> _RootZone._startMicrotaskLoop</h4>
<p>è¿™é‡Œé¢çš„<code>_startMicrotaskLoop</code>æ–¹æ³•æ˜¯å®é™…ä¸Šå¤„ç† microtask çš„åœ°æ–¹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œ<code>_AsyncRun._scheduleImmediate</code>æ–¹æ³•åˆ™æ˜¯è§¦å‘å¤„ç† microtask çš„æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> _AsyncRun._scheduleImmediate</h4>
<p><code>_AsyncRun._scheduleImmediate</code>æ–¹æ³•çš„å®ç°åœ¨<code>schedule_microtask_patch.dart</code>ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> _ScheduleImmediateClosure</h4>
<p>å¯ä»¥çœ‹åˆ°ï¼Œmicrotask å®é™…ä¸Šæ˜¯ä½¿ç”¨<code>_ScheduleImmediateClosure</code>è°ƒç”¨çš„ï¼Œå…³äºä»–ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ol>
<li><code>_setScheduleImmediateClosure</code></li>
<li><code>_ensureScheduleImmediate</code></li>
</ol>
<p>è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ç¬¬ä¸€ä¸ªæ–¹æ³•<code>_setScheduleImmediateClosure</code>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä¸»è¦è°ƒç”¨äº† Dart ä¸­çš„<code>_getIsolateScheduleImmediateClosure</code>æ–¹æ³•åˆ›å»ºäº†<code>schedule_immediate_closure</code>ï¼Œç„¶åé€šè¿‡<code>_setScheduleImmediateClosure</code>è¿”å›ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå°†ä¼ é€’è¿›æ¥çš„<code>callback</code>èµ‹å€¼ç»™<code>_pendingImmediateCallback</code>ã€‚</p>
<p>è€Œç»“åˆä¸Šé¢çš„ä»£ç ï¼Œ<code>_ensureScheduleImmediate</code> æ–¹æ³•ä¸»è¦ä¹Ÿæ˜¯ç”¨æ¥è§¦å‘<code>_ScheduleImmediateClosure</code>æ‰§è¡Œå›è°ƒäº‹ä»¶ã€‚</p>
<br>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬èƒ½ç¡®å®šçš„æ˜¯ï¼š</p>
<ul>
<li>åœ¨ Dart VM å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ª<code>_ScheduleImmediateClosure</code>å¹¶ä¿å­˜åœ¨<code>_pendingImmediateCallback</code>;</li>
<li>å½“æœ‰æ–°çš„ microtask åŠ å…¥çš„æ—¶å€™ï¼Œä¼šè§¦å‘<code>_startMicrotaskLoop</code>æ–¹æ³•åœ¨<code>_microtaskLoop()</code>ä¸­å®é™…å¤„ç†ä¸€ä¸ª microtaskï¼ˆè¿™é‡Œçš„<code>_startMicrotaskLoop</code>è§¦å‘çš„å®é™…æ˜¯é€šè¿‡<code>_AsyncRun._scheduleImmediate(_startMicrotaskLoop)</code>å°†å…¶ä½¿ç”¨<code>_pendingImmediateCallback</code> åŒ…è£¹ä¹‹åæ‰§è¡Œçš„ï¼‰ã€‚</li>
</ul>
<h4> _pendingImmediateCallback</h4>
<p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸ª<code>_pendingImmediateCallback</code> ä»€ä¹ˆæ—¶å€™ä¼šè¢«å®‰æ’æ‰§è¡Œå‘¢ï¼Ÿ</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„è¿™é‡Œçš„å…³é”®ä»£ç ï¼Œåœ¨<code>_handleMessage</code>æ–¹æ³•ä¸­ï¼Œä¼šå…ˆæ‰§è¡Œ<code>RawReceivePort</code>åŸæœ¬çš„ handler å†…å®¹ï¼Œç„¶åï¼Œæ‰§è¡Œ<code>_runPendingImmediateCallback()</code>ã€‚</p>
<p>åœ¨<code>_runPendingImmediateCallback</code>åˆ™ä¼šæ‰§è¡Œ<code>_pendingImmediateCallback</code>çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯å‰é¢çš„<code>_startMicrotaskLoop</code>ï¼Œå¤„ç† event loop ä¸­çš„ micro taskã€‚</p>
<br>
<p>è¿™ä¹Ÿå°±è¯æ˜äº†æˆ‘ä»¬ä¹‹å‰è¯´çš„â€œ<strong>microtask ä¼šåœ¨åŒæ­¥æ–¹æ³•ä¹‹åç«‹å³æ‰§è¡Œï¼Œå¹¶åœ¨æ¯æ¬¡æ™®é€šçš„ event loop æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œéƒ½ä¼šæ£€æŸ¥å¹¶æ‰§è¡Œ event loop ä¸­çš„ microtaskï¼Œä¹‹åæ‰ç»§ç»­æ‰§è¡Œæ™®é€š event</strong>â€ã€‚</p>
<p>åœ¨ä¸‹é¢çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè¿˜å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ event æ¯æ¬¡å¤„ç† Timer äº‹ä»¶ä¹‹åï¼Œéƒ½ä¼šæ£€æŸ¥æ‰§è¡Œ micro taskã€‚</p>
<h2> 3. event</h2>
<blockquote>
<p>é™¤äº†ä¸‹é¢åˆ—å‡ºæ¥çš„ä½¿ç”¨ Future æˆ–è€… Timer ç­‰åˆ›å»ºçš„æ–¹æ³•å¤–ï¼Œå±å¹•ç‚¹å‡»ã€åˆ·æ–°ç­‰äº‹ä»¶ä¹Ÿåœ¨æ­¤ç±» event ä¸­ã€‚</p>
</blockquote>
<p>å½“å‰ event loop ä¸­æ²¡æœ‰ micro task ä¹‹åï¼Œå°±ä¼šæ‰§è¡Œä¸€æ¬¡æ­¤ç±»æ™®é€š eventï¼Œç„¶åå†æ£€æŸ¥ä¸€æ¬¡ event loopï¼Œå¦‚æœæœ‰ micro task å°±æ‰§è¡Œ micro task ç›´åˆ°æ¸…ç©º micro taskï¼Œå¦åˆ™ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ™®é€š eventï¼Œç›´åˆ° event loop åˆ—è¡¨ä¸ºç©ºï¼Œé€€å‡º appã€‚</p>
<p>å…ˆçœ‹å‡ ç§ä¼šè§¦å‘æ­¤ç±»äº‹ä»¶çš„æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥åŠ Timer</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ä»£ç åˆ†æ</h3>
<p>æˆ‘ä»¬ä¾æ¬¡çœ‹ä¸€ä¸‹ä¸Šè¿°å‡ ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†<code>Future.wait</code>å’Œ<code>Future.any</code> <strong>è¿™ä¸¤ä¸ªå¤„ç† Future é›†åˆçš„æ–¹æ³•å¤–ï¼Œ<code>Future.delayed</code> è¿™ä¸ªæ–¹æ³•å†…éƒ¨æ˜¯å®é™…ä¸Šæ˜¯</strong>é€šè¿‡ Timer å®ç°**çš„ã€‚</p>
<h4> Future.then</h4>
<p>åœ¨çœ‹ Timer å®ç°ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹<code>Futrue.then</code>çš„å®ç°ï¼Œä»–å¯¹åº”çš„å®ç°æ˜¯<code>_Future.then</code>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>_Futrue.then</code>åªæ˜¯å¯¹ä¼ å…¥çš„å›è°ƒçš„è¿›è¡Œäº†åŒ…è£…ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡<code>_Future._addListener()</code>å®ç°å…·ä½“çš„é€»è¾‘ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>_Future._addListener(_FutureListener listener)</code>ä¸­åŸºæœ¬ä¸Šåšäº†å¦‚ä¸‹åˆ¤æ–­ï¼š</p>
<ul>
<li>å¦‚æœ Future æ˜¯å»¶è¿Ÿå®Œæˆçš„ï¼Œå°±æ·»åŠ ç›‘å¬ã€‚</li>
<li>å¦‚æœ Future å·²ç»å®Œæˆäº†ï¼Œå°±åŠ å…¥åˆ° micro task ä¸­ï¼Œå®‰æ’æ‰§è¡Œ listener å›è°ƒï¼ˆ<code>_propagateToListeners(this, listener)</code>ï¼‰ã€‚</li>
</ul>
<p>å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://juejin.cn/post/6844904196819402759" target="_blank" rel="noopener noreferrer">Flutter ä¹‹ Future åŸç†è§£æ</a>ã€‚</p>
<br>
<h3> Timer</h3>
<p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ Timer çš„å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> åˆ›å»º Timer</h4>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒTimer çš„åˆ›å»ºå®é™…ä¸Šæ˜¯ Zone é€šè¿‡ä¸¤ç§æ–¹å¼åˆ›å»ºçš„ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zone æ˜¯æŠ½è±¡ç±»ï¼Œä»–çš„å®ç°æ˜¯<code>_RootZone</code>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº† Timer ä¸­å¯¹åº”çš„ç§æœ‰æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»–ä»¬çš„å…·ä½“å®ç°åœ¨<code>timer_patch.dart</code>ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯å•æ¬¡çš„è¿˜æ˜¯å¾ªç¯çš„ Timer éƒ½æ˜¯ä½¿ç”¨<code>VMLibraryHooks.timerFactory</code>åˆ›å»ºçš„ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨çš„<code>_Timer._createTimer</code>æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨åˆ›å»º timer çš„æ—¶å€™ï¼Œå…ˆè·å–äº†å½“å‰çš„æ—¶é—´æˆ³ï¼Œç„¶åè®¡ç®—å‡º timer çš„å”¤é†’æ—¶é—´<code>wakeupTime</code> ï¼Œæœ€åè°ƒç”¨<code>_Timer._internal</code>åˆ›å»º timerã€‚</p>
<p><code>_Timer._internal</code>åªæ˜¯ç®€å•åˆ›å»ºäº† Timer:</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨åˆ›å»ºæ ¹æ®éœ€è¦åˆ›å»ºå¥½ Timer ä¹‹åï¼Œä½¿ç”¨<code>_Timer._enqueue</code>æ–¹æ³•æŠŠ Timer æ”¾å…¥åˆ°ç›¸åº”çš„é˜Ÿåˆ—ä¸­ã€‚</p>
<h4> timer._enqueue</h4>
<p>ä¸»è¦çœ‹ä¸€ä¸‹<code>timer._enqueue()</code>æ–¹æ³•çš„å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°æ— è®ºæ˜¯å•æ¬¡è¿˜æ˜¯å¾ªç¯çš„ Timer æœ€åéƒ½æ˜¯ä½¿ç”¨<code>_Timer._internal</code>åˆ›å»ºçš„ï¼Œç„¶åå†ä½¿ç”¨<code>_Timer._enqueue()</code>æ–¹æ³•å°† timer æ·»åŠ åˆ°<code>heap</code>æˆ–è€…<code>timer list</code>ä¸­ï¼š</p>
<ul>
<li>å¦‚æœ Timer çš„<code>_milliSeconds</code>ä¸º 0ï¼Œåˆ™ä¼šè¢«æ·»åŠ åˆ°<code>_lastZeroTimer</code>ä¸­ï¼ˆå¹¶å°†ä¸Šä¸€ä¸ª timer çš„_indexOrNext æŒ‡å‘è‡ªå·±ï¼‰ï¼Œå¹¶åœ¨<code>_notifyZeroHandler()</code>æ–¹æ³•å‘é€_ZERO_EVENT äº‹ä»¶ï¼ˆæœ€ç»ˆä¼šè§¦å‘<code>_Timer._handleMessage</code> ï¼‰ï¼›</li>
<li>å¦åˆ™åˆ™å°†å…¶åŠ å…¥åˆ°<code>_heap</code>ä¸­ï¼Œå¦‚æœä»–æ˜¯ç¬¬ä¸€ä¸ª timerï¼Œå°±é€šè¿‡<code>_notifyEventHandler()</code>å¯åŠ¨å¤„ç† Timer çš„ event handlerï¼ˆè¿™ä¸ªçº¿ç¨‹ä¼šåœ¨åˆé€‚çš„æ—¶é—´å”¤èµ· Timer æ‰§è¡Œ<code>_Timer._handleMessage</code>æ–¹æ³•ï¼‰ã€‚</li>
</ul>
<p>åœ¨å…·ä½“åˆ†ææ•´ä¸ªè¿‡ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å‡ ä¸ªå±æ€§çš„åˆ›å»ºè¿‡ç¨‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li><code>_sendPort</code>æ˜¯<code>_receivePort</code>å¯¹åº”çš„ sendPortï¼Œåè€…çš„ handler æ˜¯<code>_handleMessage()</code>æ–¹æ³•</li>
<li>æ— è®ºæ˜¯<code>_notifyEventHandler()</code>è¿˜æ˜¯ <code>_notifyZeroHandler()</code>éƒ½ä¼šä¿è¯<code>_createTimerHandler()</code>è¢«<strong>è°ƒç”¨è¿‡</strong>ã€‚</li>
</ul>
<h5> _milliSeconds == 0</h5>
<p>å…ˆçœ‹ä¸€ä¸‹<code>_milliSeconds</code>ä¸º 0 çš„æƒ…å†µï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŒ‰ç…§ä¸Šé¢çš„åˆ†æï¼Œ<code>_sendPort!.send(_ZERO_EVENT)</code>å‘é€çš„æ¶ˆæ¯ï¼Œé€šè¿‡<code>MessageHandler::PostMessage</code>å¤„ç†ï¼Œæœ€åè°ƒç”¨<code>_receivePort</code>çš„ handler ä¹Ÿå°±æ˜¯åœ¨<code>_handleMessage(msg)</code>æ–¹æ³•ä¸­æ‰§è¡Œã€‚</p>
<h5> _milliSeconds â‰  0</h5>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ï¼Œå½“_milliSeconds â‰  0 çš„æ—¶å€™ï¼Œä¼šå°†å…¶åŠ å…¥åˆ°<code>_heap</code>ä¸­ï¼Œå¦‚æœå½“å‰çš„ timer æ˜¯<code>_heap</code>ä¸­ç¬¬ä¸€ä¸ªï¼Œåˆ™è°ƒç”¨<code>_notifyEventHandler()</code>å‘Šè¯‰ event handler<strong>åœ¨æŒ‡å®šçš„æ—¶é—´å”¤èµ· isolate</strong>ã€‚</p>
<p>è¿™é‡Œä¸»è¦çš„å®ç°æ˜¯<code>VMLibraryHooks.eventHandlerSendData</code>ï¼Œä»–çš„å®ç°å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»–çš„å®ç°åœ¨ native å±‚çš„<code>EventHander</code>ä¸­åä¸º<code>event handler</code>çš„å­çº¿ç¨‹ä¸­<strong>é€šè¿‡å¼‚æ­¥ IO æ‰§è¡Œä»»åŠ¡</strong>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸åŒçš„ç³»ç»Ÿå®ç°ä¸åŒï¼Œå¯¹äº Android æ¥è¯´ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åç³»ç»Ÿä¼šåœ¨æ—¶é—´åˆ°äº†ä¹‹åï¼Œä¼šè°ƒç”¨<code>EventHandlerImplementation::HandleEvents</code>é€šè¿‡<code>_send_port</code>å‘é€æ¶ˆæ¯ï¼Œå¹¶è§¦å‘<code>_receivePort</code>çš„ hander ä¹Ÿå°±æ˜¯<code>_handleMessage</code>æ–¹æ³•å¤„ç†æ¶ˆæ¯ã€‚</p>
<h5> _handleMessage</h5>
<p>æ— è®ºæ˜¯_milliSeconds == 0 çš„æ—¶å€™<code>_sendPort!.send(_ZERO_EVENT);</code>ï¼Œè¿˜æ˜¯_milliSeconds != 0 é€šè¿‡<code>EventHandler</code>å‘é€_TIMEOUT_EVENT æ¶ˆæ¯ï¼Œæœ€ç»ˆéƒ½ä¼šä½¿ç”¨<code>_handleMessage</code>å¤„ç†æ¶ˆæ¯ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>_handleMessage</code>ä¸­æŒ‰ç…§ msg çš„ç±»å‹å–å‡ºå¯¹åº”çš„<code>pendingTimers</code>ç„¶åå†<code>_runTimers</code>ä¸­æ‰§è¡Œï¼Œåœ¨æ‰§è¡Œå®Œæ¯•æˆ–è€…é‡åˆ°é”™è¯¯æ—¶ï¼Œè°ƒç”¨<code>_notifyEventHandler()</code>é€šçŸ¥<code>event handler</code>æˆ–è€…å…³é—­<code>TimerHandler</code>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä¾æ¬¡éå†ä¼ å…¥çš„ pendingTimersï¼Œå¹¶åœ¨æ¯æ¬¡æ‰§è¡Œå®Œ event åï¼Œå»æ£€æŸ¥æ‰§è¡Œä¸€ä¸‹ micro taskã€‚</p>
<br>
<p>æ ¹æ®åˆ›å»º Timer çš„æ—¶å€™_milliSeconds æ˜¯å¦ç­‰äº 0ï¼šä¼šåˆ†åˆ«ä½¿ç”¨<code>MessageHandler</code><strong>æ‰§è¡Œ</strong>æˆ–è€…åœ¨<strong>åä¸º event handler çš„ IO çº¿ç¨‹</strong>é€šè¿‡<code>isolate</code>ä¸­çš„<code>MessageHandler</code>æ¥æ‰§è¡Œä»»åŠ¡ï¼›æœ€åéƒ½ä¼šè§¦å‘ Timer çš„<code>_handleMessage</code>æ–¹æ³•åœ¨<code>_runTimers</code>æ–¹æ³•ä¸­æ‰§è¡Œ callbackã€‚</p>
<h2> ç»“è®º</h2>
<p>ç»¼ä¸Šï¼Œdart ä¸­çš„æ–¹æ³•æ€»å…±æœ‰ 3 ç§ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ä»å‰åˆ°åä¾æ¬¡æ˜¯ï¼š</p>
<ol>
<li>æ™®é€šçš„åŒæ­¥æ–¹æ³•</li>
<li>micro task</li>
<li>å…¶ä»– eventï¼šéƒ¨åˆ† Futureã€Timerã€ç‚¹å‡»äº‹ä»¶ã€å±å¹•åˆ·æ–°ç­‰</li>
</ol>
<p>åœ¨æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼š</p>
<ol>
<li>å…ˆæ‰§è¡Œå®Œæ¯•æ‰€æœ‰çš„åŒæ­¥æ–¹æ³•ï¼›</li>
<li>ç„¶ååˆ¤æ–­æ˜¯å¦æœ‰ micro taskï¼Œæœ‰çš„è¯å°±ç«‹å³æ‰§è¡Œï¼›</li>
<li>å¦åˆ™ï¼Œå°±æ‰§è¡Œæ™®é€šçš„ eventï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ª event å°±æ‰§è¡Œä¸€æ¬¡æ­¥éª¤ 2ï¼›</li>
<li>ç›´åˆ°å½“å‰ app ä¸­æ—¢æ²¡æœ‰ micro task ä¹Ÿæ²¡æœ‰æ™®é€šçš„ eventï¼Œé€€å‡º appã€‚</li>
</ol>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://github.com/dart-lang/sdk" target="_blank" rel="noopener noreferrer">dart sdk</a></p>
<p><a href="https://web.archive.org/web/20170704074724/https://webdev.dartlang.org/articles/performance/event-loop" target="_blank" rel="noopener noreferrer">The Event Loop and Dart</a></p>
<p><a href="https://juejin.cn/post/6844904196819402759#heading-0" target="_blank" rel="noopener noreferrer">Flutter ä¹‹ Future åŸç†è§£æ - æ˜é‡‘</a></p>
<p><a href="https://juejin.cn/post/6844904196819386375" target="_blank" rel="noopener noreferrer">Flutter ä¹‹ Timer åŸç†è§£æ - æ˜é‡‘</a></p>
<p><a href="https://dart.dev/" target="_blank" rel="noopener noreferrer">Dart å®˜ç½‘</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/dart/event_loop/dart_event_loop.png" type="image/png"/>
    </item>
    <item>
      <title>Dart è¯»å–æ–‡ä»¶è¿‡ç¨‹åˆ†æ</title>
      <link>https://jixiaoyong.github.io/blog/posts/3db5282.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/3db5282.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Dart è¯»å–æ–‡ä»¶è¿‡ç¨‹åˆ†æ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 02 Jun 2022 08:25:23 GMT</pubDate>
      <content:encoded><![CDATA[<p>Dart è¯»å–æ–‡ä»¶æ—¶ï¼Œå…ˆåœ¨ Dart ä»£ç åˆ›å»º File å¼•ç”¨ï¼Œé€šè¿‡ä¸<code>IOService</code>è·¨<code>Isolate</code>é€šä¿¡ï¼ˆå…ˆé€šè¿‡ IO Service è€Œå‘é€è¯·æ±‚åˆ° native ç«¯ï¼Œç­‰åˆ° native æ‰§è¡Œå®Œæ“ä½œä¹‹åå†å›è°ƒç»“æœï¼‰ä»è€Œå®ç°å¯¹æ–‡ä»¶çš„è¯»å†™ã€‚</p>
<p>å®ç°ä¸€ä¸ªç®€å•çš„è¯»å–æ–‡ä»¶çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/202206041125613.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2> è¿‡ç¨‹åˆ†æ</h2>
<h3> Dart ç«¯å‘èµ·æ–‡ä»¶è¯»å†™è¯·æ±‚</h3>
<p>å…¶ä¸­<code>file.readAsBytes()</code> æ˜¯å…·ä½“æ‰§è¡Œè¯»å–æ–‡ä»¶çš„åœ°æ–¹ï¼Œä»–çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æˆ‘ä»¬åˆ›å»º<code>File</code>æ—¶ï¼Œå®é™…ä¸Šåˆ›å»ºçš„æ˜¯<code>_File</code> ï¼ˆ<code>class _File extends FileSystemEntity implements File</code>ï¼‰å¯¹è±¡ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>_File</code> æ˜¯<code>File</code> çš„å®ç°ç±»ï¼Œæ‰€ä»¥<code>file.readAsBytes()</code>å®é™…è°ƒç”¨çš„æ˜¯<code>_File</code> å®ç°çš„æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯æ™®é€šçš„æ–‡ä»¶æ ¼å¼ï¼Œè¿˜æ˜¯ character deviceï¼Œæœ€åéƒ½æ˜¯è°ƒç”¨äº†<code>_RandomAccessFile</code>çš„<code>open()</code>å’Œ<code>read(int bytes)</code>æ–¹æ³•å¼‚æ­¥è¯»å–æ–‡ä»¶ã€‚</p>
<blockquote>
<p>è®¾å¤‡æ–‡ä»¶åˆ†ä¸º Block Device Driver å’Œ Character Device Drive ä¸¤ç±»ã€‚<br>
Character Device Driver åˆè¢«ç§°ä¸ºå­—ç¬¦è®¾å¤‡æˆ–è£¸è®¾å¤‡ raw devices; Block Device Driver é€šå¸¸æˆä¸ºå—è®¾å¤‡ã€‚<br>
è€Œ Block Device Driver æ˜¯ä»¥å›ºå®šå¤§å°é•¿åº¦æ¥ä¼ é€è½¬ç§»èµ„æ–™ï¼›Character Device Driver æ˜¯ä»¥ä¸å®šé•¿åº¦çš„å­—å…ƒä¼ é€èµ„æ–™ã€‚ <a href="https://www.cnblogs.com/qlee/archive/2011/07/27/2118406.html#:~:text=Character" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/qlee/archive/2011/07/27/2118406.html#:~:text=Character</a></p>
</blockquote>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>_RandomAccessFile</code>ä¸­ï¼Œé™¤äº†åŒæ­¥è¯»å†™æ–‡ä»¶æ˜¯å¯¹è¿”å›çš„æ–‡ä»¶å¼•ç”¨ç›´æ¥æ“ä½œå¤–ï¼Œå¾ˆå¤šæ“ä½œéƒ½èƒ½çœ‹åˆ°é€šè¿‡<code>_dispatch()</code>æ–¹æ³•ä¸<code>IO Service</code>é€šä¿¡ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥é˜…<a href="https://github.com/dart-lang/sdk/blob/main/sdk/lib/io/io_service.dart" target="_blank" rel="noopener noreferrer">_IOService</a>çš„æºç åå‘ç°è¿™æ˜¯ä¸ª<code>external</code> æ–¹æ³•ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>An <code>external</code> function is connected to its body by an implementation-specific mechanism. Attempting to invoke an external function that has not been connected to its body will throw a NoSuchMethodError or some subclass thereof.<br>
****<a href="https://github.com/dart-lang/sdk/issues/4300" target="_blank" rel="noopener noreferrer">https://github.com/dart-lang/sdk/issues/4300</a></p>
</blockquote>
<p>æ ¹æ®<code>external</code>çš„å®šä¹‰ï¼Œ<code>_dispatch</code>æ–¹æ³•åœ¨ä¸åŒçš„æœºå™¨ä¸Šé¢å®ç°ä¸åŒã€‚æˆ‘ä»¬åªçœ‹å’Œ app ç›¸å…³çš„å®ç°ï¼ˆåœ¨<code>sdk\lib\_internal\vm</code>ç›®å½•ä¸‹ï¼Œvm åŒçº§ç›®å½•è¿˜æœ‰ js ç­‰å®ç°ï¼‰ï¼Œå…·ä½“çš„å®ç°å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€åæ˜¯é€šè¿‡<code>RawReceivePort</code>/<code>SendPort</code>è¿›è¡Œ<strong>è·¨ Isolate é€šä¿¡</strong>ã€‚</p>
<p><code>_IOService</code>ä½¿ç”¨<code>_servicePorts</code>å¯¹ native å±‚å‘é€æ¶ˆæ¯è§¦å‘ IO æ“ä½œï¼Œç„¶åä½¿ç”¨<code>_receivePort</code>ç›‘å¬ï¼Œå½“ IO æ“ä½œå®Œæˆæ—¶ä¼šé€šè¿‡<code>_replyToPort</code> å›è°ƒç»“æœï¼Œä¼šåœ¨ <code>_receivePort!.handler</code>æ–¹æ³•ä¸­æ ¹æ®å½“æ—¶è¯·æ±‚çš„<code>id</code>æ‰¾åˆ°<code>Completer</code>å°†ç»“æœä¼ é€’å›å»ã€‚</p>
<p>è¿™æ ·å½“æ—¶æˆ‘ä»¬åœ¨ <code>file.readAsBytes()</code>æ—¶è·å–åˆ°çš„<code>Future</code>ä¾¿ä¼šæ”¶åˆ°å›è°ƒï¼Œä»è€Œå®Œæˆæ–‡ä»¶æ“ä½œçš„æµç¨‹ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢æ˜¯åˆ°ç›®å‰ä¸ºæ­¢æ¶‰åŠåˆ°çš„ç±»å…³ç³»ç¤ºæ„å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images//202206041127617.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3> IO Service ä¸­è½¬</h3>
<p>é‚£ä¹ˆï¼Œè¿™ä¸ª IO Service æ˜¯åšä»€ä¹ˆçš„ï¼Œä»–åˆæ˜¯å¦‚ä½•å®ç°ä¸ dart ä¸­çš„è°ƒç”¨æ–¹åŒå‘é€šä¿¡ï¼Œä»¥åŠæ‰§è¡Œè°ƒç”¨æ–¹éœ€è¦çš„åŠŸèƒ½å‘¢ï¼Ÿ</p>
<p>ä½äº<code>sdk\lib\_internal\vm\bin\io_service_patch.dart</code>çš„_IOService æ˜¯ä¸€ä¸ªä¸­è½¬ç«™ï¼Œ<strong>å‘ä¸Šæ‰¿æ¥</strong>æ¥è‡ª Dart ä»£ç çš„ IO è¯·æ±‚æŒ‡ä»¤ï¼ˆå…ˆè¡Œè¿”å› Futureï¼‰ï¼Œ<strong>å‘ä¸‹å°†è¿™äº›æŒ‡ä»¤è½¬å‘</strong>è‡³ Native å±‚çš„ IO Serviceï¼Œå¹¶<strong>ç›‘å¬å›è°ƒ</strong>ï¼Œå½“ native å±‚å¤„ç†å®Œè¿™äº› IO æŒ‡ä»¤ä¹‹åï¼Œå°†ç»“æœé€šè¿‡ Future è¿”å›ç»™ Dart è°ƒç”¨æ–¹ã€‚</p>
<p>è®©æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ä»–çš„å…·ä½“å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li><code>_IOService</code>æŒæœ‰<code>_IOServicePorts _servicePorts</code>ä»¥ä¾¿è·å–<code>SendPort servicePort</code>å’Œ native å±‚é€šä¿¡ï¼Œ</li>
<li>åœ¨ä¹‹å‰çš„ä»£ç åˆ†æä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“<code>_IOService</code>è¿˜åœ¨<code>_ensureInitialize()</code>ä¸­ç›‘å¬ç€<code>RawReceivePort? _receivePort</code>çš„å›è°ƒï¼Œ</li>
<li>è¿™æ ·å½“<code>_IOService</code>åœ¨<code>_dispatch()</code>æ–¹æ³•ä¸­å°†<code>_replyToPort</code>ï¼ˆ<code>_receivePort</code>çš„ SendPortï¼‰ä¼ é€’ç»™<code>servicePort</code>åï¼Œä¸€æ—¦ native é€šè¿‡<code>_replyToPort</code>å‘é€å¤„ç†ç»“æœï¼Œ<code>_IOService</code>ç«‹é©¬å¯ä»¥æ”¶åˆ°å¹¶é€šè¿‡<code>Completer.complete</code>è¿”å›ç»™<strong>Dart ä¸­çš„è°ƒç”¨æ–¹</strong>ã€‚</li>
</ul>
<aside>
ğŸ’¡ æ³¨æ„è¿™é‡Œçš„`SendPort **servicePort`** ï¼Œä»–æ˜¯ä» native å±‚çš„`_IOService` è·å–åˆ°çš„ï¼š
1. åœ¨ native å±‚é€šè¿‡`PortMap::CreatePort(MessageHandler* handler)`åˆ›å»ºå¥½æ­¤`Dart_Port port` 
2. `MessageHandler` åœ¨åˆ›å»º`Dart_Port port`çš„æ—¶å€™å°±ä¸ä¹‹å…³è”
3. åœ¨ Dart å±‚çš„`_IOService` è¿™é‡Œç›‘å¬
è¿™æ ·ï¼Œå½“ native å±‚çš„`MessageHandler`æ‰§è¡ŒæŒ‡ä»¤ä¹‹åï¼Œä¼šå°†`Dart_Port port`ä¼ é€’ç»™`IOServiceCallback`ï¼Œåè€…å°†ä»–å’Œè‡ªèº«æ‰§è¡Œç»“æœä¸€å¹¶æ‰“åŒ…ä¸º native å±‚çš„ Message å‹å…¥`MessageHandler`çš„`æ¶ˆæ¯ queue`ä¸­ï¼Œç„¶åç”±æ¶ˆæ¯åˆ†å‘ç³»ç»ŸæŒ‰ç…§å‘é€åˆ° Dart è¿™é‡Œï¼ŒæŒ‰ç…§`SendPort **servicePort`** æ‰¾åˆ°è¦æ‰§è¡Œçš„ä»£ç ã€‚
</aside>
<p>ä¸Šè¿°è¿™äº›æ­¥éª¤èƒ½å¤Ÿå®æ–½çš„å…³é”®ï¼Œåœ¨äº<strong>Dart</strong>å±‚çš„<code>_IOService</code>å¦‚ä½•ä¸<strong>native</strong>å±‚çš„<code>_IOService</code>å…³è”èµ·æ¥å‘¢ï¼Ÿ</p>
<p>è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹<code>SendPort servicePort</code>çš„è·å–è¿‡ç¨‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ€åçš„å…³é”®æ–¹æ³•æ˜¯<code>SendPort _newServicePort()</code>ï¼Œè¿™æ˜¯ä¸€ä¸ª<code>external</code>æ–¹æ³•ï¼Œåœ¨ native å®ç°ã€‚</p>
<h3> Native å¤„ç† Dart çš„æŒ‡ä»¤</h3>
<h4> IOService_NewServicePort</h4>
<p><code>SendPort</code>æ˜¯ç”±<code>_newServicePort()</code>æ–¹æ³•åˆ›å»ºçš„ï¼Œè¿™æ˜¯ä¸€ä¸ª<code>external</code>æ–¹æ³•ï¼Œä»–çš„ native å±‚å®ç°åç§°æ˜¯<code>IOService_NewServicePort</code>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œåœ¨ Dart å±‚çš„<code>_IOService</code>çš„<code>SendPort _newServicePort()</code> æ–¹æ³•æœ€åå†è¿™é‡Œè°ƒç”¨äº†<code>IOService_NewServicePort</code>ã€‚</p>
<p>è¿™é‡Œä¸»è¦æœ‰ 3 ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ä½¿ç”¨<code>Dart_NewNativePort("IOService", IOServiceCallback, true);</code>åˆ›å»º<code>Dart_Port</code></li>
<li>ä½¿ç”¨<code>Dart_NewSendPort</code>å°†<code>Dart_Port</code>è½¬åŒ–ä¸º<code>Dart_Handle</code>ï¼ˆä¹Ÿå°±æ˜¯ Dart ä¸­çš„<code>SendPort</code>ï¼‰</li>
<li>è¿”å›ä¸Šé¢åˆ›å»ºå¥½çš„<code>Dart_Handle</code>ï¼ŒDart ä»£ç æ‹¿åˆ°è¿”å›çš„ Dart_Handle ä¹Ÿå°±æ˜¯<code>SendPort servicePort</code>ä¹‹åï¼Œå°±å¯ä»¥å’Œ native å±‚çš„ IO Service åŒé€šä¿¡ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å‰ 2 æ­¥åˆ†åˆ«æ˜¯æ€ä¹ˆå®ç°çš„ï¼š</p>
<h4> Dart_NewNativePort</h4>
<p>å†çœ‹ä¸€ä¸‹<code>Dart_NewNativePort</code>çš„è°ƒç”¨å‚æ•°ï¼š</p>
<div class="language-jsx line-numbers-mode" data-ext="jsx"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>IOServiceCallback</strong></p>
<p><code>Dart_NewNativePort</code>æ€»å…±æœ‰ 3 ä¸ªå‚æ•°ï¼Œ<code>Dart_NativeMessageHandler handler</code>æ˜¯å½“è¿™ä¸ª<code>Dart_Port</code>æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¼šè¢«å›è°ƒçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šè¿‡ Dart ç«¯çš„<code>_IOService.dispatch</code>æ–¹æ³•çš„**<code>servicePort**.send(&lt;dynamic&gt;[id, **_replyToPort**, request, data]);</code>è¯­å¥æ‰§è¡Œå‘ native å‘é€ IO æŒ‡ä»¤æ—¶ï¼Œåœ¨ native è¿™é‡ŒçœŸæ­£è´Ÿè´£æ‰§è¡Œçš„æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IOService å…·ä½“çš„æ‰§è¡Œæ˜¯åœ¨<code>IO_SERVICE_REQUEST_LIST</code>æ ¹æ®è§£æåˆ°çš„å‚æ•°æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼š</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œå¯ä»¥å¾—çŸ¥ï¼ŒIOService ä¸»è¦å¤„ç†çš„æ–¹æ³•æœ‰å››ç±»ï¼š</p>
<ul>
<li><code>File</code></li>
<li><code>Directory</code></li>
<li><code>Socket</code></li>
<li><code>SSLFilter</code></li>
</ul>
<p>åœ¨<code>IOServiceCallback</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œç¨‹åºæœ€åæ‰§è¡Œçš„ç»“æœæ˜¯é€šè¿‡<code>Dart_PostCObject</code>è¿”å›çš„ï¼Œæ¥çœ‹ä¸€ä¸‹ä»–æ˜¯æ€ä¹ˆå®ç°çš„ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç æœ€åå°†ç»“æœåŒ…è£…æˆäº† Message æ‰“åŒ…è¿›<code>MessageHandler</code>çš„<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ä¸­ï¼Œè¿™æ ·ä¾¿å¯ä»¥åœ¨ Dart ç«¯é€šè¿‡æ¶ˆæ¯åˆ†å‘æ¥æ”¶åˆ°ç»“æœã€‚</p>
<p><strong>Dart_NewNativePort</strong></p>
<p>å†æ¥çœ‹ä¸€ä¸‹<code>Dart_NewNativePort</code>çš„å®ç°å¦‚ä¸‹ï¼š</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸»è¦çš„æµç¨‹æœ‰ï¼š</p>
<ol>
<li>åˆ‡æ¢é€€å‡ºå½“å‰ isolate</li>
<li>åˆ›å»º<code>NativeMessageHandler nmh</code>åŒ…è£¹è¦å¤„ç†çš„å›è°ƒ</li>
<li>æ ¹æ®ä¸Šé¢åˆ›å»ºçš„<code>nmh</code>åˆ›å»º<code>Dart_Port port_id</code></li>
<li>æ‰§è¡Œ**<code>nmh-&gt;Run()</code>**æ–¹æ³•å°†<code>nmh</code>æ”¾åˆ°çº¿ç¨‹æ± ä¸­è¿è¡Œ</li>
<li>å½“<code>nmh</code>æ‰§è¡Œå®Œæ¯•å›è°ƒåï¼Œå…³é—­<code>Dart_Port port_id</code></li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ Dart ä¸­å‘ Native å‘é€æŒ‡ä»¤æ—¶ï¼Œé€šè¿‡ Dart çš„<code>_IOService._dispatch()</code>æ–¹æ³•ä¸­æ‰§è¡Œ<code>_servicePorts._getPort(id);</code>å‘ Native å±‚çš„ IOService è·å–ç”¨äºé€šä¿¡çš„<code>SendPort servicePort</code>æ—¶ï¼Œä¼šå…ˆé€šè¿‡ Dart_NewNativePort åˆ›å»ºä¸€ä¸ª<strong>NativeMessageHandler</strong>ï¼ˆä¼šå‹å…¥æ¶ˆæ¯æ ˆä¸­ï¼‰ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªå¯¹åº”çš„<code>Dart_Port port_id</code>å¹¶è¿”å›ç»™ Dart ç”¨æ¥è§¦å‘æ¶ˆæ¯ã€‚</p>
<p>è®©æˆ‘ä»¬æŒ¨ä¸ªåˆ†æä¸€ä¸‹ï¼š</p>
<p>1.é€€å‡ºå½“å‰ isolate</p>
<p>è§ <a href="https://www.notion.so/IsolateLeaveScope-d62547a99c6d464bbd1bbf5baa45de18" target="_blank" rel="noopener noreferrer">IsolateLeaveScope</a></p>
<p>2.åˆ›å»º<code>NativeMessageHandler nmh</code>åŒ…è£¹è¦å¤„ç†çš„å›è°ƒ</p>
<p>3.æ ¹æ®ä¸Šé¢åˆ›å»ºçš„<code>nmh</code>åˆ›å»º<code>Dart_Port port_id</code></p>
<p>çœ‹ä¸€ä¸‹<code>PortMap::CreatePort</code>çš„å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.æ‰§è¡Œ**<code>nmh-&gt;Run()</code>**æ–¹æ³•å°†<code>nmh</code>æ”¾åˆ°çº¿ç¨‹æ± ä¸­è¿è¡Œ</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨åˆ›å»ºäº†æ–°çš„ç³»ç»Ÿçº¿ç¨‹åï¼Œä¼šæ‰§è¡Œä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> Dart_NewSendPort</h4>
<p>çœ‹ä¸€ä¸‹<code>Dart_NewSendPort</code>å¦‚ä½•å°†åˆ›å»ºå¥½çš„<code>Dart_Port service_port</code>è½¬å˜ä¸º Dart çš„<code>SendPort</code>çš„ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ°è¿™é‡Œæˆ‘ä»¬å‘ç°ï¼Œ<code>Dart_NewNativePort</code>å°†è¦å¤„ç†çš„äº‹ä»¶<code>handler</code>å°è£…èµ·æ¥ï¼Œæœ€ååœ¨<strong>éå½“å‰ isolate</strong>çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p>
<h2> ç»“è®º</h2>
<p>ä»ä¸Šé¢çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåœ¨ Dart ä¸­é€šè¿‡ File è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œå…¶å®æ˜¯é€šè¿‡ Dart ä¸­çš„_IOService è¿›è¡Œæ¶ˆæ¯ä¸­è½¬ï¼Œå°†ç”¨æˆ·çš„ IO æŒ‡ä»¤å‘é€åˆ° Native å±‚çš„ IOService ä¸­ï¼›</p>
<p>IOService é€šè¿‡ä¸€äº›åˆ—æ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ª<code>SendPort servicePort</code>ï¼Œä¸æ­¤åŒæ—¶å¯¹åº”çš„ IO æ“ä½œå·²ç»å‹å…¥æ¶ˆæ¯æ ˆä¸­ç­‰å¾…è§¦å‘åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼›</p>
<p>ä¹‹ååœ¨_IOService ä¸­<code>servicePort</code>å°†ç”¨æˆ·éœ€è¦çš„ IO æ“ä½œå’Œä¸è‡ªå·±é€šä¿¡çš„<code>_replyToPort = _receivePort!.sendPort;</code> é€šè¿‡<code>send</code>æ–¹æ³•è§¦å‘<code>IOServiceCallback</code>æ‰§è¡Œå¯¹åº”çš„ IO æ“ä½œï¼Œå¹¶ä¸”åœ¨æœ€åè°ƒç”¨<code>Dart_PostCObject</code>æ–¹æ³•å°†ç»“æœå‹å…¥æ¶ˆæ¯æ ˆä¸­ï¼Œè¿™ä¼šè§¦å‘ Dart å±‚_IOService çš„_receivePort!.handler å›è°ƒäº‹ä»¶ï¼Œç„¶åæ ¹æ®äº‹ä»¶å¤±è´¥æˆ–è€…æˆåŠŸï¼Œä½¿ç”¨ Completer é€šè¿‡ Event loop ä¸€æ­¥æ­¥å°†äº‹ä»¶ä¸ŠæŠ¥ï¼Œæœ€ç»ˆå›è°ƒç”¨æˆ·éœ€è¦çš„å‘½ä»¤ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://blog.csdn.net/eieihihi/article/details/119601010" target="_blank" rel="noopener noreferrer">09ã€Flutter FFI Dart Native API_åˆå¹é£_Bassy çš„åšå®¢-CSDN åšå®¢</a></p>
<p><a href="http://w4lle.com/2021/04/12/kidea-flutter/index.html" target="_blank" rel="noopener noreferrer">å¿«æ‰‹ - å¼€çœ¼å¿«åˆ› Flutter å®è·µ | w4lle's Notes</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/202206041125613.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter APP ç»˜åˆ¶è¿‡ç¨‹ç®€æ</title>
      <link>https://jixiaoyong.github.io/blog/posts/4cbcfe72.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/4cbcfe72.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter APP ç»˜åˆ¶è¿‡ç¨‹ç®€æ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 25 Jun 2022 01:03:30 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡åŸºäº Flutter 3.0</p>
</blockquote>
<p>Flutter App åŸºäº Dart è¯­è¨€ç¼–å†™ï¼Œæä¾›äº†ä¸€å¥—ç®€å•æ˜“ç”¨çš„ APIï¼Œå¯ä»¥è®©å¼€å‘è€…åœ¨ Flutter ä¸­å¿«é€Ÿå¼€å‘å‡ºä¸€ä¸ªç²¾ç¾çš„ APPã€‚é‚£ä¹ˆåœ¨ Flutter ä¸­æ˜¯å¦‚ä½•ç»˜åˆ¶ä¸€ä¸ª APP å‘¢ï¼ŒrunApp æ˜¯æ€ä¹ˆå°†æˆ‘ä»¬ç¼–å†™çš„ Widget ç­‰æ·»åŠ åˆ°æ‰‹æœºä¸Šçš„å‘¢ï¼Ÿæœ¬æ–‡ç®€å•ä» Widget,Element,RenderObjet ä¸‰è€…çš„å…³ç³»æ¥æ¢³ç†ä¸€ä¸‹ Flutter çš„ç»˜åˆ¶è¿‡ç¨‹ã€‚</p>
<p>è®©æˆ‘ä»¬è¿è¡Œä¸€ä¸ªâ€œæœ€â€ç®€å•çš„ Flutter Appï¼Œåˆ†æä¸€ä¸‹åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„ Widgetã€Elementã€RenderObject è¿™ä¸‰ä¸ª tree çš„å…³ç³»ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter_run_app/flutter_run_app_hello_center_text.png" alt="flutter_run_app_hello_center_text" tabindex="0" loading="lazy"><figcaption>flutter_run_app_hello_center_text</figcaption></figure>
<p>è®©æˆ‘ä»¬ä½¿ç”¨ Flutter DevTools çœ‹ä¸€ä¸‹å®é™…ç”Ÿæˆçš„ Widget Details Tree</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æˆ‘ä»¬åœ¨ä»£ç é‡Œé¢æ·»åŠ çš„ Center å’Œ Text è¿™ä¸¤ä¸ª Widget ä¹‹å¤–ï¼Œè¿˜å¤šå‡ºæ¥å¥½å‡ ä¸ª Widget/RenderObjectï¼Œå½“æˆ‘ä»¬ä»”ç»†æŸ¥çœ‹å…·ä½“çš„ Widgetï¼Œå¯ä»¥çœ‹åˆ°å…¶å†…éƒ¨è¿˜æœ‰ XXXElementï¼ŒBuildOwner ä¹‹ç±»çš„å­—æ®µï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°æ¶‰åŠåˆ°çš„å‡ ä¸ªç±»å½¼æ­¤ä¹‹é—´åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ï¼Œæˆ‘ä»¬çš„â€œ<code>Hello center text!</code>â€åˆæ˜¯æ€æ ·æ‰æ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„ï¼Œè®©æˆ‘ä»¬æ¥ä¸‹æ¥ä¸€ä¸ªä¸€ä¸ªåˆ†æä¸€ä¸‹ï¼š</p>
<h2> runApp</h2>
<p>åœ¨æ‰§è¡Œ runApp çš„æ—¶å€™ä¸»è¦æ‰§è¡Œäº†ä¸‰æ­¥</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> WidgetsFlutterBinding.ensureInitialized()</h3>
<p>åˆ›å»º RenderView å…·ä½“çš„é€»è¾‘åœ¨<code>WidgetsFlutterBinding.ensureInitialized</code>æ–¹æ³•ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>ensureInitialized</code>æ–¹æ³•ä¸­ï¼Œå¦‚æœ<code>WidgetsBinding._instance</code>ä¸º null åˆ™ä¼šå…ˆç”¨æ„é€ æ–¹æ³•åˆ›å»ºï¼Œå› ä¸º<code>WidgetsFlutterBinding</code>ç»§æ‰¿è‡ª BindingBaseï¼Œæ‰€ä»¥å®é™…ä¸Šæ‰§è¡Œä¸‹æ–¹çš„æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä¸»è¦åšäº† 2 ä»¶äº‹ï¼Œæˆ‘ä»¬å…³æ³¨<code>initInstances()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦é€»è¾‘éƒ½åœ¨ä»–çš„å­ç±»ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰<code>WidgetsFlutterBinding</code>æ··åˆçš„å‡ ä¸ª BindingBase å­ç±»ä¸­ï¼Œæˆ‘ä»¬å…³æ³¨å’Œå±å¹•æ¸²æŸ“æœ‰å…³çš„ RendererBindingï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>
<p>åˆ›å»ºäº†ç”¨äºç®¡ç†æ¸²æŸ“ç®¡é“çš„ PipelineOwner <code>_pipelineOwner</code></p>
<p>Pipeline æ˜¯ç”¨æ¥ç®¡ç† rendering treeï¼Œå…¶å†…éƒ¨æŒæœ‰æˆ‘ä»¬çš„ renderView ä½œä¸º rootNodeï¼ŒåŒæ—¶ç»´æŠ¤äº†_nodesNeedingLayoutï¼Œ_nodesNeedingCompositingBitsUpdateï¼Œ_nodesNeedingPaintï¼Œ_nodesNeedingSemantics å››ä¸ªåˆ—è¡¨ï¼Œå½“ flutter framework æ¯æ¬¡éœ€è¦å¾€å±å¹•ä¸Šç»˜åˆ¶å†…å®¹æ—¶ä¼šä¾æ¬¡éå†è¿™å››ä¸ªåˆ—è¡¨ï¼Œå°† RenderObject ç»˜åˆ¶åˆ°å±å¹•ä¸Šé¢ã€‚</p>
</li>
<li>
<p>åˆ›å»ºäº† rendering tree çš„æ ¹èŠ‚ç‚¹<code>renderView</code> ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º<code>_pipelineOwner</code>çš„æ ¹èŠ‚ç‚¹</p>
</li>
</ul>
<h3> ..scheduleAttachRootWidget(app)</h3>
<p>æ­¤æ–¹æ³•æ˜¯<code>WidgetsFlutterBinding</code>çš„å¦å¤–ä¸€ä¸ªæ··åˆç±»<code>WidgetsBinding</code>è´Ÿè´£å…·ä½“å®ç°ï¼š</p>
<p><code>WidgetsBinding</code>çš„<code>scheduleAttachRootWidget</code> æ–¹æ³•æœ€åè°ƒç”¨äº†<code>attachRootWidget(Widget rootWidget)</code> ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä¸»è¦æœ‰ 3 æ­¥ï¼š</p>
<ul>
<li>åˆ›å»º RenderObjectToWidgetAdapter åŒ…è£… RenderView</li>
<li>åœ¨<code>attachToRenderTree</code>æ–¹æ³•ä¸­åˆ›å»º RenderObjectToWidgetElement å¹¶<code>mount</code>åˆ° element tree ä¸­ï¼ˆwidget tree å®é™…ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œè€Œæ˜¯é€šè¿‡ element tree ç®¡ç†ï¼‰</li>
<li>éœ€è¦çš„è¯å®‰æ’ä¸€æ¬¡ frameï¼ˆåˆ·æ–°é¡µé¢ï¼‰</li>
</ul>
<p>è¿˜éœ€è¦æ³¨æ„ä¸€ä¸ªæ–°çš„è§’è‰²<code>buildOwner</code>ï¼Œè¿™ä¸ªå¯¹è±¡å…¨å±€å”¯ä¸€ï¼ˆä¸€èˆ¬ç”± parent ä¼ ç»™ childï¼‰ï¼Œåœ¨<code>WidgetsBinding.initInstances</code>æ–¹æ³•åˆ›å»ºï¼Œç”¨æ¥ç®¡ç†ä¸ Widget tree ç›¸å…³çš„ç±»ï¼Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡ç®¡ç† Element çš„æ’å…¥ï¼Œç§»é™¤ï¼Œæ›´æ–°æ¥é—´æ¥ç®¡ç† Widget treeï¼ˆå¯¹åº”æˆ‘ä»¬åœ¨ä¹‹å‰é‡åˆ°çš„ç”¨æ¥ç®¡ç† rendering tree çš„<code>pipelineOwner</code> ï¼Œè¿™ä¸¤ä¸ª Owner ç®¡ç†ç€æˆ‘ä»¬æ‰€è¯´çš„ Flutter çš„ Widget/Element/RenderObjectâ€œä¸‰â€ä¸ª treeï¼‰ã€‚</p>
<h4> RenderObjectToWidgetAdapter</h4>
<p>å‰é¢æˆ‘ä»¬çŸ¥é“<code>renderView</code>å…¶å®æ˜¯ä¸€ä¸ª RenderObjectï¼Œæ‰€ä»¥è¿™é‡Œä¸ºä»–åˆ›å»ºäº†ä¸€ä¸ªå¯¹åº”çš„ Widgetâ€”â€”<code>RenderObjectToWidgetAdapter</code>ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å°†<code>rootWidget</code>ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¼€å§‹å†™çš„ Center Widget åŠå…¶ childï¼‰ç»‘å®šåˆ°ä¹‹å‰ç”Ÿæˆçš„<code>renderView</code>ä¸Šé¢ï¼Œå¹¶å°†<code>renderView</code>ä½œä¸ºè‡ªå·±å¯¹åº”çš„ RenderObjectã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>RenderObjectToWidgetAdapter.createRenderObject</code> è¿”å›çš„å°±æ˜¯<code>container</code> ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ RenderViewã€‚</p>
<h4> attachToRenderTree</h4>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>RenderObjectToWidgetAdapter</code>åœ¨<code>attachToRenderTree</code> æ–¹æ³•ä¸­ï¼Œåˆ›å»ºå¯¹åº”çš„<code>RenderObjectToWidgetElement</code> ä¸è‡ªå·±ç»‘å®šï¼Œå¹¶ä¸”åŒæ—¶ä¹Ÿå°†<code>rootWidget</code>å’Œä¹‹å‰åˆ›å»ºçš„ rendering tree çš„æ ¹èŠ‚ç‚¹<code>renderView</code>ç»‘å®šã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹<code>RenderObjectToWidgetElement</code>è°ƒç”¨çš„çˆ¶ç±»<code>RenderObjectElement.mount</code>æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼Œè¿˜ä¼šè°ƒç”¨çš„<code>Element.mount</code>æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå°†<code>RenderObjectToWidgetElement</code> æ³¨å†Œåˆ°äº† BuildOwner ä¸­</p>
<p>åœ¨<code>RenderObjectToWidgetElement</code>çš„<code>mount</code>æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œé™¤äº†è°ƒç”¨çˆ¶ç±»çš„<code>mount</code>æ–¹æ³•å¤–ï¼Œè¿˜ä¼šè§¦å‘<code>_rebuild()</code> æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>_rebuild</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>WidgetsBinding.attachRootWidget</code>æ–¹æ³•ä¸­ç»™ RenderObjectToWidgetAdapter ä½œä¸º<code>child</code>å‚æ•°ä¼ å…¥çš„<code>rootWidget</code>ï¼ˆä¹Ÿå³æˆ‘ä»¬ç¤ºä¾‹ä¸­çš„<code>Center</code>Widgetï¼‰ï¼Œåœ¨è¿™é‡Œè¢«ä¼ å…¥äº† RenderView å¯¹åº”çš„ RenderObjectToWidgetElement çš„<code>child</code>ä¸­ï¼ˆè¿™é‡Œçš„è¿‡ç¨‹æˆ‘ä»¬ä¸‹é¢ Center ä¸€èŠ‚å†åˆ†æï¼‰ï¼Œä»è€Œå°†å…¶æ’å…¥åˆ° Flutter çš„æ¸²æŸ“æ ‘ä¸­ã€‚</p>
<p>è¿™æ · RenderViewï¼ˆ<code>RenderObject</code>ï¼‰å°±æœ‰äº†å¯¹åº”çš„<code>Widget</code>å’Œ<code>Element</code>ï¼Œå¹¶ä¸”æœ‰äº†è‡ªå·±çš„<code>child</code>ã€‚</p>
<h3> ..scheduleWarmUpFrame()</h3>
<p>è¿™ä¸ªæ–¹æ³•åˆ™æ˜¯å°½å¿«å®‰æ’ä¸€ä¸ª frame ä»¥ä¾¿åœ¨å±å¹•ä¸‹æ¬¡åˆ·æ–°çš„æ—¶å€™æ˜¾ç¤º app çš„å†…å®¹ï¼ˆåœ¨ app å¯åŠ¨ä¹‹åçš„ç¬¬ä¸€æ¬¡ï¼ï¼ï¼ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬çš„ app å¯åŠ¨äº†ï¼Œæˆ‘ä»¬å†™çš„å†…å®¹ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</p>
<p>é€šè¿‡ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼ŒrunApp æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œåˆ›å»ºäº†<code>RenderView</code>å¯¹è±¡ï¼Œå¹¶å°†å…¶ä½œä¸ºæ•´ä¸ª Flutter APP çš„ RenderObject rendering tree çš„æ ¹èŠ‚ç‚¹ï¼ˆåç»­æ‰€æœ‰çš„ Widget åˆ›å»ºçš„ RenderObject éƒ½æ˜¯åœ¨ RenderView çš„ä¸‹å±‚ï¼‰ï¼Œå¹¶ä¸”åˆå§‹åŒ–å®ƒä»¥ä¾¿åœ¨ä¸‹ä¸€å¸§çš„æ—¶å€™å¯¹å…¶è¿›è¡Œæ¸²æŸ“ã€‚</p>
<br>
<p>åˆ†æå®Œäº†<code>runApp</code>ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹åˆšåˆšæåˆ°çš„å‡ ä¸ªç±»ï¼Œä»¥åŠä»–ä»¬æ˜¯å¦‚ä½•æ·»åŠ åˆ°æˆ‘ä»¬çš„ flutter app ä¸­çš„ã€‚</p>
<h2> RenderView</h2>
<p>å…ˆçœ‹ä¸€ä¸‹åœ¨æœ€é¡¶å±‚çš„<a href="https://github.com/flutter/flutter/blob/a0248ebdf20d2befe29cdf325dc7331826151dab/packages/flutter/lib/src/rendering/view.dart#L63" target="_blank" rel="noopener noreferrer">RenderView</a>ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥é˜…æºç å¯çŸ¥ï¼ŒRenderView æ˜¯ RenderObjectï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ Flutter çš„æ ¹ Viewï¼Œè¡¨ç¤ºæ•´ä¸ª rendering tree çš„ output surfaceï¼Œå¤„ç†å¼•å¯¼ç€ render pipelineã€‚</p>
<p>RenderView æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª RenderBox ç±»å‹çš„<code>child</code>ï¼Œä»–ä¼šå¼ºåˆ¶å°†<code>child</code>çš„<code>size</code>æ”¹ä¸º RenderView åˆå§‹åŒ–æ—¶å€™çš„å…¥å‚<code>configuration</code>çš„å€¼ï¼ˆä¸€èˆ¬æ˜¯å½“å‰<code>window</code>ä¹Ÿå°±æ˜¯<strong>æ‰‹æœºå±å¹•</strong>çš„é€»è¾‘åƒç´ <code>size</code>ï¼‰ã€‚</p>
<h2> Center</h2>
<p>ä¸ŠèŠ‚æˆ‘ä»¬è¯´é“ï¼ŒCenter Widget é€šè¿‡<code>RenderObjectToWidgetElement.updateChild</code>ï¼ˆæœ€ç»ˆè°ƒç”¨ Element åŒåæ–¹æ³•ï¼‰æ–¹æ³•æ’å…¥åˆ°æ¸²æŸ“æ ‘ä¸­ï¼Œä¸‹é¢æˆ‘ä»¬è¯¦ç»†åˆ†æä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p>åœ¨<code>updateChild</code>ä¸­ï¼Œå› ä¸º<code>child==null</code>ï¼Œè€Œ<code>newWidget</code>ä¹Ÿå°±æ˜¯ Center ä¸ä¸º<code>null</code>ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨<code>inflateWidget(newWidget, newSlot)</code>åˆ›å»ºæ–°çš„ Element å¹¶ä½œä¸º RenderObjectToWidgetElement çš„<code>_child</code>ï¼Œè€Œä½œä¸ºç¬¬ä¸€æ¬¡åˆ›å»ºçš„ Centerï¼Œåœ¨<code>Element.inflateWidget</code>æ–¹æ³•ä¸­å¤§æ¦‚ä¼šæ‰§è¡Œä¸‹é¢å‡ æ­¥ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¿™é‡Œå…ˆæ‰§è¡Œäº†<code>Center.createElement</code>æ–¹æ³•åˆ›å»º Elementï¼Œç„¶åè°ƒç”¨æ­¤<code>Element.mount</code>æ–¹æ³•å°† Element æ·»åŠ åˆ° Element treeã€‚</p>
<p>è®©æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ Center çš„ Widget Details Treeï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ° Center çš„<code>_parent</code>å’Œ<code>_ancestorRenderObjectElement</code>æ˜¯ RenderObjectToWidgetElementï¼Œ<code>_depth</code>æ˜¯ 2ï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬æœ€åˆçš„åˆ†æä¸€è‡´ï¼Œå› ä¸º Centerï¼ˆå…¶å®ä¸¥æ ¼æ¥è¯´ï¼Œæ˜¯ Center Widget çš„ï¼ˆæˆ–å­çº§çš„ï¼‰RenderObjectï¼‰æ˜¯ RenderView çš„<code>child</code>ã€‚</p>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥ä¸»è¦å…³æ³¨ä¸€ä¸‹å‡ ä¸ªå±æ€§ï¼š</p>
<ul>
<li><code>alignment</code>: Alignment.center</li>
<li><code>renderObject</code>: RenderPositionedBox</li>
<li><code>_widget</code>: Center</li>
<li><code>_child</code>: StatelessElement</li>
</ul>
<p>å…ˆçœ‹ä¸€ä¸‹ Center çš„æºç ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Center ä»£ç ååˆ†ç®€å•ï¼Œä¸»è¦çš„é€»è¾‘åœ¨ä»–çš„çˆ¶ç±» Align ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Align å…¶å®æ˜¯ä¸€ä¸ª<code>SingleChildRenderObjectWidget</code> ,å¯¹åº”çš„ Element æ˜¯<code>SingleChildRenderObjectElement</code>ï¼Œä»–åˆ›å»ºçš„ RenderObject æ˜¯<code>RenderPositionedBox</code> ã€‚</p>
<p><code>SingleChildRenderObjectElement</code> æ˜¯ä¸€ä¸ª<code>RenderObjectElement</code> ä¹Ÿå°±æ„å‘³ç€ä»–åœ¨ rendering tree æœ‰ä¸€ä¸ªå…³è”çš„ RenderObject è´Ÿè´£ layoutï¼Œpainting ä»¥åŠ hit-testã€‚</p>
<p>å›åˆ°æˆ‘ä»¬çš„ Center Widget ä¸­ï¼š</p>
<h3> <strong>alignment: Alignment.center</strong></h3>
<p><strong>Alignment.center</strong>æ˜¯åœ¨åˆ›å»º Center çš„æ—¶å€™é»˜è®¤è®¾ç½®çš„å¯¹é½æ–¹å¼</p>
<h3> <strong>renderObject: RenderPositionedBox</strong></h3>
<p><strong>RenderPositionedBox</strong>æ˜¯ Center Widget å¯¹åº”çš„ RenderObjectï¼Œåœ¨<code>SingleChildRenderObjectWidget.mount</code> çš„æ—¶å€™åˆ›å»ºã€‚å…¶æœ¬èº«å¹¶ä¸åœ¨å±å¹•ä¸Šç»˜åˆ¶è‚‰çœ¼å¯è§çš„å†…å®¹ï¼Œè€Œæ˜¯å°† child æŒ‰ç…§æŒ‡å®šçš„å¯¹é½æ–¹å¼è¿›è¡Œå®šä½ã€‚</p>
<p><code>RenderPositionedBox</code> çš„ç»§æ‰¿å…³ç³»ï¼š<code>RenderPositionedBox</code> â†’ <code>RenderAligningShiftedBox</code> â†’ <code>RenderShiftedBox</code> â†’ <code>RenderBox</code> â†’ <code>RenderObject</code></p>
<p><strong>RenderPositionedBox</strong>å¯ä»¥æŒ‰ç…§ç»™å®šçš„<code>AlignmentGeometry</code>å®šä½ childã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä»–çš„å‡ ä¸ªå±æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>alignment</code>: Alignment.center</li>
<li><code>_owner</code>: PipelineOwner</li>
<li><code>_parent</code>: RenderView</li>
<li><code>_child</code>: RenderParagraph</li>
</ul>
<p>å‰ä¸‰ä¸ªå±æ€§å«ä¹‰å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œæˆ‘ä»¬æ³¨æ„åˆ°ä»–çš„<code>_child</code>å¹¶ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„<code>Text</code>ï¼Œè¿™ä¸ªåŸå› æˆ‘ä»¬åé¢å†åˆ†æã€‚</p>
<h3> <strong>_widget: Center</strong></h3>
<p>å…¶å®é€šè¿‡ä¸Šè¿°çš„åˆ†æï¼Œæˆ‘ä»¬åº”è¯¥å·²ç»çŸ¥é“ï¼Œæˆ‘ä»¬åœ¨ Widget Details Tree ä¸­çœ‹åˆ°çš„ Center å…¶å®æ˜¯ Center Widget å¯¹åº”çš„ Elementï¼Œä¹Ÿå°±æ˜¯<code>SingleChildRenderObjectElement</code> ã€‚</p>
<p>å…¶ç»§æ‰¿å…³ç³»ï¼š<code>SingleChildRenderObjectElement</code> â†’ <code>RenderObjectElement</code> â†’ <code>Element</code></p>
<p>æ ¹æ® Element çš„å®šä¹‰ï¼Œè¿™é‡Œçš„ Widget æ˜¯åœ¨ Widget åˆ›å»º<code>SingleChildRenderObjectElement</code>çš„æ—¶å€™ä¼ å…¥çš„ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åè¿™ä¸ª Element åœ¨ä¸Šè¿°<code>WidgetsBinding.attachRootWidget</code>æ­¥éª¤ä¸­é€šè¿‡ä¸€ç³»åˆ—æ“ä½œï¼Œæœ€ç»ˆåœ¨ RenderObjectToWidgetElement çš„<code>updateChild</code>æ–¹æ³•è¢«åˆ›å»ºå¹¶è¢«<code>BuildOwner</code> æ’å…¥åˆ° tree ä¸­ã€‚</p>
<p>è¿™é‡Œçš„<code>_widget</code>æ‰çœŸæ­£å¯¹åº”ç€æˆ‘ä»¬åœ¨<code>runApp</code>é‡Œé¢ä¼ å…¥çš„ Center Widgetï¼Œä»–çš„<code>child</code>ä¹Ÿæ­£æ˜¯æˆ‘ä»¬çš„ Textã€‚</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> <strong>_child: StatelessElement</strong></h3>
<p>Center å¯¹åº”çš„ Element çš„<code>_child</code>æ˜¯ä¸€ä¸ª StatelessElementï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šä¸€æ­¥çš„åˆ†æï¼ŒStatelessElement åº”è¯¥æ˜¯ Text Widget åˆ›å»ºï¼Œäº‹å®ä¹Ÿç¡®å®å¦‚æ­¤ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™ä¸ª<code>_child</code>çš„èµ‹å€¼è¿‡ç¨‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Center å¯¹åº”çš„ Elementâ€”â€”<code>SingleChildRenderObjectElement</code> åœ¨<code>mount</code>çš„æ—¶å€™ï¼ŒåŒæ—¶ä¹Ÿä¼šæ›´æ–°<code>child</code>ï¼ˆæœ¬ä¾‹ä¸­ Center çš„<code>child</code>æ˜¯ Textï¼‰ï¼Œè¿™é‡Œè°ƒç”¨çš„æ˜¯ Element çš„<code>updateChild</code>æ–¹æ³•ï¼Œä»–çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>updateChild</code>çš„é€»è¾‘åˆ†ä¸º 4 ç§æƒ…å†µï¼šå…¶ä½™æƒ…å†µéƒ½æ¯”è¾ƒç®€å•ï¼Œåªæœ‰<code>newWidget != null</code>æˆ–è€…<code>child != null</code>çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœå¯ä»¥æ›´æ–°å°±æ›´æ–°å¦åˆ™å°±åˆ›å»ºæ–°çš„ Elementï¼Œå¯ä»¥åˆ†ä¸ºä¸‹é¢è¿™å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li><code>child.widget == newWidget</code>ï¼šä¸¤ä¸ªæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå°±åªæ›´æ–°<code>child</code>çš„<code>slot</code></li>
<li><code>Widget.canUpdate(child.widget, newWidget)</code>ï¼šäºŒè€…çš„<code>runtimeType</code>å’Œ<code>key</code>ä¸€æ ·ï¼Œå°±è°ƒç”¨<code>child.update(newWidget)</code>æ›´æ–°<code>child._widget</code>ï¼Œå¿…è¦æ—¶æ›´æ–°<code>child</code>çš„<code>slot</code></li>
<li>å¦åˆ™åˆ›å»ºæ–°çš„<code>element</code>å¹¶æ›¿ä»£</li>
</ul>
<p>åˆ°è¿™é‡Œè·Ÿ Center æ’å…¥åˆ° render tree çš„æ­¥éª¤ä¸€æ ·ï¼Œå°† Text æ’å…¥åˆ°äº† tree ä¸­ã€‚</p>
<h2> Text</h2>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸€ä¸‹ Text æ˜¯å¦‚ä½•è¢«åŠ å…¥ Widget Details Tree çš„ã€‚</p>
<p>å…¶ç»§æ‰¿å…³ç³»ï¼š<code>Text</code> â†’ <code>StatelessWidget</code> â†’ <code>Widget</code></p>
<p>Text æ˜¯ StatelessWidgetï¼Œä»–çš„å†…å®¹æ¯”è¾ƒç®€å•ï¼Œä¸»è¦çš„é€»è¾‘éƒ½åœ¨<code>build</code>æ–¹æ³•ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ ·ï¼Œä½œä¸º StatelessWidgetï¼Œä»–ä¹Ÿåˆ›å»ºäº†ä¸€ä¸ª<code>StatelessElement</code> ï¼š</p>
<p>å…¶ç»§æ‰¿å…³ç³»ï¼š<code>StatelessElement</code> â†’ <code>ComponentElement</code> â†’ <code>Element</code></p>
<p>æŒ‰ç…§ä¹‹å‰çš„åˆ†æï¼ŒText æ’å…¥åˆ° tree ä¸­æ‰§è¡Œçš„æ–¹æ³•åˆ†åˆ«æ˜¯<code>Text.createElement</code>å’Œ Text å¯¹åº”çš„ Elementâ€”â€”<code>StatelessElement.mount</code>æ–¹æ³•ï¼š</p>
<p>Text æ˜¯ StatelessWidget çš„å­ç±»ï¼Œä»–çš„ä¸»è¦é€»è¾‘éƒ½åœ¨ StatelessWidgetï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°å…¶<code>createElement</code>åˆ›å»ºçš„æ˜¯ StatelessElementï¼Œä¹Ÿå°±æ˜¯è¯´ Text æ’å…¥åˆ° Center è¿‡ç¨‹ä¸»è¦åœ¨ StatelessElement ä¸­ã€‚</p>
<p><code>StatelessElement.mount</code>æ–¹æ³•ä¸»è¦é€»è¾‘åœ¨ ComponentElement ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•é™¤äº†è°ƒç”¨ Element åŒåæ–¹æ³•å¤–ï¼Œè¿˜è°ƒç”¨äº†<code>ComponentElement._firstBuild()</code> â†’ <code>Element.rebuild()</code> â†’ <code>ComponentElement.performRebuild()</code> ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„ä¸»è¦æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>è°ƒç”¨<code>ComponentElement.build</code>æ–¹æ³•ï¼Œç”Ÿäº§ Widgetï¼ˆæœ¬ä¾‹ä¸­ï¼Œé—´æ¥è°ƒç”¨äº† Text çš„<code>build</code>æ–¹æ³•ï¼‰</li>
<li>è°ƒç”¨<code>ComponentElement.updateChild</code>æ–¹æ³•ï¼Œæ›´æ–°<code>child</code>ï¼ˆæœ€ç»ˆæ‰§è¡Œçš„æ˜¯ Element åŒåæ–¹æ³•é€»è¾‘ï¼‰</li>
</ul>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ Widget/Element/RenderObject tree å¦‚ä¸‹ï¼ˆç¬¬å››çº§ RichText ä¸‹é¢å†åˆ†æï¼‰ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸éš¾çœ‹å‡ºï¼Œåœ¨ä»å®šå¾€ä¸‹æ•°ç¬¬ä¸‰å±‚ä¹Ÿå°±æ˜¯ Text å¯¹åº”çš„è¿™ä¸€çº§ä¸­ï¼ŒRenderObject tree è¿™é‡Œå¹¶æ²¡æœ‰å¯¹åº”çš„å¯¹è±¡ï¼Œåœ¨ä¸Šé¢çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº† StatelessWidget æœ¬èº«å¹¶æ²¡æœ‰åˆ›å»º RenderObject çš„æ–¹æ³•ã€‚å®é™…ä¸Šï¼ŒWidget åˆ†ä¸ºå¤šä¸ªç§ç±»ï¼Œåªæœ‰ RenderObject ç±»åŠå…¶å­ç±»æ‰ä¼šåˆ›å»º RenderObjectï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter_run_app/heritance_of_widget.png" alt="Untitled" tabindex="0" loading="lazy"><figcaption>Untitled</figcaption></figure>
<h3> RichText</h3>
<p>ç»ˆäºåˆ°äº†æˆ‘ä»¬è¿™ä¸ª app çœŸæ­£åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹è¿™é‡Œäº†ï¼Œä¸Šé¢æˆ‘ä»¬åˆ†æåˆ°ï¼ŒText ä½œä¸º StatelessWidgetï¼Œæœ¬èº«å¹¶ä¸ä¼šäº§ç”Ÿå¯ä»¥åœ¨å±å¹•ä¸Šç»˜åˆ¶çš„ RenderObjectï¼Œè€Œæ˜¯é€šè¿‡ä»–çš„<code>build</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¯ä»¥äº§ç”Ÿ RenderObject çš„ Widgetï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ª Widget å°±æ˜¯ RichTextï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>RichText ç»§æ‰¿è‡ª<code>MultiChildRenderObjectWidget</code> ï¼Œå¦‚ä¸ŠèŠ‚åˆ†æçš„ï¼Œæ˜¯ä¸€ç§<code>RenderObjectWidget</code>ï¼Œå®ƒåˆ›å»ºäº†çœŸæ­£åœ¨å±å¹•ä¸Šæ¸²æŸ“çš„ RenderObjectâ€”â€”<code>RenderParagraph</code>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢è¯´é“ï¼ŒText æœ¬èº«ä½œä¸º StatelessWidget å¹¶ä¸äº§ç”Ÿ RenderObjectï¼Œé‚£ä¹ˆè¿™é‡Œçš„ RenderParagraph æ˜¯å¦‚ä½•æ‰¾åˆ°å¹¶æ’å…¥åˆ° rendering tree ä¸­çš„å‘¢ï¼Ÿ</p>
<p>å¸¦ç€è¿™ä¸ªç–‘é—®ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹<code>MultiChildRenderObjectWidget</code> åˆ›å»ºçš„<code>MultiChildRenderObjectElement</code> ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨ MultiChildRenderObjectElement çš„<code>mount</code>æ–¹æ³•ä¸­ï¼š</p>
<ul>
<li>è°ƒç”¨çˆ¶ç±»<code>mount</code>æ–¹æ³•</li>
<li>éå†äº†æ‰€æœ‰çš„<code>children</code>å°†å…¶æ’å…¥åˆ° MultiChildRenderObjectElement ä¸­ã€‚</li>
</ul>
<p>åœ¨å‰é¢çš„ Text æºç ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ç»™åªç»™<code>RichText.text</code>èµ‹å€¼äº†ï¼ŒRichText çš„<code>textSpan</code>å’Œ<code>children</code>éƒ½æ˜¯<code>null</code>ï¼Œæ‰€ä»¥åé¢å¯¹<code>children</code>çš„å¤„ç†åœ¨æœ¬ä¾‹ä¸­ä¸æ¶‰åŠï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>super.mount(parent, newSlot)</code>æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä¸»è¦æœ‰ 2 æ­¥ï¼š</p>
<ul>
<li>é€šè¿‡<code>widget.createRenderObject</code> åˆ›å»º<code>_renderObject</code>ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯ç”¨ RichText åˆ›å»ºäº† RenderParagraph</li>
<li>è°ƒç”¨<code>RenderObjectElement.attachRenderObject</code>æ–¹æ³•å°†<code>_renderObject</code>æ’å…¥åˆ° rendering tree</li>
</ul>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ attachRenderObject çš„å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>attachRenderObject</code>æ–¹æ³•ä¸­æ’å…¥çš„æ–¹å¼å¾ˆç®€å•ï¼šå…ˆåœ¨å½“å‰ tree ä¸­å‘ä¸Šæ‰¾åˆ°çˆ¶çº§ä¸­ç¦»å¾—æœ€è¿‘çš„ RenderObjectElementï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯ Center è¿™ä¸ª Widget å¯¹åº”çš„ SingleChildRenderObjectElementï¼ˆæ³¨æ„ä¸æ˜¯åˆ›å»º RichText çš„ Textï¼‰ï¼Œç„¶åè°ƒç”¨å…¶<code>insertRenderObjectChild</code>æ–¹æ³•å°†å½“å‰çš„ RenderParagraph æ’å…¥åˆ° rendering tree ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ SingleChildRenderObjectElement çš„<code>insertRenderObjectChild</code>æ–¹æ³•ä¸­å…ˆæ˜¯æŸ¥æ‰¾å½“å‰ Element æŒæœ‰çš„<code>renderObject</code>,ç„¶åå°†æˆ‘ä»¬ä¼ å…¥çš„ RichText çš„ RenderObjectâ€”â€”RenderParagraph èµ‹å€¼ç»™<code>renderObject.child</code>ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„æ‰€æœ‰ Widget åœ¨ Element çš„ç»„ç»‡ä¸‹ï¼Œå°†å¯¹äºçš„ RenderObject æ·»åŠ åˆ° Rendering Tree ä¸­ï¼Œä»–ä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå½“å±å¹•åˆ·æ–°çš„æ—¶å€™ï¼Œè¿™äº›å†…å®¹ä¾¿ç»˜åˆ¶åœ¨å±å¹•ä¸Šé¢ã€‚</p>
<h2> æ€»ç»“</h2>
<p>åœ¨<code>runApp</code>æ–¹æ³•ä¸­ï¼ŒWidgetsFlutterBinding ä½œä¸ºå°† flutter framework ç»‘å®šåˆ° flutter engine çš„ç²˜åˆå‰‚ï¼š</p>
<ul>
<li>
<p>åœ¨<code>ensureInitialized</code>æ–¹æ³•ä¸­åˆ›å»ºäº†<code>_pipelineOwner</code>ï¼ˆç®¡ç† rendering treeï¼‰ã€<code>renderView</code>å’Œ<code>buildOwner</code>ï¼ˆé€šè¿‡ç®¡ç† Element tree é—´æ¥ç®¡ç† widget treeï¼‰ï¼Œå¹¶å°†<code>renderView</code>è®¾ç½®ä¸º<code>_pipelineOwner</code>çš„æ ¹èŠ‚ç‚¹ã€‚</p>
</li>
<li>
<p>åœ¨<code>scheduleAttachRootWidget</code>æ–¹æ³•ä¸­ï¼Œä¸º<code>renderView</code>åˆ›å»ºå¹¶ç»‘å®šäº†å¯¹åº”çš„ Widgetï¼ˆRenderObjectToWidgetAdapterï¼‰å’Œ Elementï¼ˆRenderObjectToWidgetElementï¼‰ã€‚ç„¶åé€šè¿‡<code>RenderObjectToWidgetElement.mount</code>æ–¹æ³•ï¼Œå°†ä¹‹å‰åˆ›å»ºçš„<code>buildOwner</code>ä¸è‡ªå·±ç»‘å®šã€‚</p>
<p>å¹¶ä¸”å°†æˆ‘ä»¬åœ¨<code>runApp</code>ä¼ å…¥çš„ Widget<code>rootWidget</code>ï¼ˆä¹Ÿå°±æ˜¯æœ¬ä¾‹ä¸­çš„ Center Widgetï¼‰å¯¹åº”çš„ Element æ·»åŠ ä¸º RenderObjectToWidgetElement çš„å­èŠ‚ç‚¹ã€‚å¹¶ä¾æ­¤å°† Textã€Text å†…éƒ¨çš„ RichText ç­‰å¯¹åº”çš„ Element éƒ½åŠ å…¥åˆ° Element tree ä¸­ï¼Œç›´åˆ°éå†å®Œæ•´ä¸ª Widget treeã€‚</p>
</li>
<li>
<p>åœ¨<code>scheduleWarmUpFrame</code>æ–¹æ³•ä¸­å®‰æ’åœ¨ä¸‹ä¸€æ¬¡å±å¹•åˆ·æ–°çš„æ—¶å€™å°†æˆ‘ä»¬çš„å†…å®¹å±•ç¤ºåœ¨å±å¹•ä¸Šé¢ã€‚</p>
</li>
</ul>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬è¿™ä¸ªâ€œæœ€â€ç®€å•çš„ Flutter App çš„ç»“æ„ç¤ºæ„ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter_run_app/flutter_run_app_widget_elelemt_renderobject_tree.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://api.flutter.dev/" target="_blank" rel="noopener noreferrer">Flutter - Dart API docs</a></p>
<p><a href="https://www.youtube.com/watch?v=PnWxW21vDak" target="_blank" rel="noopener noreferrer">Flutter, what are Widgets, RenderObjects and Elements? - Norbert Kozsir | Flutter Europe</a></p>
<p><a href="https://www.youtube.com/watch?v=FU2Eeizo95o&amp;ab_channel=RetroPortalStudio" target="_blank" rel="noopener noreferrer">Flutter Widgets Explained | Understand How Flutter Works!</a></p>
<p><a href="http://zxfcumtcs.github.io/2020/12/05/deepinto-flutter-pipelineowner/" target="_blank" rel="noopener noreferrer">æ·±å…¥æµ…å‡º Flutter Framework ä¹‹ PipelineOwner</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/flutter_run_app/flutter_run_app_hello_center_text.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter UI ç»˜åˆ¶ä¸ InheritedWidget è§£æ</title>
      <link>https://jixiaoyong.github.io/blog/posts/4c220635.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/4c220635.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter UI ç»˜åˆ¶ä¸ InheritedWidget è§£æ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 15 May 2022 11:02:13 GMT</pubDate>
      <content:encoded><![CDATA[<h2> Flutter UI ç»˜åˆ¶ä¸ InheritedWidget è§£æ</h2>
<p>Flutter çš„<code>Widget</code>åˆ†ä¸º<code>StatefulWidget</code>å’Œ<code>StatelessWidget</code> ï¼ŒäºŒè€…éƒ½ç»§æ‰¿è‡ª<code>Widget</code>ã€‚</p>
<p>æ­¤å¤–è¿˜æœ‰ä¸€ç§ç”¨æ¥ä¼ è¾“æ•°æ®çš„<code>Widget</code>â€”â€”<code>InheritedWidget</code>ï¼Œä¸ä¸Šè¿°ä¸¤è€…ä¸å¤ªä¸€æ ·çš„æ˜¯ï¼Œä»–çš„ç»§æ‰¿å…³ç³»æ˜¯ï¼š<code>InheritedWidget</code>â†’<code>ProxyWidget</code> â†’<code>Widget</code> ã€‚</p>
<p>Flutter çš„æ¸²æŸ“æµç¨‹å¦‚å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter_widget_element_renderobject_relationship.png" alt="flutter_widget_element_renderobject_relationship" tabindex="0" loading="lazy"><figcaption>flutter_widget_element_renderobject_relationship</figcaption></figure>
<p>å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œ <code>Widget</code>æ˜¯é…ç½®ä¿¡æ¯ï¼Œ<code>Element</code>ä»£è¡¨åœ¨æ ‘ä¸­è¯¦ç»†çš„ä½ç½®ï¼Œè€Œ<code>RenderObject</code>åˆ™æ˜¯å®é™…æ¸²æŸ“çš„å¯¹è±¡ã€‚</p>
<p><code>StatelessWidget</code>å’Œ<code>StatefulWidget</code>åœ¨åˆ›å»ºä¹‹åå°±ä¸ä¼šå†å˜åŒ–ï¼Œè€Œ<code>StatefulWidget</code>å› ä¸ºæœ‰<code>State</code>ï¼Œæ‰€ä»¥å¯ä»¥åœ¨<code>State</code>è°ƒç”¨<code>setState()</code>æ–¹æ³•ä¹‹åï¼Œé‡æ–°æ‰§è¡Œ<code>State</code>çš„<code>build()</code>æ–¹æ³•ï¼Œä»è€Œæ›´æ–°ç•Œé¢ã€‚</p>
<p>å¦‚æœ<code>Widget</code>æ˜¯<code>const</code>çš„ï¼Œé‚£ä¹ˆä»–å°±ä¸ä¼šè¢«<code>rebuild</code>ã€‚</p>
<h2> Widget Rebuild çš„è¿‡ç¨‹</h2>
<p>ä»¥ StatefulWidget ä¸ºä¾‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter_render_flow_chart.png" alt="flutter_render_flow_chart" tabindex="0" loading="lazy"><figcaption>flutter_render_flow_chart</figcaption></figure>
<ol>
<li>
<p>è°ƒç”¨<code>setState()</code>æ–¹æ³•ï¼Œä¼šè°ƒç”¨å¯¹åº”çš„<code>Element</code>çš„<code>markNeedsBuild()</code> æ–¹æ³•ï¼Œé€šè¿‡<code>BuildOwner</code>çš„<code>scheduleBuildFor(Element element)</code> æ–¹æ³•å°†å½“å‰<code>Element</code>æ ‡è®°ä¸º<code>dirty</code>ï¼Œä»¥ä¾¿åœ¨ä¸‹æ¬¡å±å¹•åˆ·æ–°æ—¶å®‰æ’<code>rebuilt</code> ã€‚</p>
</li>
<li>
<p>ä¸‹ä¸€å¸§å±å¹•åˆ·æ–°ï¼Œè°ƒç”¨<code>BuildOwner</code>çš„<code>buildScope(Element context, [ VoidCallback? callback ])</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šéå†<code>_dirtyElements</code> ä¸­æ‰€æœ‰<code>dirty</code>çš„<code>element</code>æ‰§è¡Œ<code>element.rebuild();</code> æ–¹æ³•ï¼Œåœ¨å…¶å†…éƒ¨è°ƒç”¨äº†<code>Element</code>çš„<code>performRebuild()</code> æ–¹æ³•ã€‚</p>
</li>
<li>
<p><code>Element</code>çš„<code>performRebuild()</code> æ–¹æ³•å› å„ä¸ª<code>Element</code>çš„å®ç°è€Œå¼‚ï¼š</p>
<ol>
<li>
<p><code>StatelessElement</code> ã€<code>InheritedElement</code>ï¼šä¸çˆ¶ç±»<code>ComponentElement</code> ä¿æŒä¸€è‡´</p>
</li>
<li>
<p><code>StatefulElement</code> ï¼šåˆ¤æ–­æœ‰éœ€è¦æ—¶è°ƒç”¨<code>state.didChangeDependencies();</code> ï¼Œå…¶ä½™ä¸çˆ¶ç±»<code>ComponentElement</code> ä¿æŒä¸€è‡´</p>
</li>
</ol>
</li>
</ol>
<p>è€Œ<code>ComponentElement</code> çš„<code>performRebuild()</code> ä¸»è¦åšäº† 2 ä»¶äº‹ï¼š<br>
ï¼ˆ1ï¼‰<code>built = build();</code> ï¼›ï¼ˆ2ï¼‰<code>_child = updateChild(_child, built, slot);</code></p>
<p>åœ¨è¿™å…¶ä¸­<code>build()</code>ï¼š</p>
<ol>
<li><code>StatelessElement</code>:<code>build() =&gt; widget.build(this);</code></li>
<li><code>StatefulElement</code> : <code>build() =&gt; state.build(this);</code></li>
<li><code>InheritedElement</code> :<code>build() =&gt; widget.child;</code></li>
</ol>
<p><code>updateChild</code> ä¼šåˆ¤æ–­ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>newWidget == null</th>
<th>newWidget != null</th>
</tr>
</thead>
<tbody>
<tr>
<td>child == null</td>
<td>return null</td>
<td>return new Element</td>
</tr>
<tr>
<td>child != null</td>
<td>remove old child, return null</td>
<td>Old child updated if possible, returns child or new Element</td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­ï¼Œ<code>old child updated</code> çš„æ—¶å€™è°ƒç”¨çš„æ˜¯<code>child.update(newWidget);</code> æ–¹æ³•ä¼šè§¦å‘<code>Widget</code>çš„<code>rebuild()</code> ã€‚</p>
<p>è¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡ Rebuildã€‚</p>
<h2> InheritedWidget çš„ Rebuild è¿‡ç¨‹</h2>
<p><code>InheritedWidget</code>æ˜¯æŒæœ‰çŠ¶æ€çš„<code>Widget</code>ï¼Œä»–çš„å­<code>Widget</code>å¯ä»¥é€šè¿‡ä»–æ¥è·å–è¿™äº›çŠ¶æ€ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>InheritedWidget</code>æŒæœ‰çš„çŠ¶æ€æ˜¯<code>final</code>çš„ï¼Œå¦‚æœè¦æ›´æ–°çŠ¶æ€ï¼Œå°±éœ€è¦åœ¨å…¶å¤–éƒ¨åŒ…è£¹ä¸€ä¸ª<code>StatefulWidget</code>ï¼Œé€šè¿‡<code>StatefulWidget</code>çš„<code>State.setState()</code>æ¥è§¦å‘<code>InheritedWidget</code>é‡å»ºï¼ˆå®é™…ä¸Š<code>InheritedElement</code>æ²¡æœ‰é‡æ–°åˆ›å»ºï¼‰ï¼Œä»è€Œæ›´æ–°é‚£äº›ä¾èµ–äº†<code>InheritedWidget</code>çš„å­<code>Widget</code>ã€‚</p>
<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªè¢«<code>StatefulWidget</code>åŒ…è£¹çš„<code>InheritedWidget</code>åœ¨<code>setSate(){}</code>æ–¹æ³•æ‰§è¡Œåçš„æµç¨‹å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter_render_flow_chart_with_inheritedwidget.png" alt="flutter_render_flow_chart_with_inheritedwidget" tabindex="0" loading="lazy"><figcaption>flutter_render_flow_chart_with_inheritedwidget</figcaption></figure>
<p>å½“å¤–å±‚<code>StatefulWidget</code>çš„<code>Element</code>æ‰§è¡Œåˆ°<code>updateChild(child,build,solt);</code>ä¼šè°ƒç”¨<code>InheritedElement</code>çš„<code>update()</code> æ–¹æ³•ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨<code>updated(oldWidget)</code> æ–¹æ³•ï¼Œåœ¨å†…éƒ¨é€šè¿‡<code>notifyClients(oldWidget);</code> æ–¹æ³•ï¼Œé€šçŸ¥åŸå…ˆçš„<code>InheritedElement</code>çš„<code>_dependents</code> ï¼Œå°†å…¶æ ‡è®°ä¸º<code>dirty</code>ï¼Œå‡†å¤‡<code>rebuild</code>ã€‚</p>
<p>åœ¨æ­¤ä¹‹åï¼Œ<code>update()</code>æ–¹æ³•è¿˜ä¼šå°†å½“å‰<code>Element</code>æ ‡è®°ä¸º<code>dirty</code>ï¼Œé€šè¿‡è°ƒç”¨<code>rebuild();</code> æ‰§è¡Œ<code>performRebuild();</code></p>
<p>åœ¨<code>performRebuild()</code>æ–¹æ³•ä¸­ï¼š</p>
<ul>
<li><code>built = build();</code> ä¸­çš„<code>build</code>æ–¹æ³•ï¼š<code>build() =&gt; widget.child;</code> å®é™…ä¸Šå–äº†<code>widget</code>çš„<code>child</code>ã€‚</li>
<li>ç„¶åæ‰§è¡Œ<code>_child = updateChild(_child, built, slot);</code> è¿™ä¸ªè¿‡ç¨‹ä¸æ™®é€š<code>Widget</code>ä¸€è‡´ã€‚</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>updateChild</code> ä¸­ï¼Œå¦‚æœå­<code>Widget</code>ä¸æ˜¯<code>const</code> ï¼ˆæˆ–è€…è¢«<code>InheritedWidget</code>å¤–å±‚çš„<code>widget</code>/<code>state</code>ä¹‹ç±»çš„æŒæœ‰ï¼‰å°±ä¼šè¢«è®¤ä¸º<code>built!=_child</code> ä»è€Œå¯¼è‡´<code>InheritedWidget</code>çš„å­<code>Widget</code>é‡å»ºã€‚å¯¼è‡´çš„ç»“æœå°±æ˜¯ï¼šè™½ç„¶<code>InheritedWidget</code>çš„ç¡®åªæ ‡è®°äº†é‚£äº›ä¾èµ–äº†ä»–çš„<code>Widget</code>ï¼Œä½†æ˜¯ç”±äºç›´æ¥å­<code>Widget</code>è¦é‡å»ºï¼Œæ‰€ä»¥è¿˜æ˜¯æ‰€æœ‰çš„<code>éconst Widget</code>éƒ½é‡å»ºäº†ã€‚</p>
<h3> InheritedWidget çš„è·å–æ–¹å¼</h3>
<ul>
<li><code>T? dependOnInheritedWidgetOfExactType&lt;T extends InheritedWidget&gt;({ Object? aspect });</code> è·å–æŒ‡å®šç±»å‹çš„<code>InheritedWidget</code>ï¼Œå¹¶ä¸”å°†è‡ªå·±æ³¨å†Œåˆ°æ­¤<code>Widget</code>ï¼Œä»¥ä¾¿å½“è¯¥<code>Widget</code>å˜åŒ–çš„æ—¶å€™ï¼Œè‡ªå·±ä¹Ÿèƒ½<code>rebuilt</code> ã€‚å¤æ‚åº¦<code>O(1)</code> ã€‚</li>
<li><code>T? findAncestorWidgetOfExactType&lt;T extends Widget&gt;();</code> åªè·å–æŒ‡å®šç±»å‹çš„<code>Widget</code> ï¼ŒåŒ…æ‹¬<code>InheritedWidget</code> ï¼Œä»…è·å–è¯¥<code>Widget</code>æ‰§è¡Œä¸€äº›æ“ä½œï¼Œé€šå¸¸ç”¨åœ¨<code>interaction event handlers</code> ä¹‹ç±»ä¸­ã€‚å¤æ‚åº¦<code>(O(N)</code> ã€‚</li>
</ul>
<h3> ä»£ç ç¤ºä¾‹</h3>
<p>æ ¹æ®ä¸Šè¿°ç†è®ºï¼Œåˆ›å»ºä¸€ä¸ª<code>InheritedWidget</code>æ¥ä¼ é€’æ•°æ®ï¼š</p>
<p>1ã€<code>AppColor.dart</code> ä¸€ä¸ªæŒæœ‰<code>color</code> çš„<code>InheritedWidget</code>ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å®šä¹‰ä¸€äº›ç±»ï¼Œä½¿ç”¨æˆ–æœªä½¿ç”¨åˆ°<code>InheritedWidget</code>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€æ¥ä¸‹æ¥å®ç°ä¸€ç§åŸºç¡€çš„ä½¿ç”¨<code>InheritedWidget</code>çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ä¼šåœ¨<code>InheritedWidget</code>æ›´æ–°çš„æ—¶å€™ï¼Œrebuilt <code>InheritedWidget</code>ä¸‹é¢çš„æ‰€æœ‰å­ç±»ï¼Œæ— è®ºä»–ä»¬æ˜¯å¦ä½¿ç”¨åˆ°äº†<code>InheritedWidget</code>ï¼ˆåŸå› æ˜¯ä¸Šé¢è¯´åˆ°çš„ Flutter rebuild çš„æœºåˆ¶å¯¼è‡´çš„ï¼Œå®é™…ä¸Š<code>InheritedWidget</code>æœ¬èº«åªæ ‡è®°äº†<code>ColorfulContainer</code>ä¸º<code>dirty</code>ï¼‰ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€æ¥ä¸‹æ¥å®ç°ä¸€ç§ä½¿ç”¨<code>InheritedWidget</code>çš„æ–¹æ³•ï¼Œå½“<code>InheritedWidget</code>æ›´æ–°çš„æ—¶å€™ï¼Œåªä¼šæ›´æ–°é‚£äº›åœ¨<code>InheritedWidget</code>è¿™é‡Œæ³¨å†Œä¾èµ–äº†çš„<code>Widget</code>ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://petercoding.com/flutter/2021/07/04/using-inherited-widget-in-flutter/" target="_blank" rel="noopener noreferrer">Using Inherited Widget In Flutter</a></p>
<p><a href="https://www.cnblogs.com/lxlx1798/p/11190230.html?share_token=1bd95081-524b-4a3b-af65-686ab5c88ce4" target="_blank" rel="noopener noreferrer">ã€Flutter å­¦ä¹ ã€‘ä¹‹ Widget æ•°æ®å…±äº«ä¹‹ InheritedWidget æ¢é£å®‡</a></p>
<p><a href="https://stackoverflow.com/questions/54494398/inheritedwidget-confusion" target="_blank" rel="noopener noreferrer">InheritedWidget confusion</a></p>
<p><a href="https://medium.com/flutter/managing-flutter-application-state-with-inheritedwidgets-1140452befe1" target="_blank" rel="noopener noreferrer">Managing Flutter Application State With InheritedWidgets</a></p>
<p><a href="https://stackoverflow.com/questions/53492705/does-using-const-in-the-widget-tree-improve-performance" target="_blank" rel="noopener noreferrer">Does using const in the widget tree improve performance?</a></p>
<p><a href="https://api.flutter-io.cn/flutter/widgets/StatefulWidget-class.html" target="_blank" rel="noopener noreferrer">StatefulWidget</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/flutter_widget_element_renderobject_relationship.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter Expanded VS Flexible</title>
      <link>https://jixiaoyong.github.io/blog/posts/767a594.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/767a594.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter Expanded VS Flexible</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 11 May 2022 03:49:12 GMT</pubDate>
      <content:encoded><![CDATA[<p>åœ¨ Flutter ä¸­ï¼Œå½“éœ€è¦å¡«å……å®¹å™¨ï¼ˆ<code>Row</code>, <code>Column</code>, or <code>Flex</code>ï¼‰å‰©ä½™ç©ºé—´çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨<code>Expanded</code>æˆ–<code>Flexible</code>ï¼Œæœ¬æ–‡å¯¹è¿™äºŒè€…çš„å·®å¼‚åšä¸€åˆ†æã€‚</p>
<h2> åˆ†æ</h2>
<p><code>Expanded</code> æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œä»–ä¼šå¼ºåˆ¶ child æ”¹å˜å¤§å°ï¼Œå æ®å®¹å™¨çš„å‰©ä½™ç©ºé—´ï¼Œå¦‚æœæœ‰å¤šä¸ª<code>Expanded</code>çš„è¯ï¼Œä¼šæŒ‰ç…§ä»–ä»¬çš„ flex å æ¯”æ¥åˆ†é…æ¯ä¸ª child å¯ä»¥å æ®çš„ç©ºé—´å¤§å°ã€‚</p>
<p><code>Flexible</code> ç¨å¾®ç‰¹æ®Šä¸€äº›ï¼Œæœ‰æ—¶å€™çœ‹èµ·æ¥ä¼¼ä¹ä»–çš„ child å æ®çš„å¤§å°æ—¢ä¸å…¨æ˜¯çˆ¶å¸ƒå±€çš„å‰©ä½™ç©ºé—´ï¼Œä¹Ÿä¸å…¨æ˜¯åˆšåˆšåŒ…è£¹ child å†…å®¹çš„å¤§å°ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>Flexible</code>çš„æºç ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»–ä½¿ç”¨çš„<code>fit</code>æ¨¡å¼æ˜¯<code>FlexFit.loose</code>ï¼ŒæŸ¥é˜…æ–‡æ¡£å®šä¹‰å¯çŸ¥ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Flexible</code>çš„ child æœ€å¤§å¯ä»¥æ˜¯çˆ¶å®¹å™¨åˆ†é…ç»™<code>Flexible</code>çš„å¤§å°ï¼ˆå‡è®¾ä¸º<code>MaxSzie</code>ï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœ child çš„å¤§å°æ¯”è¿™ä¸ª<code>MaxSzie</code>è¦å°çš„è¯ï¼Œé‚£ä¹ˆå…è®¸ child æŒ‰ç…§è‡ªå·±çš„å¤§å°æ¥æ˜¾ç¤ºã€‚</p>
<p>è€Œå¦‚æœ<code>Flexible</code>çš„<code>fit</code>æ˜¯<code>FlexFit.tight</code>çš„è¯ï¼Œå°±ä¼šå¼ºåˆ¶ child å¤§å°ä¸º<code>MaxSzie</code>ï¼Œæ•ˆæœå’Œ<code>Expanded</code>ä¸€è‡´ï¼Œå®é™…ä¸Š<code>Expanded</code>å°±æ˜¯<code>FlexFit.tight</code>æ¨¡å¼çš„<code>Flexible</code>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºä¸Šè¿°çš„ç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢çš„ä»£ç ä¸­å¾—åˆ°è¯å®ï¼š</p>
<figure><img src="https://s3.bmp.ovh/imgs/2022/05/11/8559625d0d49ae28.png" alt="Untitled" tabindex="0" loading="lazy"><figcaption>Untitled</figcaption></figure>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æ€»ç»“</h2>
<p><code>Expanded</code>å’Œ<code>Flexible</code>é»˜è®¤æƒ…å†µä¸‹éƒ½ä¼šæŒ‰ç…§<code>flex</code>å æ®çˆ¶å®¹å™¨å‰©ä½™çš„å¯ç”¨ç©ºé—´ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œ<code>Expanded</code>ä¼šå¼ºåˆ¶ child æ”¹å˜å¤§å°ä¸ºçˆ¶å®¹å™¨åˆ†é…çš„å¤§å°ï¼Œè€Œ<code>Flexible</code>åˆ™ä¼šå‘Šè¯‰ childï¼Œ<strong>æœ€å¤§åªèƒ½æ˜¯çˆ¶å®¹å™¨åˆ†é…çš„å¤§å°ï¼Œè¦æ˜¯ child æƒ³è¦å°ä¸€äº›çš„è¯ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§ child çš„å¤§å°æ˜¾ç¤º</strong>ã€‚</p>
<p>å¦‚æœæ”¹å˜<code>Flexible</code>çš„<code>fit</code>ä¸º<code>FlexFit.tight</code>çš„è¯ï¼Œ<code>Expanded</code>å’Œ<code>Flexible</code>æ²¡æœ‰å·®åˆ«ã€‚</p>
]]></content:encoded>
      <enclosure url="https://s3.bmp.ovh/imgs/2022/05/11/8559625d0d49ae28.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter Widget ç®€å•å…¥é—¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/e35c106d.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/e35c106d.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter Widget ç®€å•å…¥é—¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 21 Oct 2018 14:26:41 GMT</pubDate>
      <content:encoded><![CDATA[<p>Flutter æ˜¯ Google æå‡ºçš„è·¨å¹³å°å¼€å‘æ¡†æ¶ï¼Œä½¿ç”¨ Dart è¯­è¨€ï¼Œæ”¯æŒ Androidï¼ŒIOS ç³»ç»Ÿã€‚Flutter ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µå³æ˜¯â€”â€”<em>â€œä¸‡ç‰©çš†æ§ä»¶ï¼ˆWidgetï¼‰â€</em>ï¼Œåƒ<code>Padding</code>,<code>Center</code>ç­‰éƒ½æ˜¯ Widgetã€‚</p>
<p>Widget å’Œ Android ä¸­çš„ View å¾ˆç›¸ä¼¼ä½†åˆæœ‰ä¸åŒï¼ŒWidget ä¸€æ—¦ç”Ÿæˆä¾¿â€œä¸€æˆä¸å˜â€ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å› ä¸º Widget æ›´æ”¹æˆ–è€… state æ›´æ–°è€Œè¢«é‡æ–°åˆ›å»ºï¼ˆFlutterâ€™s framework creates a new tree of widget instances.ï¼‰ï¼Œè€Œ View åˆ™åªä¼šè¢«<code>drawn</code>ä¸€æ¬¡ï¼Œç›´åˆ°<code>invalidate</code>æ–¹æ³•è¢«è°ƒç”¨ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦è®°å½•ä¸€ä¸‹ Flutter ä¸­ä¸¤ä¸ªé‡è¦çš„æ§ä»¶ï¼šStatelessWidget å’Œ StatefulWidgetï¼Œä»¥åŠ Flutter å¼€å‘çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚</p>
<h2> Flutter åŸºç¡€çŸ¥è¯†</h2>
<p>Flutter ä»¥ Dart å¼€å‘ï¼Œå…¶å·¥ç¨‹åŸºæœ¬çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<ul>
<li>android</li>
<li>ios</li>
<li>lib
<ul>
<li>main.dart</li>
</ul>
</li>
<li>pubspec.yaml //Flutter å·¥ç¨‹çš„é…ç½®ä¿¡æ¯</li>
</ul>
<p>Flutter é¡¹ç›®å¯åŠ¨åä¼šé¦–å…ˆåŠ è½½<code>/lib/main.dart</code>ä¸­çš„<code>main()</code>æ–¹æ³•ã€‚<br>
ä¸€ä¸ªæ ‡å‡†çš„ material app çš„ main.dart å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> StatelessWidget &amp; StatefulWidget</h2>
<p>StatelessWidget å’Œ StateFulWidget åŒºåˆ«åœ¨äºï¼šå‰è€…ä¸€æ—¦åˆ›å»ºï¼ŒçŠ¶æ€ä¾¿ä¸ä¼šå†æ›´æ”¹ï¼Œè€Œåè€…åˆ™å¯ä»¥åŠ¨æ€æ”¹å˜ State ä»è€Œä½¿ flutter æ”¹å˜å…¶çŠ¶æ€ã€‚ä½†æ˜¯ä¸¤è€…éƒ½ä¼šåœ¨æ¯ä¸€å¸§è¢« rebuildã€‚</p>
<h3> StatelessWidget</h3>
<blockquote>
<p>A <code>StatelessWidget</code> is just what it sounds likeâ€”a widget with no state information.</p>
</blockquote>
<p>StatelessWidget ä¸€æ—¦åˆ›å»ºä¾¿ä¸ä¼šæ›´æ”¹ï¼Œå…¶çŠ¶æ€åªå’Œæ„é€ å‡½æ•°ä¸­çš„å‚æ•°æœ‰å…³ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª StatelessWidget ç¤ºä¾‹ï¼Œä¸€èˆ¬åªéœ€è¦é‡å†™å…¶ build() æ–¹æ³•ï¼Œè¿”å›è¦å±•ç¤ºçš„æ§ä»¶å³å¯ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> StatefulWidget</h3>
<blockquote>
<p><code>StatefulWidget</code> has a <code>State</code> object that stores state data across frames and restores it.</p>
</blockquote>
<p>StatefulWidget å¯ä»¥é€šè¿‡åŠ¨æ€æ›´æ”¹å…¶åŒ…å«çš„ Stateï¼Œä»è€Œä½¿ flutter åœ¨ä¸‹ä¸€æ¬¡æ›´æ–°ç•Œé¢æ—¶ä¾æ® state æ›´æ–° StateWidgetï¼Œ<em>æœ¬è´¨ä¸Šè¿˜æ˜¯æ›´æ–°äº†ä¸€ä¸ªå¯ä»¥åœ¨å¤šå¸§ä¹‹é—´å­˜æ´»çš„ Stateï¼Œåœ¨ä¸‹ä¸€å¸§æ›´æ–°æ§ä»¶</em>ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª StatefulWidget çš„ç¤ºä¾‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥æ³¨æ„åˆ° StatefulWidget é‡å†™äº†<code>createState()</code>ï¼Œè€Œè¯¥æ–¹æ³•è¿”å›äº†è‡ªå®šä¹‰çš„<code>ProductManagerState</code>ç±»å¯¹è±¡ï¼Œåœ¨è¯¥ç±»ä¸­<code>build()</code>æ–¹æ³•å®ç°å’Œ StatelessWidget ä¸­çš„æ–¹æ³•ç±»ä¼¼ï¼Œè¿”å›è¦å±•ç¤ºçš„é¡µé¢æ§ä»¶ã€‚</p>
<p>ä¸¤è€…çš„ä¸åŒä¹‹å¤„åœ¨äºï¼ŒStatefulWidget ä¸­å¯ä»¥è°ƒç”¨<code>setState()</code>ï¼Œæ›´æ”¹å…¶ç›¸åº”çš„<code>state</code>ï¼Œä»¥ä¾¿å‘Šè¯‰ flutter åœ¨ä¸‹ä¸€æ¬¡ rebuild çš„æ—¶å€™æ›´æ–° UIã€‚</p>
<p>StatelessWidget è¦æƒ³å®ç°åŠ¨æ€æ›´æ–°å…¶å†…å®¹ï¼Œå¯ä»¥åœ¨å…¶å¤–éƒ¨åŒ…è£¹ä¸€å±‚ StatefulWidgetï¼Œé€šè¿‡ StatefulWidget æ›´æ”¹çŠ¶æ€ stateï¼Œå°†æ›´æ”¹åçš„ state ä¼ ç»™ StatelessWidgetï¼Œä»è€Œé—´æ¥æ›´æ–°äº† StatelessWidget çš„çŠ¶æ€ã€‚</p>
<p>å¯ä»¥é€šè¿‡å¯¹è¯¥æ–¹æ³•å°±è¡ŒåŒ…è£…ï¼Œä½¿å¾—åœ¨ StatelessWidget æ§ä»¶ä¸­è°ƒç”¨ StatefulWidget æ§ä»¶çš„<code>setState()</code>æ–¹æ³•ï¼Œè¾¾åˆ°åˆ·æ–°é¡µé¢çš„æ•ˆæœï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ä¸ Android çš„å¯¹æ¯”</h2>
<h3> Intent</h3>
<p>Android çš„ Intent æœ‰ä¸¤ä¸ªä¸»è¦ä½œç”¨ï¼š</p>
<ul>
<li>Activity é—´è·³è½¬</li>
<li>ç»„ä»¶é—´ä¼ é€’æ•°æ®</li>
</ul>
<p>Flutter å¯¹æ­¤ç›¸åº”ï¼š</p>
<ul>
<li>ä½¿ç”¨ Navigator å’Œ<code>Route</code>s å®ç°åœ¨åŒä¸€ä¸ªâ€œActivityâ€ä¸­ä¸åŒçš„ç•Œé¢é—´ï¼ˆ â€œscreenâ€orâ€œpageâ€ï¼‰è·³è½¬ï¼ˆpushï¼Œpopï¼‰ï¼ŒNavigator ç±»ä¼¼äº Android ä¸­çš„ Activity æ ˆã€‚</li>
<li>é€šè¿‡ Android åŸç”Ÿ Intent ç»„ä»¶è·å–åˆ°å…¶ä»– App ä¼ æ¥çš„æ•°æ®ï¼Œç„¶åä¸­é€šè¿‡ä¸‹é¢çš„æ–¹æ³•å®ç° Android å’Œ Flutter äº¤äº’ï¼š</li>
</ul>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> çº¿ç¨‹</h3>
<p>Flutter æ˜¯å•çº¿ç¨‹çš„ï¼Œä»–çš„çº¿ç¨‹å’Œ Android çš„ UI çº¿ç¨‹ç»‘å®šï¼Œåœ¨è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼ŒIO æ“ä½œç­‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>sync/await</code> åœ¨æ‰§è¡Œå®Œè€—æ—¶æ“ä½œåï¼Œå†å»æ›´æ–° state åˆ·æ–° UIã€‚</p>
<blockquote>
<p>Since Flutter is single threaded and runs an event loop (like Node.js), you donâ€™t have to worry about thread management or spawning background threads. If youâ€™re doing I/O-bound work, such as disk access or a network call, then you can safely use async/await and youâ€™re all set.</p>
</blockquote>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œå¦‚æœæœ‰ç‰¹åˆ«é¢‘ç¹çš„ cpu è®¡ç®—ä»¥è‡³äºèƒ½å¯¼è‡´ UI æŒ‚èµ·ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<code>Isolate</code>s åˆ©ç”¨ CPU å¤šæ ¸å¿ƒå¤„ç†ä»»åŠ¡ï¼Œä½†æ˜¯è¿™æ ·å°±ä¸èƒ½å’Œä¸»çº¿ç¨‹å…±äº«æ•°æ®ï¼Œé€šè¿‡<code>ReceivePort</code>ï¼Œ<code>SendPort</code>ç­‰ä¼ é€’æ•°æ®ã€‚</p>
<blockquote>
<p>Isolates(éš”ç¦») are separate execution threads that do not share any memory with the main execution memory heap. This means you canâ€™t access variables from the main thread, or update your UI by calling <code>setState()</code>. Unlike Android threads, Isolates are true to their name, and cannot share memory (in the form of static fields, for example).</p>
</blockquote>
<h3> æœ¬åœ°èµ„æº</h3>
<p>æˆªæ­¢ Flutter beta 2 ä»ç„¶ä¸èƒ½ç›´æ¥è®¿é—® Android assets æˆ–è€…å…¶ä»–æœ¬åœ°èµ„æºï¼Œä½†æ˜¯ Android å¯ä»¥è®¿é—® flutter çš„ assets èµ„æºï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é€šè¿‡ Channelï¼Œflutter å¯ä»¥é—´æ¥è®¿é—® Android èµ„æºï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<blockquote>
<p>ä¸»è¦æ˜¯é€šè¿‡ Channel å®Œæˆï¼Œå¯ä»¥ç§°ä¹‹ä¸ºéš§é“ã€‚ä¸»è¦æ˜¯ MethodChannel å’Œ MessageChannel ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯è°ƒç”¨æ–¹æ³•ï¼Œç¬¬äºŒç§æ˜¯ä¼ é€’ä¿¡æ¯ã€‚é¦–å…ˆé€šä¿¡çš„åŒæ–¹æ˜¯ Flutter å’Œæœ¬åœ°æ“ä½œç³»ç»Ÿæˆ–è€…åº”ç”¨ï¼Œè€Œä¸”æ–¹æ³•çš„è°ƒç”¨å’Œæ¶ˆæ¯çš„æ–¹æ³•å¯ä»¥ä»ä»»ä½•ä¸€æ–¹å‘èµ·ï¼Œç±»ä¼¼ RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ã€‚</p>
<p>ä½œè€…ï¼šé»„é©¬</p>
<p>é“¾æ¥ï¼šæ˜é‡‘ <a href="https://juejin.im/post/5b35a75e51882574ea3a25e3" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5b35a75e51882574ea3a25e3</a></p>
<p>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote>
<h3> ç”Ÿå‘½å‘¨æœŸ</h3>
<p>Flutter ç”Ÿå‘½å‘¨æœŸæ²¡æœ‰ Android ä¸­é‚£ä¹ˆâ€œé‡è¦â€ï¼Œå¯ä»¥é‡å†™ <code>didChangeAppLifecycleState()</code> ç›‘å¬ã€‚</p>
<ul>
<li><code>inactive</code> â€” åº”ç”¨å¤„äºéæ´»åŠ¨çŠ¶æ€ï¼Œä¸æ¥å—è¾“å…¥ã€‚iOS</li>
<li><code>paused</code> â€” åº”ç”¨åœ¨åå°è¿è¡Œï¼Œä¸å¯è§ï¼Œä¸æ¥å—è¾“å…¥ã€‚ç±»ä¼¼ Android çš„<code>onPause()</code></li>
<li><code>resumed</code> â€” åº”ç”¨å¯è§ï¼Œå¹¶æ¥å—è¾“å…¥ã€‚ç±»ä¼¼ Android çš„<code>onPostResume()</code></li>
<li><code>suspending</code> â€” åº”ç”¨è¯·æ±‚æš‚åœã€‚ç±»ä¼¼ Android çš„<code>onStop()</code></li>
</ul>
<h3> å¸ƒå±€</h3>
<p>Flutter æœ‰å¸ƒå±€ Widget å¦‚ï¼š</p>
<ul>
<li>Column åˆ—</li>
<li>Row è¡Œ</li>
<li>Stack å·¦ä¸Šè§’å †ç§¯ï¼Œç±»ä¼¼ FrameLayout</li>
</ul>
<h3> ç‚¹å‡»äº‹ä»¶</h3>
<p>FLutter ä¸­çš„â€œ<code>onClick()</code>â€: <code>onPressed</code>,<code>onTap</code>ç­‰ç­‰ã€‚</p>
<p>æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œåœ¨ Widget å¤–é¢æ·»åŠ ä¸€ä¸ª<code>GestureDetector</code>Widgetï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒé“¾æ¥</h2>
<p><a href="https://www.youtube.com/watch?v=GLSG_Wh_YWc" target="_blank" rel="noopener noreferrer">Flutter Tutorial for Beginners - Build iOS and Android Apps with Google's Flutter &amp; Dart</a></p>
<p><a href="https://flutter.io/flutter-for-android/" target="_blank" rel="noopener noreferrer">Flutter for android</a></p>
<p><a href="https://juejin.im/post/5b35a75e51882574ea3a25e3" target="_blank" rel="noopener noreferrer">Flutter è®¿é—®æœ¬åœ°èµ„æº</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Flutter ä¸­çš„å¼‚å¸¸å¤„ç†</title>
      <link>https://jixiaoyong.github.io/blog/posts/9e235953.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/9e235953.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter ä¸­çš„å¼‚å¸¸å¤„ç†</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 29 Jul 2021 07:41:47 GMT</pubDate>
      <content:encoded><![CDATA[<h2> è¯´æ˜</h2>
<p><code>FLutter</code>ä¸­çš„é”™è¯¯ä¸ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå¥”æºƒï¼Œåªä¼šç»ˆæ­¢æ‰§è¡Œå‡ºé”™ä»£ç ä¹‹åçš„é€»è¾‘ï¼Œåœ¨å¯¼è‡´<code>Widget.build()</code>è¿”å›ä¸º<code>null</code>çš„é”™è¯¯ä¼šå¯¼è‡´<code>Widget</code>æ„å»ºå¤±è´¥ï¼Œå¹¶è¿”å›<em>çº¢åº•é»„å­—</em>çš„é”™è¯¯åŸå› <code>Widget</code>ï¼ˆåœ¨ Release æ¨¡å¼åˆ™ä¼šæ˜¾ç¤ºä¸º<em>ç°åº•åŒºåŸŸ</em>ï¼‰ï¼›ä¸€èˆ¬æ¥è¯´ï¼ŒFlutter ä¸­çš„é”™è¯¯éƒ½ä¼šè¢«<code>FlutterError.onError</code>æ•è·å¹¶å¤„ç†ï¼›å¯¹äºå¼‚æ­¥æ–¹æ³•äº§ç”Ÿå¼‚å¸¸ç­‰<code>Flutteræ¡†æ¶</code>æ²¡æœ‰æ•è·çš„æƒ…å†µï¼Œä¼šäº¤ç”±å½“å‰ä»£ç æ‰€åœ¨çš„<code>Zone</code>å¤„ç†ï¼ˆè¿™äº›å¼‚å¸¸å¯ä»¥ä½¿ç”¨<code>runZonedGuarded</code>æ•è·å¹¶å¤„ç†ï¼‰ã€‚</p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆ flutter è§¦å‘å¼‚å¸¸çš„æ—¶å€™ä¸ä¼šå´©æºƒï¼Ÿ</strong><br>
è¿™ä¸ªå’Œ <code>flutter</code> çš„æ¶ˆæ¯å¾ªç¯æœºåˆ¶æœ‰å…³ï¼Œä»»åŠ¡åˆ†ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯å¾®ä»»åŠ¡ <code>microtask</code>ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶ <code>event</code>ï¼Œä»–ä»¬æœ‰è‡ªå·±çš„é˜Ÿåˆ—ï¼Œæ¯ä¸ªä»»åŠ¡æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸€æ—¦æŸä¸ªä»»åŠ¡è§¦å‘å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯å¯¼è‡´è¿™ä¸ªä»»åŠ¡åç»­ä»£ç æ— æ³•æ‰§è¡Œï¼Œå¹¶ä¸ä¼šå½±å“å…¶ä»–ä»»åŠ¡æ‰§è¡Œ</p>
</blockquote>
<p><em>æœ¬æ–‡åŸºäº Flutter (Channel stable, 2.2.3)</em></p>
<h2> è¯¦ç»†è¯´æ˜</h2>
<p>Flutter ä¸­çš„é”™è¯¯å¤„ç†åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p>
<h3> <code>try...catch</code></h3>
<p>å¯¹äºæ™®é€šçš„é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡<code>try...catch</code>æ¥æ•è·ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºï¼Œå¼‚æ­¥å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨<code>await</code>ç­‰å¾…å…¶æ‰§è¡Œå®Œæ¯•ï¼Œå°†å…¶å˜ä¸ºåŒæ­¥ä»»åŠ¡ï¼Œå¦åˆ™æ— æ³•åˆ™æ•è·ã€‚</p>
<h3> <code>ErrorWidget.builder</code></h3>
<p>å½“åœ¨<code>Widget</code>æ„å»ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œå¯¼è‡´<code>build()</code>æ–¹æ³•è¿”å›<code>null</code>ï¼Œ<code>Flutteræ¡†æ¶</code>ä¼šè°ƒç”¨<code>ErrorWidget.builder</code>è¿”å›ä¸€ä¸ª<code>Widget</code>æ›¿ä»£<code>å‡ºé”™çš„Widget</code>ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>debug</code>æ¨¡å¼è¿”å›çš„æ˜¯çº¢åº•é»„å­—çš„é”™è¯¯æç¤ºï¼Œè€Œ<code>release</code>æ¨¡å¼è¿”å›çš„æ˜¯<code>ç°è‰²Widget</code>ã€‚</p>
<p>å¯ä»¥åœ¨<code>RunApp</code>æ–¹æ³•ä¸­æ›¿æ¢è¿™ä¸ªé»˜è®¤çš„é”™è¯¯ç•Œé¢ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­çš„<code>MainErrorWidget</code>æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å±•ç¤ºé”™è¯¯ä¿¡æ¯çš„é¡µé¢ã€‚</p>
<ul>
<li>
<p><code>MainErrorWidget</code>çš„ä¸€ç§å®ç°æ–¹å¼</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé”™è¯¯<code>Widget</code>åœ¨<code>Debug</code>å’Œ<code>Release</code>æ¨¡å¼ä¸‹æœ‰ä¸€äº›åŒºåˆ«ï¼š</p>
<ul>
<li><code>Debug</code>æ¨¡å¼ä¸‹<code>ErrorWidget.builder</code>ä¼šè¿”å›é”™è¯¯è¯¦ç»†ä¿¡æ¯<code>FlutterErrorDetails</code> ï¼Œ<code>Release</code>ä¸‹åˆ™ä¸ä¼šï¼›</li>
<li><code>Debug</code>æ¨¡å¼ä¸‹ï¼Œ<code>Widget</code>ç­‰å‡ºé”™ä¼šæ‰“å°<code>Exception caught by widgets library ...</code> ç­‰æç¤ºå¹¶è¾“å‡ºé”™è¯¯å †æ ˆä¿¡æ¯ï¼Œä½†æ˜¯<code>Release</code>æ¨¡å¼ä¸‹ä¸ä¼šï¼›</li>
<li><code>Debug</code>æ¨¡å¼ä¸‹ï¼Œå‡ºé”™ä¸ä¼šè°ƒç”¨<code>FlutterError.onError</code>ï¼Œ<code>Release</code>æ¨¡å¼ä¸‹ä¼šã€‚</li>
</ul>
<h3> <code>FlutterError.onError</code></h3>
<p>ä¸Šè¿°å‡ ç§æƒ…å†µéƒ½æ²¡æœ‰å¤„ç†çš„ï¼Œè¢« Flutter æ¡†æ¶å¼•èµ·çš„å¼‚å¸¸ï¼Œä¼šåœ¨è¿™é‡Œè¢«å¤„ç†ã€‚</p>
<p>åœ¨<code>Flutter 2.2.3</code>ä¸­ï¼Œ<code>Debug</code>æ¨¡å¼ä¸‹å¦‚<code>onPressed</code>ä¸­çš„æœªæ•è·é”™è¯¯ç­‰éƒ½ä¼šè¢« Widget ç­‰æ•è·ï¼Œè€Œä¸ä¼šèµ°åˆ°è¿™é‡Œæ¥ï¼Œåœ¨<code>Release</code>æ¨¡å¼ä¸‹åˆ™ä¼šè°ƒç”¨<code>FlutterError.onError</code>ã€‚</p>
<p>åœ¨è¿™é‡Œå¯ä»¥å¯¹é”™è¯¯è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚è¾“å‡ºåˆ°æ§åˆ¶å°ã€äº¤ç»™ Zone ç»Ÿä¸€å¤„ç†ã€ç›´æ¥ç»“æŸæ‰ APP ç­‰ï¼š</p>
<ul>
<li><code>FlutterError.dumpErrorToConsole(details);</code> è¾“å‡ºåˆ°æ§åˆ¶å°</li>
<li><code>exit(1);</code> é€€å‡º APP</li>
<li><code>Zone.current.handleUncaughtError(details.exception, details.stack);</code> äº¤ç»™ Zone ç»Ÿä¸€å¤„ç†</li>
<li><code>defaultOnError?.call(details);</code> è‡ªå·±å¤„ç†å®Œå¼‚å¸¸åï¼Œä¹Ÿè¦æŠŠå¼‚å¸¸å‘ä¸ŠæŠ›ã€æ¨èã€‘ï¼Œå…¶ä¸­<code>defaultOnError</code> å¯ä»¥é¢„å…ˆç¼“å­˜<code>final defaultOnError = FlutterError.onError;</code></li>
</ul>
<h3> <code>runZonedGuarded(onError)</code></h3>
<p>ä¸Šè¿°å‡ ç§æƒ…å†µéƒ½æ²¡æœ‰å¤„ç†çš„å¼‚å¸¸ï¼Œä¼šè¢«å‘é€åˆ°è¿™é‡Œå¤„ç†ï¼Œå¯ä»¥ç±»æ¯”ä¸º<code>Android</code>ä¸­çš„<code>Thread.UncaughtExceptionHandler</code>ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zone å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ²™ç›’ï¼Œå…¶ä¸­çš„ä»£ç å‡ºé”™ï¼ŒåŒ…æ‹¬å¼‚æ­¥çš„éƒ½å¯ä»¥æ•è·åˆ°ã€‚ä½†æ˜¯å¦‚æœæ˜¯å¦å¤–ä¸€ä¸ªæ²™ç›’ä¸­çš„é”™è¯¯åˆ™æ— æ³•å¤„ç†ã€‚</p>
<h2> å‚è€ƒæ–‡ç« </h2>
<p><a href="https://flutter.cn/docs/testing/errors#define-a-custom-error-widget-for-build-phase-errors" target="_blank" rel="noopener noreferrer">Flutter å®˜ç½‘å¼‚å¸¸å¤„ç†</a></p>
<p><a href="https://www.fnzblog.site/Flutter%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.html" target="_blank" rel="noopener noreferrer">Flutter å¼‚å¸¸å¤„ç†</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Flutter åŠ¨ç”»åˆ†æä¹‹ AnimatedWidget&amp;ImplicitlyAnimatedWidget</title>
      <link>https://jixiaoyong.github.io/blog/posts/47c43abe.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/47c43abe.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter åŠ¨ç”»åˆ†æä¹‹ AnimatedWidget&amp;ImplicitlyAnimatedWidget</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 22 Aug 2022 00:58:45 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡è®¨è®ºçš„ Flutter åŠ¨ç”»ä¸»è¦é™å®šåœ¨ï¼š<em>éšç€æ¯ä¸€å¸§çš„å˜åŒ–ï¼Œä¿®æ”¹ Flutter Widget çš„å¤§å°ã€é¢œè‰²ã€ä½ç½®ç­‰å±æ€§ï¼Œä½¿ä¹‹çœ‹èµ·æ¥ä»ä¸€ç§çŠ¶æ€æ¸å˜ä¸ºå¦å¤–ä¸€ç§çŠ¶æ€</em> è¿™ä¸€èŒƒå›´ã€‚</p>
</blockquote>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°† Flutter ä¸­åŠ¨ç”»çš„å®ç°åˆ†ä¸º <em>åº•å±‚å®ç°</em> å’Œ <em>å°è£…å¥½çš„ Widget</em> ä¸¤å¤§éƒ¨åˆ†ï¼Œç›®å‰å·²ç»åˆ†æäº†åº•å±‚å®ç°çš„éƒ¨åˆ†ï¼š</p>
<ul>
<li><a href="https://jixiaoyong.github.io/blog/posts/6ec43bd8.html" target="_blank" rel="noopener noreferrer">AnimationController</a></li>
<li><a href="https://jixiaoyong.github.io/blog/posts/820d6240.html" target="_blank" rel="noopener noreferrer">Tween&amp;Curve</a></li>
</ul>
<p>è€Œ Flutter å°è£…å¥½çš„åŠ¨ç”» Widget ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_widget.png" alt="Flutter ä¸­ä¸åŠ¨ç”»æœ‰å…³çš„ Widget" tabindex="0" loading="lazy"><figcaption>Flutter ä¸­ä¸åŠ¨ç”»æœ‰å…³çš„ Widget</figcaption></figure>
<ul>
<li>
<p><strong>ImplicitlyAnimatedWidget</strong> éšå¼åŠ¨ç”»ï¼Œå…³äºåŠ¨ç”»çš„å¼€å§‹ã€åœæ­¢ç­‰éƒ½å°è£…åœ¨ Widget å†…éƒ¨ï¼Œåªè¦ Widget <em>å‰åä¼ å…¥çš„å€¼ä¸åŒ</em> ä¾¿å¯ä»¥è‡ªåŠ¨ä» old æ¸å˜åˆ° newï¼Œå†…ç½®çš„è¿™äº›ç±»ä¸»è¦ä»¥ <em>AnimatedFoo</em> å‘½åã€‚</p>
</li>
<li>
<p><strong>AnimatedWidget</strong>ï¼Œæ˜¾å¼åŠ¨ç”»ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªå·±åˆ›å»º Animationï¼ˆä¸€èˆ¬æ˜¯ AnimationControllerï¼‰å¹¶é€šè¿‡å…¶ <em>ä¸»åŠ¨ç®¡ç†åŠ¨ç”»</em>ï¼Œæ­¤ç±» Widget ä¸»è¦æ˜¯ç›‘å¬ AnimationController çš„å€¼å¹¶åˆ·æ–° Widget çš„å†…å®¹ã€‚</p>
<p>æ­¤ç±» Widget ä¸»è¦æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š</p>
<ul>
<li>ç»§æ‰¿ AnimatedWidget</li>
<li>ä½¿ç”¨ AnimatedBuilder</li>
<li>ä½¿ç”¨å„ç§å†…ç½®çš„ AnimatedWidget å­ç±»ï¼Œä¸€èˆ¬ä»¥ FooTransition å‘½åã€‚</li>
</ul>
</li>
</ul>
<p>å¯¹äº Flutter ä¸­è¿™äº›ä¸åŠ¨ç”»æœ‰å…³çš„ç±»å¦‚ä½•é€‰æ‹©ï¼ŒFlutter å®˜æ–¹ç»™äº†ä¸€å¼ å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_select.png" alt="å¦‚ä½•å®ç° Flutter ä¸­çš„åŠ¨ç”»" tabindex="0" loading="lazy"><figcaption>å¦‚ä½•å®ç° Flutter ä¸­çš„åŠ¨ç”»</figcaption></figure>
<p>ç®€å•æ¥è¯´ï¼ŒFlutter æœ‰ä¸€äº›å†…ç½®çš„åŠ¨ç”»ï¼Œåœ¨è¦å†™åŠ¨ç”»çš„æ—¶å€™ï¼Œå¯ä»¥ä¾æ¬¡è€ƒè™‘ï¼ˆå®ç°ç¨‹åº¦ç”±æ˜“åˆ°éš¾ï¼‰ï¼š</p>
<ul>
<li>AnimatedFoo å‚è€ƒ<a href="https://medium.com/flutter/flutter-animation-basics-with-implicit-animations-95db481c5916" target="_blank" rel="noopener noreferrer">æ–‡ç« </a>ï¼Œè®¾ç½®æ–°çš„çŠ¶æ€ï¼Œè¿™äº›æ§ä»¶ä¼šè‡ªåŠ¨ä»ä¹‹å‰çš„çŠ¶æ€åˆ‡æ¢åˆ°æ–°çŠ¶æ€</li>
<li>TweenAnimationBuilder å‚è€ƒ<a href="https://medium.com/flutter/custom-implicit-animations-in-flutter-with-tweenanimationbuilder-c76540b47185" target="_blank" rel="noopener noreferrer">æ–‡ç« </a>ï¼Œå°†ä»»æ„å±æ€§åœ¨ Tween æŒ‡å®šçš„èŒƒå›´å˜åŒ–ï¼Œå’Œä¸Šé¢çš„ AnimatedFoo éƒ½æ˜¯å±äº<a href="https://api.flutter.dev/flutter/widgets/ImplicitlyAnimatedWidget-class.html" target="_blank" rel="noopener noreferrer">Implicitly animated widgets</a>ï¼ˆéšå¼åŠ¨ç”»ï¼Œç”±ç³»ç»Ÿæ§ä»¶æ§åˆ¶åŠ¨ç”»ï¼‰ã€‚</li>
<li>FooTranslation</li>
<li>AnimatedBuilder / AnimatedWidget</li>
<li>CustomPainter</li>
</ul>
<br>
<p>æœ¬æ–‡å°†å¯¹ Flutter å†…ç½®å°è£…å¥½çš„åŠ¨ç”»ç›¸å…³çš„ Widget çš„å®ç°å’Œç”¨æ³•è¿›è¡Œç®€å•åˆ†æã€‚</p>
<h2> æºç åˆ†æ</h2>
<p>æŒ‰ç…§ä¸Šè¿°åˆ†æï¼ŒFlutter ä¸­çš„åŠ¨ç”» Widget å¯ä»¥å¤§ä½“åˆ†ä¸º <em>éšå¼åŠ¨ç”»</em> å’Œ <em>æ˜¾å¼åŠ¨ç”»</em> ä¸¤ç§ã€‚</p>
<h3> ImplicitlyAnimatedWidget</h3>
<blockquote>
<p>ImplicitlyAnimatedWidgets (and their subclasses) automatically animate changes in their properties whenever they change.</p>
</blockquote>
<p>éšå¼åŠ¨ç”»å†…éƒ¨æŒæœ‰ AnimationController ä»¥ç®¡ç†åŠ¨ç”»ï¼Œé»˜è®¤æ²¡æœ‰åŠ¨ç”»ï¼Œå½“ä½¿ç”¨ä¸åŒçš„å€¼é‡æ–°æ„å»º Widget çš„æ—¶å€™ï¼Œä¼šæ‰§è¡ŒåŠ¨ç”»ï¼Œä½¿ç”¨è€…åªèƒ½è®¾ç½® Duration å’Œ Curveï¼Œå¦‚æœæƒ³è¦æ›´æ·±å…¥çš„æ§åˆ¶åŠ¨ç”»ï¼ˆæ¯”å¦‚æš‚åœåŠ¨ç”»ï¼‰åˆ™åº”è¯¥ä½¿ç”¨ AnimatedWidgetã€‚</p>
<p>ImplicitlyAnimatedWidget ä¸»è¦åˆ†ä¸º 2 å¤§ç±»ï¼š</p>
<ul>
<li>TweenAnimationBuilder, which animates any property expressed by a Tween to a specified target value.</li>
<li>AnimatedFoo
<ul>
<li>AnimatedAlign, which is an implicitly animated version of Align.</li>
<li>AnimatedContainer, which is an implicitly animated version of Container.</li>
<li>AnimatedDefaultTextStyle, which is an implicitly animated version of DefaultTextStyle.</li>
<li>AnimatedScale, which is an implicitly animated version of Transform.scale.</li>
<li>AnimatedRotation, which is an implicitly animated version of Transform.rotate.</li>
<li>AnimatedSlide, which implicitly animates the position of a widget relative to its normal position.</li>
<li>AnimatedOpacity, which is an implicitly animated version of Opacity.</li>
<li>AnimatedPadding, which is an implicitly animated version of Padding.</li>
<li>AnimatedPhysicalModel, which is an implicitly animated version of PhysicalModel.</li>
<li>AnimatedPositioned, which is an implicitly animated version of Positioned.</li>
<li>AnimatedPositionedDirectional, which is an implicitly animated version of PositionedDirectional.</li>
<li>AnimatedTheme, which is an implicitly animated version of Theme.</li>
<li>AnimatedCrossFade, which cross-fades between two given children and animates itself between their sizes.</li>
<li>AnimatedSize, which automatically transitions its size over a given duration.</li>
<li>AnimatedSwitcher, which fades from one widget to another.</li>
</ul>
</li>
</ul>
<p>æˆ‘ä»¬ç®€å•åˆ†æä¸€ä¸‹ ImplicitlyAnimatedWidget å’Œ TweenAnimationBuilderï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p><code>ImplicitlyAnimatedWidget.createState()</code>å¿…é¡»è¿”å› ImplicitlyAnimatedWidgetState æˆ–è€… AnimatedWidgetBaseState åŠå…¶å­ç±»ã€‚</p>
</blockquote>
<p>ImplicitlyAnimatedWidget ä½œä¸º StatefulWidgetï¼Œå®ƒçš„ä¸»è¦é€»è¾‘åœ¨ ImplicitlyAnimatedWidgetState ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ImplicitlyAnimatedWidgetState ä¸­ï¼Œæ ¹æ®ä¼ å…¥çš„ <em>Duration</em> å’Œ <em>Curve</em>ï¼Œåˆ›å»ºå¹¶æŒæœ‰äº† <em>AnimationController</em> å’Œ <em>Animation&lt;double&gt;</em> ç”¨äºé©±åŠ¨éšå¼åŠ¨ç”»ã€‚</p>
<h4> initState</h4>
<p>åœ¨<code>ImplicitlyAnimatedWidgetState.initState</code>æ–¹æ³•ä¸­ï¼š</p>
<ul>
<li>ç›‘å¬<code>_controller</code>çš„çŠ¶æ€ï¼Œå½“<code>AnimationStatus.completed</code>æ—¶å›è°ƒ<code>ImplicitlyAnimatedWidget.onEnd</code>æ–¹æ³•ï¼›</li>
<li>æ­¤å¤–è¿˜è°ƒç”¨äº†<code>_constructTweens()</code>éå† Tweenï¼Œå¹¶è°ƒç”¨ç”±å­ç±»å®ç°çš„<code>forEachTween()</code>æ–¹æ³•ï¼ˆå­ç±»åœ¨æ­¤æ–¹æ³•å†…éƒ¨ï¼Œè·å–åˆ°å¯¹åº”çš„ Tweenï¼Œæ¯”å¦‚ Paddingï¼Œä»è€Œåœ¨ç›‘å¬åˆ°<code>_controller</code>å˜åŒ–å¹¶è§¦å‘ rebuilt æ—¶ä½¿ç”¨<code>Animatable.evaluate()</code>æ–¹æ³•è·å–å¹¶æ˜¾ç¤ºæœ€æ–°çš„å±æ€§ï¼Œå®ç°åŠ¨ç”»æ•ˆæœï¼‰ï¼›</li>
<li>æœ€åè¿˜è°ƒç”¨äº†<code>didUpdateTweens()</code>æ–¹æ³•é€šçŸ¥å­ç±» Tweens å‘ç”Ÿå˜åŒ–äº†ã€‚</li>
</ul>
<h4> _constructTweens</h4>
<p><code>_constructTweens()</code>æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ª TweenVisitor&lt;dynamic&gt;å¹¶ä¼ ç»™å­ç±» <code>forEachTween()</code>æ–¹æ³•ï¼Œå­ç±»å¯ä»¥ä½¿ç”¨å…¶è·å–å¯¹åº”çš„ Tween å¯¹è±¡ã€‚</p>
<p><code>_constructTweens()</code>åˆ™åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨<code>_shouldAnimateTween()</code>å¾—çŸ¥äº†å­ç±»ä¸­æ˜¯å¦æœ‰ Tween å¯ä»¥å¼€å§‹åŠ¨ç”»â€”â€”<code>shouldStartAnimation</code>ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> didUpdateWidget</h4>
<p>å½“ ImplicitlyAnimatedWidget è¢«é‡æ–°åˆ›å»ºæ—¶ï¼Œä¼šè°ƒç”¨ ImplicitlyAnimatedWidgetState.didUpdateWidget æ–¹æ³•ã€‚</p>
<p>åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œé™¤äº†æ£€æŸ¥å¹¶æ›´æ–° Curveã€Durationã€Tween ä¹‹å¤–ï¼Œæœ€é‡è¦çš„æ˜¯ä½¿ç”¨ AnimationController.forward() å¼€å¯äº†åŠ¨ç”»ã€‚ä¹Ÿå°±æ˜¯è¯´â€”â€”â€œ<strong>ImplicitlyAnimatedWidget ç¬¬ä¸€æ¬¡æ’å…¥ Widget Tree æ—¶æ²¡æœ‰åŠ¨ç”»ï¼Œå½“å†æ¬¡è¢«æ›´æ–°æ—¶ä¼šè§¦å‘åŠ¨ç”»</strong>â€ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> forEachTween</h4>
<p>å­ç±»å¿…é¡»å®ç°æ­¤æ–¹æ³•ï¼Œä½¿ç”¨ä¼ å…¥çš„ TweenVisitor åˆ›å»ºè‡ªå·±å¯¹åº”çš„ Tweenã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4> didUpdateTweens</h4>
<p>å½“ Tween å˜åŒ–æ—¶ä¼šè°ƒç”¨æ­¤æ–¹æ³•é€šçŸ¥å­ç±»ï¼Œå­ç±»ï¼ˆå¯é€‰ï¼‰å¯ä»¥å®ç°æ­¤æ–¹æ³•ã€‚</p>
<br>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ AnimationController å·²ç»æ§åˆ¶åŠ¨ç”»å¼€å§‹æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸º<strong>æ²¡æœ‰ç›‘å¬ AnimationController.value çš„å˜åŒ–</strong>ï¼Œæ‰€ä»¥è¿˜ä¸èƒ½è‡ªåŠ¨è§¦å‘ ImplicitlyAnimatedWidgetState.build() æ–¹æ³•ã€‚</p>
<p>ä¸ºäº†å®ç°åŠ¨ç”»æ•ˆæœï¼Œå­ç±»å¯ä»¥é€‰æ‹©<strong>è‡ªå·±ä¸»åŠ¨ç›‘å¬ AnimationController</strong>ï¼›æˆ–è€…ï¼Œ<strong>ç»§æ‰¿ AnimatedWidgetBaseState</strong>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ImplicitlyAnimatedWidget çš„å­ç±»ä¸»è¦å®ç° AnimatedWidgetBaseState/ImplicitlyAnimatedWidgetState çš„<code>forEachTween()</code>å’Œ<code>build()</code>æ–¹æ³•å³å¯ã€‚å‰è€…ç”¨äºç”Ÿæˆ Widget æ‰€éœ€çš„ Tweenï¼›åè€…åˆ™ä½¿ç”¨ç”Ÿæˆçš„ Tween&lt;T&gt;çš„<code>evaluate(animation)</code>æ–¹æ³•è®¡ç®—å¯¹åº”çš„å±æ€§å¹¶å±•ç¤ºã€‚</p>
<p>ä»¥ AnimatedPadding ä¸ºä¾‹ï¼Œå®ƒç»§æ‰¿è‡ª ImplicitlyAnimatedWidgetï¼Œåˆ›å»ºçš„_AnimatedPaddingState ç»§æ‰¿è‡ª AnimatedWidgetBaseState&lt;AnimatedPadding&gt;ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br>
<p>ä¸Šè¿°åˆ†ææ˜¯ç»§æ‰¿ ImplicitlyAnimatedWidget å®ç°éšå¼åŠ¨ç”»çš„å¸¸ç”¨æµç¨‹ï¼ŒFlutter ä¸­å†…ç½®çš„ AnimatedFoo åŠ¨ç”»éƒ½æ˜¯ç±»ä¼¼å®ç°ã€‚</p>
<h4> TweenAnimationBuilder</h4>
<p>ImplicitlyAnimatedWidget çš„å­ç±»ï¼ˆä»¥ AnimatedFoo å‘½åçš„ä¸€ä¼—å­ç±»ï¼‰æä¾›äº†å¸¸è§çš„åŠ¨ç”»æ•ˆæœï¼Œä½†æ˜¯å¦‚æœæœ‰ç‰¹æ®Šçš„åŠ¨ç”»æ•ˆæœéœ€è¦å®ç°ï¼Œé™¤äº†ç›´æ¥ç»§æ‰¿ ImplicitlyAnimatedWidget ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ TweenAnimationBuilder å¹¶ä¼ å…¥ Tween æ¥å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ Widget <strong>é¦–æ¬¡ build çš„æ—¶å€™å°±ä¼šè§¦å‘åŠ¨ç”»</strong>ä» Tween.begin è¿‡æ¸¡åˆ° Tween.endï¼›å½“å†æ¬¡æä¾›ä¸€ä¸ªæœ‰<strong>æ–° end çš„ Tween ä¹Ÿå¯ä»¥éšæ—¶è§¦å‘æ–°åŠ¨ç”»</strong>ï¼ˆæ–°åŠ¨ç”»ä»åŠ¨ç”»å½“å‰å€¼å¼€å§‹ï¼‰ã€‚</p>
<p>éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>ä¼ å…¥åˆ° TweenAnimationBuilder ä¸­çš„ Tween è¢«å…¶æŒæœ‰ï¼ˆå¯èƒ½ä¿®æ”¹ï¼‰,æ‰€ä»¥ä¸åº”å½“å†æ“ä½œå®ƒï¼›</li>
<li>å½“åŠ¨ç”»æ‰§è¡Œå®Œæ¯•ä¼šè°ƒç”¨ TweenAnimationBuilder.onEnd æ–¹æ³•ï¼›</li>
<li>ä¸ºäº†æ€§èƒ½ï¼Œåº”å½“å°†ä¸éœ€è¦æ¯æ¬¡æ›´æ–°çš„ subtree ä¼ å…¥åˆ° TweenAnimationBuilder.child ä¸­é¿å…é‡ç»˜ã€‚</li>
</ul>
<p>å’Œå…¶ä»– ImplicitlyAnimatedWidget çš„å­ç±»ä¸€æ ·ï¼ŒTweenAnimationBuilder çš„ä¸»è¦é€»è¾‘ä¹Ÿåœ¨ç»§æ‰¿è‡ª AnimatedWidgetBaseState çš„_TweenAnimationBuilderState ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ï¼Œåªæœ‰ä¼ å…¥ TweenAnimationBuilder çš„ Tween æ˜¯ä¸€ä¸ªæ–°çš„ã€å¹¶ä¸” end å€¼å’Œä¹‹å‰ä¸ä¸€æ ·çš„æ‰ä¼šè§¦å‘åŠ¨ç”»ã€‚å¦‚æœ end å€¼ä¸€æ ·åˆ™æ— åŠ¨ç”»ã€å¦‚æœä¸æ˜¯æ–°çš„åˆ™ builder çš„å†…å®¹åªä¼šçªç„¶å˜åŒ–ä¸º end å€¼å¯¹åº”çŠ¶æ€è€Œæ— åŠ¨ç”»ã€‚</p>
<h3> AnimatedWidget</h3>
<p>ä¹‹å‰åˆ†æçš„ TweenAnimationBuilder ä»¥åŠ ImplicitlyAnimatedWidget çš„å…¶ä»–å­ç±»ï¼ŒåŸºæœ¬ä¸Šéƒ½åªèƒ½å®šä¹‰åŠ¨ç”»çš„ Tweenã€Durationã€Curve ç­‰ï¼ŒåŠ¨ç”»çš„å¼€å§‹ç»“æŸåŠ¨éƒ½ç”±è¿™äº› Widget å†…éƒ¨æ§åˆ¶ã€‚</p>
<p>å¦‚æœéœ€è¦æ‰‹åŠ¨ä¸»åŠ¨æ§åˆ¶åŠ¨ç”»ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ <strong>æ˜¾å¼åŠ¨ç”»</strong> â€”â€” AnimatedWidget åŠå…¶å­ç±»ï¼š</p>
<p>å…¶åŒæ ·ä¹Ÿåˆ†ä¸º 2 å¤§ç±»ï¼š</p>
<ul>
<li>AnimatedBuilder, which is useful for complex animation use cases and a notable exception to the naming scheme of AnimatedWidget subclasses.</li>
<li>FooTransition å­ç±»
<ul>
<li>AlignTransition, which is an animated version of Align.</li>
<li>DecoratedBoxTransition, which is an animated version of DecoratedBox.</li>
<li>DefaultTextStyleTransition, which is an animated version of DefaultTextStyle.</li>
<li>PositionedTransition, which is an animated version of Positioned.</li>
<li>RelativePositionedTransition, which is an animated version of Positioned.</li>
<li>RotationTransition, which animates the rotation of a widget.</li>
<li>ScaleTransition, which animates the scale of a widget.</li>
<li>SizeTransition, which animates its own size.</li>
<li>SlideTransition, which animates the position of a widget relative to its normal position.</li>
<li>FadeTransition, which is an animated version of Opacity.</li>
<li>AnimatedModalBarrier, which is an animated version of ModalBarrier.</li>
</ul>
</li>
</ul>
<p>AnimatedWidget æ¯” ImplicitlyAnimatedWidget ç®€å•è®¸å¤šï¼Œå…¶æ¥å—ä¸€ä¸ª Listenable å¯¹è±¡ï¼Œåœ¨_AnimatedState ä¸­ç›‘å¬å…¶å¹¶è§¦å‘ rebuiltã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>AnimatedWidget.listenable</code>é€šå¸¸æ˜¯ AnimationControllerï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å®ç° Listenable çš„ç±»ï¼ˆincluding ChangeNotifier and ValueNotifierï¼‰ã€‚</p>
<h4> _AnimatedState</h4>
<p>AnimatedWidget çš„ä¸»è¦é€»è¾‘åœ¨å¯¹åº”çš„_AnimatedState ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œç›¸å¯¹äºéšå¼åŠ¨ç”» ImplicitlyAnimatedWidgetï¼Œæ˜¾ç¤ºåŠ¨ç”» AnimatedWidget çš„é€»è¾‘è¦ç®€å•çš„å¤šï¼Œåªæ˜¯ç›‘å¬ä¼ å…¥çš„ Listenable å¹¶è§¦å‘ rebuilt å³å¯ã€‚å¯¹äºåŠ¨ç”»çš„æ§åˆ¶åˆ™ç”± Listenableï¼ˆé€šå¸¸æ˜¯ AnimationControllerï¼‰å¤„ç†ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¾ç¤ºåŠ¨ç”» AnimatedWidget åªæ˜¯<strong>æ›¿å­ç±»åšäº†ç›‘å¬/ç§»é™¤ç›‘å¬ Listenable çš„å€¼å˜åŒ–ï¼Œå¹¶è§¦å‘ rebuilt çš„å·¥ä½œ</strong>ï¼Œå¦‚ä½•è·å–å˜åŒ–çš„å€¼ï¼Œä»¥åŠå±•ç¤ºå¯¹åº”çš„ Widget åˆ™éœ€è¦å­ç±»è‡ªå·±å¤„ç†ã€‚</p>
<p>ä»–çš„å­ç±» FooTransition å®ç°é€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨åœ¨ Widget.build æ ¹æ®ä¸åŒçš„çŠ¶æ€åˆ›å»ºåˆ›å»ºä¸åŒå±æ€§çš„ Widget å³å¯ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> AnimatedBuilder</h4>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒFlutter å†…ç½®çš„ä»¥ FooTransition å‘½åçš„ AnimatedWidget çš„å­ç±»å¯ä»¥æ»¡è¶³åŸºæœ¬çš„éœ€æ±‚ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦å®ç°æ›´å¤æ‚çš„æ•ˆæœï¼Œé™¤äº†ç›´æ¥ç»§æ‰¿ AnimatedWidget ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ AnimatedBuilder å®ç°ä¸°å¯Œçš„åŠ¨ç”»ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œ AnimatedBuilder çš„å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æ€»ç»“</h2>
<p><strong>ImplicitlyAnimatedWidget éšå¼åŠ¨ç”»</strong>ï¼Œå†…éƒ¨åˆ›å»ºå¹¶ç›‘å¬ AnimationController ä»¥ç»´æŠ¤åŠ¨ç”»ï¼Œæ§åˆ¶åŠ¨ç”»çš„å¼€å§‹å’Œç»“æŸï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¼ å…¥ Durationã€Curveã€Tween ç­‰å†³å®šåŠ¨ç”»çš„æ—¶é•¿ã€æ›²çº¿ã€å¼€å§‹å’Œç»“æŸå€¼ç­‰ï¼Œå½“åŠ¨ç”»ç›¸å…³çš„å±æ€§å˜åŒ–æ—¶ï¼Œéšå¼åŠ¨ç”»ä¼šè‡ªåŠ¨æ’­æ”¾ï¼Œä½¿ç”¨è€…ä¸å¯ä»¥ç›´æ¥æ§åˆ¶åŠ¨ç”»ã€‚<br>
Flutter å†…ç½®çš„éšå¼åŠ¨ç”»ä¸º TweenAnimationBuilder å’Œ AnimatedFooã€‚</p>
<p><strong>AnimatedWidget æ˜¾å¼åŠ¨ç”»</strong>ï¼Œæ¥å— Listenableï¼ˆé€šå¸¸æ˜¯ AnimationControllerï¼‰å¹¶ç›‘å¬å…¶å€¼å˜åŒ–ï¼Œä»¥è§¦å‘ Widget é‡æ–° buildï¼Œå…¶å­ç±»ä¸­ä¸€èˆ¬ä¼šç›‘å¬ Listenable çš„å€¼å¹¶è®¡ç®—è®¾ç½® Widget å¯¹åº”çš„å±æ€§ã€‚ä½¿ç”¨è€…éœ€è¦è´Ÿè´£åˆ›å»ºã€æ§åˆ¶ Listenable ä»è€Œæ§åˆ¶åŠ¨ç”»æ’­æ”¾ã€‚Flutter å†…ç½®çš„æ˜¾å¼åŠ¨ç”»ä¸º AnimatedBuilder å’Œ FooTransitionã€‚</p>
<p>åœ¨ä½¿ç”¨ Flutter å®ç°<strong>Widget åŠ¨ç”»</strong>æ—¶ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹é¡ºåºé€‰æ‹©å®ç°æ–¹å¼ï¼š</p>
<ol>
<li>AnimatedFooï¼Œé€‰æ‹©å†…ç½®çš„éšå¼åŠ¨ç”»ï¼Œä»¥å®ç°å½“ Paddingã€Alignment ç­‰å±æ€§å˜åŒ–æ—¶è‡ªåŠ¨æ¸å˜åˆ°æ–°å€¼çš„åŠ¨ç”»æ•ˆæœã€‚</li>
<li>TweenAnimationBuilder/ç»§æ‰¿ ImplicitlyAnimatedWidgetï¼Œå½“ä¸Šä¸€æ­¥æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿›ä¸€æ­¥è‡ªå®šä¹‰å®ç°éšå¼åŠ¨ç”»ã€‚</li>
<li>FooTransitionï¼Œå¦‚æœä¸æ­¢è¦å±•ç¤ºåŠ¨ç”»ï¼Œè¿˜å¸Œæœ›èƒ½å¤Ÿæ§åˆ¶åŠ¨ç”»å¼€å§‹ã€ç»“æŸï¼Œå°±ä½¿ç”¨å†…ç½®çš„æ˜¾å¼åŠ¨ç”»ç»“åˆè‡ªå·±åˆ›å»ºçš„ AnimationController å®ç°åŠ¨ç”»ã€‚</li>
<li>AnimationBuilder/AnimatedWidgetï¼Œå¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„å†…ç½®æ˜¾å¼åŠ¨ç”»ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å®ç°æ˜¾å¼åŠ¨ç”»ã€‚</li>
<li>CustomPainterï¼Œå¦‚æœä¸Šè¿°æ–¹æ³•ä»ç„¶æ— æ³•æ»¡è¶³åŠ¨ç”»éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ CustomPainter è‡ªå·±ç»˜åˆ¶åŠ¨ç”»ã€‚</li>
</ol>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://flutter.cn/docs/development/ui/animations" target="_blank" rel="noopener noreferrer">åŠ¨ç”»æ•ˆæœä»‹ç» flutter.cn</a></p>
<p><a href="https://api.flutter.dev/flutter/widgets/ImplicitlyAnimatedWidget-class.html" target="_blank" rel="noopener noreferrer">ImplicitlyAnimatedWidget</a></p>
<p><a href="https://api.flutter.dev/flutter/widgets/AnimatedWidget-class.html" target="_blank" rel="noopener noreferrer">AnimatedWidget</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_widget.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter åŠ¨ç”»åˆ†æä¹‹ AnimationController</title>
      <link>https://jixiaoyong.github.io/blog/posts/6ec43bd8.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/6ec43bd8.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter åŠ¨ç”»åˆ†æä¹‹ AnimationController</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 21 Aug 2022 02:43:24 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡è®¨è®ºçš„ Flutter åŠ¨ç”»ä¸»è¦é™å®šåœ¨ï¼š<em>éšç€æ¯ä¸€å¸§çš„å˜åŒ–ï¼Œä¿®æ”¹ Flutter Widget çš„å¤§å°ã€é¢œè‰²ã€ä½ç½®ç­‰å±æ€§ï¼Œä½¿ä¹‹çœ‹èµ·æ¥ä»ä¸€ç§çŠ¶æ€æ¸å˜ä¸ºå¦å¤–ä¸€ç§çŠ¶æ€</em> è¿™ä¸€èŒƒå›´ã€‚</p>
</blockquote>
<p>Flutter ä¸­å…³äºåŠ¨ç”»çš„ç±»æœ‰å¾ˆå¤šï¼Œä¸ºäº†ä¾¿äºåˆ†æï¼Œå°†å…¶åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul>
<li>Flutter æ¡†æ¶åº•å±‚å®ç°åŠ¨ç”»çš„å„ä¸ªç±»ï¼Œæ¯”å¦‚ AnimationControllerã€Tickerã€Tweenã€Curve ç­‰</li>
<li>åŸºäºåº•å±‚å®ç°ï¼Œæä¾›è¿›ä¸€æ­¥å°è£…çš„ Flutter åŠ¨ç”»ç›¸å…³çš„ Widget ç±»ï¼Œæ¯”å¦‚ AnimatedWidgetã€ImplicitlyAnimatedWidget å’Œä»–ä»¬çš„å­ç±»ã€‚</li>
</ul>
<p>ä»–ä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p>
<p>AnimationController é€šè¿‡ Ticker ç›‘å¬ Flutter å±å¹•å¸§åˆ·æ–°ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_struct2.png" alt="Flutter ä¸­ AnimationController ä¸ Ticker å…³ç³»" tabindex="0" loading="lazy"><figcaption>Flutter ä¸­ AnimationController ä¸ Ticker å…³ç³»</figcaption></figure>
<p>æ¯ä¸€å¸§åˆ·æ–°åï¼ŒAnimationController ç›‘å¬å¹¶æ ¹æ® Duration ç­‰è®¡ç®—å‡ºå½“å‰çš„ Animation.valueï¼›<br>
æ­¤å¤–ä¹Ÿå¯ä»¥é€šè¿‡ Tween å°† double ç±»å‹è½¬åŒ–ä¸ºå…¶ä»–çš„ç±»å‹æ¯”å¦‚ Offset ç­‰ï¼›<br>
ä¸Šè¿°ä¸¤ç§æ–¹å¼ä¸­ value éƒ½æ˜¯éšç€æ—¶é—´çº¿æ€§å˜åŒ–ï¼Œè€Œ Curve å¯ä»¥ä¸ CurveTweenã€AnimationController ç­‰ç»“åˆä½¿ value å®ç°éçº¿æ€§çš„å˜åŒ–ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_struct1.png" alt="Flutter å„ç§åŠ¨ç”»åº•å±‚ç±»å…³ç³»" tabindex="0" loading="lazy"><figcaption>Flutter å„ç§åŠ¨ç”»åº•å±‚ç±»å…³ç³»</figcaption></figure>
<p>å½“éšç€æ—¶é—´å˜åŒ–ï¼Œè®¡ç®—å‡ºå½“å‰çš„ Animation.value æ—¶ï¼Œä¾¿å¯ä»¥æ ¹æ®æ­¤å€¼ä¿®æ”¹ Flutter Widget çš„å„ä¸ªå±æ€§ï¼Œä»è€Œå®ç°åŠ¨ç”»çš„è§†è§‰æ•ˆæœã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_widget.png" alt="Flutter ä¸­ä¸åŠ¨ç”»æœ‰å…³çš„ Widget" tabindex="0" loading="lazy"><figcaption>Flutter ä¸­ä¸åŠ¨ç”»æœ‰å…³çš„ Widget</figcaption></figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒFlutter æä¾›çš„åŠ¨ç”» Widget ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul>
<li>
<p>ImplicitlyAnimatedWidget éšå¼åŠ¨ç”»ï¼Œå…³äºåŠ¨ç”»çš„å¼€å§‹ã€åœæ­¢ç­‰éƒ½å°è£…åœ¨ Widget å†…éƒ¨ï¼Œåªè¦ Widget å‰åä¼ å…¥çš„å€¼ä¸åŒä¾¿å¯ä»¥è‡ªåŠ¨ä» old æ¸å˜åˆ° newï¼Œå†…ç½®çš„è¿™äº›ç±»ä¸»è¦ä»¥ AnimatedFoo å‘½åã€‚</p>
</li>
<li>
<p>AnimatedWidgetï¼Œæ˜¾å¼åŠ¨ç”»ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªå·±åˆ›å»º Animationï¼ˆä¸€èˆ¬æ˜¯ AnimationControllerï¼‰å¹¶é€šè¿‡å…¶ç®¡ç†åŠ¨ç”»ï¼Œæ­¤ç±» Widget ä¸»è¦æ˜¯ç›‘å¬ AnimationController çš„å€¼å¹¶åˆ·æ–° Widget çš„å†…å®¹ã€‚</p>
<p>æ­¤ç±» Widget ä¸»è¦æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š</p>
<ul>
<li>ç»§æ‰¿ AnimatedWidget</li>
<li>ä½¿ç”¨ AnimatedBuilder</li>
<li>ä½¿ç”¨å„ç§å†…ç½®çš„ AnimatedWidget å­ç±»ï¼Œä¸€èˆ¬ä»¥ FooTransition å‘½åã€‚</li>
</ul>
</li>
</ul>
<p>å¯¹äº Flutter ä¸­è¿™äº›ä¸åŠ¨ç”»æœ‰å…³çš„ç±»å¦‚ä½•é€‰æ‹©ï¼ŒFlutter å®˜æ–¹ç»™äº†ä¸€å¼ å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_select.png" alt="å¦‚ä½•å®ç° Flutter ä¸­çš„åŠ¨ç”»" tabindex="0" loading="lazy"><figcaption>å¦‚ä½•å®ç° Flutter ä¸­çš„åŠ¨ç”»</figcaption></figure>
<p>ç®€å•æ¥è¯´ï¼ŒFlutter æœ‰ä¸€äº›å†…ç½®çš„åŠ¨ç”»ï¼Œåœ¨è¦å†™åŠ¨ç”»çš„æ—¶å€™ï¼Œå¯ä»¥ä¾æ¬¡è€ƒè™‘ï¼ˆå®ç°ç¨‹åº¦ç”±æ˜“åˆ°éš¾ï¼‰ï¼š</p>
<ul>
<li>AnimatedFoo å‚è€ƒ<a href="https://medium.com/flutter/flutter-animation-basics-with-implicit-animations-95db481c5916" target="_blank" rel="noopener noreferrer">æ–‡ç« </a>ï¼Œè®¾ç½®æ–°çš„çŠ¶æ€ï¼Œè¿™äº›æ§ä»¶ä¼šè‡ªåŠ¨ä»ä¹‹å‰çš„çŠ¶æ€åˆ‡æ¢åˆ°æ–°çŠ¶æ€</li>
<li>TweenAnimationBuilder å‚è€ƒ<a href="https://medium.com/flutter/custom-implicit-animations-in-flutter-with-tweenanimationbuilder-c76540b47185" target="_blank" rel="noopener noreferrer">æ–‡ç« </a>ï¼Œå°†ä»»æ„å±æ€§åœ¨ Tween æŒ‡å®šçš„èŒƒå›´å˜åŒ–ï¼Œå’Œä¸Šé¢çš„ AnimatedFoo éƒ½æ˜¯å±äº<a href="https://api.flutter.dev/flutter/widgets/ImplicitlyAnimatedWidget-class.html" target="_blank" rel="noopener noreferrer">Implicitly animated widgets</a>ï¼ˆéšå¼åŠ¨ç”»ï¼Œç”±ç³»ç»Ÿæ§ä»¶æ§åˆ¶åŠ¨ç”»ï¼‰ã€‚</li>
<li>FooTranslation</li>
<li>AnimatedBuilder / AnimatedWidget</li>
<li>CustomPainter</li>
</ul>
<br>
<p>æœ¬æ–‡ä¸»è¦åˆ†æ AnimationController åŠå…¶ç›¸å…³ç±»ã€‚</p>
<h2> æºç åˆ†æ</h2>
<p>AnimationController æ˜¯ Flutter ä¸­åŠ¨ç”»çš„åŸºçŸ³ï¼Œå®ƒç»§æ‰¿è‡ª Animationï¼Œæ ¹æ®ä¸åŒçš„æ–¹æ³•è°ƒç”¨åˆ›å»ºå¯¹åº”çš„ Simulation å¹¶å¼€å§‹ç›‘å¬ä¼ å…¥çš„ Tickerï¼›</p>
<p>æ¯å½“ Flutter ä¸­å¸§åˆ·æ–°æ—¶ï¼Œä»_simulation ä¸­è·å–å½“å‰ Animation._value å¹¶å¯¹ listener å‘å‡ºé€šçŸ¥ï¼›</p>
<p>è¿™æ ·éœ€è¦ä½¿ç”¨ Animation.value çš„å„ä¸ª Widget ä¾¿å¯ä»¥æ ¹æ®å…¶å€¼ä¿®æ”¹è‡ªèº«å±æ€§ï¼Œå®ç°åŠ¨ç”»è§†è§‰æ•ˆæœã€‚</p>
<h3> Animation</h3>
<p>æ ¹æ®ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ Animation ç±»ï¼š</p>
<blockquote>
<p>An animation with a value of type&nbsp;T</p>
</blockquote>
<p>Animation ä¸»è¦çš„ä½œç”¨æ˜¯æŒæœ‰ value å’Œ statusï¼Œå¹¶å…è®¸å…¶ä»–å¯¹è±¡ç›‘å¬äºŒè€…çš„å˜åŒ–ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Animation ç»§æ‰¿è‡ª Listenableï¼Œå®ç° ValueListenable æ¥å£ï¼Œå…¶ä»–ç±»å¯ä»¥é€šè¿‡ addListener/removeListener æˆ–è€… addStatusListener/removeStatusListener ç›‘å¬ Animation çš„ value æˆ–è€… status å˜åŒ–ã€‚</p>
<p>Animation å…±æœ‰ 4 ç§çŠ¶æ€ï¼šdismissedã€forwardã€reverseã€completedã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒAnimation.drive æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å°†ä¼ å…¥çš„ Animatable åº”ç”¨åˆ°è‡ªèº«çš„ Animationã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæä¾›äº†å°† <code>Animation&lt;double&gt;</code> è½¬åŒ–ä¸º <code>Animation&lt;U&gt;</code> ç±»å‹çš„æ–¹æ³•ã€‚</p>
<h4> å…¶ä»–å­ç±»</h4>
<p>é™¤äº†åé¢è¦è¯¦ç»†åˆ†æçš„ AnimationController ä¹‹å¤–ï¼ŒAnimation è¿˜æœ‰å¦‚ä¸‹å­ç±»ï¼š</p>
<table>
<thead>
<tr>
<th>class</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>AlwaysStoppedAnimation</td>
<td>æ°¸è¿œåœç•™åœ¨æŒ‡å®šå€¼çš„ animation</td>
</tr>
<tr>
<td><strong>ProxyAnimation</strong></td>
<td>ä»£ç† Animationï¼Œé€‚ç”¨äºåŠ¨ç”»å¯èƒ½ä¼šå˜åŒ–çš„æƒ…å†µï¼Œå…ˆä½¿ç”¨ ProxyAnimation åº”ç”¨ä¸€ä¸ª Animationï¼Œç„¶åå†ä¿®æ”¹ä¸ºå…¶ä»– Animationï¼ˆä¸ç”¨æ‰‹åŠ¨æ·»åŠ ç§»é™¤ listenerï¼‰</td>
</tr>
<tr>
<td>ReverseAnimation</td>
<td>è¿”å›å’Œå½“å‰ animation åæ–¹å‘çš„ Animation</td>
</tr>
<tr>
<td><strong>CurvedAnimation</strong></td>
<td>å¯ä»¥ä¸ºä¼ å…¥çš„ animation ä½¿ç”¨ Curve çš„ animationï¼Œé€‚ç”¨äºå°†åŸå…ˆçº¿æ€§å˜åŒ–çš„ Animation æ”¹ä¸ºéçº¿æ€§çš„</td>
</tr>
<tr>
<td>TrainHoppingAnimation</td>
<td>ç›‘å¬ä¼ å…¥çš„ä¸¤ä¸ª Animation&lt;double&gt;ï¼Œå½“ç¬¬äºŒä¸ª Animation çš„å€¼è¶…è¿‡ç¬¬ä¸€ä¸ª Animation çš„å€¼æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªå¹¶å›è°ƒ onSwitchedTrainã€‚å¦‚æœä¸€å¼€å§‹ä¸¤ä¸ª Animation å°±åœ¨åŒä¸€ä¸ªå€¼ï¼Œåˆ™åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªå¹¶ä¸ä¼šè°ƒç”¨ onSwitchedTrainã€‚</td>
</tr>
<tr>
<td>CompoundAnimation</td>
<td>å¯ä»¥ç»„åˆå¤šä¸ª Animation&lt;T&gt;çš„æ¥å£ï¼Œå½“ Animation&lt;T&gt; next å¤„äºè¿åŠ¨çŠ¶æ€æ—¶è¿”å› next çš„çŠ¶æ€ï¼Œå¦åˆ™è¿”å› Animation&lt;T&gt; first çš„çŠ¶æ€ã€‚</td>
</tr>
</tbody>
</table>
<p>å¯¹äºä¸Šè¿°çš„ CompoundAnimationï¼Œå­ç±»åªéœ€é‡å†™ <code>double get value</code> æ–¹æ³•å³å¯ï¼Œå…¶æœ‰ä¸‰ä¸ªå­ç±»ï¼š</p>
<ul>
<li><code>AnimationMean</code> è¿”å› first å’Œ next å€¼å’Œçš„äºŒåˆ†ä¹‹ä¸€ï¼Œå€¼ä¸º double</li>
<li><code>AnimationMax&lt;T extends num&gt;</code> è¿”å› first å’Œ next ä¸­æœ€å¤§å€¼</li>
<li><code>AnimationMin&lt;T extends num&gt;</code> è¿”å› first å’Œ next ä¸­æœ€å°å€¼</li>
</ul>
<h3> AnimationController</h3>
<blockquote>
<p>A controller for an animation.</p>
</blockquote>
<p>å°½ç®¡æœ‰å„ç§å­ç±»ï¼Œä½† Animation æœ€å¸¸ç”¨çš„å­ç±»æ˜¯ AnimationControllerï¼Œä½¿ç”¨è€…å¯ä»¥ç”¨å®ƒæ¥æ§åˆ¶ã€ç›‘å¬åŠ¨ç”»ã€åˆ›å»ºå…¶ä»–åŠ¨ç”»ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4> æ„é€ æ–¹æ³•</h4>
<p>AnimationController æœ‰ä¸¤ç§æ„é€ æ–¹æ³•ï¼Œè¿™ä¸¤ç§æ„é€ æ–¹æ³•ä¸»è¦ä¼šåˆå§‹åŒ–ä»¥ä¸‹å˜é‡ï¼š</p>
<ul>
<li>double value å½“å‰å€¼</li>
<li>Duration? duration,reverseDuration åŠ¨ç”»æ­£å‘ã€åå‘è¿è¡Œçš„æ—¶é•¿ï¼Œåˆå§‹åŒ–æ—¶å¯ä»¥ä¸º nullï¼Œä½†åœ¨å®é™…å¼€å§‹åŠ¨ç”»ä¹‹å‰ï¼Œè‡³å°‘ä¿è¯ duration ä¸ä¸º null</li>
<li>double lowerBound,double upperBound å½“ value è§¦è¾¾æ­¤å€¼æ—¶ï¼Œanimation åˆ†åˆ«è¢«è®¤ä¸ºæ˜¯ dismissedã€completed</li>
<li>Ticker? _ticker ç”±æ„é€ æ–¹æ³•ä¸­å¿…ä¼ çš„ TickerProvider vsync åˆ›å»º</li>
</ul>
<p>ä»–çš„ä¸¤ä¸ªæ„é€ æ–¹æ³•åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>
<p>AnimationController()</p>
<p>é»˜è®¤æ„é€ æ–¹æ³•ï¼Œdouble lowerBound,double upperBound é»˜è®¤åˆ†åˆ«ä¸º 0.0ï¼Œ1.0</p>
</li>
<li>
<p>AnimationController.unbounded()</p>
<p>ä¸é™åˆ¶ value å€¼çš„æ„é€ æ–¹æ³•ï¼Œdouble lowerBound,double upperBound é»˜è®¤åˆ†åˆ«ä¸º double.negativeInfinityï¼Œdouble.infinityã€‚é€‚ç”¨äºæ²¡æœ‰é¢„è®¾ç¼–è¾‘çš„ç‰©ç†æ¨¡æ‹ŸåŠ¨ç”»ã€‚</p>
</li>
</ul>
<p>åœ¨è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•å†…éƒ¨ï¼Œéƒ½ä¼šé€šè¿‡<code>_ticker = vsync.createTicker(_tick)</code>åˆ›å»º_tickerï¼Œå¹¶ä¿è¯å½“_ticker å›è°ƒæ—¶æ‰§è¡Œ<code>AnimationController._tick()</code>æ–¹æ³•ã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„ TickerProvider ä¸»è¦æœ‰ 2 ç§ï¼š</p>
<ul>
<li>SingleTickerProviderStateMixin é€‚ç”¨äº State ä¸­åªæœ‰ä¸€ä¸ª AnimationController çš„æƒ…å†µï¼Œæ€§èƒ½æ›´å¥½</li>
<li>TickerProviderStateMixin é€‚ç”¨äº State ç”Ÿå‘½å‘¨æœŸå†…æœ‰å¤šä¸ª AnimationController çš„æƒ…å†µ</li>
</ul>
</blockquote>
<br>
<p>é™¤äº†ä» Animation ç»§æ‰¿çš„æ–¹æ³•å¤–ï¼ŒAnimationController è¿˜æä¾›äº†å¦‚ä¸‹æ–¹æ³•ï¼Œç”¨äºæ“çºµåŠ¨ç”»ï¼š</p>
<p><strong>æ“çºµä»<code>double? from</code>æ­£å‘/åå‘å¼€å§‹åŠ¨ç”»</strong>ï¼š</p>
<ul>
<li>TickerFuture forward({ double? from })</li>
<li>TickerFuture reverse({ double? from })</li>
</ul>
<p><strong>æ“çºµæ­£å‘/åå‘å¼€å§‹æœå‘<code>double target</code>å¼€å§‹åŠ¨ç”»</strong>ï¼Œæ­¤ç±»åŠ¨ç”»è¿˜å¯ä»¥æ”¹å˜<em>Duration</em>å’Œ<em>Curve</em>ï¼š</p>
<ul>
<li>TickerFuture animateTo(double target, { Duration? duration, Curve curve = Curves.linear })</li>
<li>TickerFuture animateBack(double target, { Duration? duration, Curve curve = Curves.linear })</li>
</ul>
<p>ä¸Šè¿°å››ç§æ–¹æ³•ï¼Œå†…éƒ¨éƒ½æ˜¯é€šè¿‡ <code>AnimationController._animateToInternal()</code>æ–¹æ³•å®ç°ï¼Œè€Œæ­¤æ–¹æ³•å†…éƒ¨åˆæ˜¯æ‰§è¡Œ <code>AnimationController._startSimulation()</code>ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹å‡ ç±»æ–¹æ³•å†…éƒ¨ä¹Ÿæ˜¯åŸºäº_startSimulation() æ–¹æ³•å®ç°ï¼Œä¸»è¦åŒºåˆ«åœ¨äºä¸åŒæ–¹æ³•æ–¹æ³•åˆ›å»ºäº†ä¸åŒçš„ Simulationï¼š</p>
<ul>
<li>TickerFuture repeat({ double? min, double? max, bool reverse = false, Duration? period })</li>
<li>TickerFuture fling({ double velocity = 1.0, SpringDescription? springDescription, AnimationBehavior? animationBehavior })</li>
<li>TickerFuture animateWith(Simulation simulation)</li>
</ul>
<h4> _startSimulation</h4>
<p><code>AnimationController._startSimulation()</code>æ–¹æ³•æ˜¯å…¶å®ç°åŠ¨ç”»çš„åŸºçŸ³ï¼Œå…¶å†…éƒ¨ä¸»è¦æ˜¯å¼€å¯äº†_ticker å¹¶å‘å‡ºé€šçŸ¥ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>_ticker.start()</code>æ–¹æ³•æœ€ç»ˆé€šè¿‡<code>SchedulerBinding.instance.scheduleFrameCallback()</code>æ–¹æ³•ç›‘å¬ Flutter Framework çš„å¸§åˆ·æ–°ï¼Œå¹¶å›è°ƒ <code>AnimationController._tick</code> æ–¹æ³•</p>
<h4> _tick</h4>
<p>åœ¨æ­¤æ–¹æ³•å†…éƒ¨æ ¹æ®å½“å‰æ—¶é—´å’Œ_simulation è·å–_value å¹¶å‘å‡ºé€šçŸ¥ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> å…¶ä»–æ–¹æ³•</h4>
<ul>
<li>void resync(TickerProvider vsync) ä½¿ç”¨ vsync é‡æ–°åˆ›å»ºæ–°çš„_ticker</li>
<li>void stop({ bool canceled = true }) åœæ­¢åŠ¨ç”»ï¼Œä¸ä¼šè§¦å‘é€šçŸ¥ï¼Œé»˜è®¤æ ‡è®°åŠ¨ç”»ä¸º canceled</li>
<li>void dispose() é‡Šæ”¾èµ„æºï¼ŒåŠ¨ç”»è¢«æ ‡è®°ä¸º canceled</li>
</ul>
<h3> Simulation</h3>
<p>ä»ä¸Šé¢çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° Simulation åœ¨ AnimationController åŠ¨ç”»ä¸­ä¹Ÿèµ·åˆ°å¾ˆé‡è¦çš„ä½œç”¨ï¼šSimulation ä¸»è¦æ˜¯åœ¨ä¸€ç»´ç©ºé—´å¯¹ç‰©ç†è¿›è¡Œä½ç½®ã€é€Ÿåº¦ç­‰å»ºæ¨¡ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ AnimationController ä¸­å¸¸ç”¨çš„å­ç±»æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p>
<h4> _InterpolationSimulation</h4>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ x() æ–¹æ³•ä¸­é™¤äº† t ä¸º 0.0 æˆ– 1.0 çš„æƒ…å†µå¤–ï¼Œå…¶ä½™æ—¶å€™ä¾é  Curveï¼ˆé»˜è®¤ä¸º Curves.linearï¼‰è®¡ç®—å€¼ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> _RepeatingSimulation</h4>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ²¡æœ‰ Curveï¼Œå…¶ double x(double timeInSeconds) æ–¹æ³•å¯ä»¥è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦åå‘å¹¶ä¿®æ”¹æ–¹å‘ï¼ˆä¼šè§¦å‘ status æ”¹å˜é€šçŸ¥ï¼‰ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ä»–çš„ isDone æ–¹æ³•ä¸€è‡´è¿”å› falseï¼Œè¡¨ç¤ºä¸ä¼šä¸»åŠ¨ç»“æŸåŠ¨ç”»ã€‚</p>
<h4> SpringSimulation</h4>
<p>ç”¨äº fling æ–¹æ³•ï¼Œåˆ›å»ºå¼¹æ€§çš„æ¨¡æ‹Ÿ</p>
<h2> æ€»ç»“</h2>
<p>ç»è¿‡ä¸Šè¿°åˆ†æï¼Œåº”è¯¥èƒ½äº†è§£ Flutter åŠ¨ç”»ä¸­ AnimationController çš„ä½œç”¨ï¼š</p>
<ul>
<li>
<p><strong>AnimationController</strong> é€šè¿‡ä¼ å…¥çš„ <strong>TickerProvider</strong> åˆ›å»ºå¹¶ç›‘å¬ <strong>Ticker</strong>ï¼Œç¡®ä¿ Ticker æ”¶åˆ°ç³»ç»Ÿå¸§å›è°ƒæ—¶è§¦å‘ AnimationController._tick æ–¹æ³•ï¼›</p>
</li>
<li>
<p>æä¾› forwardï¼Œreverseï¼ŒanimateToï¼ŒanimateBackï¼Œrepeatï¼Œflingï¼ŒanimateWith ç­‰æ–¹æ³•åˆ›å»ºä¸åŒçš„ <strong>Simulation</strong> å¹¶å¼€å¯ Tickerï¼Œä»è€Œå¯ä»¥é€šè¿‡ <strong>SchedulerBinding</strong>.instance.scheduleFrameCallback ç›‘å¬ Flutter æ¯ä¸€å¸§åˆ·æ–°ã€‚</p>
<p>å¹¶ä¸”åœ¨ animateToï¼ŒanimateBack æ–¹æ³•ä¸­å¯ä»¥ä½¿ç”¨ <strong>Curve</strong> å®ç°éçº¿æ€§å˜åŒ–ã€‚</p>
</li>
<li>
<p>å½“ Flutter å¸§åˆ·æ–°æ—¶ï¼Œ_tick æ–¹æ³•ä¸­é€šè¿‡_simulation ç»“åˆæ—¶é—´ï¼ŒlowerBound å’Œ upperBound ç­‰è·å–å½“å‰å€¼_value å’ŒçŠ¶æ€_status å¹¶å‘å‡ºé€šçŸ¥ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨è€…å¯ä»¥é€šè¿‡ AnimationController ç»§æ‰¿è‡ªçˆ¶ç±» <strong>Animation</strong> çš„ addListener/removeListenerã€addStatusListener/removeStatusListener ç›‘å¬åŠ¨ç”»çš„å€¼å’ŒçŠ¶æ€</p>
</li>
<li>
<p>ä½¿ç”¨è€…å¯ä»¥ä»çˆ¶ç±» <code>Animation&lt;double&gt;</code>ç»§æ‰¿çš„<code>Animation&lt;U&gt; drive&lt;U&gt;(Animatable&lt;U&gt; child)</code>æ–¹æ³•ä½¿ç”¨ <code>Animatable&lt;U&gt;</code>ä» <code>Animation&lt;double&gt;</code>çš„ animation åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Animation&lt;U&gt;</code>ï¼Œä»è€Œå¯ä»¥å¾—åˆ°å¯ä»¥éšæ—¶é—´å˜åŒ–è¿‡æ¸¡çš„ Offsetã€Size ç­‰åŠ¨ç”»ã€‚</p>
</li>
<li>
<p>stop æ–¹æ³•å¯ä»¥åœæ­¢åŠ¨ç”»</p>
</li>
</ul>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://flutter.cn/docs/development/ui/animations" target="_blank" rel="noopener noreferrer">åŠ¨ç”»æ•ˆæœä»‹ç» flutter.cn</a></p>
<p><a href="https://api.flutter.dev/flutter/animation/Animation-class.html" target="_blank" rel="noopener noreferrer">Animation api.flutter.dev</a></p>
<p><a href="https://api.flutter.dev/flutter/animation/AnimationController-class.html" target="_blank" rel="noopener noreferrer">AnimationController api.flutter.dev</a></p>
<p><a href="https://api.flutter.dev/flutter/scheduler/TickerProvider-class.html" target="_blank" rel="noopener noreferrer">TickerProvider api.flutter.dev</a></p>
<p><a href="https://api.flutter.dev/flutter/scheduler/SingleTickerProviderStateMixin-class.html" target="_blank" rel="noopener noreferrer">SingleTickerProviderStateMixin api.flutter.dev</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_struct2.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter åŠ¨ç”»åˆ†æä¹‹ Hero</title>
      <link>https://jixiaoyong.github.io/blog/posts/62beedda.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/62beedda.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter åŠ¨ç”»åˆ†æä¹‹ Hero</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 14 Aug 2022 11:14:01 GMT</pubDate>
      <content:encoded><![CDATA[<p>Flutter ä¸­çš„ Hero åŠ¨ç”»æ˜¯æŒ‡å¯ä»¥åœ¨åˆ‡æ¢é¡µé¢æ—¶è‡ªåŠ¨è·¨é¡µé¢å®ç° Widget æ”¾å¤§ç¼©å°ã€ä½ç§»çš„åŠ¨ç”»ï¼Œåœ¨ç”¨æˆ·çœ‹èµ·æ¥å¥½åƒæ˜¯å½“å‰é¡µé¢çš„ Widgetâ€œé£â€å…¥åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢ï¼Œåº•å±‚åŸºäº Overlay å®ç°ã€‚</p>
<p>æœ¬æ–‡å¯¹å…¶åŸç†å’Œåº”ç”¨åšä¸€ç®€å•åˆ†æï¼Œä¸»è¦æ˜¯å¯¹<a href="https://flutter.cn/docs/development/ui/animations/hero-animations" target="_blank" rel="noopener noreferrer">å®˜æ–¹ä»‹ç»</a>çš„ç†è§£ä¸åˆ†æï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç›´æ¥é˜…è¯»å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h2> ä½¿ç”¨</h2>
<h3> ç®€å•ä½¿ç”¨ Standard hero animations</h3>
<blockquote>
<p>è¯¦ç»†çš„ä»£ç å¯ä»¥ä»<a href="https://gist.github.com/jixiaoyong/8b6584e73abe430d3c1ae926b80a86bd#file-simple_hero_animation-dart" target="_blank" rel="noopener noreferrer">simple_hero_animation.dart</a>è·å–ã€‚</p>
</blockquote>
<p>Hero åŠ¨ç”»çš„ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼š</p>
<ul>
<li>åˆ†åˆ«åœ¨ä¸¤ä¸ª Flutter é¡µé¢å°†éœ€è¦å®ç° Hero åŠ¨ç”»çš„ Widgetï¼ˆä¸€èˆ¬æ˜¯å›¾ç‰‡ï¼‰ä½œä¸º Hero æ§ä»¶çš„ child</li>
<li>ä¸ºè¿™ä¸¤ä¸ª Hero æŒ‡å®šåŒä¸€ä¸ª tag</li>
<li>Hero åº•å±‚åŸºäº Overlay å®ç°ï¼Œæ‰€æœ‰ Hero.child å¯ä»¥ä½¿ç”¨ Position ç­‰é€‚ç”¨äº Stack.child çš„å±æ€§</li>
</ul>
<p>è¿™é‡Œè¦æ³¨æ„ï¼š</p>
<ul>
<li>è¿™ä¸¤ä¸ª Page è¦æ˜¯<strong>ç›¸é‚»</strong>çš„é¡µé¢ï¼Œå¦åˆ™ Hero åŠ¨ç”»ä¸ä¼šç”Ÿæ•ˆ</li>
<li>åŒä¸€ä¸ªé¡µé¢ï¼Œ<strong>ä¸èƒ½æœ‰å¤šä¸ª</strong> Hero.tag ç›¸åŒçš„ Hero æ§ä»¶</li>
<li>Hero åŠ¨ç”»<strong>é»˜è®¤åªæ”¯æŒå¤§å°ï¼ˆsizeï¼‰å’Œä½ç½®ï¼ˆlocationï¼‰å˜åŒ–</strong>ï¼Œæ‰€ä»¥ Hero.child ä¸å»ºè®®æœ‰å…¶ä»–å˜åŒ–ï¼ˆDon't rotate your heroesï¼‰</li>
</ul>
<p>æŒ‰ç…§ä¸Šè¿°çš„è¦æ±‚ï¼Œæˆ‘ä»¬å† FirstHeroPage ä¸­æ·»åŠ ç¬¬ä¸€ä¸ª Hero Widgetï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨è¦è·³è½¬åˆ°çš„ç¬¬äºŒä¸ªé¡µé¢ SecondHeroPage æ·»åŠ ç›®æ ‡ Heroï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå½“ä» FirstHeroPage è·³è½¬åˆ° SecondHeroPage çš„æ—¶å€™ï¼ŒHero åŠ¨ç”»ä½œç”¨äº Hero.childï¼Œçœ‹èµ·æ¥å¥½åƒæ˜¯å‰ä¸€ä¸ªé¡µé¢çš„ HeroChildWidget é€æ¸ä» Alignment.bottomLeft ç§»åŠ¨åˆ° Alignment.topCenterï¼Œå¹¶ä¸”å¤§å°ä¹Ÿä» 100 é€æ¸å˜ä¸º 200ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/hero/simple_hero.gif" alt="Simple Hero Animation" tabindex="0" loading="lazy"><figcaption>Simple Hero Animation</figcaption></figure>
<h4> åŸç†åˆ†æ</h4>
<p>é‚£ä¹ˆ Hero åŠ¨ç”»æ˜¯å¦‚ä½•å®ç°è¿™ä¸ªæ•ˆæœçš„å‘¢ï¼Ÿ</p>
<p>Flutter ä¸­ Page ä¹‹é—´çš„è·³è½¬ç”± Navigator ç®¡ç†ï¼Œåœ¨ Navigator ç®¡ç†çš„æ‰€æœ‰ Flutter Page çš„ä¸Šå±‚æœ‰ä¸€ä¸ªå åŠ å±‚ Overlayï¼Œåœ¨ Z è½´æ–¹å‘ä¸Šå¤„äºæ‰€æœ‰ Page ä¸Šå±‚ï¼Œå…¶å†…éƒ¨çš„ widget å¯ä»¥è¢«ç‹¬ç«‹ç®¡ç†ã€‚</p>
<p>ä»¥å½“å‰ Page ä¸º Aï¼Œè¦è·³è½¬çš„ Page ä¸º Bï¼š</p>
<ul>
<li>
<p>é‚£ä¹ˆå½“ä» A è·³è½¬åˆ° B æ—¶ï¼ŒHero åŠ¨ç”»æ¡†æ¶ä¼šå…ˆéšè— A ä¸­çš„ Hero.child å¹¶ç”¨ç›¸åŒå¤§å°çš„ï¼ˆä¸å¯è§ï¼‰ç»„ä»¶å ä½ï¼›</p>
</li>
<li>
<p>ä¸æ­¤åŒæ—¶ï¼ŒHero åŠ¨ç”»æ¡†æ¶è¯»å–è¦è·³è½¬å»çš„ B ä¸­çš„ Hero.child å¹¶æ®æ­¤åˆ›å»º Widgetï¼Œå°†å…¶å¤§å°å’Œä½ç½®ä¸ä¸º A ä¸­ Hero.child å¯¹é½ï¼Œæ”¾å…¥åˆ° Overlay ä¸­ã€‚åŒæ—¶è®¡ç®—å™¨è¿‡æ¸¡åˆ° B ä¸­çš„ Hero.child ä½ç½®å’Œå¤§å°çš„è·¯å¾„åŠ¨ç”»ï¼Œå¹¶æ‰§è¡Œï¼›</p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸Šä¸€æ­¥æˆ‘ä»¬ç®€å•çš„ Hero åŠ¨ç”»ä¸­ï¼ŒA å‘ B é¡µé¢åˆ‡æ¢æ—¶è¿‡æ¸¡çš„ Widget ä¸­æ–‡å­—è™½ç„¶æ˜¯<em>Second</em>ï¼Œä½†æ˜¯æ ·å¼çœ‹èµ·æ¥å’Œé¡µé¢ä¸­çš„æ–‡å­—æ ·å¼ä¸ä¸€æ ·ï¼Œè¿™æ˜¯å› ä¸º<a href="https://api.flutter-io.cn/flutter/widgets/Overlay-class.html" target="_blank" rel="noopener noreferrer">Overlayï¼ˆå¯è§†ä¸ºä¸€ä¸ªç‰¹æ®Šçš„ Stackï¼‰</a>ä¸Šçš„ç»„ä»¶æ˜¯å•ç‹¬ç®¡ç†çš„ï¼Œæ²¡æœ‰ä½¿ç”¨æˆ‘ä»¬çš„ Material æ ·å¼ã€‚<br>
è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ Hero.child ä¸­æ·»åŠ <code>Material</code>ç»„ä»¶ä½¿å…¶åº”ç”¨æ ·å¼å³å¯ã€‚</p>
</li>
<li>
<p>å½“ B åˆ›å»ºå¥½ä¹‹åï¼ŒHero åŠ¨ç”»æ­£åœ¨è¿è¡Œä¸­ï¼Œæ‰€ä»¥ B ä¸­çš„ Hero.child ä¹Ÿä¼šè¢«ç›¸åŒå¤§å°çš„ï¼ˆä¸å¯è§ï¼‰ç»„ä»¶å ä½ï¼›</p>
</li>
<li>
<p>å½“ Hero åŠ¨ç”»æ’­æ”¾å®Œæ¯•ä¹‹åï¼Œä½äº Overlay ä¸­çš„ Widget è¢«ç§»é™¤ï¼ŒA å’Œ B ä¸­çš„ Hero.child ä¹Ÿæ­£å¸¸æ˜¾ç¤ºã€‚</p>
</li>
<li>
<p>å¦‚æœåˆä» B è¿”å› A åˆ™ä¸Šè¿°æ­¥éª¤åˆä¼šåå‘ï¼ˆAã€B ä¸­ Hero.child æ¢ä½ï¼‰æ‰§è¡Œä¸€æ¬¡ã€‚</p>
</li>
</ul>
<p>ä¸‹å›¾æ˜¯ Flutter å®˜æ–¹å¯¹ Hero åŠ¨ç”»æ‰§è¡Œçš„è§£é‡Šï¼Œåˆšå¥½å¤„äºç”± A åˆ° B è¿‡æ¸¡çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ° Aã€B é¡µé¢ä¸­çš„ Widget éƒ½è¢«ç§»é™¤ï¼Œåªæœ‰æ ¹æ®ç›®æ ‡ Pageâ€”â€”B ä¸­çš„ Hero.child åˆ›å»ºçš„ä½äº Overlay çš„ Destination hero æ§ä»¶åœ¨ä» A ä¸­å¯¹åº”çš„ä½ç½®å’Œå¤§å°è¿‡æ¸¡åˆ° B ä¸­å¯¹åº”çš„ä½ç½®å’Œå¤§å°ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/hero/hero-transition-2.webp" alt="Hero åŠ¨ç”»è¿›è¡Œä¸­çš„å›¾è§£" tabindex="0" loading="lazy"><figcaption>Hero åŠ¨ç”»è¿›è¡Œä¸­çš„å›¾è§£</figcaption></figure>
<h3> è¿›é˜¶ä½¿ç”¨ Radial hero animations</h3>
<p>é»˜è®¤å®ç°çš„ Hero åŠ¨ç”»åªæ”¯æŒå¤§å°å’Œä½ç§»å˜åŒ–ï¼Œé€šè¿‡ä½¿ç”¨ Radial Transformationï¼ˆå¾„å‘è½¬åŒ–ï¼‰å¯ä»¥å®ç°ç”±åœ†å˜ä¸ºæ­£æ–¹å½¢çš„è¿‡æ¸¡åŠ¨ç”»ã€‚</p>
<blockquote>
<p>å¾„å‘è¿‡æ¸¡ æ˜¯ç”±åœ†å½¢å˜æˆæ­£æ–¹å½¢çš„è¿‡æ¸¡åŠ¨ç”»ã€‚<br>
â€”â€” <a href="https://flutter.cn/docs/development/ui/animations/hero-animations#:~:text=%E5%BE%84%E5%90%91%E8%BF%87%E6%B8%A1%20%E6%98%AF%E7%94%B1%E5%9C%86%E5%BD%A2%E5%8F%98%E6%88%90%E6%AD%A3%E6%96%B9%E5%BD%A2%E7%9A%84%E8%BF%87%E6%B8%A1%E5%8A%A8%E7%94%BB%E3%80%82" target="_blank" rel="noopener noreferrer">flutter.cn å®˜ç½‘</a></p>
</blockquote>
<p>å¾„å‘åŠ¨ç”»çš„<em>æœ¬è´¨è¿˜æ˜¯ Hero åŠ¨ç”»</em>ï¼Œåªä¸è¿‡åœ¨ Hero åŠ¨ç”»ä¹‹ä¸Šåšäº†ä¸€å±‚ç”± ClipOval å’Œ ClipRect ç»„æˆçš„è£å‰ªé®ç½©ï¼Œé€šè¿‡äºŒè€…çš„é…åˆï¼Œå¯¼è‡´å…¶é‡å éƒ¨åˆ†çš„å†…å®¹çœ‹èµ·æ¥å¥½åƒåœ¨ Hero åŠ¨ç”»æ’­æ”¾çš„æ—¶å€™åœ¨<em>åœ†</em>å’Œ<em>æ­£æ–¹å½¢</em>ä¹‹é—´åˆ‡æ¢ã€‚</p>
<p>å®˜æ–¹çš„å®ç°ä¸º<a href="https://github.com/cfug/flutter.cn/blob/master/examples/_animation/radial_hero_animation_animate_rectclip/main.dart" target="_blank" rel="noopener noreferrer">radial_hero_animation_animate_rectclip</a>ï¼Œä½†æ˜¯ä¸ºäº†ä¾¿äºç†è§£å¾„å‘åŠ¨ç”»çš„åŸç†ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„ Hero åŠ¨ç”»çš„ç®€å•ä½¿ç”¨<a href="https://gist.github.com/jixiaoyong/8b6584e73abe430d3c1ae926b80a86bd" target="_blank" rel="noopener noreferrer">ä»£ç </a>åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p>
<blockquote>
<p>è¯¦ç»†çš„ä»£ç å¯ä»¥ä»<a href="https://gist.github.com/jixiaoyong/8b6584e73abe430d3c1ae926b80a86bd#file-advanced_hero_animation-dart" target="_blank" rel="noopener noreferrer">advanced_hero_animation.dart</a>è·å–ã€‚</p>
</blockquote>
<p>ç›¸å¯¹äºä¹‹å‰çš„ï¼Œæˆ‘ä»¬ä¸»è¦å°† HeroChildWidget ç±»ä¿®æ”¹ä¸º HeroClippedChildWidget ç±»ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼ŒFirstHeroPage çš„ HeroClippedChildWidget.minClipOvalDiameterï¼ŒSecondHeroPage ä¸­åˆ™ä¸º maxClipOvalDiameterã€‚</p>
<p>å…¶æ•ˆæœå¦‚å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/hero/advanced_hero.gif" alt="advanced_hero" tabindex="0" loading="lazy"><figcaption>advanced_hero</figcaption></figure>
<blockquote>
<p>å®é™…ä¸Šæ ¹æ®æ­¤æ–¹å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›‘å¬ Hero.child çš„å¤§å°ã€ä½ç½®å˜åŒ–ä»è€Œæ¨æµ‹å‡º Hero åŠ¨ç”»çš„è¿›åº¦å’Œæ–¹å‘ï¼ˆæ˜¯ä» from åˆ° toï¼Œè¿˜æ˜¯ç›¸åï¼‰ï¼Œä»è€Œå®ç°æ›´ä¸°å¯Œçš„åŠ¨ç”»æ•ˆæœã€‚</p>
<p>æ¯”å¦‚ç›‘å¬è¿›åº¦ä»è€Œå®ç°æ—‹è½¬ï¼š<a href="https://github.com/jixiaoyong/flutter_custom_widget/blob/master/lib/widgets/animation_hero_child.dart" target="_blank" rel="noopener noreferrer">https://github.com/jixiaoyong/flutter_custom_widget/blob/master/lib/widgets/animation_hero_child.dart</a></p>
</blockquote>
<h4> åŸç†åˆ†æ</h4>
<p>æ­¤ç±»èƒ½å¤Ÿå®ç°åˆ‡æ¢çš„åŒæ—¶ä¿®æ”¹ Hero.child çš„æ ·å¼ï¼Œä¸»è¦åœ¨äº ClipOval å’Œ ClipRect çš„ç»„åˆæ•ˆæœï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/hero/radial-hero-animation.webp" alt="Radial hero animations çš„ç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>Radial hero animations çš„ç¤ºæ„å›¾</figcaption></figure>
<p>ClipRect çš„å¤§å°å›ºå®šä¸º<code>var clipRectSize = maxClipOvalDiameter.width * math.sqrt2 / 2</code>ï¼Œè€Œ ClipOval çš„å¤§å°åˆ™éšç€ Hero åŠ¨ç”»çš„å˜åŒ–è€Œå˜åŒ–ï¼Œå§‹ç»ˆä¸ HeroClippedChildWidget ä¿æŒä¸€è‡´ã€‚</p>
<p>å‡è®¾ä»é¡µé¢ A åˆ° B åˆ‡æ¢æ—¶ Hero.child ä¼šä»å°å˜å¤§ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>åˆšåˆšä»é¡µé¢ A åˆ‡æ¢æ—¶ï¼Œä½äº Overlay çš„ HeroClippedChildWidget/ClipOval å¤§å°ä¸º minClipOvalDiameterï¼ˆä¹Ÿå°±æ˜¯ 100*100ï¼‰ï¼Œæ­¤æ—¶ ClipRect çš„å¤§å° clipRectSizeï¼ˆä¹Ÿå°±æ˜¯ 200/2*æ ¹å· 2 çº¦ç­‰äº 141ï¼‰å¤§äº ClipOval çš„å¤§å°ï¼Œæ‰€ä»¥ä»–ä»¬çš„ç›¸äº¤å¤„ä¸º ClipOvalï¼Œæ•…è€Œ HeroClippedChildWidget æ˜¾ç¤ºä¸ºç›´å¾„ä¸º 100 çš„åœ†ã€‚</li>
<li>å½“åˆšåˆšå®Œæ•´åˆ‡æ¢åˆ°é¡µé¢ Bï¼ŒHero åŠ¨ç”»å°†è¦ç»“æŸæ—¶ï¼Œä½äº Overlay çš„ HeroClippedChildWidget/ClipOval å¤§å°ä¸º maxClipOvalDiameterï¼ˆä¹Ÿå°±æ˜¯ 200*200ï¼‰ï¼Œæ­¤æ—¶ ClipRect çš„å¤§å° clipRectSizeï¼ˆä¾æ—§æ˜¯ 141ï¼‰å°äº ClipOval çš„å¤§å°ï¼Œæ‰€ä»¥ä»–ä»¬çš„ç›¸äº¤å¤„ä¸º ClipRectï¼Œæ•…è€Œ HeroClippedChildWidget æ˜¾ç¤ºä¸ºè¾¹é•¿çº¦ä¸º 141 çš„æ­£æ–¹å½¢ã€‚</li>
<li>åœ¨äºŒè€…çš„è¿‡æ¸¡é˜¶æ®µï¼Œå°±æ˜¯ ClipOval æ³¨è§£ä»å°äº ClipRect å˜åŒ–ä¸ºå¤§äº ClipRect çš„è¿‡ç¨‹ï¼Œä»–ä»¬ç›¸äº¤çš„åŒºåŸŸä¹Ÿä»åœ†å˜ä¸ºåœ†è§’ï¼Œå†å˜ä¸ºæ­£æ–¹å½¢ã€‚</li>
</ul>
<h4> å…¶ä»–å±æ€§</h4>
<p>æ­¤å¤–ï¼ŒHero è¿˜æœ‰å‡ ä¸ªå±æ€§å¯ä»¥ä¾›æˆ‘ä»¬è‡ªå®šä¹‰ï¼š</p>
<ul>
<li><code>flightShuttleBuilder</code> æ›¿æ¢é¡µé¢åˆ‡æ¢æ—¶çš„é»˜è®¤è¿‡æ¸¡ Widgetã€‚æ¯”å¦‚ä»é¡µé¢ A åˆ‡æ¢åˆ° B æ—¶ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨ B ä¸­çš„ Hero.childï¼Œå¦‚æœæ­¤å€¼ä¸ä¸º null åˆ™ä¼šå±•ç¤º flightShuttleBuilder è¿”å›çš„ Widgetã€‚</li>
<li><code>placeholderBuilder</code> å½“ Hero åŠ¨ç”»å¼€å§‹ï¼Œé¡µé¢ Aã€B ä¸­ Hero.child éšè—æ—¶ï¼Œä¼šå±•ç¤º placeholderBuilder è¿”å›çš„å†…å®¹æˆ–è€…ä¸ºç©ºï¼ˆé»˜è®¤ï¼‰</li>
<li><code>createRectTween</code> å®šä¹‰ Hero åŠ¨ç”»çš„è¿‡æ¸¡ç»„ä»¶åŠ¨ç”»æ¸å˜çš„æ–¹å¼ï¼ŒMaterialApp é»˜è®¤ä½¿ç”¨ MaterialRectArcTween()ï¼Œæ­¤å¤–è¿˜æœ‰ MaterialRectCenterArcTween()ï¼ˆå¯ä»¥ç­‰æ¯”ä¾‹ç¼©æ”¾ï¼‰ã€MaterialPointArcTween()ã€‚</li>
</ul>
<p>ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<figure><img src="https://flutter.github.io/assets-for-api-docs/assets/interaction/heroes.png" alt="flutter.cn å®˜ç½‘ Hero ç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption><a href="http://flutter.cn" target="_blank" rel="noopener noreferrer">flutter.cn</a> å®˜ç½‘ Hero ç¤ºæ„å›¾</figcaption></figure>
<h2> åº•å±‚å®ç°</h2>
<h3> Hero</h3>
<p>Hero æ˜¯ä¸€ä¸ª StatefulWidgetï¼Œé™¤äº†ä¹‹å‰æåˆ°çš„å„ä¸ªå±æ€§ä¹‹å¤–ï¼Œè¿˜æä¾›äº†<code>_allHeroesFor()</code>æ–¹æ³•ä¾› HeroController è°ƒç”¨ï¼Œç”¨äºæŸ¥æ‰¾æŒ‡å®š Context ä¸‹æ‰€æœ‰çš„ Hero Widgetï¼Œå¹¶åœ¨æ£€æµ‹åˆ°æœ‰é‡å¤ Hero.tag æ—¶æŠ¥é”™ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> _HeroState</h3>
<p>_HeroState ä¸»è¦æ˜¯æä¾› startFlight/endFlight ä¾› HeroController-&gt;_HeroFlight-&gt;_HeroFlightManifest è°ƒç”¨ï¼›ä»¥åŠæ ¹æ®åˆå§‹åŒ–ä»¥åŠå¼€å§‹/æŠ€æœ¯ Flight åŠ¨ç”»åçŠ¶æ€çš„å˜åŒ–è€Œæ›´æ”¹ Hero.child åœ¨å±å¹•ä¸Šé¢ï¼ˆå¯¹åº”é¡µé¢ä¸ŠåŸå…ˆ Hero Widget æ‰€å¤„ä½ç½®çš„åŒºåŸŸï¼‰çš„æ˜¾ç¤ºæ•ˆæœã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹å‡ºï¼ŒstartFlight/endFlight æ–¹æ³•ä¸»è¦å½±å“çš„æ˜¯_placeholderSize çš„å€¼ï¼Œå¹¶å¼•å‘ rebuildï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼ŒHero å’Œ_HeroState ä¸»è¦æ˜¯æä¾›äº†æ“çºµã€ç»Ÿè®¡å½“å‰ Page çš„ Hero Widget ä»¥åŠæ§åˆ¶å…¶ Hero.child åŠå ä½ Widget çš„æ˜¾ç¤ºä¸å¦ï¼Œé‚£ä¹ˆåœ¨å“ªé‡Œå‘èµ·å’Œç»“æŸ Hero åŠ¨ç”»ï¼Œä»¥åŠç»˜åˆ¶è¿‡æ¸¡ Widget çš„å‘¢ï¼Ÿ</p>
<h3> _HeroFlightManifest</h3>
<blockquote>
<p>â€œ_HeroFlightManifestï¼šEverything known about a hero flight that's to be started or diverted.â€</p>
</blockquote>
<p>_HeroFlightManifest æ˜¯ä¸€ä¸ªæ•°æ®ç±»ï¼Œä¸»è¦å°è£…äº†<code>fromHero</code>/<code>toHero</code>ä¸¤ä¸ª_HeroStateï¼Œå¹¶æä¾› Hero Widget çš„ä½ç½®ä¿¡æ¯ Rectï¼›æ­¤å¤–è¿˜å°è£…äº†è¿‡æ¸¡åŠ¨ç”»ç›¸å…³çš„<code>get animation</code>å’Œ<code>createHeroRectTween</code>æ–¹æ³•ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> HeroController</h3>
<p>HeroController çœŸæ­£åœ¨è·¯ç”±åˆ‡æ¢æ—¶æ“ä½œ Hero åŠ¨ç”»ã€‚</p>
<p>æ— è®ºæ˜¯ CupertinoApp è¿˜æ˜¯ MaterialApp éƒ½æä¾›äº†åˆ›å»º HeroController çš„é™æ€æ–¹æ³•ï¼Œåœ¨ä»–ä»¬å¯¹åº”çš„ State.initState æ–¹æ³•ä¸­åˆ›å»ºã€‚</p>
<blockquote>
<p>CupertinoTabView ä¹Ÿåˆ›å»ºæœ‰è‡ªå·±çš„ HeroControllerã€‚</p>
</blockquote>
<p>ä»¥ MaterialApp ä¸ºä¾‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨_MaterialAppState ä¸­åˆ›å»ºå¹¶æŒæœ‰ HeroControllerï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>HeroControllerScope æ˜¯ä¸€ä¸ª InheritedWidgetï¼Œç»è¿‡ä¸Šè¿°ä»£ç ï¼ŒMaterialApp å†…éƒ¨å¯ä»¥é€šè¿‡<code>HeroControllerScope.of()</code>æ–¹æ³•è·å–åˆ° HeroControllerã€‚</p>
<p>è€Œåœ¨ WidgetsApp ä¸­åˆ›å»ºçš„ Navigator å¯¹åº”çš„<code>NavigatorState._updateHeroController</code>æ–¹æ³•ä¸­ä¼šä½¿ç”¨å…¶è·å– HeroControllerï¼Œå¹¶é€šè¿‡<code>HeroController._navigator = this</code>åŠ<code>NavigatorState._updateEffectiveObservers()</code>æ–¹æ³•ä¸ä¹‹ç»‘å®šã€‚</p>
<p>è¿™æ ·å½“ Navigator åˆ‡æ¢é¡µé¢æ—¶ï¼Œå„ä¸ªæ—¶é—´éƒ½ä¼šé€šçŸ¥åˆ° HeroControllerï¼Œæ‰§è¡Œå…¶ didPush/didPop/didRemove/didReplace/didStartUserGesture/didStopUserGesture ç­‰æ–¹æ³•ï¼Œä»è€Œè§¦å‘/ç»ˆæ­¢ Hero åŠ¨ç”»ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> _maybeStartHeroTransition</h4>
<p>HeroController ä» NavigatorObserver ç»§æ‰¿åˆ°çš„æ–¹æ³•ä¸­ï¼Œé™¤äº† didStopUserGesture éƒ½ä¼šæ‰§è¡Œ HeroController._maybeStartHeroTransition æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> _startHeroTransition</h4>
<p>å½“ä¸Šè¿°æ¡ä»¶æ»¡è¶³ä¹‹åï¼Œä¾¿å¯ä»¥å¼€å§‹æ‰§è¡Œ Hero åŠ¨ç”»ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> _HeroFlight</h3>
<p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæœ€ç»ˆæ˜¯åœ¨_HeroFlight æ–¹æ³•ä¸­çœŸæ­£æ‰§è¡Œ Hero åŠ¨ç”»ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Hero åŠ¨ç”»å®é™…æ’­æ”¾çš„è¿‡æ¸¡åŠ¨ç”»å†…å®¹ï¼Œç”±_HeroFlight._buildOverlay æ ¹æ®åŠ¨ç”»è¿›åº¦åˆ›å»ºï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æ€»ç»“</h2>
<p>Flutter ä¸­ Hero åŠ¨ç”»æ˜¯åŸºäº Overlay å®ç°çš„ï¼Œç›‘å¬ Navigator è·¯ç”±å˜åŒ–ï¼Œä»è€Œåœ¨ä¸åŒ Flutter é¡µé¢åˆ‡æ¢æ—¶è§¦å‘çš„ã€è¡¨ç°ä¸º Hero.child ä»å½“å‰é¡µé¢â€œé£â€åˆ°ç›®æ ‡é¡µé¢å¯¹åº”ä½ç½®ï¼Œå¹¶ä¼´éšç€ä½ç½®ã€å¤§å°ã€é€æ˜åº¦ç­‰å˜åŒ–çš„åŠ¨ç”»ã€‚</p>
<p>MaterialApp æˆ–è€… CupertinoApp å¯¹åº”çš„<code>State.initState</code>æ–¹æ³•ä¸­åˆ›å»º HeroControllerï¼Œå¹¶é€šè¿‡ HeroControllerScope æä¾›ç»™å‰é¢åˆ›å»ºçš„ WidgetsApp å†…éƒ¨åˆ›å»ºçš„ Navigator å¹¶ç»‘å®šï¼›è¿™æ ·å½“è·¯ç”±å˜åŒ–æ—¶ HeroController æ”¶åˆ°é€šçŸ¥å¹¶åœ¨<code>HeroState._startHeroTransition</code>æ–¹æ³•ä¸­é€šè¿‡<code>Hero._allHeroesFor</code>æ–¹æ³•è·å–åˆ°å½“å‰é¡µå’Œç›®æ ‡é¡µé¢çš„ Hero åŠ¨ç”»ç»„ä»¶ï¼Œå°†å…¶ Animationã€Tweenã€Rectã€_HeroState ç­‰å°è£…åˆ°_HeroFlightManifest ä¸­ï¼Œä¼ é€’ç»™<code>_HeroFlight.start</code>æ‰§è¡ŒåŠ¨ç”»ï¼Œå¹¶åœ¨<code>_HeroFlight.onTick</code>æ–¹æ³•ç›‘å¬å¤„ç†åŠ¨ç”»è¿›åº¦ï¼Œä»è€Œå¯¼è‡´<code>_HeroFlight._buildOverlay</code>åˆ›å»ºçš„è¿‡æ¸¡ Widget ä½ç½®ã€å¤§å°ã€é€æ˜åº¦ç­‰å˜åŒ–ï¼Œäº§ç”Ÿ Hero Widgetâ€œé£å…¥â€çš„è§†è§‰æ•ˆæœã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://flutter.cn/docs/development/ui/animations/hero-animations" target="_blank" rel="noopener noreferrer">ä¸»åŠ¨ç”» (Hero animations)</a></p>
<p><a href="https://api.flutter-io.cn/flutter/widgets/Hero-class.html" target="_blank" rel="noopener noreferrer">Hero class</a></p>
<p><a href="https://api.flutter-io.cn/flutter/widgets/Overlay-class.html" target="_blank" rel="noopener noreferrer">Overlay class</a></p>
<p><a href="https://github.com/cfug/flutter.cn/blob/master/examples/_animation/radial_hero_animation_animate_rectclip/main.dart" target="_blank" rel="noopener noreferrer">radial_hero_animation_animate_rectclip</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/flutter/hero/simple_hero.gif" type="image/gif"/>
    </item>
    <item>
      <title>Flutter åŠ¨ç”»åˆ†æä¹‹ Tween&amp;Curve</title>
      <link>https://jixiaoyong.github.io/blog/posts/820d6240.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/820d6240.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter åŠ¨ç”»åˆ†æä¹‹ Tween&amp;Curve</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 21 Aug 2022 08:28:43 GMT</pubDate>
      <content:encoded><![CDATA[<p>åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº† Flutter ä¸­ä¸»è¦ç”±<a href="https://jixiaoyong.github.io/blog/posts/6ec43bd8/" target="_blank" rel="noopener noreferrer">AnimationController</a>æ§åˆ¶åŠ¨ç”»çš„å¼€å§‹ã€ç»“æŸï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹å…¶åªèƒ½äº§ç”Ÿ<strong>çº¿æ€§å˜åŒ–çš„ double ç±»å‹çš„ value</strong>ï¼Œå¦‚æœæƒ³éšæ—¶é—´å˜åŒ–ï¼Œè®© Widget äº§ç”Ÿ Sizeã€Offset ç­‰å±æ€§çš„å˜åŒ–ï¼Œäº¦æˆ–è€…æ§åˆ¶è¿™äº›å€¼å˜åŒ–çš„é€Ÿåº¦å¿«æ…¢ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ° Tween å’Œ Curve äº†ã€‚</p>
<p>ä¸‹å›¾æ˜¯ Tween/Curve/AnimationController ç­‰ç±»çš„å…³ç³»ç®€å•ç¤ºæ„ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_struct1.png" alt="Flutter å„ç§åŠ¨ç”»åº•å±‚ç±»å…³ç³»" tabindex="0" loading="lazy"><figcaption>Flutter å„ç§åŠ¨ç”»åº•å±‚ç±»å…³ç³»</figcaption></figure>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š</p>
<ul>
<li><strong>Tween</strong> å’Œ <strong>CurveTween</strong> éƒ½ç»§æ‰¿è‡ª <strong>Animatable</strong>ï¼Œå¯ä»¥æŒ‰ç…§ç»™å®šçš„ Animation&lt;double&gt;ç”Ÿäº§ T ç±»å‹çš„å€¼ï¼Œä»è€Œå¯ä»¥<em>ä» AnimationController ä¸­è¡ç”Ÿå‡ºå…¶ä»–ç±»å‹çš„ Animation</em>ï¼›</li>
<li>è€Œ <strong>Curve</strong> ç»§æ‰¿è‡ª <em>ParametricCurve</em>ï¼Œé™¤äº†ä¹‹å‰æ–‡ç« ä¸­åˆ†æçš„ä¼ å…¥ <code>AnimationController.animateTo</code> å’Œ <code>AnimationController.animateBack</code> ä¸­ä»è€Œä½œç”¨äºå…¶åˆ›å»ºçš„<code>_InterpolationSimulation.x()</code>æ–¹æ³•ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥è¢«ä¼ å…¥ CurveTween æˆ– CurvedAnimation ä¸­ï¼Œå°† Curve åº”ç”¨äº AnimationControllerã€‚</li>
</ul>
<p>ä¸Šè¿°å…³äº Tween å’Œ CurveTween å’Œ AnimationController ä½œç”¨çš„æ–¹å¼ï¼Œå…¶å®ç°éƒ½æ˜¯ä¾èµ–äº <code>Animation&lt;T&gt; Animatable.animate(Animation&lt;double&gt; parent)</code> æ–¹æ³•ï¼Œæ ¹æ®ä¼ å…¥çš„ Animation&lt;double&gt;ï¼ˆä¸€èˆ¬ä¼šæ˜¯ AnimationController å¯¹è±¡ï¼‰åˆ›å»ºæ–°çš„ Animation&lt;T&gt;ï¼ˆå®é™…ä¸Šæ˜¯ç»§æ‰¿è‡ª Animation çš„_AnimatedEvaluationï¼Œå…¶ Animation.value å–è‡ª <code>Animatable.evaluate(Animation&lt;double&gt;)</code>ï¼‰ã€‚</p>
<h2> æºç åˆ†æ</h2>
<h3> Animatable</h3>
<blockquote>
<p>An object that can produce a value of type <code>T</code> given an <code>Animation&lt;double&gt;</code> as input.</p>
</blockquote>
<p>Animatable æ ¹æ®ä¼ å…¥çš„<code>Animation&lt;double&gt;</code>å¯¹è±¡åˆ›å»º T ç±»å‹çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶<em>å°† Animation äº§ç”Ÿçš„ double ç±»å‹â€œè½¬åŒ–â€ä¸º T ç±»å‹</em>ï¼Œä»è€Œä½¿å¾— Flutter æ”¯æŒæ›´åŠ ä¸°å¯Œçš„åŠ¨ç”»ã€‚</p>
<blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ª<code>Animation&lt;double&gt;</code>çš„å€¼èŒƒå›´æ˜¯[0.0,1.0]ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½è¶…å‡ºæ­¤èŒƒå›´ã€‚</p>
</blockquote>
<p>è€Œè¿™ä¸€åˆ‡éƒ½é€šè¿‡ä»–çš„<code>animate</code>æ–¹æ³•å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œå°†æ¥æ”¶ Animation&lt;double&gt;å¯¹è±¡ä½œä¸º<code>parent</code>ï¼Œå°†è‡ªèº«ä½œä¸º<code>_evaluatable</code>å±æ€§åˆ›å»ºäº† Animation çš„å­ç±»_AnimatedEvaluation å¹¶è¿”å›ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†çœ‹ä¸€ä¸‹ Animatable çš„æºç ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶<code>evaluate</code>æ–¹æ³•å†…éƒ¨é€šè¿‡å…¶å”¯ä¸€çš„æŠ½è±¡æ–¹æ³•<code>transform</code>æ–¹æ³•å®ç°ï¼ŒAnimatable çš„å„ä¸ªå­ç±»ä¹Ÿåªéœ€è¦å®ç°<code>transform</code>æ–¹æ³•å³å¯ã€‚</p>
<p>é™¤äº†ä¸Šè¿°ä¸ Animation æœ‰å…³çš„ä¸‰ä¸ªæ–¹æ³•å¤–ï¼ŒAnimatable è¿˜æœ‰ä¸€ä¸ªé“¾æ¥ä¸¤ä¸ª Animatable çš„æ–¹æ³•â€”â€”<code>Animatable.chain()</code>ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ Animatable.animate æ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯æ­¤æ–¹æ³•è¿”å›çš„æ˜¯ Animatable&lt;T&gt;çš„å­ç±»â€”â€”_ChainedEvaluation</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥æ­¤æ–¹æ³•ä½œç”¨æ˜¯ç»“åˆä¸¤ä¸ª Animatable çš„æ•ˆæœã€‚</p>
<br>
<p>Animatable çš„ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®ä¼ å…¥çš„ Animation åˆ›å»ºå¯¹åº”çš„ T ç±»å‹çš„å€¼ï¼›å…¶ä¸»è¦çš„å­ç±»æœ‰ Tweenã€CurveTweenã€TweenSequenceã€‚</p>
<p>TweenSequence çš„ä½œç”¨äº_chainedEvaluation ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒå¯ä»¥å°†å¤šä¸ª Animatable æŒ‰ç…§æ‰€å æ¯”é‡ weight åœ¨ Animatable.transform ä¸­åº”ç”¨ã€‚</p>
<h3> Tween</h3>
<blockquote>
<p>A linear interpolation (æ’å€¼) between a beginning and ending value.</p>
</blockquote>
<p>Tween æ˜¯ Animatable çš„ä¸»è¦å­ç±»ä¹‹ä¸€ï¼Œä½œç”¨æ ¹æ®ä¼ å…¥çš„ Animationï¼ˆé€šå¸¸æ˜¯ AnimationControllerï¼‰æ˜¯åœ¨ä¼ å…¥çš„<strong>begin å’Œ end å€¼ä¹‹é—´åˆ›å»ºçº¿æ€§çš„æ’å€¼</strong>ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä» Tween çš„æºç å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå®ç°äº†çˆ¶ç±» Animatable.transform æ–¹æ³•ï¼Œå¹¶åœ¨ t åœ¨ (0.0,1.0) ä¹‹é—´æ—¶è°ƒç”¨ Tween.lerp æ–¹æ³•è·å–å¯¹åº”çš„å€¼ï¼Œé»˜è®¤çº¿æ€§çš„åœ¨ T ä¸Šåº”ç”¨åŠ å‡ä¹˜è¿ç®—ï¼Œå¹¶è¿”å›ç»“æœã€‚Tween çš„å­ç±»åªéœ€è¦é‡å†™ Tween.lerp æ–¹æ³•è€Œé Animatable.transform æ–¹æ³•ã€‚</p>
<p>è¿™ä¹Ÿå°±è¦æ±‚ï¼š</p>
<ul>
<li>
<p>æ”¯æŒ <code>lerp</code> é™æ€æ–¹æ³•çš„ç±»é€šå¸¸æœ‰å¯¹åº”çš„ Tween å­ç±»ï¼Œä¸€èˆ¬ä»¥ <em>FooTween</em> å‘½åï¼Œæ¯”å¦‚ ColorTween å°±æ˜¯å€ŸåŠ© Color.lerp æ–¹æ³•å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><em>Tween&lt;T&gt;</em> çš„ç±»å‹ T å¿…é¡»æ”¯æŒ<code>+-*</code>ä¸‰ç§è¿ç®—ï¼Œå¹¶ä¸”è¿”å›å€¼è¿˜æ˜¯ Tï¼›</p>
</li>
<li>
<p>å¯¹äº int æ¥è¯´ï¼Œå› ä¸º int*double=num è€Œé intï¼Œæœ‰å¯¹åº”çš„ç‰¹æ®Šç±»ï¼š</p>
<ul>
<li>IntTweenï¼Œä½¿ç”¨ double.round å®ç°è¿‘ä¼¼çº¿æ€§æ’å€¼</li>
<li>StepTweenï¼Œä½¿ç”¨ double.floor ç¡®ä¿ç»“æœæ°¸è¿œä¸ä¼šå¤§äºä½¿ç”¨ Tween&lt;double&gt;çš„å€¼</li>
</ul>
</li>
</ul>
<p>åœ¨ä½¿ç”¨æ—¶ï¼Œå¦‚æœ Tween ç¡®å®šä¸ä¼šå˜åŒ–ï¼Œå°±å¯ä»¥å°†å…¶ä¿å­˜åœ¨<code>static final</code>å¯¹è±¡ä¸­ä»¥ä¾¿åœ¨éœ€è¦çš„åœ°æ–¹å…±äº«åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œéåœ¨ State.build æ–¹æ³•ä¸­å®æ—¶åˆ›å»ºã€‚</p>
<h3> CurveTween</h3>
<p>CurveTween ç»§æ‰¿è‡ª Animatable&lt;double&gt;ï¼Œå¸¸è§çš„ç”¨æ³•æ˜¯ä¼ å…¥<code>AnimationController.drive</code>æ–¹æ³•ä¸­è·å–ä¸€ä¸ªæ–°çš„ Animation&lt;double&gt;:</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tween å’Œ CurveTween çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼ŒTween éœ€è¦ Tï¼Ÿç±»å‹çš„ begin å’Œ end æ¥åˆ›å»ºçº¿æ€§æ’å€¼ï¼Œè€Œ CurveTween åˆ™éœ€è¦ Curve ä»¥ä¾¿ä¸º Animation&lt;double&gt;åˆ›å»ºï¼ˆéï¼‰çº¿æ€§æ’å€¼ã€‚</p>
<h3> Curve</h3>
<p>ParametricCurve&lt;T&gt;æ˜¯ Curve çš„çˆ¶ç±»ï¼Œå…¶æä¾› ParametricCurve.transform æ–¹æ³•å°† double tï¼ˆåœ¨[0.0,1.0]ä¹‹é—´ï¼‰è½¬åŒ–ä¸ºæ›²çº¿åœ¨ t å¤„å¯¹åº”çš„å€¼ T tï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»å…¶æºç å¯ä»¥çœ‹å‡ºï¼ŒParametricCurve.transform ä¸»è¦æ˜¯æ£€æŸ¥å…¥å‚æ˜¯å¦åˆè§„ï¼Œå…¶ä¸»è¦é€»è¾‘åœ¨ ParametricCurve.transformInternal ä¸­ï¼Œä¸€èˆ¬å­ç±»åªéœ€è¦å®ç°åè€…å³å¯ã€‚</p>
<p>Curve ç»§æ‰¿è‡ª ParametricCurve&lt;double&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½äº§ç”Ÿ double ç±»å‹çš„æ’å€¼ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Curve é‡å†™äº†çˆ¶ç±»çš„ transform æ–¹æ³•ä»¥è§„èŒƒå¯¹ double t çš„å¤„ç†ï¼Œä½†è¿˜æ˜¯å»ºè®®å­ç±»åªéœ€è¦å®ç° <code>ParametricCurve.transformInternal</code> æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬ä»¥ Curve çš„å­ç±»_Linear ä¸ºä¾‹ï¼ŒæŸ¥çœ‹å®ç° Curve çš„è¿‡ç¨‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»çš„æ¥è¯´ï¼ŒCurve åŠå…¶å­ç±»å®šä¹‰äº†ä¸€ä¸ªæ›²çº¿ï¼ˆå¯èƒ½æ˜¯çº¿æ€§å˜åŒ–ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ï¼‰ï¼Œå¹¶æä¾›äº†<code>double Curve.transform(double t)</code>ä¾›ä½¿ç”¨è€…è·å–æŒ‡å®šæ—¶é—´ double t æ—¶æ›²çº¿ä¸Šå¯¹åº”çš„å€¼ doubleã€‚</p>
<p>Flutter ä¸ºæˆ‘ä»¬é¢„ç½®äº†å¾ˆå¤šä¸°å¯Œçš„ Curveï¼Œå¯ä»¥åœ¨è¿™é‡Œé¢„è§ˆï¼š<br>
<a href="https://api.flutter.dev/flutter/animation/Curves-class.html" target="_blank" rel="noopener noreferrer">Curves</a>ã€‚</p>
<h2> æ€»ç»“</h2>
<p>ç»è¿‡ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæ— è®ºæ˜¯ Tween è¿˜æ˜¯ CurveTweenï¼Œä½œä¸º Animatableï¼Œä»–ä»¬æä¾›äº†<code>Animation&lt;T&gt; Animatable.animatee(Animation&lt;double&gt; parent)</code>æ–¹æ³•ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªæ–°çš„ï¼Œç›¸å½“äºä½¿ç”¨<code>Animatable&lt;T&gt;.transform(double parent.value)</code>è®¡ç®—<code>Animation&lt;T&gt;.value</code>çš„ï¼ŒAnimation&lt;T&gt;ã€‚</p>
<p>è€Œ Curveï¼Œåªèƒ½é€šè¿‡<code>double transform(double t)</code>è®¡ç®—æ›²çº¿åœ¨ t ä½ç½®çš„å€¼çš„ç±»ï¼Œä¸€èˆ¬å¯ä»¥åœ¨ CurveTweenã€CurveAnimation çš„æ„é€ æ–¹æ³•æˆ–è€… AnimationController çš„ animateTo/animateBack æ–¹æ³•ä¸­ï¼Œä»¥ä¾¿äº§ç”Ÿéçº¿æ€§çš„åŠ¨ç”»ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://api.flutter.dev/flutter/animation/Animatable-class.html" target="_blank" rel="noopener noreferrer">Animatable api.flutter.dev</a></p>
<p><a href="https://api.flutter.dev/flutter/animation/Tween-class.html" target="_blank" rel="noopener noreferrer">Tween api.flutter.dev</a></p>
<p><a href="https://api.flutter.dev/flutter/animation/CurveTween-class.html" target="_blank" rel="noopener noreferrer">CurveTween api.flutter.dev</a></p>
<p><a href="https://api.flutter.dev/flutter/animation/Curve-class.html" target="_blank" rel="noopener noreferrer">Curve api.flutter.dev</a></p>
<p><a href="https://api.flutter.dev/flutter/animation/Curves-class.html" target="_blank" rel="noopener noreferrer">Curves api.flutter.dev</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/flutter/animate/flutter_animate_struct1.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter å›¾ç‰‡åŠ è½½æ–¹æ¡ˆåˆ†æä¹‹ Image</title>
      <link>https://jixiaoyong.github.io/blog/posts/1912667a.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/1912667a.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter å›¾ç‰‡åŠ è½½æ–¹æ¡ˆåˆ†æä¹‹ Image</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 27 Jul 2022 07:31:03 GMT</pubDate>
      <content:encoded><![CDATA[<p>Flutter é»˜è®¤æä¾›äº†<strong>Image</strong>ç”¨äºä»ç½‘ç»œã€æ–‡ä»¶ç­‰åŠ è½½å›¾ç‰‡ï¼Œå¹¶ä¸”ä½¿ç”¨<strong>ImageCache</strong>ç»Ÿä¸€ç®¡ç†å›¾ç‰‡ç¼“å­˜ï¼Œä½†æœ‰æ—¶å€™å¹¶ä¸èƒ½æ»¡è¶³ä½¿ç”¨éœ€æ±‚ï¼ˆæ¯”å¦‚ç½‘ç»œå›¾ç‰‡æ²¡æœ‰ç£ç›˜ç¼“å­˜ï¼Œå¯¼è‡´æ¯æ¬¡ ImageCache æ¸…é™¤ç¼“å­˜ä¹‹ååˆè¦ä»ç½‘ç»œä¸‹è½½ï¼‰ï¼Œæ‰€ä»¥åˆå‡ºç°äº†<a href="https://github.com/Baseflow/flutter_cached_network_image" target="_blank" rel="noopener noreferrer">flutter_cached_network_image</a>ã€<a href="https://github.com/fluttercandies/extended_image" target="_blank" rel="noopener noreferrer">extended_image</a>ç­‰åŸºäº Flutter åŸç”Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠ<a href="https://github.com/alibaba/power_image" target="_blank" rel="noopener noreferrer">power_image</a>ç­‰åŸºäºæ··åˆå¼€å‘çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡å¯¹ Flutter ä¸­çš„ Image åŠ è½½è¿‡ç¨‹ã€åŸç†åšä¸€ç®€å•åˆ†æã€‚</p>
<h2> å›¾ç‰‡å±•ç¤ºçš„æµç¨‹</h2>
<p>é¦–å…ˆï¼Œç®€å•æ¢³ç†ä¸€ä¸‹å›¾ç‰‡ä»åŠ è½½åˆ°å±•ç¤ºçš„è¿‡ç¨‹ã€‚</p>
<h3> Image</h3>
<p><em><code>A widget that displays an image.</code></em></p>
<p>åœ¨æŸ¥çœ‹ Image å…·ä½“å®ç°ä¹‹å‰ï¼Œå…ˆäº†è§£å‡ ä¸ªåŸºç¡€æ–¹æ³•ï¼š</p>
<ul>
<li><code>ImageConfiguration createLocalImageConfiguration(BuildContext context, { Size? size })</code> ï¼šåˆ›å»º <strong>ImageConfiguration</strong>ï¼Œä¸€èˆ¬ç”¨äº <code>state.didChangeDependencies</code> ç­‰ä¾èµ–å˜åŒ–æ—¶ä¼šè°ƒç”¨çš„åœ°æ–¹ï¼Œå…¶åˆ›å»ºçš„ ImageConfiguration å¯¹è±¡ä¼šä¼ å…¥ <code>BoxPainter.paint</code> æˆ–è€… <code>ImageProvider.resolver</code> æ–¹æ³•ä¸­ä»¥ç”¨æ¥è·å– <strong>ImageStream</strong>ã€‚</li>
<li><code>Future&lt;void&gt; precacheImage(...)</code> é¢„å…ˆåŠ è½½ image åˆ° <strong>ImageCache</strong> ä¸­ï¼Œä»¥ä¾¿ Imageã€BoxDecorationã€FadeInImage ç­‰èƒ½å¤Ÿæ›´å¿«åœ°åŠ è½½ imageã€‚</li>
</ul>
<p>Image æ˜¯ Flutter ä¸­ç”¨äºå±•ç¤ºå›¾ç‰‡çš„ Widgetï¼Œä¸»è¦æœ‰å¦‚ä¸‹ç”¨æ³•ï¼š</p>
<ul>
<li><a href="https://api.flutter.dev/flutter/widgets/Image/Image.html" target="_blank" rel="noopener noreferrer">Image.new</a>, for obtaining an image from an&nbsp;<a href="https://api.flutter.dev/flutter/painting/ImageProvider-class.html" target="_blank" rel="noopener noreferrer">ImageProvider</a>.</li>
<li><a href="https://api.flutter.dev/flutter/widgets/Image/Image.asset.html" target="_blank" rel="noopener noreferrer">Image.asset</a>, for obtaining an image from an&nbsp;<a href="https://api.flutter.dev/flutter/services/AssetBundle-class.html" target="_blank" rel="noopener noreferrer">AssetBundle</a>&nbsp;using a key.</li>
<li><a href="https://api.flutter.dev/flutter/widgets/Image/Image.network.html" target="_blank" rel="noopener noreferrer">Image.network</a>, for obtaining an image from a URL.</li>
<li><a href="https://api.flutter.dev/flutter/widgets/Image/Image.file.html" target="_blank" rel="noopener noreferrer">Image.file</a>, for obtaining an image from a&nbsp;<a href="https://api.flutter.dev/flutter/dart-io/File-class.html" target="_blank" rel="noopener noreferrer">File</a>.</li>
<li><a href="https://api.flutter.dev/flutter/widgets/Image/Image.memory.html" target="_blank" rel="noopener noreferrer">Image.memory</a>, for obtaining an image from a&nbsp;<a href="https://api.flutter.dev/flutter/dart-typed_data/Uint8List-class.html" target="_blank" rel="noopener noreferrer">Uint8List</a>.</li>
</ul>
<p>æ”¯æŒçš„æ ¼å¼æœ‰ï¼šJPEG, PNG, GIF, Animated GIF, WebP, Animated WebP, BMP, and WBMPï¼Œä»¥åŠä¾èµ–äºç‰¹å®šè®¾å¤‡çš„æ ¼å¼ï¼ˆFlutter ä¼šå°è¯•ä½¿ç”¨å¹³å° API è§£ææœªçŸ¥æ ¼å¼ï¼‰ã€‚</p>
<p>é€šè¿‡æŒ‡å®š<code>cacheWidth</code>å’Œ<code>cacheHeight</code>å¯ä»¥è®©å¼•æ“æŒ‰ç…§æŒ‡å®šå¤§å°è§£ç å›¾ç‰‡ï¼Œå¯ä»¥é™ä½ ImageCache å ç”¨çš„å†…å­˜ã€‚</p>
<p><code>Image(...)</code>æ„é€ å‡½æ•°ä¸­åªæœ‰ä¸€ä¸ªå¿…ä¼ é¡¹<code>ImageProvider image</code>ç”¨äºè·å–å›¾ç‰‡ï¼Œå…¶ä½™å››ç§æ„é€ æ–¹æ³•ä¹Ÿéƒ½æ˜¯åœ¨æ­¤æ–¹æ³•çš„åŸºç¡€ä¸Šåˆ†åˆ«æŒ‡å®šäº†å„è‡ªçš„ <strong>ImageProvider</strong>ï¼Œä»¥<code>Image.network</code>ä¸ºä¾‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­çš„ ResizeImageï¼ŒNetworkImage ç­‰éƒ½ç»§æ‰¿è‡ª <strong>ImageProvider</strong>ï¼Œ<code>ImageProvider.resolve</code>æ–¹æ³•åˆ›å»ºå¹¶è¿”å› <strong>ImageStream</strong> ä¾› <strong>Image</strong> ä½¿ç”¨ï¼Œå†…éƒ¨é€šè¿‡<code>ImageProvider.resolveStreamForKey</code>æ–¹æ³•ä» <strong>ImageCache</strong> æˆ–è€…å­ç±»æŒ‡å®šçš„é€”å¾„ï¼ˆæ¯”å¦‚ NetworkImage ä¼šä»ç½‘ç»œï¼‰åŠ è½½å›¾ç‰‡ï¼ˆå¹¶ä¿å­˜åˆ° ImageCacheï¼‰ã€‚</p>
<h3> _ImageState</h3>
<p><strong>Image</strong>æ˜¯ <em>StatefulWidget</em>ï¼Œå¤„ç† image çš„ä¸»è¦é€»è¾‘åœ¨ <strong>_ImageState</strong> ä¸­ï¼šå…¶æ··å…¥äº†<strong>WidgetsBindingObserver</strong>ä»¥ä¾¿ç›‘å¬ç³»ç»Ÿç”Ÿå‘½å‘¨æœŸï¼›åœ¨å†…éƒ¨é€šè¿‡ç›‘å¬<strong>ImageStream</strong>è·å¾—<strong>ImageInfo</strong>å¹¶æœ€ç»ˆåœ¨<code>_ImageState.build</code>æ–¹æ³•ä¸­åˆ›å»º<strong>RawImage</strong>ï¼›RawImage æ˜¯ä¸€ä¸ª<em>LeafRenderObjectWidget</em>ï¼Œä¼šåˆ›å»º<strong>RenderImage</strong>å¹¶åœ¨<code>RenderImage.paint</code>æ ¹æ®ä¹‹å‰è·å–çš„ä¿¡æ¯è°ƒç”¨<code>DecorationImagePainter.paintImage</code>æ–¹æ³•é€šè¿‡<code>canvas.drawImageRect</code>ç»˜åˆ¶å›¾ç‰‡ã€‚</p>
<h4> _resolveImage</h4>
<p>å½“ä¾èµ–å˜åŒ–ï¼ˆ<code>didChangeDependencies()</code>ï¼‰ã€Widget å˜åŒ–ï¼ˆ<code>didUpdateWidget(Image oldWidget)</code>ï¼‰ã€ä»¥åŠçƒ­æ›´æ–°ï¼ˆ<code>reassemble()</code>ï¼‰æ—¶ï¼Œ_ImageState ä¼šæ‰§è¡Œ<code>_resolveImage()</code>æ–¹æ³•é€šè¿‡ ImageProvider è·å– ImageStreamï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬è¿˜å¯ä»¥æ³¨æ„åˆ°ï¼Œå½“åœ¨<code>_resolveImage()</code>ä¸­è·å–åˆ° ImageStream ä¹‹åï¼Œä¼šé€šè¿‡<code>_updateSourceStream()</code>æ›´æ–° ImageStreamã€‚</p>
<h4> _updateSourceStream</h4>
<p>åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œå…ˆæ˜¯æ›´æ–°äº†<code>ImageStream? _imageStream</code> å¯¹è±¡ï¼Œç„¶åæ ¹æ®<code>_isListeningToStream</code>çš„å€¼æ‰§è¡Œ<code>_imageStream!.addListener(_getListener())</code>æ›´æ–° ImageStream çš„ Listenerï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ <strong>ImageStreamListener</strong> ä¸­ï¼Œæ ¹æ® ImageStream çš„ä¸åŒçŠ¶æ€åˆ†åˆ«æ›´æ–° Image çš„æ˜¾ç¤ºã€‚</p>
<h4> _handleImageFrame</h4>
<p><code>_handleImageFrame()</code>æ–¹æ³•ä½¿ç”¨ ImageStream ä¸­è¿”å›çš„<strong>ImageInfo</strong>ï¼Œè°ƒç”¨<code>setState</code>æ–¹æ³•æ›´æ–°_ImageState ä¸­çš„<code>ImageInfo? **_imageInfo**</code>å±æ€§ï¼Œä»è€Œåˆ·æ–° Image å±•ç¤ºã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ImageInfo</strong>ç±»å†…éƒ¨æŒæœ‰<strong>ui.Image</strong>å’Œå…¶å¯¹åº”çš„<code>scale</code>ï¼Œä»¥åŠä¸€ä¸ªè·å–å›¾ç‰‡åƒç´ å¤§å°çš„<code>sizeBytes</code>æ–¹æ³•ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> build</h4>
<p>ä¸Šé¢åˆ†æäº†_ImageState å¦‚ä½•ç›‘å¬ä½¿ç”¨ ImageProvider è·å–åˆ°çš„ ImageStreamï¼Œä»ä¸­è·å– ImageInfo æ›´æ–°è‡ªå·±çš„ <code>ImageInfo? _imageInfo</code> å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§æ˜¯å¦‚ä½•å½±å“åˆ°æˆ‘ä»¬çš„ Image å±•ç¤ºå›¾ç‰‡çš„å‘¢ï¼Œå…³é”®å°±åœ¨ <code>build</code> æ–¹æ³•ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ImageInfo.image</code> æ˜¯<strong>ui.Image</strong>å¯¹è±¡ï¼Œæ˜¯åŸå§‹çš„ image åƒç´ ï¼Œé€šè¿‡<strong>RawImage</strong>ä¼ å…¥åˆ°<code>Canvas.drawImageRect</code>æˆ–è€…<code>Canvas.drawImageNine</code>ç»˜åˆ¶å›¾ç‰‡ã€‚</p>
<h3> RawImage</h3>
<p><em>A widget that displays a <code>[dart:ui.Image]</code> directly.</em></p>
<p>RawImage ç»§æ‰¿è‡ª <em>LeafRenderWidget</em>ï¼Œå¯ä»¥ç›´æ¥å±•ç¤º<code>ui.Image</code>çš„å†…å®¹ï¼Œåè€…æ˜¯è§£ç çš„å›¾ç‰‡æ•°æ®çš„ä¸é€æ˜å¥æŸ„ï¼ˆ<em>Opaque handle to raw decoded image data (pixels)</em>ï¼‰ã€æ˜¯å¯¹<code>_Image</code>ç±»çš„å°è£…ã€å¯¹å¤–æä¾›å®½é«˜ä»¥åŠ<code>Image.toByteData</code>ï¼ˆå°†<code>ui.Image</code>å¯¹è±¡è½¬åŒ–ä¸º<code>ByteData</code>ï¼ŒByteData å¯ä»¥ç›´æ¥ä¼ å…¥<code>Canvas.drawImageRect</code>æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ã€‚</p>
<p>RawImage ä¸»è¦é€»è¾‘å°±æ˜¯åˆ›å»º/æ›´æ–° RenderImage çš„æ—¶å€™å°†ä»<code>_ImageState.build</code>æ–¹æ³•è·å¾—çš„<code>ui.Image? image</code> çš„ clone ä¼ å…¥ï¼ˆå…¶å®å°±æ˜¯ä½¿ç”¨<code>ui.Image? image</code>å¯¹åº”çš„<code>_Image _image</code> æ–°å»ºäº†ä¸€ä¸ª ui.Imageï¼Œæ¯ä¸€ä¸ª ui.Image éƒ½æ˜¯_image çš„ä¸€ä¸ªå¥æŸ„ï¼Œåªæœ‰å½“æ²¡æœ‰ ui.Image æŒ‡å‘_image æ—¶åè€…æ‰ä¼šçœŸæ­£çš„ disposeï¼‰ã€‚</p>
<h3> RenderImage</h3>
<p><em>An image in the render tree.</em></p>
<p>RenderImage ä½œä¸ºä¸€ä¸ª RenderBoxï¼Œåœ¨ä» RawImage é‚£é‡Œæ‹¿åˆ°<code>ui.Image? _image</code>ä¹‹åï¼Œç„¶ååœ¨å…¶<code>RenderImage.paint</code>æ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨<code>paintImage</code>æ–¹æ³•ç»˜åˆ¶<code>_image</code>ä»£è¡¨çš„å›¾ç‰‡ã€‚</p>
<blockquote>
<p>ui.Image å®é™…æ˜¯ ui._Image çš„åŒ…è£…ç±»ï¼Œå®ƒçš„ widthã€heightã€toByteData ç­‰æ–¹æ³•æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨ ui._Image å¯¹åº”çš„å®ç°ã€‚</p>
</blockquote>
<p><code>paintImage</code> æ–¹æ³•æ˜¯ä½äº <em>lib\src\painting\decoration_image.dart</em> çš„å…¨å±€æ–¹æ³•ï¼Œåœ¨å…¶å†…éƒ¨è°ƒç”¨ canvas ç»˜åˆ¶_image å¯¹åº”çš„å›¾ç‰‡ã€‚</p>
<br>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<strong>Image</strong>ä¸­ï¼Œæ ¹æ®æ„é€ æ–¹æ³•çš„ä¸åŒåˆ›å»ºäº†ä¸åŒçš„<strong>ImageProvider</strong>å¯¹è±¡ä½œä¸º<code>Image.image</code>å‚æ•°ï¼›</p>
<p>ç„¶ååœ¨ <strong>_ImageState</strong> ä¸­ï¼Œä½¿ç”¨<code>ImageProvider.resolve</code>æ–¹æ³•åˆ›å»ºå¹¶æ›´æ–°<code>ImageStream? _imageStream</code>ï¼Œå¹¶ä¸”ç›‘å¬<strong>ImageStream</strong>ä»¥ä¾¿åœ¨å›¾ç‰‡åŠ è½½æˆåŠŸä¹‹åè·å–<code>ImageInfo? _imageInfo</code>ï¼›</p>
<p>è¿™ä¸ª<strong>ImageInfo</strong>æ˜¯å¯¹<strong>ui.Image</strong>çš„å°è£…ç±»ï¼Œåœ¨<code>_ImageState.build</code>æ–¹æ³•ä¸­è¢«ä¼ å…¥<strong>RawImage</strong>ï¼Œåè€…åˆ™åˆ›å»ºäº†<strong>RenderImage</strong>å¹¶æœ€ç»ˆå°† ui.Image çš„å†…å®¹ç»˜åˆ¶åœ¨å±å¹•ä¸Šé¢ã€‚</p>
<br>
<h2> å›¾ç‰‡è·å–ä¸ç¼“å­˜</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¤§ä½“æ¢³ç†äº†å›¾ç‰‡å±•ç¤ºçš„è¿™éƒ¨åˆ†æµç¨‹ï¼Œæ­¤å¤–ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†åŒæ ·é‡è¦çš„æµç¨‹â€”â€”å›¾ç‰‡çš„è·å–ä¸ç¼“å­˜ã€‚</p>
<h3> ImageProvider</h3>
<p><strong>ImageProvider</strong> æ˜¯è·å–å›¾ç‰‡èµ„æºçš„åŸºç±»ï¼Œå…¶ä»–ç±»å¯ä»¥è°ƒç”¨<code>ImageProvider.resolve</code>æ–¹æ³•è·å– <strong>ImageStream</strong> ï¼Œæ­¤æ–¹æ³•ä¼šè°ƒç”¨<code>ImageCache.putIfAbsent</code>ä¼˜å…ˆä» <strong>ImageCache</strong> ä¸­è·å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨<code>ImageProvider.load</code>æ–¹æ³•è·å–å¹¶ç¼“å­˜åˆ° ImageCache ä¸­ã€‚</p>
<p>å…¶å­ç±»ä¸€èˆ¬åªéœ€è¦é‡å†™<code>ImageProvider</code>çš„<code>ImageStreamCompleter load(T key, DecoderCallback decode)</code>å’Œ<code>Future&lt;T&gt; obtainKey(ImageConfiguration configuration)</code>æ–¹æ³•å³å¯ã€‚</p>
<p>ä»¥<code>NetworkImage</code>åŠ è½½ç½‘ç»œå›¾ç‰‡çš„è¿‡ç¨‹ä¸ºä¾‹ï¼š</p>
<blockquote>
<p>æˆ‘ä»¬é€šè¿‡<code>NetworkImage()</code>æ–¹æ³•è·å–çš„å®é™…æ˜¯<code>network_image.NetworkImage</code>å¯¹è±¡ã€‚</p>
</blockquote>
<p>å½“<code>_ImageState._resolveImage()</code>æ–¹æ³•è°ƒç”¨<code>ImageProvider.resolve</code>æ–¹æ³•æ—¶ï¼Œå†…éƒ¨ä¼šè°ƒç”¨<code>ImageProvider.resolveStreamForKey</code>æ–¹æ³•ï¼Œåœ¨å…¶å†…éƒ¨ä¼šæ‰§è¡Œï¼š</p>
<ul>
<li>é€šè¿‡<code>ImageProvider.obtainKey</code>è·å–å›¾ç‰‡å¯¹åº”çš„ key</li>
<li>æ‰§è¡Œ<code>PaintingBinding.*instance*!.imageCache!.putIfAbsent(key,() =&gt;</code> <code>load(key, PaintingBinding.*instance*!.instantiateImageCodec),onError: handleError,)</code>æ–¹æ³•ï¼Œä¼˜å…ˆä» imageCache ä¸­è·å–ç¼“å­˜çš„å›¾ç‰‡ï¼Œæ²¡æœ‰çš„è¯æ‰§è¡Œ<code>ImageProvider.load</code>æ–¹æ³•è·å–å›¾ç‰‡ã€‚</li>
</ul>
<p>å¯¹äº<code>network_image.NetworkImage</code>å¯¹è±¡ï¼Œä»–çš„<code>obtainKey()</code>å’Œ<code>load()</code>æ–¹æ³•å®ç°å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™å…¶ä¸­ï¼Œ<code>network_image.NetworkImage._loadAsync()</code>æ–¹æ³•æ‰æ˜¯çœŸæ­£ä½¿ç”¨<code>HttpClient</code>ä»ç½‘ä¸Šè·å–å›¾ç‰‡èµ„æºçš„æ–¹æ³•ï¼ˆå®é™…ä¸Š AssetBundleImageProviderã€FileImage å’Œ MemoryImage ç­‰ä¸€ä¼— ImageProvider ç­‰éƒ½çº¦å®šä¿—æˆåœ¨<code>_loadAsync</code> ä¸­æ‰§è¡ŒçœŸæ­£è·å–å›¾ç‰‡çš„é€»è¾‘ï¼‰ï¼Œè¿”å›å€¼ Future&lt;ui.Codec&gt;å’Œ ui.Image çš„å…³ç³»å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ImageCache</h3>
<p><em>Class for caching images.</em></p>
<p>åœ¨ä¸Šé¢æ–¹åˆ†æ ImageProvider çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ¯æ¬¡é€šè¿‡<code>ImageProvider.resolveStreamForKey</code>æ–¹æ³•è·å– ImageStream æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨<code>PaintingBinding.instance!.imageCache.putIfAbsent</code>æ–¹æ³•ä¼˜å…ˆè·å–<strong>Image å¯¹è±¡çš„ç¼“å­˜</strong>ï¼Œè¿™å°±æ¶‰åŠåˆ°å’Œ Image ç¼“å­˜æœ‰å…³çš„ç±»â€”â€”<strong>ImageCache</strong>ã€‚</p>
<p>ImageCache å¯¹è±¡å…¨å±€å”¯ä¸€ï¼Œä½¿ç”¨ LRU ç®—æ³•æœ€å¤šç¼“å­˜<strong>1000 å¼ æˆ–è€…æœ€å¤§ 100MB å›¾ç‰‡</strong>ï¼Œå¯ä»¥åˆ†åˆ«ä½¿ç”¨<code>maximumSize</code>å’Œ<code>maximumSizeBytes</code>ä¿®æ”¹é…ç½®ã€‚</p>
<p>å…¶å†…éƒ¨ç»´æŒæœ‰ä¸‰ä¸ª Mapï¼š</p>
<ul>
<li><code>Map&lt;Object, PendingImage&gt; _pendingImages</code> æ­£åœ¨åŠ è½½ä¸­çš„å›¾ç‰‡ï¼Œå¯èƒ½å¯èƒ½åŒæ—¶ä¹Ÿæ˜¯<code>_liveImage</code>ï¼ˆå¯¹åº”çš„ ImageStream å·²ç»è¢«ç›‘å¬äº†ï¼‰ã€‚</li>
<li><code>Map&lt;Object, _CachedImage&gt; _cache</code> ç¼“å­˜çš„å›¾ç‰‡ï¼ŒmaximumSize å’Œ maximumSizeBytes é™åˆ¶é’ˆå¯¹çš„æ˜¯<code>_cache</code>ã€‚</li>
<li><code>Map&lt;Object, _LiveImage&gt; _liveImages</code> æ­£åœ¨ä½¿ç”¨çš„å›¾ç‰‡ï¼Œä»–çš„ ImageStreamCompleters è‡³å°‘æœ‰ä¸€ä¸ª listenerï¼Œå¯èƒ½åŒæ—¶åœ¨<code>_pendingImages</code>ï¼ˆæ‰€ä»¥è¿™é‡Œçš„_LiveImage çš„<code>sizeBytes</code>å¯èƒ½ä¸º nullï¼‰æˆ–è€…<code>_liveImages</code>ä¸­ã€‚</li>
</ul>
<p><code>_CachedImage</code>å’Œ<code>_LiveImage</code>éƒ½ç»§æ‰¿è‡ª<code>_CachedImageBase</code>ï¼Œå…¶å†…éƒ¨æŒæœ‰<code>ImageStreamCompleter</code>ï¼Œå›¾ç‰‡çš„ handler<code>ImageStreamCompleterHandle</code>ï¼Œä»¥åŠå›¾ç‰‡å¤§å°<code>sizeBytes</code>ã€‚</p>
<p><code>ImageCacheStatus</code>å¤„ç† ImageCache ç¼“å­˜çš„å›¾ç‰‡çŠ¶æ€ï¼š</p>
<ul>
<li><code>pending</code>ï¼Œè¿˜æ²¡æœ‰åŠ è½½å®Œæˆçš„ imageï¼Œå¦‚æœè¢«ç›‘å¬çš„è¯ï¼Œè¿˜ä¼šæ˜¯<code>live</code>çš„</li>
<li><code>keepAlive</code>ï¼Œå›¾ç‰‡ä¼šè¢«<code>ImageCache._cache</code>ä¿å­˜ã€‚å¯èƒ½æ˜¯ live çš„ï¼Œä½†ä¸ä¼š pending çš„ã€‚</li>
<li><code>live</code>ï¼Œå›¾ç‰‡ä¼šä¸€ç›´è¢«æŒæœ‰ï¼Œé™¤é<code>ImageStreamCompleter</code>æ²¡æœ‰ listener äº†ã€‚å¯èƒ½æ˜¯ pending çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ keepAlive çš„</li>
<li><code>untracked</code>ï¼Œä¸ä¼šè¢«ç¼“å­˜çš„å›¾ç‰‡ï¼ˆä¸Šè¿°ä¸‰å€¼éƒ½ä¸º falseï¼‰ã€‚</li>
</ul>
<p>å¯ä»¥ä½¿ç”¨<code>ImageCache.statusForKey</code>æˆ–è€…<code>ImageProvider.obtainCacheStatus</code>è·å–å›¾ç‰‡çŠ¶æ€<code>ImageCacheStatus</code>ã€‚</p>
<p>æ­¤å¤–ï¼ŒImageCache è¿˜æä¾›<code>ImageCache.evict</code>æ–¹æ³•ä»ç¼“å­˜ä¸­æ¸…é™¤æŒ‡å®šå›¾ç‰‡ã€‚</p>
<h4> putIfAbsent</h4>
<p>å½“ ImageProvider è°ƒç”¨<code>ImageCache.putIfAbsent</code>æ–¹æ³•è·å– ImageStreamCompleter æ—¶ï¼Œä¼šä¾æ¬¡å°è¯•ä»<code>_pendingImages</code> ã€<code>_cache</code> ã€<code>_liveImages</code> ä¸­è¯»å–ï¼Œå¦‚æœéƒ½æ²¡æœ‰åˆ™ä¼šå°è¯•æ‰§è¡Œä¼ å…¥çš„ loader æ–¹æ³•è·å–ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»è¿‡ä¸Šè¿°åˆ†æå¯ä»¥çŸ¥é“ï¼Œå½“_cacheã€_liveImagesã€_pendingImages ä¸­éƒ½æ²¡æœ‰æŒ‡å®šå›¾ç‰‡æ—¶ï¼Œä¼šä»ç½‘ç»œä¸‹è½½ï¼ˆæˆ–è€…ç£ç›˜ã€asset ç­‰ï¼‰ï¼Œè€Œåœ¨å›¾ç‰‡å®Œå…¨åŠ è½½å®Œæˆä¹‹å‰ï¼Œ_pendingImages ä¸­ä¸‹è½½å›¾ç‰‡æ‰€å å¤§å°æ˜¯æ²¡æœ‰è¢« ImageCache è¿½è¸ªçš„ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>ImageCache._cache çš„æœ€å¤§ä¸ªæ•°å’Œæ€»å¤§å°é™åˆ¶éƒ½ä¸ä¼šç®¡ç†è¿™éƒ¨åˆ†å›¾ç‰‡</strong>ï¼›æ•…è€Œé¢å¯¹å¤§é‡é«˜æ¸…å¤§å›¾åŠ è½½çš„åœºæ™¯ï¼ˆæ¯”å¦‚ï¼Œäº”åˆ— 1:1 ç½‘æ ¼åŠ è½½å¹³å‡å¤§å°å‡  Mb çš„ç½‘ç»œå›¾ç‰‡ï¼‰ï¼Œå¦‚æœ<strong>å¿«é€Ÿæ»‘åŠ¨</strong>ä¼šå¯¼è‡´_pendingImages æ€¥é€Ÿå¢å¤§ï¼Œè¿™æ ·ä¸‹è½½ä¸­ä¸”è¿˜æœªå®Œå…¨ä¸‹è½½çš„å›¾ç‰‡æ‰€å ç”¨çš„å†…å­˜ä¼šé€æ¸ç´¯è®¡ï¼Œä»è€Œå¯¼è‡´ Flutter APP<strong>å†…å­˜æš´å¢ï¼Œé¡µé¢å¡é¡¿</strong>ç­‰ï¼ˆæœ¬åœ°èµ„æºä¸å®¹æ˜“å‡ºç°æ˜¯å› ä¸ºä» load åˆ°å›¾ç‰‡åŠ è½½å®Œæˆé—´éš”æ¯”è¾ƒçŸ­ï¼Œè€Œç½‘ç»œå›¾ç‰‡ç”±äºç½‘é€Ÿç­‰å¯¼è‡´_pendingImages ä¸­ä¼šç´¯è®¡å¾ˆå¤šæ­£åœ¨ä¸‹è½½ä¸­çš„å›¾ç‰‡ï¼Œä¼šæ¯”è¾ƒæ˜æ˜¾ï¼‰ã€‚</p>
<p>é‚£äº›åœ¨ Flutter ä¸­åŠ è½½å›¾ç‰‡å¹¶ä¸”å®Œå…¨é‡‡ç”¨ ImageCache ç®¡ç†å›¾ç‰‡å†…å­˜çš„å›¾ç‰‡åŠ è½½æ¡†æ¶æ¯”å¦‚ Image/ExtendedImage/CachedNetworkImage ç­‰éƒ½å­˜åœ¨æ­¤é—®é¢˜ï¼›é˜¿é‡Œçš„ PowerImage ç”±äºå°†å›¾ç‰‡ä¸‹è½½è¿™ä¸ªè¿‡ç¨‹äº¤ç»™äº†åŸç”Ÿæˆç†Ÿçš„å›¾ç‰‡åŠ è½½åº“å¤„ç†ï¼Œä½¿å¾— ImageCache åªç®¡ç†å·²ç»åŠ è½½å®Œæˆçš„å›¾ç‰‡ï¼Œä»è€Œé¿å…äº†ä¸Šè¿°æƒ…å†µã€‚</p>
<br>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä»¥ä»ç½‘ç»œåŠ è½½å›¾ç‰‡ä¸ºä¾‹ï¼ŒFlutter åŸç”Ÿæä¾›çš„ Image åªæœ‰å†…å­˜ä¸­çš„ ImageCache ä¸€çº§ç¼“å­˜ï¼Œå¦‚æœ ImageCache æ²¡æœ‰æŒ‡å®šçš„å›¾ç‰‡ï¼ˆé¦–æ¬¡åŠ è½½æˆ–è€…ç¼“å­˜è¢«æ¸…ç©ºï¼‰åˆ™ä¼šå†æ¬¡ä»ç½‘ç»œåŠ è½½ï¼Œè¿™ä¼šå¯¼è‡´å¤šå›¾åˆ—è¡¨çš„æ—¶å€™å›¾ç‰‡è¢«é¢‘ç¹çš„å›æ”¶/é‡æ–°ä¸‹è½½ï¼Œä»è€Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</p>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæ¶Œç°äº†å¾ˆå¤šç¬¬ä¸‰æ–¹å›¾ç‰‡åŠ è½½æ§ä»¶ï¼š</p>
<ul>
<li><a href="https://github.com/fluttercandies/extended_image" target="_blank" rel="noopener noreferrer">extended_image</a> å¯¹å®˜æ–¹ Image çš„äºŒæ¬¡å¼€å‘ï¼Œå¢åŠ äº†ç£ç›˜ç¼“å­˜ã€‚</li>
<li><a href="https://github.com/Baseflow/flutter_cached_network_image" target="_blank" rel="noopener noreferrer">flutter_cached_network_image</a> ä½¿ç”¨<em>sqflite æ•°æ®åº“</em>ç®¡ç†ç¼“å­˜çš„<strong>ç½‘ç»œå›¾ç‰‡åŠ è½½</strong>åº“ï¼Œå¢åŠ äº†ç£ç›˜ç¼“å­˜ã€‚</li>
<li><a href="https://github.com/alibaba/power_image" target="_blank" rel="noopener noreferrer">power_image</a> ä½¿ç”¨äº<strong>æ··åˆé¡¹ç›®</strong>çš„å›¾ç‰‡åŠ è½½åº“ï¼Œæä¾›<em>ffi</em>å’Œ<em>texture</em>ä¸¤ç§å›¾ç‰‡å±•ç¤ºæ–¹å¼ï¼Œä¾èµ–äºåŸç”Ÿå›¾ç‰‡åŠ è½½åº“ï¼ˆæ¯”å¦‚<em>Glide</em>ï¼‰åŠ è½½å›¾ç‰‡ã€ç®¡ç†ç¼“å­˜ã€‚</li>
</ul>
<h2> æ€»ç»“</h2>
<p>ç®€å•æ€»ç»“ä¸€ä¸‹ Flutter åŸç”Ÿ Image ç»„ä»¶åŠ è½½å›¾ç‰‡çš„æµç¨‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/flutter_image_class_structure.png" alt="flutter_image_class_structure.png" tabindex="0" loading="lazy"><figcaption>flutter_image_class_structure.png</figcaption></figure>
<p>ç®€å•æ¥è¯´å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”¨æˆ·é€šè¿‡ Image Widget çš„å„ä¸ªæ„é€ æ–¹æ³•åˆ›å»ºæŒ‡å®šçš„ ImageProviderï¼›</li>
<li>åœ¨_ImageState ä¸­ä½¿ç”¨<code>ImageProvider.resolve(ImageConfiguration)</code>è·å–å¹¶ç›‘å¬ ImageStreamï¼ˆlistener ä¸º ImageStreamListenerï¼‰ï¼›</li>
<li>ImageProvider ä¼šæŒ‰ç…§ä¼ å…¥çš„ ImageConfiguration ç”Ÿæˆçš„ key åœ¨ ImageCache ä¸­æŸ¥æ‰¾å¯¹åº”çš„ç¼“å­˜ï¼Œæ²¡æœ‰çš„è¯åˆ™å…ˆåŠ è½½å†ç¼“å­˜ï¼›</li>
<li>å½“ ImageProvider æˆåŠŸåŠ è½½å›¾ç‰‡æ—¶ï¼ŒImageStreamListener è·å¾— ImageInfo æ—¶ï¼Œå¹¶è§¦å‘<code>_ImageState.build()</code>æ–¹æ³•å°†<code>ui.Image _imageInfo?.image</code>ä¼ å…¥ RawImage ä¸­ï¼›</li>
<li>ä½œä¸ºä¸€ä¸ª LeafRenderObjectWidgetï¼ŒRawImage åˆ›å»º RenderImage å¹¶ä¼ å…¥<code>ui.Image? image?.clone()</code>ä½œä¸º<code>RenderImage.image</code>ï¼Œæ­¤åå†åœ¨<code>RenderImage.paint</code>æ–¹æ³•ä¸­è°ƒç”¨ç³»ç»Ÿçš„<code>paintImage()</code>æ–¹æ³•é€šè¿‡<code>canvas.drawImageRect</code>ç»˜åˆ¶å›¾ç‰‡å†…å®¹ã€‚</li>
</ul>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://api.flutter.dev/flutter/widgets/Image-class.html" target="_blank" rel="noopener noreferrer">Image_api.flutter.dev</a><br>
<a href="https://mp.weixin.qq.com/s/alglGvnNKIzr7f8SwRZucA" target="_blank" rel="noopener noreferrer">äº¬ä¸œåœ¨ Flutter åŠ è½½å¤§é‡å›¾ç‰‡å¯¼è‡´çš„å†…å­˜æº¢å‡ºçš„ä¼˜åŒ–å®è·µ</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/flutter_image_class_structure.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter å›¾ç‰‡åŠ è½½æ–¹æ¡ˆåˆ†æä¹‹ extended_image</title>
      <link>https://jixiaoyong.github.io/blog/posts/23ac516a.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/23ac516a.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter å›¾ç‰‡åŠ è½½æ–¹æ¡ˆåˆ†æä¹‹ extended_image</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 01 Aug 2022 09:42:35 GMT</pubDate>
      <content:encoded><![CDATA[<p>Flutter é»˜è®¤æä¾›äº†<strong>Image</strong>ç”¨äºä»ç½‘ç»œã€æ–‡ä»¶ç­‰åŠ è½½å›¾ç‰‡ï¼Œå¹¶ä¸”ä½¿ç”¨<strong>ImageCache</strong>ç»Ÿä¸€ç®¡ç†å›¾ç‰‡ç¼“å­˜ï¼Œä½†æœ‰æ—¶å€™å¹¶ä¸èƒ½æ»¡è¶³ä½¿ç”¨éœ€æ±‚ï¼ˆæ¯”å¦‚ç½‘ç»œå›¾ç‰‡æ²¡æœ‰ç£ç›˜ç¼“å­˜ï¼Œå¯¼è‡´æ¯æ¬¡ ImageCache æ¸…é™¤ç¼“å­˜ä¹‹ååˆè¦ä»ç½‘ç»œä¸‹è½½ï¼‰ï¼Œæ‰€ä»¥åˆå‡ºç°äº†<a href="https://github.com/Baseflow/flutter_cached_network_image" target="_blank" rel="noopener noreferrer">flutter_cached_network_image</a>ã€<a href="https://github.com/fluttercandies/extended_image" target="_blank" rel="noopener noreferrer">extended_image</a>ç­‰åŸºäº Flutter åŸç”Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠ<a href="https://github.com/alibaba/power_image" target="_blank" rel="noopener noreferrer">power_image</a>ç­‰åŸºäºæ··åˆå¼€å‘çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡å¯¹ extended_image åŠ è½½è¿‡ç¨‹ã€åŸç†åšä¸€ç®€å•åˆ†æã€‚</p>
<h2> extended_image</h2>
<p><a href="https://github.com/fluttercandies/extended_image" target="_blank" rel="noopener noreferrer">extended_image</a>æ˜¯åŸºäºå®˜æ–¹ Image çš„æ‹“å±•ç»„ä»¶ï¼Œæ”¯æŒåŠ è½½ä»¥åŠå¤±è´¥æ˜¾ç¤ºï¼Œç¼“å­˜ç½‘ç»œå›¾ç‰‡ï¼Œç¼©æ”¾æ‹–æ‹½å›¾ç‰‡ï¼Œå›¾ç‰‡æµè§ˆ (å¾®ä¿¡æ˜é‡‘æ•ˆæœ)ï¼Œæ»‘åŠ¨é€€å‡ºé¡µé¢ (å¾®ä¿¡æ˜é‡‘æ•ˆæœ)ï¼Œç¼–è¾‘å›¾ç‰‡ (è£å‰ªæ—‹è½¬ç¿»è½¬)ï¼Œä¿å­˜ï¼Œç»˜åˆ¶è‡ªå®šä¹‰æ•ˆæœç­‰åŠŸèƒ½ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦å¯¹å…¶<strong>åŠ è½½ç¼“å­˜ç½‘ç»œå›¾ç‰‡</strong>çš„æµç¨‹åšä¸€åˆ†æï¼Œå› ä¸ºè¿™ä¸ªåº“æ˜¯å®˜æ–¹ Image çš„æ‹“å±•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šåœ¨ä¹‹å‰<a href="https://jixiaoyong.github.io/blog/posts/1912667a.html" target="_blank" rel="noopener noreferrer">å¯¹ Image çš„åˆ†æ</a>åŸºç¡€ä¸Šè¿›è¡Œå¯¹æ¯”åˆ†æã€‚</p>
<p>extended_image çš„æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/extended_image_class_structure.png" alt="extended_image_class_structure" tabindex="0" loading="lazy"><figcaption>extended_image_class_structure</figcaption></figure>
<h2> åˆ†æ</h2>
<p>å› ä¸º extended_image çš„å®šä½æ˜¯å®˜æ–¹ Image çš„æ‹“å±•ç‰ˆï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†ä½¿ç”¨æ–¹å¼å’Œå®˜æ–¹ç±»ä¼¼ã€‚</p>
<h3> ExtendedImage</h3>
<p>ä»–çš„æ„é€ å‡½æ•°åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>ExtendedImage</li>
<li>ExtendedImage.asset</li>
<li>ExtendedImage.file</li>
<li>ExtendedImage.memory</li>
<li>ExtendedImage.network</li>
</ul>
<p>åŒæ ·æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­æŒ‡å®šå¹¶åˆ›å»º ImageProviderï¼Œä¸è¿‡ extented_image åº“çš„ ImageProvider éƒ½æ˜¯ç»§æ‰¿è‡ªå®˜æ–¹ ImageProvider å¹¶ä¸”æ··å…¥äº†<strong>ExtendedImageProvider</strong>çš„å­ç±»ã€‚ä»¥<code>ExtendedImage.network</code>ä¸ºä¾‹ï¼Œåˆ›å»ºçš„ ImageProvider ç±»å‹æ˜¯<strong>ExtendedNetworkImageProvider</strong>ã€‚</p>
<p>å…¶ä½™çš„æ­¥éª¤å’Œæˆ‘ä»¬ä¹‹å‰åˆ†æçš„å®˜æ–¹ Image ç»„ä»¶ç±»ä¼¼ï¼Œåœ¨ <strong>_ExtendedImageState</strong> ä¸­ä½¿ç”¨ <strong>ImageProvider</strong> è·å–å¹¶ç›‘å¬ <strong>ImageStream</strong>ï¼Œå½“æˆåŠŸåŠ è½½å›¾ç‰‡ä¹‹åè·å¾—<code>ImageInfo? _imageInfo</code>å¹¶åˆ·æ–°é¡µé¢ï¼Œåœ¨<code>_ExtendedImageState.build</code>æ–¹æ³•ä¸­ï¼Œè™½ç„¶ extended_image å¢åŠ äº†ä¸€äº›ç‰¹æœ‰çš„åŠ è½½ä¸­ã€åŠ è½½å¤±è´¥ã€æ‰‹åŠ¿ç­‰å°è£…ï¼Œä½†æœ€åè¿˜æ˜¯ä½¿ç”¨<code>ImageInfo.image</code>åˆ›å»º<strong>ExtendedRawImage</strong>ä»¥å±•ç¤ºå›¾ç‰‡å†…å®¹ã€‚</p>
<p>å¦‚æ­¤å¯è§ï¼Œåœ¨ä»ç½‘ç»œåŠ è½½å›¾ç‰‡è¿™éƒ¨åˆ†å†…å®¹æ¥çœ‹ï¼ŒExtendedImage å’Œ Image çš„ä¸»è¦ä¸åŒåœ¨äº<strong>ExtendedNetworkImageProvider</strong>çš„å®ç°ï¼š</p>
<h3> ExtendedNetworkImageProvider</h3>
<blockquote>
<p>è¿™éƒ¨åˆ†å†…å®¹çš„ä»£ç åœ¨<a href="https://github.com/fluttercandies/extended_image_library" target="_blank" rel="noopener noreferrer">extended_image_library</a>ä¸­ã€‚</p>
</blockquote>
<p>ExtendedNetworkImageProvider ç»§æ‰¿è‡ª<strong>ImageProvider</strong>ï¼Œæ··å…¥äº†<strong>ExtendedImageProvider</strong>ï¼Œåè€…æä¾›äº†<code>get imageCache</code>/<code>instantiateImageCodec</code>/<code>resolveStreamForKey</code>ç­‰ä¸€ç³»åˆ—é€šç”¨æ–¹æ³•ã€‚</p>
<p>ä¸‹é¢æ˜¯ ExtendedNetworkImageProvider çš„æºç ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ExtendedNetworkImageProvider æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä»–çš„é€»è¾‘åœ¨<code>network_image.ExtendedNetworkImageProvider</code>ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœéœ€è¦ç¼“å­˜æ—¶ï¼Œé™¤äº† ImageCache æœ¬èº«çš„ç¼“å­˜å¤–ï¼ŒExtendedNetworkImageProvider è¿˜ä¼šæ‰§è¡Œ<code>_loadCache</code>å°è¯•ä»æœ¬åœ°æ–‡ä»¶ä¸­è¯»å–ç¼“å­˜ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­æ‰§è¡Œåˆ°çš„<code>ExtendedNetworkImageProvider._loadNetwork()</code>æ–¹æ³•åªä¼šä½¿ç”¨<code>HttpClient</code>ä»ç½‘ç»œä¸­ä¸‹è½½å›¾ç‰‡å¹¶è¿”å›ã€‚</p>
<h3> ExtendedImageProvider</h3>
<p>æ­¤å¤–ï¼Œä¹‹å‰æåˆ°çš„<code>ExtendedImageProvider</code>ä¸º extended_image åº“ä¸­çš„ ImageProvider æä¾›äº†ä¸€äº›é€šç”¨çš„æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼Œè¿˜æ”¹åŠ¨äº†<code>ExtendedImageProvider.resolveStreamForKey</code>æ–¹æ³•ä»¥ä½¿ç”¨æŒ‡å®šçš„ ImageCacheã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»¼ä¸Šæ‰€è§ï¼ŒExtendedImageProvider çš„ä¸»è¦ä½œç”¨æ˜¯å€ŸåŠ©<code>rawImageDataMap</code>æä¾›äº†ç¼“å­˜å›¾ç‰‡åŸå§‹æ•°æ®çš„åŠŸèƒ½ï¼Œæ­¤å¤–è¿˜æä¾›äº†ä¸€ä¸ª ImageCache åˆ†ç»„çš„æ–¹æ³•ï¼Œä»¥ä¾¿å¯¹ä¸€éƒ¨åˆ†å›¾ç‰‡ç¼“å­˜ç»Ÿä¸€å¤„ç†ã€‚</p>
<h2> æ€»ç»“</h2>
<p>ä»…å°±ä»ç½‘ç»œåŠ è½½å›¾ç‰‡è€Œè¨€ï¼Œextended_image å’Œ Flutter å®˜æ–¹ Image ç»„ä»¶çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼šåœ¨ ImageCache ä¹‹å¤–ï¼Œ<strong>å¤šäº†ä¸€å±‚æœ¬åœ°ç£ç›˜ç¼“å­˜</strong>ï¼Œå¦‚æœè¿™äºŒè€…éƒ½æœªå‘½ä¸­ç¼“å­˜åˆ™ä»ç½‘ç»œä¸‹è½½å›¾ç‰‡ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œextended_image æœ¬èº«è¿˜æä¾›äº†è¯¸å¦‚å›¾ç‰‡ç¼©æ”¾æ‹–æ‹½ã€æ»‘åŠ¨é€€å‡ºç­‰å›¾ç‰‡æ“ä½œå¸¸ç”¨çš„â€œå¤§è€Œå…¨â€çš„åŠŸèƒ½ã€‚è¿™éƒ¨åˆ†è§ä»è§æ™ºï¼Œå¦‚æœ APP éœ€æ±‚åˆšå¥½éœ€è¦ç”¨åˆ°è¿™äº›åŠŸèƒ½çš„è¯ï¼Œextended_image æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æ˜¯å¦‚æœåªæ˜¯æƒ³è§£å†³å›¾ç‰‡ç¼“å­˜é—®é¢˜çš„è¯ï¼Œå¯èƒ½ä¼šæ˜¾å¾—æœ‰äº›è‡ƒè‚¿ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªå¸¸ç”¨çš„å›¾ç‰‡åº“<a href="https://github.com/fluttercandies/extended_image" target="_blank" rel="noopener noreferrer">flutter_cached_network_image</a>åˆ™æ˜¯å€ŸåŠ©<a href="https://github.com/Baseflow/flutter_cache_manager" target="_blank" rel="noopener noreferrer">flutter_cache_manager</a>å®ç°ç¼“å­˜ç½‘ç»œå›¾ç‰‡çš„åŠŸèƒ½ï¼Œç›¸å¯¹æ¯”è¾ƒè½»é‡ã€‚</p>
<p>ä¸Šè¿°ä¸¤ç§åº“éƒ½æ˜¯åŸºäº Flutter Image ç»„ä»¶å®ç°å›¾ç‰‡åŠ è½½ã€ç¼“å­˜ï¼Œé˜¿é‡Œå·´å·´å‡ºå“çš„<a href="https://github.com/alibaba/power_image" target="_blank" rel="noopener noreferrer">power_image</a>åˆ™æ˜¯ä¸€æ¬¾ä¸º Flutter-Native æ··åˆé¡¹ç›®å¼€å‘çš„å›¾ç‰‡åŠ è½½åº“ï¼Œå€ŸåŠ© Texture å’Œ ffi é€šè¿‡ Native ç«¯å·²æœ‰çš„å›¾ç‰‡åŠ è½½åº“å®Œæˆå›¾ç‰‡åŠ è½½ã€ç¼“å­˜çš„åŠŸèƒ½ï¼ŒFlutter ç«¯åªè´Ÿè´£å±•ç¤ºï¼ˆä»¥åŠ ImageCache ç¼“å­˜ï¼‰ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://github.com/fluttercandies/extended_image" target="_blank" rel="noopener noreferrer">extended_image</a></p>
<p><a href="https://github.com/fluttercandies/extended_image_library" target="_blank" rel="noopener noreferrer">extended_image_library</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/extended_image_class_structure.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter å›¾ç‰‡åŠ è½½æ–¹æ¡ˆåˆ†æä¹‹ power_image</title>
      <link>https://jixiaoyong.github.io/blog/posts/727d7800.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/727d7800.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter å›¾ç‰‡åŠ è½½æ–¹æ¡ˆåˆ†æä¹‹ power_image</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 02 Aug 2022 07:54:39 GMT</pubDate>
      <content:encoded><![CDATA[<p>Flutter é»˜è®¤æä¾›äº†<strong>Image</strong>ç”¨äºä»ç½‘ç»œã€æ–‡ä»¶ç­‰åŠ è½½å›¾ç‰‡ï¼Œå¹¶ä¸”ä½¿ç”¨<strong>ImageCache</strong>ç»Ÿä¸€ç®¡ç†å›¾ç‰‡ç¼“å­˜ï¼Œä½†æœ‰æ—¶å€™å¹¶ä¸èƒ½æ»¡è¶³ä½¿ç”¨éœ€æ±‚ï¼ˆæ¯”å¦‚ç½‘ç»œå›¾ç‰‡æ²¡æœ‰ç£ç›˜ç¼“å­˜ï¼Œå¯¼è‡´æ¯æ¬¡ ImageCache æ¸…é™¤ç¼“å­˜ä¹‹ååˆè¦ä»ç½‘ç»œä¸‹è½½ï¼‰ï¼Œæ‰€ä»¥åˆå‡ºç°äº†<a href="https://github.com/Baseflow/flutter_cached_network_image" target="_blank" rel="noopener noreferrer">flutter_cached_network_image</a>ã€<a href="https://github.com/fluttercandies/extended_image" target="_blank" rel="noopener noreferrer">extended_image</a>ç­‰åŸºäº Flutter åŸç”Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠ<a href="https://github.com/alibaba/power_image" target="_blank" rel="noopener noreferrer">power_image</a>ç­‰åŸºäºæ··åˆå¼€å‘çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡å¯¹ Alibaba ä¸­çš„ power_image åŠ è½½è¿‡ç¨‹ã€åŸç†åšä¸€ç®€å•åˆ†æã€‚</p>
<h2> power_image</h2>
<p><em>power_image</em>æ˜¯é˜¿é‡Œå·´å·´å‡ºå“çš„ Flutter æ··åˆå¼€å‘å›¾ç‰‡åŠ è½½åº“ï¼Œé€šè¿‡<em>texture</em>å’Œ<em>ffi</em>æŠ€æœ¯å€ŸåŠ©åŸç”Ÿå›¾ç‰‡åŠ è½½åº“åŠ è½½å›¾ç‰‡ã€Flutter ç«¯å±•ç¤ºå›¾ç‰‡ã€‚</p>
<p>æ— è®ºæ˜¯ Flutter <a href="https://jixiaoyong.github.io/blog/posts/1912667a/" target="_blank" rel="noopener noreferrer">Image</a> ç»„ä»¶ï¼Œè¿˜æ˜¯ç¬¬ä¸‰æ–¹çš„<a href="https://jixiaoyong.github.io/blog/posts/23ac516a/" target="_blank" rel="noopener noreferrer"><em>extende_image</em></a>ã€<em>flutter_cached_nework_image</em>éƒ½æ˜¯åœ¨ Flutter ç«¯åŠ è½½è§£æå›¾ç‰‡ï¼Œè¿™äº›æ–¹æ¡ˆå¯¹ä¸€èˆ¬çº¯ Flutter å¼€å‘çš„ APP æ¥è¯´åŸºæœ¬å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯å¯¹äºå¤§å¤šæ•°æ··åˆå¼€å‘çš„ APP æ¥è¯´ï¼Œè¿™äº›æ–¹æ¡ˆä¼šåœ¨ Flutter å’Œ Native åŒæ—¶å­˜åœ¨ä¸¤ä»½å›¾ç‰‡èµ„æºé€ æˆå†…å­˜æµªè´¹ï¼Œæ­¤å¤–æ ¹æ®<a href="https://mp.weixin.qq.com/s/yUm4UFggYLgDbj4_JCjEdg#at" target="_blank" rel="noopener noreferrer">è´å£³çš„åˆ†æ</a>ï¼ŒFlutter ç«¯è§£å†³æ–¹æ¡ˆå­˜åœ¨å›¾ç‰‡å†…å­˜é‡Šæ”¾æ—¶æœºï¼ˆFlutter å¼•æ“æŒæœ‰çš„ SkImage é‡Šæ”¾æ—¶æœºï¼‰ä»¥åŠè¶…å¤§å›¾å†…å­˜å³°å€¼ç­‰é—®é¢˜ã€‚</p>
<p>è€Œ<em>power_image</em>èƒ½å¤Ÿè¾ƒå¥½çš„è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå…¶æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š</p>
<p>ç±»ç»“æ„å›¾ï¼š<br>
<img src="https://jixiaoyong.github.io/images/flutter/power_image_class_structure.png" alt="ç±»ç»“æ„å›¾" loading="lazy"></p>
<p>æ¶æ„å›¾ï¼š<br>
<img src="https://jixiaoyong.github.io/images/flutter/power_image_structure.png" alt="æ¶æ„å›¾" loading="lazy"></p>
<p><em>power_image</em>å¯ä»¥å¤§ä½“åˆ’åˆ†ä¸º<strong>Flutter ç«¯å›¾ç‰‡å±•ç¤º</strong>å’Œ<strong>Native å›¾ç‰‡åŠ è½½</strong>ä¸¤éƒ¨åˆ†ï¼Œä¸‹é¢åˆ†åˆ«åˆ†æã€‚</p>
<h2> Flutter ç«¯å›¾ç‰‡å±•ç¤º</h2>
<h3> PowerImage</h3>
<p><code>PowerImage</code>ç»§æ‰¿è‡ª<em>StatefulWidget</em>ï¼Œæä¾›å¤šç§åˆ›å»ºæ–¹å¼ï¼šæ—¢å¯ä»¥ä½¿ç”¨é¢„è®¾çš„<code>PowerImage.network</code>ã€<code>PowerImage.file</code>ç­‰æ„é€ å‡½æ•°ä»ç½‘ç»œã€æ–‡ä»¶ç­‰è·å–å›¾ç‰‡ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨<code>PowerImage.type</code>ã€<code>PowerImage.options</code>ç­‰è‡ªå®šä¹‰é€šé“è·å–å›¾ç‰‡å¹¶å±•ç¤ºï¼›æˆ–è€…ä½¿ç”¨<code>PowerImage()</code>å®Œå…¨è‡ªå®šä¹‰ã€‚</p>
<p>é™¤äº†<code>PowerImage()</code>æ„é€ å‡½æ•°ä¹‹å¤–ï¼Œä¸Šè¿°å…¶ä½™æ„é€ å‡½æ•°éƒ½æ ¹æ®ä¼ å…¥çš„<code>String? renderingType</code>æŒ‡å®šäº† PowerImage ç‰¹å®šçš„<code>PowerImageProvider image</code>å±æ€§ï¼ˆæ˜¯<em>ffi</em>è¿˜æ˜¯<em>texture</em>ï¼‰ç”¨äºè·å–å›¾ç‰‡ã€‚</p>
<h3> PowerImageState</h3>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ PowerImageState çš„<code>build()</code>æ–¹æ³•ä¸­ï¼Œæ ¹æ®ä¸åŒçš„<code>PowerImageProvider image</code>ç±»å‹ä¼šè¿”å›ä¸åŒçš„ Widgetï¼š</p>
<ul>
<li><code>image</code>æ˜¯ <strong><em>PowerTextureImageProvider</em></strong> ç±»å‹ï¼šé‡‡ç”¨ <em>texture</em> æ¨¡å¼å±•ç¤ºå›¾ç‰‡ï¼Œè¿”å›**<em>PowerTextureImage</em><strong>ï¼Œæœ€ç»ˆä¼šè¿”å›ç»è¿‡å°è£…çš„</strong><em>Texture</em>**å¯¹è±¡ã€‚</li>
<li><code>image</code>æ˜¯**<em>PowerExternalImageProvider</em><strong>ç±»å‹ï¼šé‡‡ç”¨ <em>ffi</em> æ¨¡å¼å±•ç¤ºå›¾ç‰‡ï¼Œè¿”å›</strong><em>PowerExternalImage</em><strong>ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯</strong><em>RawImage</em>**å¯¹è±¡ï¼Œå’Œä½¿ç”¨ Flutter Image å±•ç¤ºå›¾ç‰‡çš„æµç¨‹ä¸€è‡´ã€‚</li>
<li>å…¶ä»–ç±»å‹ï¼ŒæŒ‰ç…§è‡ªå®šä¹‰çš„è§„åˆ™å±•ç¤ºã€‚</li>
</ul>
<p>è®©æˆ‘ä»¬æ¥åˆ†åˆ«çœ‹ä¸€ä¸‹**<em>PowerTextureImage</em><strong>å’Œ</strong><em>PowerExternalImage</em>**çš„å®ç°ï¼š</p>
<h3> PowerTextureImage</h3>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> PowerExternalImage</h3>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡å¯¹æ¯”**<em>PowerTextureImage</em><strong>å’Œ</strong><em>PowerExternalImage</em>**çš„æºç å¯ä»¥å‘ç°ï¼ŒäºŒè€…æœ€ç»ˆè¿˜æ˜¯åˆ›å»ºäº† ImageExt å¯¹è±¡ï¼Œåªä¸è¿‡ PowerTextureImage ä¸­ ImageExt.imageBuilder è¿”å›äº† Textureï¼Œè€Œ PowerExternalImage ä¸­ ImageExt.imageBuilder ä¸º nullã€‚</p>
<p>å†æ ¹æ®ä¸‹é¢çš„<code>_ImageExtState.build</code>æºç å¯ä»¥ç¡®å®šï¼Œå½“ä½¿ç”¨ PowerTextureImage æ—¶ PowerImage åˆ›å»ºçš„æ˜¯å°è£…äº†çš„ <strong>Texture</strong>ï¼Œè€Œ PowerExternalImage æ—¶åˆ™ä¼šä½¿ç”¨ PowerExternalImageProvider åˆ›å»ºçš„ ImageInfo åˆ›å»º <strong>RawImage</strong>ï¼Œè¿™å®é™…ä¸Šä¸ Flutter åŸæœ‰çš„ Image ç»„ä»¶ä¸€è‡´ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥çŸ¥é“ï¼Œ<strong><em>PowerImage</em><strong>ä½¿ç”¨ä»</strong><em>PowerImageProvider</em></strong> è·å–çš„ <strong><em>ImageInfo</em></strong> æ¥å±•ç¤ºå›¾ç‰‡ï¼Œé‡‡ç”¨**<em>texture</em>**æ–¹æ¡ˆæ—¶ï¼Œä½¿ç”¨ ImageInfo ä¸­çš„ textureId å¹¶è¿”å› Texture å¯¹è±¡å±•ç¤ºå›¾ç‰‡ï¼›è€Œä½¿ç”¨ <strong><em>ffi</em></strong> æ–¹æ¡ˆæ—¶ï¼Œä¼šä½¿ç”¨ ImageInfo ä¸­çš„<code>ui.Image image</code>å¯¹è±¡ä¼ å…¥ RawIamge å±•ç¤ºå›¾ç‰‡ï¼ˆè¿™éƒ¨åˆ†ä¸ Flutter Image ç»„ä»¶é€»è¾‘ä¸€è‡´ï¼‰ã€‚</p>
<br>
<h3> PowerImageProvider</h3>
<p>PowerImageProvider ç»§æ‰¿è‡ª<em>ImageProviderExt</em> -&gt; <em>ImageProvider</em>ï¼Œæ˜¯<em>power_image</em>çš„å…³é”®ç±»ä¹‹ä¸€ï¼Œä¸»è¦å®ç°é€šè¿‡ Flutter/Native è·¨ç«¯é€šä¿¡ä» Native è·å–/é‡Šæ”¾å›¾ç‰‡èµ„æºç­‰ï¼Œåˆ›å»ºä¾› ImageExt ä½¿ç”¨çš„ ImageInfoã€‚</p>
<p>ç›¸å¯¹äº Flutter å®˜æ–¹çš„ ImageProviderï¼Œé™¤äº†ä¿®æ”¹éƒ¨åˆ†ç±»ä¸º power_image å¯¹åº”çš„ç±»ä¹‹å¤–ï¼ŒPowerImageProvider ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹æ”¹å˜ï¼š</p>
<ul>
<li>å·¥å‚æ–¹æ³•<code>PowerImageProvider.options</code>ç”Ÿäº§ PowerImageProviderï¼šæ ¹æ®ä¼ å…¥çš„ PowerImageRequestOptions ä¸­<code>PowerImageRequestOptions.renderingType</code>çš„å€¼ï¼Œåˆ†åˆ«åˆ›å»ºå¯¹åº”çš„**<em>PowerExternalImageProvider</em><strong>æˆ–è€…</strong><em>PowerTextureImageProvider</em>**ã€‚</li>
<li>é‡å†™<code>_loadAsync</code>æ–¹æ³•ï¼Œè°ƒç”¨ Native å›¾ç‰‡åº“åŠ è½½å›¾ç‰‡ï¼Œå¹¶æ ¹æ®è¿”å›å€¼è°ƒç”¨å­ç±» <code>createImageInfo</code> æ–¹æ³•åˆ›å»º PowerImageInfoã€‚</li>
</ul>
<h4> _loadAsync</h4>
<p>é€šè¿‡é‡å†™<code>_loadAsync</code>æ–¹æ³•ï¼ŒPowerImageProvider å®ç°äº†ä¸åŒçš„å­ç±»åˆ†åˆ«åˆ›å»º PowerImageInfo å±•ç¤ºå›¾ç‰‡ã€ç»Ÿä¸€è®© ImageCache ç®¡ç†å›¾ç‰‡ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å¾—çŸ¥ï¼Œ<em>texture</em>å’Œ<em>ffi</em>æ–¹æ¡ˆåˆ†åˆ«ä½¿ç”¨ ImageProvider æä¾›çš„ PowerImageInfo ä¸­çš„<code>int? textureId</code>å’Œ<code>ui.Image image</code>å±•ç¤ºå›¾ç‰‡ï¼Œè®©æˆ‘ä»¬åˆ†åˆ«çœ‹ä¸€ä¸‹ä»–ä»¬æ˜¯å¦‚ä½•è·å–çš„ï¼š</p>
<h4> PowerTextureImageProvider</h4>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> PowerExternalImageProvider</h4>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li><em>texture</em> æ–¹æ¡ˆé‡‡ç”¨çš„ PowerTextureImageProvider åˆ›å»ºçš„ ImageInfo å¯¹åº”çš„ <code>ui.Image image</code> ä¸€ä¸ªå…±äº«çš„å ä½ç¬¦ï¼Œå¹¶ä¸èƒ½çœŸæ­£çœŸæ­£ç»˜åˆ¶å†…å®¹ï¼Œå®é™…ä¸Šå›¾ç‰‡ä¿¡æ¯åœ¨å¯¹åº”çš„<code>PowerTextureImageInfo.textureId</code>ä¸­ï¼›</li>
<li><em>ffi</em> æ–¹æ¡ˆåˆ›å»ºçš„ ImageInfo åˆ™æ ¹æ® native å†…å­˜ä¸­çš„å›¾ç‰‡æ•°æ®åˆ›å»ºäº†å¯¹åº”çš„ ui.Imageï¼Œä¸ Flutter é»˜è®¤çš„ ImageProvider æä¾›çš„ ImageInfo ä¸€æ ·å¯ä»¥è¢« RawImage æ­£å¸¸ä½¿ç”¨ã€‚</li>
</ul>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œè™½ç„¶ <em>texture</em> å’Œ <em>ffi</em> éƒ½é‡‡ç”¨äº† ImageCache æ¥ç®¡ç†å›¾ç‰‡ç¼“å­˜ï¼Œç”šè‡³ <em>ffi</em> çš„å†…å­˜ä¹Ÿåœ¨ Flutter ä¾§ç®¡ç†ï¼Œä½†æ˜¯ PowerImage æœ¬èº«ä¸ä¼šå‡ºç°æˆ‘ä»¬ä¹‹å‰åœ¨<a href="https://jixiaoyong.github.io/blog/posts/1912667a.html" target="_blank" rel="noopener noreferrer">Flutter Image</a>ä¸­åˆ†æçš„åŠ è½½å¤§é‡é«˜æ¸…ç½‘å›¾ä¼šå‡ºç°çš„<strong>å†…å­˜çˆ†ç‚¸</strong>ï¼Œè¿™æ˜¯å› ä¸ºè™½ç„¶åœ¨ ImageCache.putIfAbsent æ–¹æ³•ä¸­_pendingImages åŒæ ·ä¿å­˜äº†åŠ è½½ä¸­çš„å›¾ç‰‡ï¼Œä½†æ˜¯å®é™…è¿™äº›<strong>å›¾ç‰‡åŠ è½½è¿‡ç¨‹ä¸­çš„å†…å­˜ç”± Native ç«¯å›¾ç‰‡åŠ è½½åº“ç®¡ç†</strong>ï¼Œè€Œé Flutterï¼Œæ‰€ä»¥åªè¦ Native ç«¯å›¾ç‰‡åŠ è½½åº“æ¯”è¾ƒæˆç†Ÿï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åˆ†æäº† PowerImage æ ¹æ® PowerImageProvider è·å–çš„ ImageInfo åˆ†åˆ«é‡‡ç”¨ ffi å’Œ texture ä¸¤ç§æ–¹æ¡ˆå±•ç¤ºå›¾ç‰‡çš„è¿‡ç¨‹ã€‚</p>
<br>
<p>æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹ä¹‹å‰æåˆ°çš„ <code>PowerImageProvider._loadAsync</code> æ–¹æ³•ä¸­ä½¿ç”¨ PowerImageLoader è·å–å›¾ç‰‡çš„è¿‡ç¨‹ã€‚æ•´ä¸ªè¿‡ç¨‹å¯ä»¥åˆ†ä¸º <strong>flutter ç«¯å‘èµ·è¯·æ±‚/å¤„ç†å›è°ƒ</strong>ã€<strong>native ç«¯æ¥æ”¶è¯·æ±‚/è¿”å›ç»“æœ</strong>ä¸¤éƒ¨åˆ†ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ Flutter å’Œ Native ä½¿ç”¨ MethodChannelï¼ˆå‘é€è·å–é‡Šæ”¾å›¾ç‰‡æŒ‡ä»¤ï¼‰å’Œ EventChannelï¼ˆæ¥æ”¶å›¾ç‰‡æˆåŠŸåŠ è½½çš„äº‹ä»¶ï¼‰è¿›è¡Œé€šä¿¡ã€‚</p>
<h2> Flutter/Native é€šä¿¡</h2>
<p>åœ¨ä¸Šé¢åˆ†æ<code>PowerImageProvider._loadAsync</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å…¶ä¸­ä½¿ç”¨äº†**<em>PowerImageLoader</em>**è·å–å›¾ç‰‡ä¿¡æ¯ PowerImageCompleterï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæ˜¯ä½¿ç”¨ PowerImageLoader çš„å•ä¾‹åŠ è½½å›¾ç‰‡ï¼Œçœ‹ä¸€ä¸‹å…·ä½“çš„å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆåˆ›å»ºäº† PowerImageRequest å¯¹è±¡ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>imageType</code>è¡¨ç¤ºè·å–å›¾ç‰‡çš„æ–¹å¼ï¼ˆæ¯”å¦‚<code>network</code>ï¼Œ<code>nativeAsset</code>ï¼Œ<code>file</code>ï¼Œ<code>asset</code>ç­‰ï¼‰ï¼›</li>
<li><code>renderingType</code>è¡¨ç¤ºå›¾ç‰‡æ¸²æŸ“æ–¹å¼ï¼Œæ¯”å¦‚<code>external</code>ï¼ˆå³ ffi æ–¹æ¡ˆï¼‰ã€<code>texture</code>ã€‚</li>
</ul>
<p>ç„¶åé€šè¿‡<code>PowerImageChannel</code>å‘é€è¯·æ±‚ï¼ˆå®é™…çš„æ‰§è¡Œçš„ç±»æ˜¯<code>PowerImagePlatformChannel</code>ï¼‰ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>PowerImageLoader.setup</code>æ³¨å†Œ MethodChannel å’Œ EventChannel</li>
<li>ä½¿ç”¨<code>PowerImageLoader.loadImage</code>å‘ Native å‘èµ·è¯·æ±‚åŠ è½½å›¾ç‰‡ï¼Œå°†è¯·æ±‚ä¿å­˜åˆ°<code>PowerImageLoader.completers</code>ä¸­å¹¶è¿”å›ç»™è°ƒç”¨è€…</li>
<li>å½“ Native ç«¯å¤„ç†å®Œè¯·æ±‚ä¹‹åä¼šå›è°ƒ PowerImagePlatformChannel ä¸­æ³¨å†Œçš„ EventChannelï¼Œç„¶åä¼šæ‰§è¡Œ<code>PowerImageLoader.instance.onImageComplete(event)</code>æ–¹æ³•ï¼Œä½¿ç”¨è¿”å›çš„å›¾ç‰‡ä¿¡æ¯ï¼Œä»<code>PowerImageLoader.completers</code>æ‰¾å‡ºå¹¶å®Œæˆä¹‹å‰çš„è¯·æ±‚</li>
</ul>
<br>
<p>ä»¥ä¸Šåˆ†æä¸º Flutter ç«¯å‘ Native ç«¯å‘èµ·è¯·æ±‚çš„è¿‡ç¨‹ï¼Œä¸‹é¢ä»¥ Android ç«¯ä¸ºä¾‹åˆ†æä¸€ä¸‹ Native ç«¯çš„å¤„ç†è¿‡ç¨‹ï¼š</p>
<p>é¦–å…ˆæ˜¯åœ¨ PowerImagePlugin ä¸­å‘ Flutter å¼•æ“æ³¨å†Œå¯¹åº”çš„æ–¹æ³•ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ Flutter ç«¯å‘ Native å‘é€æ¶ˆæ¯æ—¶ï¼ŒFlutter å¼•æ“ä¼šè°ƒç”¨<code>PowerImagePlugin.onMethodCall</code>æ–¹æ³•ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºä¸åŒçš„è°ƒç”¨è¯·æ±‚ï¼š</p>
<ul>
<li><code>startImageRequests</code>ï¼šå…ˆæ ¹æ®è¯·æ±‚å‚æ•°åˆ›å»ºå¥½è¯·æ±‚å¹¶è¿”å›ç»™ Flutter è°ƒç”¨æ–¹ï¼›ç„¶åé€šè¿‡ PowerImageRequestManager çœŸæ­£æ‰§è¡Œè¯·æ±‚ï¼ˆæœ€ç»ˆä¼šé€šè¿‡<code>PowerImagePlugin.PowerImageEventSink.getInstance().sendImageStateEvent</code>å‘ Flutter é€šçŸ¥ç»“æœï¼‰ã€‚</li>
<li><code>releaseImageRequests</code>ï¼šç«‹å³ä»<code>PowerImageRequestManager.requests</code>ä¸­å»é™¤å¯¹åº”çš„è¯·æ±‚å¹¶å°è¯•ç»ˆæ­¢ä»»åŠ¡ï¼Œå¹¶å‘ Flutter è¿”å›ç»“æœã€‚</li>
</ul>
<p>ä¸‹é¢ç€é‡åˆ†æä¸€ä¸‹æ‰§è¡Œå›¾ç‰‡è¯·æ±‚çš„é€»è¾‘ï¼ˆ<code>startImageRequests</code>çš„æƒ…å†µï¼‰ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§å¯¹äº<em>ffi</em>å’Œ<em>texture</em>æ–¹æ¡ˆï¼Œåˆ†åˆ«æ¶‰åŠåˆ°**<em>PowerImageExternalRequest</em><strong>å’Œ</strong><em>PowerImageTextureRequest</em><strong>ä¸¤ä¸ªç±»ã€‚ä»–ä»¬éƒ½ç»§æ‰¿è‡ª</strong><em>PowerImageBaseRequest</em>**ç±»ï¼Œå…¶<code>startLoading</code>æ–¹æ³•ä¼šè°ƒç”¨<code>performLoadImage</code>æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>PowerImageBaseRequest.performLoadImage</code>æ–¹æ³•ä¸­ï¼š</p>
<ul>
<li>ä¼šå…ˆé€šè¿‡<code>PowerImageLoader.getInstance().handleRequest</code>æ–¹æ³•è·å–å›¾ç‰‡ï¼›</li>
<li>ç„¶åè°ƒç”¨<code>PowerImageBaseRequest.this.onLoadResult</code>æ–¹æ³•ä¹Ÿå°±æ˜¯<em>PowerImageExternalRequest</em>å’Œ<em>PowerImageTextureRequest</em>çš„<code>onLoadResult()</code>æ–¹æ³•ã€‚</li>
</ul>
<p>åœ¨ä»–ä»¬çš„<code>onLoadResult(final PowerImageResult result)</code>æ–¹æ³•ä¸­ï¼Œå…¥å‚ PowerImageResult æŒæœ‰ FlutterImage å¯¹è±¡ï¼Œåè€…æŒæœ‰åŠ è½½çš„å›¾ç‰‡çš„ Drawableï¼Œä»–ä»¬æ ¹æ®å„è‡ªçš„ç‰¹ç‚¹å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†åï¼ˆ<em>ffi</em>è·å– Drawable çš„ bitmap å¯¹è±¡ï¼Œ&lt;&gt;å¦‚æœå›¾ç‰‡ä¸æ˜¯<code>ARGB_8888</code>åˆ™<em>ä¼š</em>å‘ç”Ÿä¸€æ¬¡ Bitmap æ‹·è´&gt;ï¼›<em>texture</em>ä½¿ç”¨ Bitmap ç»˜åˆ¶åˆ° Canvas ä¸Šé¢ï¼‰ï¼Œé€šè¿‡<code>PowerImageBaseRequest.onLoadSuccess()</code>æ–¹æ³•æˆ–è€…<code>PowerImageBaseRequest.onLoadFailed</code>è¿”å›ç»“æœã€‚</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>PowerImageExternalRequest ä»è·å–åˆ°çš„å›¾ç‰‡ç”Ÿæˆ Bitmap å¹¶è¿”å›å…¶æŒ‡é’ˆã€å®½é«˜ã€å¤§å°ç­‰å±æ€§è¿”å›ï¼›</li>
<li>PowerImageTextureRequest åˆ™å°†å›¾ç‰‡ç»˜åˆ¶åˆ°<code>Surface</code>ä¸­å¹¶è¿”å›<code>textureId</code>ç­‰ä¿¡æ¯ã€‚</li>
</ul>
<p>è€Œå¯¹äº<code>PowerImageLoader.getInstance().handleRequest()</code>ï¼Œè¿™é‡Œé¢çš„å„ä¸ª PowerImageLoaderProtocol ç”± Native ç«¯é€šè¿‡<code>PowerImageLoader.getInstance().registerImageLoader</code><strong>æ³¨å†Œå…·ä½“çš„å®ç°</strong>ï¼Œ<code>handleRequest()</code>æ–¹æ³•æ­£æ˜¯è°ƒç”¨ä»–ä»¬è·å–å›¾ç‰‡ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> Native ç«¯å›¾ç‰‡è·å–</h2>
<p>ä¸Šé¢æåˆ°ï¼Œ<em>power_image</em>é»˜è®¤çš„**<em>PowerImageLoaderProtocol</em>**æœ‰ä»¥ä¸‹å‡ ç§ç±»ï¼š"<code>network</code>"ã€"<code>nativeAsset</code>"ã€"<code>asset</code>"ã€"<code>file</code>"ï¼Œè¿™äº›éƒ½éœ€è¦ä½¿ç”¨è€…åœ¨ Native ç«¯æ³¨å†Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p>
<p>ä»¥"<code>network</code>"ä¸ºä¾‹ï¼Œåœ¨<code>MainActivity.onCreate</code>æ–¹æ³•ä¸­ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><em>PowerImageNetworkLoader</em><strong>ç»§æ‰¿è‡ª</strong><em>PowerImageLoaderProtocol</em></strong>ï¼Œå›¾ç‰‡çš„åŠ è½½é€»è¾‘åœ¨å…¶<code>handleRequest</code>æ–¹æ³•ä¸­ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå½“ Flutter ç«¯å‘ Native å‘é€æ¶ˆæ¯æ—¶ï¼š</p>
<ul>
<li>Flutter å¼•æ“ä¼šè°ƒç”¨<code>PowerImagePlugin.onMethodCall</code>æ–¹æ³•ï¼Œå…ˆ<strong>åˆ›å»º</strong>å¯¹åº”çš„è¯·æ±‚**<em>PowerImageBaseRequest</em>**ï¼›</li>
<li>ç„¶å<code>PowerImageRequestManager.getInstance().startLoadingWithArguments</code><strong>æ‰§è¡Œ</strong>åˆšåˆšä¸Šä¸€æ­¥åˆ›å»ºçš„è¯·æ±‚ï¼Œæ­¤æ–¹æ³•å†…éƒ¨æ‰§è¡Œ<code>PowerImageBaseRequest.startLoading()</code>æ–¹æ³•ï¼›</li>
<li>åœ¨**<em>PowerImageBaseRequest</em><strong>ç±»å†…éƒ¨ï¼Œå…¶<code>startLoading</code>æ–¹æ³•ä¼šè°ƒç”¨<code>performLoadImage</code>æ–¹æ³•ï¼Œåè€…åˆä¼šè°ƒç”¨<code>PowerImageLoader.getInstance().handleRequest()</code>æ–¹æ³•</strong>è¯·æ±‚åŠ è½½å›¾ç‰‡**ï¼Œå¹¶æŒ‡å®šå›è°ƒæ–¹æ³•ä¸º<code>PowerImageBaseRequest.onLoadResult(result)</code>ï¼›</li>
<li><code>PowerImageLoader.handleRequest</code>æ–¹æ³•å†…éƒ¨é€šè¿‡è¯·æ±‚çš„<code>imageType</code>æ‰¾åˆ° Native ç«¯ï¼ˆæ¯”å¦‚ Android åœ¨<code>MainActivity.onCreate</code>ä¸­æ³¨å†Œçš„ï¼‰<code>PowerImageLoaderProtocol imageLoader</code>ï¼Œå¹¶æ‰§è¡Œå…¶<code>handleRequest</code>æ–¹æ³•<strong>å¤„ç†åŠ è½½å›¾ç‰‡</strong>è¯·æ±‚ï¼›</li>
<li><code>PowerImageLoaderProtocol.handleRequest()</code>æ–¹æ³•ä¸­<strong>è°ƒç”¨åŸç”Ÿçš„å›¾ç‰‡åŠ è½½åº“</strong>è·å– Drawable å¹¶ç”Ÿæˆ PowerImageResult å›è°ƒ<code>PowerImageResponse.onResult</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šå›è°ƒ<code>PowerImageBaseRequest.this.onLoadResult(result)</code> ï¼›</li>
<li>åœ¨**<em>PowerImageTextureRequest</em><strong>æˆ–è€…</strong><em>PowerImageExternalRequest</em>**çš„<code>onLoadResult</code>æ–¹æ³•ä¸­å¯¹è·å–åˆ°çš„<code>PowerImageResult</code>è¿›è¡Œå¤„ç†ä¹‹åå›è°ƒ<code>PowerImageBaseRequest</code>çš„<code>onLoadSuccess()</code>æˆ–è€…<code>onLoadFailed(final String errMsg)</code>æ–¹æ³•è¿”å›å›¾ç‰‡è¯·æ±‚ç»“æœã€‚</li>
</ul>
<h2> æ€»ç»“</h2>
<p><strong><em>power_image</em></strong> æ˜¯ä¸€ä¸ªåˆ©ç”¨åŸç”Ÿåº“åŠ è½½/ç®¡ç†å›¾ç‰‡çš„æ¯”è¾ƒé€‚ç”¨äº Flutter/Native æ··åˆå¼€å‘çš„å›¾ç‰‡åŠ è½½åº“ï¼Œæä¾›äº† <strong><em>texture</em></strong> å’Œ <strong><em>ffi</em></strong> ä¸¤ç§åŠ è½½å›¾ç‰‡çš„æ–¹å¼ã€‚</p>
<p>å…¶ä¸­ï¼Œtexture æ–¹æ¡ˆå®é™…ä½¿ç”¨ Texture ç»„ä»¶å±•ç¤ºå›¾ç‰‡ï¼›è€Œ ffi æ–¹æ¡ˆåˆ™åªæœ‰å›¾ç‰‡è·å–åœ¨ Native ç«¯ï¼Œå½“ä½¿ç”¨<code>ui.decodeImageFromPixels</code>æ–¹æ³•ä» Bitmap å†…å­˜æŒ‡é’ˆåˆ›å»º<em>ui.Image</em>ä¹‹åï¼ˆæ ¹æ®<a href="https://mp.weixin.qq.com/s/TdTGK21S-Yd3aD-yZDoYyQ#:~:text=decodeImageFromPixels%C2%A0%E4%BC%9A%E6%9C%89%E5%86%85%E5%AD%98%E6%8B%B7%E8%B4%9D%EF%BC%8C%E5%9C%A8%E6%8B%B7%E8%B4%9D%E8%A7%A3%E7%A0%81%E5%90%8E%E7%9A%84%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E6%97%B6%EF%BC%8C%E5%86%85%E5%AD%98%E5%B3%B0%E5%80%BC%E4%BC%9A%E6%9B%B4%E5%8A%A0%E4%B8%A5%E9%87%8D" target="_blank" rel="noopener noreferrer">é˜¿é‡Œçš„æè¿°</a>ï¼Œè¿™é‡Œä¼šå‘ç”Ÿä¸€æ¬¡å†…å­˜æ‹·è´ï¼Œå®é™…ä»£ç å¯ä»¥å‚è€ƒ<a href="https://www.notion.so/ui-decodeImageFromPixels-a401c6cf1c92428bb3c3a37da1078a6b" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ï¼‰ï¼Œå‰©ä¸‹æŒ‰ç…§å’Œ Flutter Image ç±»ä¼¼çš„æ­¥éª¤å±•ç¤ºå›¾ç‰‡ã€‚</p>
<p>æ ¹æ®å®˜æ–¹çš„è¯´æ³•ï¼š</p>
<ol>
<li>Texture é€‚ç”¨äºæ—¥å¸¸åœºæ™¯ï¼Œä¼˜å…ˆé€‰æ‹©ï¼›</li>
<li>FFI æ›´é€‚ç”¨äº
<ol>
<li>flutter &lt;= 1.23.0-18.1.pre ç‰ˆæœ¬ä¸­ï¼Œåœ¨æ¨¡æ‹Ÿå™¨ä¸Šæ˜¾ç¤ºå›¾ç‰‡</li>
<li>è·å– ui.Image å›¾ç‰‡æ•°æ®</li>
<li>flutter ä¾§è§£ç ï¼Œè§£ç å‰çš„æ•°æ®æ‹·è´å½±å“è¾ƒå°ã€‚</li>
</ol>
</li>
</ol>
<p>æ­¤å¤–ï¼Œæ ¹æ®å®˜æ–¹<a href="https://github.com/alibaba/power_image/issues/17" target="_blank" rel="noopener noreferrer">power_image/issues/17</a>çš„è¯´æ³•ï¼Œâ€œåœ¨ 2.5.3 ä¸Š ffi æ€§èƒ½å·²ç»è·Ÿ &nbsp;<code>texture</code>ä¸ç›¸ä¸Šä¸‹äº†â€ï¼Œè€Œä¸” textrue æ–¹æ¡ˆåœ¨ Android ä¸Šè¾ƒå¤§å°ºå¯¸å¯èƒ½ä¼š crashï¼ˆ<a href="https://github.com/flutter/flutter/issues/92397" target="_blank" rel="noopener noreferrer">flutter/flutter#92397</a>ï¼‰ï¼Œæ‰€ä»¥<strong>æ›´æ¨èä½¿ç”¨ ffi æ–¹æ¡ˆ</strong>ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://github.com/alibaba/power_image" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/power_image</a></p>
<p><a href="https://mp.weixin.qq.com/s/TdTGK21S-Yd3aD-yZDoYyQ" target="_blank" rel="noopener noreferrer">Flutter å›¾ç‰‡åº“é«˜ç‡ƒæ–°ç™»åœº</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzU4MDUxOTI5NA==&amp;mid=2247485142&amp;idx=1&amp;sn=b416f1d0c8f3fd2077075441154df090&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">é—²é±¼ Flutter å›¾ç‰‡æ¡†æ¶æ¶æ„æ¼”è¿›ï¼ˆè¶…è¯¦ç»†ï¼‰</a></p>
<p><a href="https://mp.weixin.qq.com/s/yUm4UFggYLgDbj4_JCjEdg#at" target="_blank" rel="noopener noreferrer">Flutter å›¾ç‰‡å†…å­˜ä¼˜åŒ–å®è·µ</a></p>
<p><a href="https://github.com/alibaba/power_image/issues/17" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/power_image/issues/17</a></p>
<p><a href="https://www.notion.so/ui-decodeImageFromPixels-a401c6cf1c92428bb3c3a37da1078a6b" target="_blank" rel="noopener noreferrer"><code>ui.decodeImageFromPixelsåˆ†æ</code></a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/flutter/power_image_class_structure.png" type="image/png"/>
    </item>
    <item>
      <title>Flutter æ»‘åŠ¨åˆ†æä¹‹ NestedScrollView</title>
      <link>https://jixiaoyong.github.io/blog/posts/ae8e53be.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/ae8e53be.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter æ»‘åŠ¨åˆ†æä¹‹ NestedScrollView</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 19 Jul 2022 09:48:12 GMT</pubDate>
      <content:encoded><![CDATA[<p>Flutter ä¸­çš„ scrollable widget æ ¹æ®å®ç°æ–¹å¼çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul>
<li>åŸºäº RenderBox çš„ box protocol å®ç°çš„ï¼Œä¸»è¦åŸºäº Size å®ç°å¸ƒå±€ã€‚å¸¸è§çš„æœ‰<a href="https://jixiaoyong.github.io/blog/posts/d3bdcb53.html" target="_blank" rel="noopener noreferrer">SingleChildScrollView</a>ã€‚</li>
<li>åŸºäº RenderSliver çš„ sliver protocol å®ç°çš„ï¼Œä¸»è¦åŸºäº SliverGeometry å®ç°å¸ƒå±€ã€‚æ¯”å¦‚ CustomScrollView åŠå…¶å­ç±» ListViewã€GridView ç­‰ç»§æ‰¿è‡ª<a href="https://jixiaoyong.github.io/blog/posts/60f8d92f.html" target="_blank" rel="noopener noreferrer">ScrollView</a>çš„ Widgetï¼Œä»¥åŠåŸºäº CustomScrollView çš„ NestedScrollViewã€åŸºäº Viewport ç­‰çš„ PageViewã€TabBarView ç­‰ç›´æ¥å¯¹ SliverFillViewport ç­‰è¿›è¡Œå°è£…çš„ Widgetã€‚</li>
</ul>
<p>ä¸Šè¿°æ‰€æœ‰çš„ scrollable widget å…¶åº•å±‚é€»è¾‘ä¾ç„¶æ˜¯å¯¹ Scrollable çš„å°è£…ï¼Œå…¶å†…éƒ¨å¤„ç†äº† ScrollControllerã€ScrollPositionï¼ˆviewport çš„ offsetï¼‰ã€ViewportBuilderï¼ˆå®¹çº³æ»šåŠ¨å†…å®¹çš„å®¹å™¨ï¼‰ã€ScrollPhysicsï¼ˆç®¡ç† scrollable view çš„ç‰©ç†å±æ€§ï¼Œæ¯”å¦‚æ˜¯å¦å¯ä»¥æ»šåŠ¨æˆ–å¼¹æ€§æ»šåŠ¨ç­‰ï¼‰ã€ScrollActivityï¼ˆå¯¹å¤–å‘å‡º ScrollNotificationï¼‰ã€RawGestureDetectorï¼ˆæ‰‹åŠ¿è¯†åˆ«ï¼‰ç­‰ç­‰ä¸€ç³»åˆ—ä¸ scroll æœ‰å…³çš„é€»è¾‘ï¼Œä»è€Œä½¿å¾—å…¶ä»– scrollable view èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿çš„å®ç° scroll æ•ˆæœã€‚</p>
<p>æœ¬æ–‡åªå¯¹ NestedScrollView çš„æºç å®ç°åšä¸€ç®€å•åˆ†æï¼šå®ƒæ˜¯å¦‚ä½•å®ç°è”åŠ¨æ»šåŠ¨æ•ˆæœï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿å’Œé™åˆ¶ã€‚</p>
<p>å®˜æ–¹å¯¹å…¶å®šä¹‰æ˜¯ï¼šâ€œA scrolling view inside of which can be nested other scrolling views, with their scroll positions being intrinsically linked.â€ã€‚</p>
<p>é¡¾åæ€ä¹‰ï¼ŒNestedScrollView æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨<strong>å†…éƒ¨åµŒå¥—å…¶ä»– scrolling views çš„æ»‘åŠ¨ View</strong>ï¼ŒæŒ‰ç…§æ‰€å¤„ä½ç½®çš„ä¸åŒï¼Œä½¿ç”¨<code>headerSliverBuilder</code>æä¾› header éƒ¨åˆ†çš„ scrolling viewsï¼ˆé™åˆ¶åªèƒ½æ˜¯å¯ä»¥äº§ç”Ÿ RenderSliver çš„ widgetï¼‰ï¼Œè€Œä½¿ç”¨<code>body</code>æä¾›åœ¨å¡«å…… header ä¹‹ä¸‹æ‰€æœ‰åŒºåŸŸçš„ widgetï¼ˆé™åˆ¶åªèƒ½æ˜¯äº§ç”Ÿ RenderBox çš„ widgetï¼‰ã€‚</p>
<h2> ç”¨ä¾‹</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª NestedScrollView ç»å…¸çš„ä½¿ç”¨æ–¹å¼ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒNestedScrollView åŒ…æ‹¬äº† headerSliverBuilder åˆ›å»ºçš„ header éƒ¨åˆ†ï¼Œä»¥åŠ header ä¸‹é¢çš„ body éƒ¨åˆ†ï¼ŒäºŒè€…çš„æ»‘åŠ¨æ•ˆæœè”åŠ¨åœ¨ä¸€èµ·ï¼Œå¥½åƒæ˜¯åŒä¸€ä¸ª scrolling viewã€‚æ¯”å¦‚ï¼Œå½“å‘ä¸Šæ»‘åŠ¨ TabBarView ä¸­åˆ—è¡¨æ—¶ï¼Œä¼šå…ˆå‘ä¸Šæ»‘åŠ¨ header å†…å®¹ï¼Œç­‰åˆ° header æ— éœ€å†æ»‘åŠ¨æ‰ä¼šå‘ä¸Šæ»‘åŠ¨åˆ—è¡¨ã€‚è€Œå¦‚æœæ²¡æœ‰ NestedScrollView çš„è¯ï¼ŒListView å’Œ header çš„æ»‘åŠ¨æ˜¯ç‹¬ç«‹çš„ä¸¤ä¸ªäº‹ä»¶ã€‚</p>
<h2> æºç åˆ†æ</h2>
<p>NestedScrollView æœ¬è´¨ä¸Šè¿˜æ˜¯å¯¹ CustomScrollViewï¼ˆçš„å­ç±»_NestedScrollViewCustomScrollViewï¼‰çš„è¿›ä¸€æ­¥å°è£…ã€‚</p>
<p>å®ƒå€ŸåŠ©äº_NestedScrollCoordinator çš„<code>_outerController</code> å’Œ<code>_innerController</code> è¿™ä¸¤ä¸ªåˆ†åˆ«ä¼ å…¥_NestedScrollViewCustomScrollViewï¼ˆheader å’Œ body å…¶å®æ˜¯ä»–çš„ <code>slivers</code>ï¼Œå…¶æœ€å¤§æ»‘åŠ¨èŒƒå›´ä¸º header çš„ scrollExtentï¼‰å’Œ body ä¸­çš„ scrolling viewï¼ˆå…¶æœ€å¤§æ»‘åŠ¨èŒƒå›´ä¸ºå†…éƒ¨æ»‘åŠ¨è§†å›¾æœ€å¤§æ»‘åŠ¨èŒƒå›´ä¹‹å’Œï¼‰çš„ ScrollControllerï¼Œåˆ›å»ºå¹¶åº”ç”¨_NestedScrollPositionï¼›å½“ç”¨æˆ·æ»‘åŠ¨ç­‰äº‹ä»¶å‘ç”Ÿï¼Œé€šè¿‡_NestedScrollViewCustomScrollView çš„_NestedScrollPosition æ¥æ”¶å¤–éƒ¨æ‰€æœ‰çš„æ»‘åŠ¨äº‹ä»¶å…¨éƒ¨å½’é›†åˆ°_NestedScrollCoordinatorï¼ˆæ¯”å¦‚ applyUserOffset æ–¹æ³•ï¼‰ç»Ÿä¸€å¤„ç†ï¼ŒæŒ‰ç…§ ScrollPhysics ç­‰åˆ†åˆ«ä¿®æ”¹ header å’Œ body çš„ ScrollPositionï¼Œä»è€Œå®ç°äº†è¿™ä¸¤å¤„æ»‘åŠ¨äº‹ä»¶çš„è”åŠ¨ã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨åˆ†æ NestedScrollView çš„æ—¶å€™ï¼Œä¸»è¦æ¶‰åŠåˆ°ä»¥ä¸‹ç±»ï¼š</p>
<ul>
<li><strong>NestedScrollViewState</strong>ï¼šæ˜¯ NestedScrollView çœŸæ­£æ‰§è¡Œé€»è¾‘çš„ç±»ï¼Œå°†_NestedScrollCoordinatorã€_NestedScrollViewCustomScrollViewã€ScrollController ç­‰ç»„è£…åœ¨ä¸€èµ·ï¼Œå¯¹å¤–æš´éœ²æ“çºµ_NestedScrollCoordinator çš„æ–¹æ³•</li>
<li>_NestedScrollViewCustomScrollViewï¼šç»§æ‰¿è‡ª CustomScrollViewï¼Œä¸»è¦ä½œç”¨æ˜¯åˆ›å»ºè‡ªå®šä¹‰çš„ NestedScrollViewViewportï¼Œåè€…åˆåˆ›å»ºäº† RenderNestedScrollViewViewport ä¸»è¦ç”¨é€”æ˜¯æ›´æ–° SliverOverlapAbsorberHandle</li>
<li><strong>_NestedScrollCoordinator</strong>ï¼šå¤„ç†_NestedScrollPosition è½¬å‘è¿‡æ¥çš„æ»‘åŠ¨äº‹ä»¶ï¼Œå°†å…¶åˆ†å‘ç»™ headerï¼ˆå…¶å®æ˜¯å®¹çº³ header å’Œ body çš„_NestedScrollViewCustomScrollViewï¼‰å’Œ bodyã€‚</li>
<li><strong>_NestedScrollController</strong>ï¼šç»™_NestedScrollCoordinator çš„ inner å’Œ outer çš„ ScrollControllerï¼Œå†…éƒ¨åˆ›å»º_NestedScrollPositionã€‚</li>
<li><strong>_NestedScrollPosition</strong>ï¼šç»™_NestedScrollCoordinator çš„ inner å’Œ outer çš„ ScrollPositionï¼Œä¼šå°† animateToã€jumpToã€pointerScrollã€updateCanDragã€holdã€drag ç­‰å’Œæ»‘åŠ¨æœ‰å…³çš„äº‹ä»¶è½¬å‘ç»™_NestedScrollCoordinator ç»Ÿä¸€å¤„ç†ã€‚</li>
<li>å…¶ä½™è¾…åŠ©ç±»</li>
</ul>
<p>ä¸‹é¢å¯¹è¿™äº›ç±»é€ä¸€åˆ†æï¼š</p>
<h3> NestedScrollViewState</h3>
<p>NestedScrollView æ˜¯ StatefulWidgetï¼Œå…¶ä¸»è¦é€»è¾‘éƒ½åœ¨åˆ›å»ºçš„ Stateâ€”â€”NestedScrollViewState ä¸­ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>NestedScrollView._buildSlivers æ–¹æ³•å°† headerSliverBuilder åˆ›å»ºçš„ header å’Œ body æ”¾åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œä¼šè¢« NestedScrollViewState ä¼ å…¥åˆ°è‡ªå®šä¹‰çš„ CustomScrollViewâ€”â€”_NestedScrollViewCustomScrollView ä¸­ã€‚</p>
<p>éœ€è¦æ³¨æ„ SliverFillRemaining é»˜è®¤ä¼šåˆ›å»º_SliverFillRemainingWithScrollableï¼Œåè€…åˆ›å»ºçš„ RenderObject æ˜¯_SliverFillRemainingWithScrollableã€‚åœ¨ RenderSliverFillRemainingWithScrollable.performLayout æ–¹æ³•ä¼šä½¿ç”¨ä»–æ‰€å¤„ viewport ä¸»è½´æ–¹å‘çš„å°ºå¯¸ä½œä¸ºè‡ªå·±çš„ scrollExtentã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´æ— è®º inner scrolling view çš„å°ºå¯¸å¦‚ä½•ï¼Œå®ƒï¼ˆä¸‹é¢ç§°å…¶ä¸º bodyï¼‰å ç”¨çš„ scrollExtent éƒ½æ˜¯æ‰€å¤„çš„ viewport çš„ä¸»è½´å°ºå¯¸ mainAxisExtentï¼›å†åŠ ä¸Š headerSliverBuilder æ–¹æ³•åˆ›å»ºçš„ headerï¼Œå¯¼è‡´_NestedScrollViewCustomScrollView æ‰€åˆ›å»ºçš„ viewport çš„æœ€å¤§å¯æ»‘åŠ¨èŒƒå›´_maxScrollExtentï¼ˆå…¶å€¼ç­‰äº header+body çš„ scrollExtentï¼‰ä¸€å®šå¤§äº viewport çš„ä¸»è½´æ–¹å‘å°ºå¯¸ mainAxisExtentï¼Œä»è€Œè®¡ç®—å‡º_NestedScrollViewCustomScrollView çš„ ScrollPosition çš„æœ€å¤§æ»‘åŠ¨èŒƒå›´ï¼ˆmaxScrollExtentï¼‰ä¸ºï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼Œæ— è®º NestedScrollView çš„ body å†…å®¹å°ºå¯¸å¦‚ä½•ï¼Œå®ƒä¸º header+body åˆ†é…çš„å°ºå¯¸åªæ¯” viewport çš„å°ºå¯¸å¤šå‡ºä¸€ä¸ª header çš„å°ºå¯¸ã€‚è¿™ä¸ªä¹Ÿæ˜¯ NestedScrollView å®ç°åè°ƒ header å’Œ body æ»‘åŠ¨çš„åŸºç¡€ã€‚</p>
<p>è®©æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ NestedScrollViewState çš„å®ç°ï¼š</p>
<p>NestedScrollViewState ä¸­ä¸€ä¸ªé‡è¦çš„å±æ€§å°±æ˜¯<code>_NestedScrollCoordinator? _coordinator</code>ï¼Œå®ƒåœ¨<code>initState()</code>æ–¹æ³•ä¸­åˆå§‹åŒ–ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>èƒ½æ³¨æ„åˆ°ï¼Œ_NestedScrollCoordinator ä¸­æŒæœ‰äº† widget.controllerï¼Œå¹¶ä¸”è¿˜ä¼šåœ¨ didChangeDependenciesã€didUpdateWidget æ–¹æ³•è¢«è°ƒç”¨æ—¶é€šè¿‡_NestedScrollCoordinator.setParent æ–¹æ³•æ›´æ–°ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š1. è·å– initialScrollOffsetï¼›2. é€šè¿‡_outerPosition?.setParent ä½¿å¾— widget.controller å¯ä»¥ç›‘å¬ outerPosition çš„å˜åŒ–ã€‚</p>
<p>ç„¶åï¼Œåœ¨ NestedScrollViewState.build æ–¹æ³•ä¸­ï¼Œä¼šåˆ›å»º_NestedScrollViewCustomScrollView å¯¹è±¡ï¼š</p>
<ul>
<li>
<p>å°†_coordinator!._outerController ä½œä¸ºå…¶ controllerï¼Œè¿™æ ·ä¼šåˆ›å»ºï¼Œ_outerPositionï¼Œåè€…ä¼šå°†_NestedScrollViewCustomScrollView çš„äº‹ä»¶è½¬å‘ç»™_coordinatorï¼Œè¿™æ ·å…¶æ¥ç®¡äº†å¤–å±‚çš„æ»‘åŠ¨äº‹ä»¶ï¼›</p>
</li>
<li>
<p>æ­¤å¤–åœ¨ NestedScrollView._buildSlivers æ–¹æ³•ä¸­åˆ›å»ºçš„ header å’Œ body ä½œä¸º_NestedScrollViewCustomScrollView ä¹Ÿå°±æ˜¯ CustomScrollView çš„ sliversã€‚</p>
<p>è¿™ä¹Ÿæ˜¯åˆ›å»º header çš„<strong>NestedScrollView.headerSliverBuilder åªæ¥å—å¯ä»¥åˆ›å»º RenderSliver çš„ widget</strong>çš„åŸå› ã€‚</p>
</li>
</ul>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>_NestedScrollViewCustomScrollView ç»§æ‰¿è‡ª CustomScrollViewï¼Œä¸»è¦ä½œç”¨æ˜¯åˆ›å»ºç»§æ‰¿è‡ª Viewport çš„ NestedScrollViewViewportï¼Œè€Œåè€…åˆä¸»è¦è´Ÿè´£åˆ›å»ºå’Œæ›´æ–°ç»§æ‰¿è‡ª RenderViewport çš„ RenderNestedScrollViewViewportâ€”â€”å…¶åœ¨å†…éƒ¨æ›´æ–°å’Œç»´æŠ¤ SliverOverlapAbsorberHandleã€‚</p>
<blockquote>
<p><code>SliverOverlapAbsorberHandle</code>: Handle to provide to a <code>SliverOverlapAbsorber</code>, a <code>SliverOverlapInjector</code>, and an <code>NestedScrollViewViewport</code>, to shift overlap in a <code>NestedScrollView</code>.</p>
</blockquote>
<p>åˆ°ç›®å‰ä½ç½®ï¼ŒUI å±•ç¤ºéƒ¨åˆ†çš„å†…å®¹å·²ç»å®Œæˆï¼Œæˆ‘ä»¬çš„ NestedScrollView å¯ä»¥å°† header å’Œ body æ˜¾ç¤ºåœ¨å±å¹•ä¸Šé¢ï¼Œä½†æ˜¯å¦‚æœè¦è”åŠ¨å¤„ç†åœ¨ header å’Œ body ä¸Šé¢çš„æ»‘åŠ¨äº‹ä»¶ï¼Œè¿˜éœ€è¦_NestedScrollCoordinatorã€_NestedScrollController å’Œ_NestedScrollPosition çš„é…åˆã€‚</p>
<h3> _NestedScrollController</h3>
<p>_NestedScrollController ç»§æ‰¿è‡ª ScrollControllerï¼Œå…¶é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ·»åŠ äº†ä¸¤é¡¹åŠŸèƒ½ï¼š</p>
<h4> åˆ›å»º_NestedScrollPosition</h4>
<p>åˆ›å»º_NestedScrollPosition çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯å°† coordinator ä¹Ÿä¸€å¹¶ä¼ å…¥ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> åœ¨ ScrollPosition å˜åŒ–æ—¶é€šçŸ¥ coordinator</h4>
<p>åœ¨ attach(ScrollPosition position) ä¸­è°ƒç”¨_scheduleUpdateShadow() å’Œ_NestedScrollCoordinator çš„ updateParentã€updateCanDragï¼Œå¯¹ä¼ å…¥çš„ ScrollPosition æ·»åŠ å›è°ƒ_scheduleUpdateShadow()ã€‚</p>
<p>åœ¨ detach(ScrollPosition position) ä¸­è°ƒç”¨_scheduleUpdateShadow()ï¼Œå¯¹ä¼ å…¥çš„ ScrollPosition ç§»é™¤å›è°ƒ_scheduleUpdateShadow()ã€‚</p>
<p>è€Œè¿™ä¸ª_scheduleUpdateShadow() æ–¹æ³•ä¸»è¦ä½œç”¨æ˜¯å¼‚æ­¥æ‰§è¡Œ coordinator.updateShadow() æ›´æ–° NestedScrollViewï¼Œå®ç°æ»‘åŠ¨æ•ˆæœã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> _NestedScrollPosition</h3>
<p>åœ¨ inner scrolling widget å’Œ outer viewport éƒ½ä½¿ç”¨_NestedScrollPositionï¼Œå®ƒè¿½è¸ªè¿™äº› viewport ä½¿ç”¨çš„ offsetï¼Œå¹¶ä¸”å†…éƒ¨æŒæœ‰_NestedScrollCoordinatorï¼Œæ‰€ä»¥æ­¤ class ä¸Šè§¦å‘ activities æ—¶ï¼Œå¯ä»¥æ¨è¿Ÿæˆ–è€…å½±å“ coordinatorã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> setParent</h4>
<p>_NestedScrollPosition.setParent ä¸­ï¼Œå°†è‡ªå·±å’Œä¼ å…¥çš„ ScrollController ç»‘å®šåœ¨ä¸€èµ·ï¼š</p>
<ul>
<li>å°†è‡ªèº«åŠ å…¥ ScrollController._positions</li>
<li>ScrollController ç›‘å¬è‡ªèº«å˜åŒ–æ—¶æ‰§è¡Œ notifyListeners é€šçŸ¥ç›‘å¬è€…</li>
</ul>
<h4> absorb</h4>
<p>åœ¨ absorb æ–¹æ³•ä¸­å°† activity çš„ delegate æ›´æ–°ä¸ºå½“å‰ ScrollPositionï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> applyClampedDragUpdate</h4>
<p>æ­¤æ–¹æ³•è¿”å›çš„æ˜¯æ²¡æœ‰ä½¿ç”¨çš„ deltaï¼Œæ­¤æ–¹æ³•ä¸ä¼šä¸»åŠ¨åˆ›å»º overscroll/underscrollï¼Œå¦‚æœå½“å‰ ScrollPosition åœ¨èŒƒå›´å†…ï¼Œåˆ™ä¸ä¼šå‘é€ overscroll/underscrollï¼›å¦‚æœå·²ç»è¶…å‡ºèŒƒå›´ï¼Œåˆ™åªä¼šâ€œå‡è½»â€è¿™ç§æƒ…å†µï¼Œè€Œä¸ä¼šâ€œåŠ é‡â€ã€‚</p>
<p>ä¹‹æ‰€ä»¥ä¸ä¼š overscrollï¼Œæ˜¯å› ä¸º min å’Œ max çš„å–å€¼é™å®šäº†ä»–ä»¬çš„èŒƒå›´ï¼Œä»¥ä¸€ä¸ªå‚ç›´æ–¹å‘å‘ä¸‹å¸ƒå±€çš„æ»‘åŠ¨åˆ—è¡¨ä¸ºä¾‹ï¼š</p>
<ul>
<li>
<p>delat &lt; 0ï¼Œå³å‘ä¸Šæ»‘åŠ¨ï¼ŒèŒƒå›´æ˜¯ minï¼š-double.infinity ~ maxï¼š0ï¼ˆoverscroll æ—¶ï¼‰æˆ–è€… maxScrollExtent å’Œ pixels ä¸­æœ€å¤§å€¼ï¼ˆåªèƒ½æ»‘åˆ°æœ€å¤§èŒƒå›´ï¼‰ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘ä¸Šæ»‘åŠ¨æ—¶ï¼Œå¦‚æœå·²ç»åœ¨é¡¶éƒ¨å‡ºç° overscrollï¼ˆæ­¤æ—¶ pixels åº”è¯¥ä¸ºè´Ÿå€¼ï¼‰ï¼Œé‚£ä¹ˆæœ€å¤šæ»‘åŠ¨åˆ° 0ï¼ˆä¹Ÿå°±æ˜¯æ¢å¤åˆ°åˆå§‹ä½ç½®ï¼‰ï¼Œæ²¡æœ‰é¡¶éƒ¨ overscroll æ—¶ï¼ˆæ­¤æ—¶ pixels ä¸ºæ­£å€¼ï¼Œå¯èƒ½åœ¨ maxScrollExtent èŒƒå›´å†…ï¼Œä¹Ÿå¯èƒ½è¶…å‡ºèŒƒå›´ï¼Œå³åº•éƒ¨å‡ºç° overscrollï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶æœ€å¤šå‘ä¸Šæ»‘åŠ¨ maxScrollExtent å’Œ pixelsï¼Œä¹Ÿå°±æ˜¯è¯´è¦ä¹ˆä¸èƒ½è¶…èŒƒå›´ï¼Œè¦æ˜¯è¶…äº†èŒƒå›´ï¼Œå°±ä¸èƒ½å†è¶…äº†ã€‚</p>
<p>è€Œæœ€å°æ»‘åŠ¨èŒƒå›´ä¸º-double.infinityï¼Œæ— è®º pixels æ­£è´Ÿï¼Œå½“å…¶ delta ä¸ºè´Ÿæ—¶ï¼Œå…¶å€¼éƒ½åªä¼šå¢å¤§ï¼Œå–å€¼-double.infinity æ˜¯ä¸ºäº†å°† pixels åŒ…å«åœ¨å†…ã€‚</p>
</li>
<li>
<p>delta &gt; 0ï¼Œå³å‘ä¸‹æ»‘åŠ¨ï¼ŒèŒƒå›´æ˜¯ minï¼šminScrollExtent å’Œ pixels æœ€å°å€¼ ~ double.infinityã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘ä¸‹æ»‘åŠ¨æœ€å°åˆ°åˆå§‹ä½ç½®ï¼Œæœ€å¤§å€¼ä¸é™å®šï¼ˆå› ä¸ºæ­¤æ—¶å¯èƒ½ offset å·²ç»ç”±äºæŸç§åŸå› è¶…è¿‡ maxScrollExtent äº†ï¼‰ã€‚</p>
</li>
</ul>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> applyFullDragUpdate</h4>
<p>æ­¤æ–¹æ³•åœ¨æ»¡è¶³ overscroll æ¡ä»¶æ—¶ï¼Œä¼šåº”ç”¨ overscrollï¼Œå¹¶å‘å‡º OverscrollNotification é€šçŸ¥ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> applyClampedPointerSignalUpdate</h4>
<p>applyClampedPointerSignalUpdate æ–¹æ³•è¿”å›æœªä½¿ç”¨çš„ deltaï¼Œä¸è€ƒè™‘ ScrollPhysics çš„å½±å“ã€‚</p>
<h4> applyNewDimensions()</h4>
<p>æ­¤æ–¹æ³•æ˜¯_outerScrollPosition æ¥ç®¡ body æ»‘åŠ¨äº‹ä»¶çš„å…³é”®ï¼Œä¹Ÿæ˜¯<strong>body ä¸­ scrolling view ä½¿ç”¨äº†è‡ªå·±çš„ ScrollController ä¹‹å NestedScrollView å°±æ— æ³•åè°ƒ header å’Œ body æ»‘åŠ¨</strong>çš„åŸå› ã€‚</p>
<p>åœ¨é»˜è®¤çš„ ScrollController ä¸­ï¼ŒcreateScrollPosition() æ–¹æ³•åˆ›å»ºçš„æ˜¯ ScrollPositionWithSingleContextï¼Œå½“ content æˆ–è€… viewport çš„å°ºå¯¸å˜åŒ–ä¹‹åä¼šè°ƒç”¨å…¶ applyNewDimensions() æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åä¼šè°ƒç”¨ ScrollableState çš„ setCanDrag æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§_gestureRecognizers é»˜è®¤ä¸ºç©ºï¼Œåªæœ‰ä¸»åŠ¨è°ƒç”¨ ScrollableState.setCanDrag(true) ä¹‹åæ»‘åŠ¨è§†å›¾ä¸­çš„ Scrollable æ‰èƒ½è¯†åˆ«æ‰‹åŠ¿å¹¶å¤„ç†ã€‚</p>
<p>è€Œåœ¨_NesetedScrollPosition çš„æ–¹æ³•ä¸­ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨ï¼Œè€Œæ˜¯ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šè¿°ä»£ç åˆ†æå¯çŸ¥ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤çš„_NestedScrollController åˆ›å»ºçš„_NestedScrollPositionï¼Œæœ€ååªæœ‰_outerPosition æ›´æ–°äº†_gestureRecognizers å¯ä»¥è¯†åˆ«æ‰‹åŠ¿ï¼Œè€Œä½¿ç”¨_innerScrollPosition çš„ body å†…éƒ¨çš„ scrolling view æ— æ³•è¯†åˆ«æ‰‹åŠ¿ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“æ²¡æœ‰ç»™ body ä¸­çš„ scrolling view ä¸»åŠ¨è®¾ç½® ScrollController æ—¶ï¼Œæ— è®ºæ˜¯åœ¨ header è¿˜æ˜¯ body çš„æ‰‹åŠ¿äº‹ä»¶éƒ½ä¼šç”± ScrollPosition æ¥è½¬å‘ç»™_NestedScrollCoordinator ç»Ÿä¸€åè°ƒå¤„ç†ï¼›è€Œ<strong>å¦‚æœç»™ body ä¸­çš„ scrolling view ä¸»åŠ¨è®¾ç½® ScrollController</strong>ï¼Œç”±äº ScrollController é»˜è®¤åˆ›å»ºçš„ ScrollPositionWithSingleContext ä¼šæŒ‰ç…§å®é™…æƒ…å†µæ›´æ–°_gestureRecognizersï¼Œ<strong>ä»è€Œå½“ç”¨æˆ·æ‰‹åŠ¿åœ¨ body ä¸­ scrolling view çš„èŒƒå›´æ—¶ï¼Œæ‰‹åŠ¿äº‹ä»¶ä¼šè¢«å…¶æ•è·å¹¶å†…éƒ¨æ¶ˆè€—ï¼Œè€Œéè½¬å‘åˆ°_NestedScrollCoordinator å¤„ç†ï¼Œæ‰€ä»¥å°±ä¼šä½¿ NestedScrollView å¤±æ•ˆ</strong>ã€‚</p>
<br>
<p>æ­¤å¤–è¿˜æŒæœ‰äº†_NestedScrollCoordinatorï¼Œåœ¨ animateTo/jumpTo/pointerScroll/applyNewDimensions/hold/drag ç­‰ä¸æ»‘åŠ¨ç›¸å…³çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰§è¡Œ_NestedScrollCoordinator ä¸­å¯¹åº”çš„æ–¹æ³•ï¼Œè¿™æ ·å°±å°† outer viewport å’Œ inner scrolling view çš„æ»‘åŠ¨äº‹ä»¶éƒ½å½’é›†åˆ°_NestedScrollCoordinator ç»Ÿä¸€å¤„ç†ã€‚</p>
<h3> _NestedScrollCoordinator</h3>
<p>ä¸ºäº†ä¸_NestedScrollPosition ä¿æŒä¸€è‡´ï¼Œæ–¹ä¾¿æ¥æ”¶å…¶è½¬å‘çš„äº‹ä»¶ï¼Œ_NestedScrollCoordinator ä¹Ÿå®ç°äº† ScrollActivityDelegate æ¥å£ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> beginActivity</h4>
<p>beginActivity ç”¨æ¥å¯¹ outer å’Œ inner åº”ç”¨ ScrollActivityï¼Œåœ¨ goIdle/goBallistic/animateTo/jumpTo/pointerScroll/drag/hold ç­‰ä¸æ»‘åŠ¨æœ‰å…³çš„æ–¹æ³•ä¸­éƒ½æœ‰ç›´æ¥æˆ–é—´æ¥çš„è°ƒç”¨ã€‚</p>
<p>å…¶ä¸­ outer activity æ˜¯ç›´æ¥æŒ‡å®šçš„ï¼Œè€Œ inner activity åˆ™æ˜¯æ ¹æ® innerActivityGetter å’Œ inner position åŠ¨æ€è®¡ç®—ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ–¹æ³•çš„ä¸€ç§ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»º outer scroll activity çš„æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§åœ¨è®¡ç®— outer scroll activity çš„æ—¶å€™ï¼Œéœ€åˆ¤æ–­ body å†…æ˜¯ä¸æ˜¯æœ‰ inner scrolling viewï¼š</p>
<ul>
<li>æ²¡æœ‰ï¼ŒæŒ‰ç…§æ­£å¸¸åˆ›å»º BallisticScrollActivity çš„æµç¨‹åˆ›å»º</li>
<li>æœ‰ï¼Œå°† inner çš„ space ä¹Ÿè®¡å…¥ï¼Œç„¶åä»¥æ­¤è®¡ç®— BallisticScrollActivity</li>
</ul>
<p>åˆ›å»º inner scroll activity çš„æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> applyUserOffset</h4>
<p>applyUserOffset() æ˜¯_NestedScrollCoordinator çš„é‡ç‚¹ï¼Œä¹Ÿæ˜¯ NestedScrollView èƒ½å¤Ÿå®ç°åè°ƒ inner å’Œ outer æ»‘åŠ¨äº‹ä»¶çš„å…³é”®ã€‚</p>
<p>åœ¨çœ‹ applyUserOffset() æ–¹æ³•ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹ drag() æ–¹æ³•ï¼Œåœ¨æ­¤æ–¹æ³•ä¸­åˆ›å»º ScrollDragController æ—¶ delegate ä¼ å…¥çš„æ˜¯_NestedScrollCoordinatorã€‚</p>
<p>å½“ç”¨æˆ·æ“ä½œå±å¹•å‘ç”Ÿ drag äº‹ä»¶æ—¶ï¼Œæ‰‹åŠ¿äº‹ä»¶ä¼šè¢« ScrollableState ä¸­çš„ RawGestureDetector è¯†åˆ«åˆ°ï¼š</p>
<ul>
<li>drag å¼€å§‹æ—¶è°ƒç”¨<code>_handleDragStart</code>ï¼Œé€šè¿‡_NestedScrollPosition è½¬å‘è°ƒç”¨<code>_NestedScrollCoordinator.drag</code>æ–¹æ³•åˆ›å»ºäº†<code>ScrollDragController drag</code></li>
</ul>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>drag å¼€å§‹æ—¶æ›´æ–°æ—¶<code>_handleDragUpdate</code>ï¼Œå†…éƒ¨è°ƒç”¨<code>ScrollDragController.update</code>,åœ¨ update æ–¹æ³•å†…éƒ¨æ‰§è¡Œäº†<code>delegate.applyUserOffset</code>ï¼Œæ­¤å¤„çš„<code>delegate</code>å°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä¼ å…¥çš„_NestedScrollCoordinator</li>
</ul>
<p>æ ¹æ®ä¸Šè¿°åˆ†æï¼Œåœ¨ç”¨æˆ·æ»‘åŠ¨å±å¹•æ—¶ï¼Œä¼šæ‰§è¡Œ<code>_NestedScrollCoordinator.applyUserOffset</code>æ–¹æ³•ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†æä¸ºä½• inner æœ‰ scrolling view æ—¶ï¼ŒNestedScrollView.physics ä¸º BouncingScrollPhysics() ä¸ç”Ÿæ•ˆï¼š</p>
<p>ä»ä¸Šè¿°ä»£ç æˆ‘ä»¬çœ‹åˆ°ï¼Œå¯ä»¥äº§ç”Ÿ overscroll æ•ˆæœçš„ applyFullDragUpdate åªæœ‰åœ¨ inner ä¸­æ²¡æœ‰ scrolling view çš„æ—¶å€™æ‰ä¼šè¢«_outerPosition åº”ç”¨ï¼Œå…¶ä»–ä¸¤ä¸ªåœºæ™¯éƒ½åªæœ‰ inner position åº”ç”¨ã€‚</p>
<p>è€Œå…¶ä½™åœºæ™¯ä¸­ï¼Œ_outerPosition å’Œ inner position éƒ½åº”ç”¨çš„æ˜¯ applyClampedDragUpdate æ–¹æ³•ï¼š</p>
<ul>
<li>å‘ä¸‹æ»‘åŠ¨ delta å¤§äº 0ï¼Œä»£ç ä¼šæ‰§è¡Œåˆ°<code>outerDelta -= _outerPosition!.applyClampedDragUpdate(outerDelta)</code>ï¼Œå› ä¸ºæ­¤æ—¶é™åˆ¶äº† applyClampedDragUpdate ä¸­çš„ newPixels èŒƒå›´ä¸ºï¼ˆå½“ ScrollPosition çš„ pixels ç­‰äº 0 æ—¶ï¼‰minScrollExtent~double.infinityï¼Œæ‰€ä»¥ clampedDelta = newPixels - pixels ç­‰äº minScrollExtentï¼ˆä¹Ÿå°±æ˜¯ 0ï¼‰ï¼Œè·³è¿‡å‰©ä½™æ­¥éª¤ç›´æ¥è¿”å›äº† deltaã€‚æ‰€ä»¥æ²¡æœ‰æ‰§è¡Œ BouncingScrollPhysics() é€»è¾‘</li>
<li>å‘ä¸Šæ»‘åŠ¨ delta å°äº 0ï¼Œä»£ç ä¼šæ‰§è¡Œ<code>final double innerDelta = _outerPosition!.applyClampedDragUpdate(outerDelta,);</code>ï¼Œåœ¨æ­¤æ–¹æ³•ä¸­ï¼Œå¦‚æœæœ‰ overscroll åˆ™ä¼šå…ˆæ¢å¤åˆ° 0ï¼Œå¦åˆ™æœ€å¤šä¸Šåˆ’åˆ° maxScrollExtentï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæ‰§è¡Œ BouncingScrollPhysics() é€»è¾‘</li>
</ul>
<br>
<p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼ŒNestedScrollView å°† header å’Œ body çš„æ»šåŠ¨äº‹ä»¶è¿›è¡Œç»„åˆã€åˆ†å‘ã€‚</p>
<h2> ä¼˜åŠ£å¯¹æ¯”</h2>
<p>NestedScrollView å°† header å’Œ body ä¸­å¯æ»‘åŠ¨ viewï¼ˆinnerï¼‰çš„æ»‘åŠ¨äº‹ä»¶ç»„åˆèµ·æ¥ï¼šå‘ä¸Šæ»‘åŠ¨æ—¶ï¼Œå…ˆç­‰è¾¾åˆ° header æœ€å¤§æ»‘åŠ¨èŒƒå›´ä¹‹åï¼Œå†å°†æ»‘åŠ¨åˆ†é…ç»™ inner æ¶ˆè€—ï¼›å½“å‘ä¸‹æ»‘åŠ¨æ—¶ï¼Œä¸€èˆ¬å…ˆæ¢å¤ inner çš„ overscrollï¼ˆå¦‚æœ_floatHeaderSlivers ä¸º trueï¼Œä¼šå…ˆå°è¯•ä¸‹æ»‘ headerï¼‰ï¼Œå°è¯•å°†å…¶æ¢å¤è‡³ offset ä¸º 0 çš„çŠ¶æ€ï¼Œå†å°è¯•å°† header å‘ä¸‹æ»‘åŠ¨åˆ°åˆå§‹ä½ç½®ï¼Œæœ€åå¦‚æœæœ‰ overscrollï¼Œä¼šå°è¯•åº”ç”¨åˆ° inner ä¸Šé¢ã€‚</p>
<p>CustomScrollView ä¹Ÿæ”¯æŒåœ¨åŒä¸€ä¸ªé¡µé¢å†…åµŒå¥—å¤šä¸ªæ»‘åŠ¨åˆ—è¡¨å¹¶å…³è”ï¼ˆåœ¨å…¶ slivers ä¸­ä¼ å…¥å¤šä¸ª SliverList,SliverGrid ç­‰ï¼‰ï¼Œä½†æ˜¯ CustomScrollView ä¸æ”¯æŒæ™®é€šçš„æ»‘åŠ¨ viewï¼Œæ¯”å¦‚ ListView ç­‰ï¼Œè¿™äº›æ»‘åŠ¨å¸ƒå±€ä¼šå†…éƒ¨æ¶ˆè€—æ‰æ»‘åŠ¨äº‹ä»¶ï¼Œä»è€Œæ— æ³•ä¸ CustomScrollView å†…å…¶ä½™ sliver æ­£å¸¸è”åŠ¨ã€‚</p>
<h2> æ€»ç»“</h2>
<p>NestedScrollView å†…éƒ¨é€šè¿‡ NestedScrollViewState.build() åˆ›å»ºç»§æ‰¿è‡ª CustomScrollView çš„_NestedScrollViewCustomScrollViewã€‚</p>
<p>é€šè¿‡ NestedScrollView._buildSlivers() å°† NestedScrollView.headerSliverBuilder è¿”å›çš„ sliver åˆ—è¡¨ï¼ˆä¸‹ç§° headerï¼‰å’Œè¢« SliverFillRemaining åŒ…è£¹çš„ body ç»„åˆåœ¨ä¸€èµ·ï¼Œä½¿å¾—åœ¨_NestedScrollViewCustomScrollView ä¸­åˆ›å»ºçš„ viewport çš„åˆ›å»ºçš„_NestedScrollCoordinator.outerPosition çš„_maxScrollExtent ä¸º NestedScrollView çš„ header çš„ä¸»è½´å°ºå¯¸ï¼Œè€Œ_NestedScrollCoordinator._innerPositions çš„_maxScrollExtent åˆ™æ˜¯ä¸ body å®é™…å†…å®¹ä¸€è‡´ã€‚</p>
<p>_NestedScrollViewCustomScrollView çš„ ScrollController æ˜¯_NestedScrollCoordinator._outerControllerï¼Œå…¶åˆ›å»ºäº†_NestedScrollCoordinator.outerPositionï¼Œæ‰€ä»¥æ•´ä¸ª NestedScrollView çš„æ»‘åŠ¨äº‹ä»¶éƒ½ä¼šé€šè¿‡_NestedScrollCoordinator._outerController è½¬åˆ°ç»™_NestedScrollCoordinator.applyUserOffset æ–¹æ³•ã€‚</p>
<p>åœ¨_NestedScrollCoordinator.applyUserOffset æ–¹æ³•ä¸­ï¼Œæ ¹æ®æ»‘åŠ¨æ–¹å‘çš„ä¸åŒï¼Œä¾æ¬¡åè°ƒ_NestedScrollCoordinator.outerPosition å’Œ_NestedScrollCoordinator._innerPositions å¤„ç†ç”¨æˆ· drag ç­‰äº§ç”Ÿçš„ deltaï¼Œä¿®æ”¹è¿™ä¸¤ä¸ª ScrollPosition çš„å€¼ï¼Œä»è€Œå®ç° header å’Œ body çš„æ»‘åŠ¨è”åŠ¨ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://api.flutter.dev/flutter/widgets/NestedScrollView-class.html" target="_blank" rel="noopener noreferrer">NestedScrollView_api.flutter.dev</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Flutter æ»‘åŠ¨åˆ†æä¹‹ Scrollview</title>
      <link>https://jixiaoyong.github.io/blog/posts/60f8d92f.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/60f8d92f.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter æ»‘åŠ¨åˆ†æä¹‹ Scrollview</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 16 Jul 2022 02:14:01 GMT</pubDate>
      <content:encoded><![CDATA[<p>Flutter ä¸­çš„ scrollable widget æ ¹æ®å®ç°æ–¹å¼çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul>
<li>åŸºäº RenderBox çš„ <em>box protocol</em> å®ç°çš„ï¼Œä¸»è¦åŸºäº Size å®ç°å¸ƒå±€ã€‚å¸¸è§çš„æœ‰ SingleChildScrollViewã€‚</li>
<li>åŸºäº RenderSliver çš„ <em>sliver protocol</em> å®ç°çš„ï¼Œä¸»è¦åŸºäº SliverGeometry å®ç°å¸ƒå±€ã€‚æ¯”å¦‚ CustomScrollView åŠå…¶å­ç±» ListViewã€GridView ç­‰ç»§æ‰¿è‡ª ScrollView çš„ Widgetï¼Œä»¥åŠåŸºäº CustomScrollView çš„ NestedScrollViewã€åŸºäº Viewport ç­‰çš„ PageViewã€TabBarView ç­‰ç›´æ¥å¯¹ SliverFillViewport ç­‰è¿›è¡Œå°è£…çš„ Widgetã€‚</li>
</ul>
<p>ä¸Šè¿°æ‰€æœ‰çš„ scrollable widget å…¶åº•å±‚é€»è¾‘ä¾ç„¶æ˜¯å¯¹ Scrollable çš„å°è£…ï¼Œå…¶å†…éƒ¨å¤„ç†äº† ScrollControllerã€ScrollPositionï¼ˆviewport çš„ offsetï¼‰ã€ViewportBuilderï¼ˆå®¹çº³æ»šåŠ¨å†…å®¹çš„å®¹å™¨ï¼‰ã€ScrollPhysicsï¼ˆç®¡ç† scrollable view çš„ç‰©ç†å±æ€§ï¼Œæ¯”å¦‚æ˜¯å¦å¯ä»¥æ»šåŠ¨æˆ–å¼¹æ€§æ»šåŠ¨ç­‰ï¼‰ã€ScrollActivityï¼ˆå¯¹å¤–å‘å‡º ScrollNotificationï¼‰ã€RawGestureDetectorï¼ˆæ‰‹åŠ¿è¯†åˆ«ï¼‰ç­‰ç­‰ä¸€ç³»åˆ—ä¸ scroll æœ‰å…³çš„é€»è¾‘ï¼Œä»è€Œä½¿å¾—å…¶ä»– scrollable view èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿çš„å®ç° scroll æ•ˆæœã€‚</p>
<br>
<p>ä¸Šå›æˆ‘ä»¬å¯¹ SingleChildScrollView çš„å®ç°åšäº†ç®€å•åˆ†æï¼ˆè§ã€Š<a href="https://jixiaoyong.github.io/blog/posts/d3bdcb53.html" target="_blank" rel="noopener noreferrer">Flutter æ»‘åŠ¨åˆ†æä¹‹ SingleChildScrollView</a>ã€‹ï¼‰ï¼Œæœ¬æ–‡å°†å¯¹å¦å¤–ä¸€ç§éµå¾ª <em>sliver protocol</em> çš„ ScrollView åšä¸€åˆ†æã€‚</p>
<p>å®˜æ–¹å¯¹ ScrollView çš„å®šä¹‰æ˜¯ï¼šâ€œA widget that scrollsâ€ã€‚</p>
<p>å…¶ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>
<p>ä¸€ä¸ª<strong>ScrollWidget</strong>ï¼Œç›‘å¬ç”¨æˆ·æ‰‹åŠ¿ï¼Œå®ç° scrolling çš„äº¤äº’è®¾è®¡</p>
</li>
<li>
<p>ä¸€ä¸ª<strong>viewport widget</strong>ï¼Œæ ¹æ®ä¼ å…¥çš„ shrinkwrap å€¼çš„ true/false åˆ†åˆ«ä¼šæ˜¯ ShrinkWrappingViewport æˆ–è€… Viewportã€‚é€šè¿‡æ ¹æ®ä¼ å…¥çš„ ViewportOffset ä¸åŒè€Œå€¼å±•ç¤º slivers çš„ä¸€éƒ¨åˆ†å†…å®¹æ¥å®ç°æ»‘åŠ¨çš„è§†è§‰è®¾è®¡æ•ˆæœã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªæˆ–å¤šä¸ª<strong>slivers</strong>ï¼Œå¯ä»¥è¢«ç»„åˆèµ·æ¥åˆ›å»ºå„ç§ scrolling effectsï¼ˆæ¯”å¦‚ listï¼Œgridsï¼Œexpanding header ç­‰ï¼‰çš„ widgetï¼Œæ˜¯çœŸæ­£æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ widgetã€‚</p>
<p>ç”±äºé»˜è®¤çš„ ScrollView åˆ›å»ºçš„ viewport çš„ slivers å±æ€§åªæ¥å—èƒ½åˆ›å»º RenderSliver çš„ Widgetï¼Œæ‰€ä»¥ ScrollView çš„<code>List&lt;Widget&gt; buildSlivers(BuildContext context)</code>æ–¹æ³•åªèƒ½è¿”å› SliverXXX ä¹‹ç±»ï¼ˆæ¯”å¦‚ SliverListï¼‰å¯ä»¥åˆ›å»º RenderSliver çš„ Widgetã€‚</p>
</li>
</ul>
<br>
<p>ScrollView æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒä¸»è¦çš„ä½œç”¨æ˜¯å°†ä¸Šé¢æåˆ°çš„ä¸‰éƒ¨åˆ†ç»„åˆèµ·æ¥ï¼Œä¸ºï¼ˆéµä» sliver protocol çš„ï¼‰scrollable widget å°è£…å±è”½æ‰æ»‘åŠ¨åº•å±‚ç»†èŠ‚ï¼Œæä¾›åƒ<code>buildSlivers</code>ä¹‹ç±»çš„æ–¹æ³•æ–¹ä¾¿å­ç±»èƒ½å¤Ÿå¿«é€Ÿå®ç°ä¸€ä¸ª scrollable widgetã€‚</p>
<h2> æºç åˆ†æ</h2>
<p><code>abstract class ScrollView extends StatelessWidget{}</code></p>
<p>ScrollView ç»§æ‰¿è‡ª StatelessWidgetï¼Œä»–çš„ä¸»è¦é€»è¾‘åœ¨ build æ–¹æ³•ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯ä¹‹å‰çš„åˆ¤æ–­ï¼šScrollView æœ¬èº«æ˜¯å¯¹ Scrollableã€viewportã€slivers çš„å°è£…ã€‚å…·ä½“çš„å¤„ç†æ»‘åŠ¨æ‰‹åŠ¿ã€æ›´æ–° ScrollPositionã€å‘é€ ScrollNotification ç­‰ç­‰éƒ½åœ¨ Scrollable ä¸­å¤„ç†äº†ï¼ŒScrollView çš„å­ç±»åªéœ€è¦æŒ‰ç…§è¦æ±‚æä¾› sliversï¼ˆé€šè¿‡ buildSlivers æ–¹æ³•ï¼‰å’Œå…¶ä»–ä¸€äº›å¿…é¡»çš„ä¿¡æ¯å³å¯ã€‚</p>
<p>ä¸Šé¢çš„ä»£ç ä¸­è¿˜åˆ†åˆ«è°ƒç”¨äº† buildViewport å’Œ buildSlivers æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€ä¸€åˆ†æä¸€ä¸‹ä»–ä»¬çš„æºç ã€‚</p>
<h3> Widget buildViewport()</h3>
<p>buildViewport æ–¹æ³•é¡¾åæ€ä¹‰ï¼Œæ˜¯ç”¨æ¥åˆ›å»º viewport çš„ã€‚åœ¨ ScrollView ä¸­é»˜è®¤ä¼šæŒ‰ç…§ shrinkWrap çš„ä¸åŒåˆ›å»ºä¸¤ç§ viewportï¼Œä»–çš„å­ç±»ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦é‡å†™æ­¤æ–¹æ³•ä»¥è¿”å›è‡ªå·±çš„ viewportã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ buildViewport() æ–¹æ³•ä¸­ï¼Œæ˜¾ç¤ºåœ¨ debug æ¨¡å¼ä¸‹æ£€æŸ¥ç¡®ä¿ widget å·²ç»ç¡®å®šäº†æ–‡æœ¬æ–¹å‘ï¼ˆTextDirection æ˜¯ rtl è¿˜æ˜¯ ltrï¼‰ï¼›ç„¶åæ ¹æ® shrinkWrap çš„ä¸åŒåˆ†åˆ«åˆ›å»º ShrinkWrappingViewport æˆ–è€… Viewportï¼Œä»–ä»¬ä¼šæ ¹æ® offset çš„å˜åŒ–å±•ç¤ºä¸åŒéƒ¨åˆ†çš„ sliversã€‚</p>
<p>ShrinkWrappingViewport å’Œ Viewport éƒ½æ˜¯ç»§æ‰¿è‡ª MultiChildRenderObjectWidget çš„ widgetï¼Œä¸»è¦é€»è¾‘æ˜¯åˆ†åˆ«åˆ›å»ºå¯¹åº”çš„ RenderObjectï¼šRenderShrinkWrappingViewport å’Œ RenderViewportï¼Œè€Œè¿™ä¸¤è€…åˆéƒ½ç»§æ‰¿è‡ª RenderViewportBaseã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> RenderViewportBase</h4>
<p><code>abstract class RenderViewportBase&lt;ParentDataClass extends ContainerParentDataMixin&lt;RenderSliver&gt;&gt; extends RenderBox with ContainerRenderObjectMixin&lt;RenderSliver, ParentDataClass&gt; implements RenderAbstractViewport {}</code></p>
<p>RenderViewportBase ç»§æ‰¿è‡ª RenderBoxï¼Œæ··å…¥äº† ContainerRenderObjectMixin&lt;RenderSliver, ParentDataClass&gt;ç±»ï¼Œæœ¬èº«ä¸æŒæœ‰ childrenï¼Œä½†æä¾›äº†åœ¨ RenderBox ä¸­å®¹çº³ RenderSliver çš„ä¸€äº›é€šç”¨æ–¹æ³•ï¼š</p>
<ul>
<li>è‡ªåŠ¨æ·»åŠ ç›‘å¬_offset çš„æ–¹æ³•ï¼Œåœ¨å…¶å˜åŒ–æ—¶æ‰§è¡Œ markNeedsLayout() æ–¹æ³•å®ç°æ»‘åŠ¨æ•ˆæœ</li>
<li>æä¾›æŒ‰ç…§_offset çš„å€¼ layoutã€paint æŒæœ‰çš„ children çš„æ–¹æ³•</li>
<li>é€šè¿‡ hitTestChildren å®ç° children çš„ hit test</li>
</ul>
<h5> æ ¡éªŒ children ç±»å‹æ˜¯å¦ä¸º RenderSliver</h5>
<p>åœ¨ RenderViewportBase æ··å…¥çš„ ContainerRenderObjectMixin&lt;RenderSliver, ParentDataClass&gt;çš„ debugValidateChild() æ–¹æ³•ä¸­ä¼š<strong>æ£€éªŒ child çš„ç±»å‹æ˜¯å¦ä¸ºæŒ‡å®šçš„ ChildType</strong>ï¼ˆåœ¨ RenderViewportBase ä¸­ ChildType ä¸º RenderSliverï¼‰ï¼Œå¦‚æœä¸æ˜¯åˆ™ä¼šæŠ›å‡º FlutterErrorï¼Œè¿™ä¹Ÿæ˜¯ ScrollView é»˜è®¤ Viewport åªæ”¯æŒå¯ä»¥åˆ›å»º RenderSliver çš„ Widget çš„åŸå› ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ ContainerRenderObjectMixin æä¾›äº†æ£€æµ‹ child ç±»å‹çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨çš„å‘¢ï¼Ÿ</p>
<p>æ— è®ºæ˜¯ Viewport è¿˜æ˜¯ ShrinkWrappingViewport éƒ½ç»§æ‰¿è‡ª MultiChildRenderObjectWidgetï¼Œå…¶ä¼šåˆ›å»º MultiChildRenderObjectElementã€‚</p>
<p>MultiChildRenderObjectElement.insertRenderObjectChild() æ·»åŠ  child ä¸­çš„ RenderObject æ—¶éƒ½ä¼šå…ˆæ£€æŸ¥ä¸€ä¸‹ child çš„ç±»å‹ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œå› ä¸ºä¸ç®¡æ˜¯ RenderShrinkWrappingViewport è¿˜æ˜¯ RenderViewport éƒ½æ˜¯ç»§æ‰¿è‡ª RenderViewportBaseï¼Œä¹Ÿå°±ä¼šæ‰§è¡Œ<code>ContainerRenderObjectMixin&lt;RenderSliver, ParentDataClass&gt;.debugValidateChild(child)</code>æ–¹æ³•ï¼Œæ ¡éªŒ child ç±»å‹æ˜¯å¦ä¸º RenderSliverï¼Œæ‰€ä»¥ä¼šåœ¨å…¶<code>slivers</code>ä¸­ç›´æ¥ä¼ å…¥ box widget åˆ™ä¼šæŠ¥é”™â€œA RenderViewport expected a child of type <strong>RenderSliver</strong> but received a child of type RenderXXX.â€</p>
<h4> RenderViewport</h4>
<p><code>class RenderViewport extends RenderViewportBase&lt;SliverPhysicalContainerParentData&gt; {}</code></p>
<p>RenderViewport æ˜¯ Flutter æ»‘åŠ¨æœºåˆ¶çš„ä¸»åŠ›ï¼Œä»–é€šè¿‡ç›‘å¬<code>offset</code>çš„å˜åŒ–å±•ç¤º<code>children</code>çš„ä¸€éƒ¨åˆ†æ¥å®ç°æ»‘åŠ¨çš„è§†è§‰æ•ˆæœï¼Œä»–ä¼šå æ®çˆ¶çº§ç»™çš„æœ€å¤§ç©ºé—´ï¼ˆ<strong>å¤§å°ç”±çˆ¶çº§æŒ‡å®š</strong>ï¼‰ã€‚</p>
<p>å…¶å†…éƒ¨æŒæœ‰ä¸€ä¸ªåŒå‘çš„ slivers åˆ—è¡¨<code>children</code>ï¼Œä»¥åœ¨ zero scroll offset çš„<code>center</code>ä¸ºé”šç‚¹ï¼š</p>
<ul>
<li>slivers åˆ—è¡¨ä¸­åœ¨ center ä¹‹å‰çš„ Slivers æŒ‰ç…§åˆ—è¡¨åæ–¹å‘ï¼Œæ²¿ç€ axisDirection çš„åæ–¹å‘å±•ç¤ºã€‚</li>
<li>slivers åˆ—è¡¨ä¸­åœ¨ center ä¹‹åçš„ Slivers æŒ‰ç…§åˆ—è¡¨çš„æ–¹å‘ï¼Œæ²¿ç€ axisDirection çš„æ–¹å‘å±•ç¤ºã€‚</li>
</ul>
<p>æ¯”å¦‚ä¸€ä¸ª axisDirection ä¸º AxisDirection.downï¼Œchildren åˆ—è¡¨ä¸º["1", "2", "3", "center", "5", "6", "7"]ï¼Œcenter ä¸ºâ€œcenterâ€ï¼Œé‚£ä¹ˆé»˜è®¤ä¼šå±•ç¤º["center", "5", "6", "7"]ï¼Œå½“æ‰‹æŒ‡å‘ä¸‹æ»‘åŠ¨çš„æ—¶å€™ï¼Œä¼šä¾æ¬¡å±•ç¤ºå‡ºâ€œ3â€ã€â€œ2â€ã€â€œ1â€ï¼Œç­‰å®Œå…¨ä¸‹æ‹‰ä¹‹åï¼Œå±•ç¤ºå†…å®¹ä¸ºï¼š["1", "2", "3", "center", "5", "6", "7"]ã€‚</p>
<h4> RenderShrinkWrappingViewport</h4>
<p><code>class RenderShrinkWrappingViewport extends RenderViewportBase&lt;SliverLogicalContainerParentData&gt;{}</code></p>
<p>RenderShrinkWrappingViewport é€šè¿‡ç›‘å¬<code>offset</code>çš„å˜åŒ–å±•ç¤º<code>children</code>çš„ä¸€éƒ¨åˆ†æ¥å®ç°æ»‘åŠ¨çš„è§†è§‰æ•ˆæœï¼Œä¸ Viewport ä¸åŒçš„æ˜¯ï¼Œä»–ä¼š shrinkWrapï¼ˆæ”¶ç¼©åŒ…è£…ï¼‰è‡ªå·±ä»¥ä¾¿åœ¨ä¸»è½´ä¸ŠåŒ¹é… children çš„ sizeï¼ˆ<strong>å¤§å°ç”± RenderShrinkWrappingViewport æ ¹æ® children è®¡ç®—è€Œæ¥</strong>ï¼‰ï¼Œ<strong>æ¯”è¾ƒè€—è´¹æ€§èƒ½</strong>ï¼ˆç‰¹åˆ«æ˜¯å½“ item å¯èƒ½ä¼šé€šè¿‡æŠ˜å å±•å¼€ç­‰æ–¹å¼æ”¹å˜å°ºå¯¸æ—¶ï¼‰ã€‚</p>
<h3> List&lt;Widget&gt; buildSlivers()</h3>
<p>ScrollView çš„ buildSlivers æ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»æ ¹æ®éœ€è¦å®ç°ï¼Œ<em>ä¸€èˆ¬å­ç±»ä¹Ÿåªéœ€è¦é‡å†™æ­¤æ–¹æ³•å³å¯</em>ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ä½¿ç”¨ç¤ºä¾‹</h2>
<p>CustomScrollView å°±æ˜¯ç»§æ‰¿è‡ª ScrollViewï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ° CustomScrollView çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œä¸»è¦é€»è¾‘æ˜¯å°†ä¼ å…¥çš„å‚æ•°<code>slivers</code>ä½œä¸º<code>List&lt;Widget&gt; buildSlivers(BuildContext context)</code>çš„è¿”å›å€¼ã€‚è¿™å¯¼è‡´æˆ‘ä»¬åœ¨ä½¿ç”¨ CustomScrollView çš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥ SliverListã€SliverAppBar ç­‰è¿™äº›ç»§æ‰¿è‡ª SliverMultiBoxAdaptorWidget èƒ½åˆ›å»º RenderSliver çš„ Widgetï¼Œè€Œä¸æ˜¯æ™®é€šçš„ box widgetã€‚</p>
<h2> æ€»ç»“</h2>
<p>ScrollView çš„å­ç±»å€ŸåŠ© SliverMultiBoxAdaptorWidget åŠå…¶å­ç±»å¯ä»¥å®ç°<strong>å¯¹ item çš„æ‡’åŠ è½½</strong>ä»è€Œé¿å…åˆ›å»ºæ— æ³•é€šè¿‡ viewport å¯è§çš„ childrenï¼ˆè¿™ç§ç±»å‹çš„ä¼ å‚ä¸€èˆ¬éƒ½éœ€ä¼ å…¥ SliverChildDelegate çš„å­ç±»ï¼‰ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½ã€‚</p>
<p>è€Œæ ¹æ® shrinkWrap çš„ä¸åŒï¼Œåˆ†åˆ«ä½¿ç”¨ Viewport å’Œ ShrinkWrappingViewport åˆ›å»º viewportï¼Œä»è€Œåˆ†åˆ«å®ç°æŒ‰ç…§çˆ¶çº§æŒ‡å®š size æˆ–æŒ‰ç…§å­çº§è®¡ç®— sizeï¼ˆæ¯”è¾ƒè€—æ€§èƒ½ï¼‰ã€‚</p>
<p>ScrollView æ˜¯ Flutter ä¸­åŸºäº sliver protocol çš„ scrollable widget çš„çˆ¶ç±»ï¼Œå› ä¸º viewport çš„é™åˆ¶åªæ¥å—åˆ›å»º RenderSliver çš„ widget ä½œä¸ºå…¶ç›´æ¥å­ç±»ã€‚å…¶å­ç±»åˆ™é€šè¿‡ SliverMultiBoxAdaptorWidget åŠå…¶å­ç±»å®ç°åŠ è½½ box widgetã€‚</p>
<p>ä»¥ä¸‹ç±»éƒ½æ˜¯åŸºäº ScrollView å®ç°çš„ scrollable widgetï¼š</p>
<ul>
<li><a href="https://api.flutter.dev/flutter/widgets/CustomScrollView-class.html" target="_blank" rel="noopener noreferrer">CustomScrollView</a></li>
<li><a href="https://api.flutter.dev/flutter/widgets/BoxScrollView-class.html" target="_blank" rel="noopener noreferrer">BoxScrollView</a>
<ul>
<li><a href="https://api.flutter.dev/flutter/widgets/ListView-class.html" target="_blank" rel="noopener noreferrer">ListView</a></li>
<li><a href="https://api.flutter.dev/flutter/widgets/GridView-class.html" target="_blank" rel="noopener noreferrer">GridView</a></li>
</ul>
</li>
</ul>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://api.flutter.dev/flutter/widgets/ScrollView-class.html" target="_blank" rel="noopener noreferrer">ScrollView_api.flutter.dev</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Flutter æ»‘åŠ¨åˆ†æä¹‹ SingleChildScrollView</title>
      <link>https://jixiaoyong.github.io/blog/posts/d3bdcb53.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/d3bdcb53.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Flutter æ»‘åŠ¨åˆ†æä¹‹ SingleChildScrollView</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 15 Jul 2022 10:36:54 GMT</pubDate>
      <content:encoded><![CDATA[<p>Flutter ä¸­çš„ scrollable widget æ ¹æ®å®ç°æ–¹å¼çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul>
<li>åŸºäº RenderBox çš„ box protocol å®ç°çš„ï¼Œä¸»è¦åŸºäº Size å®ç°å¸ƒå±€ã€‚å¸¸è§çš„æœ‰ SingleChildScrollViewã€‚</li>
<li>åŸºäº RenderSliver çš„ sliver protocol å®ç°çš„ï¼Œä¸»è¦åŸºäº SliverGeometry å®ç°å¸ƒå±€ã€‚æ¯”å¦‚ CustomScrollView åŠå…¶å­ç±» ListViewã€GridView ç­‰ç»§æ‰¿è‡ª ScrollView çš„ Widgetï¼Œä»¥åŠåŸºäº CustomScrollView çš„ NestedScrollViewã€åŸºäº Viewport ç­‰çš„ PageViewã€TabBarView ç­‰ç›´æ¥å¯¹ SliverFillViewport ç­‰è¿›è¡Œå°è£…çš„ Widgetã€‚</li>
</ul>
<p>ä¸Šè¿°æ‰€æœ‰çš„ scrollable widget å…¶åº•å±‚é€»è¾‘ä¾ç„¶æ˜¯å¯¹ Scrollable çš„å°è£…ï¼Œå…¶å†…éƒ¨å¤„ç†äº† ScrollControllerã€ScrollPositionï¼ˆviewport çš„ offsetï¼‰ã€ViewportBuilderï¼ˆå®¹çº³æ»šåŠ¨å†…å®¹çš„å®¹å™¨ï¼‰ã€ScrollPhysicsï¼ˆç®¡ç† scrollable view çš„ç‰©ç†å±æ€§ï¼Œæ¯”å¦‚æ˜¯å¦å¯ä»¥æ»šåŠ¨æˆ–å¼¹æ€§æ»šåŠ¨ç­‰ï¼‰ã€ScrollActivityï¼ˆå¯¹å¤–å‘å‡º ScrollNotificationï¼‰ã€RawGestureDetectorï¼ˆæ‰‹åŠ¿è¯†åˆ«ï¼‰ç­‰ç­‰ä¸€ç³»åˆ—ä¸ scroll æœ‰å…³çš„é€»è¾‘ï¼Œä»è€Œä½¿å¾—å…¶ä»– scrollable view èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿çš„å®ç° scroll æ•ˆæœã€‚</p>
<p>æœ¬æ–‡åªå¯¹ SingleChildScrollView çš„æºç å®ç°åšä¸€ç®€å•åˆ†æï¼šå®ƒæ˜¯å¦‚ä½•å®ç°æ»šåŠ¨æ•ˆæœï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿å’Œé™åˆ¶ã€‚</p>
<p>å®˜æ–¹å¯¹å…¶å®šä¹‰æ˜¯ï¼šâ€œA box in which a single widget can be scrolledâ€ã€‚æ˜ç¡®è¡¨æ˜ï¼ŒSingleChildScrollView æ˜¯éµå®ˆ box protocol çš„ widgetï¼Œåœ¨å…¶å†…éƒ¨ä¹Ÿåªèƒ½æœ‰ä¸€ä¸ª<strong>box widget</strong>ã€‚</p>
<h2> ç”¨ä¾‹</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª SingleChildScrollView çš„ç®€å•ä½¿ç”¨ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒSingleChildScrollView ä¸­å®¹çº³äº†ä¸€ä¸ªå« Column çš„ childï¼Œå¦‚æœ Column çš„é«˜åº¦æ— æ³•åœ¨å±å¹•ä¸­å®Œå…¨å±•ç¤ºï¼Œå°± SingleChildScrollView å°±ä¼šä¿è¯ç”¨æˆ·å¯ä»¥ä¸Šä¸‹æ»‘åŠ¨ï¼Œä»è€Œå±•ç¤ºå¯¹åº”çš„å†…å®¹ï¼›å¦åˆ™å¦‚æœèƒ½å¤Ÿå®Œå…¨æ˜¾ç¤ºï¼Œåˆ™å†…å®¹æ— æ³•æ»‘åŠ¨ã€‚</p>
<h2> æºç åˆ†æ</h2>
<h3> SingleChildScrollView</h3>
<p><code>class SingleChildScrollView extends StatelessWidget {}</code></p>
<p>ä½œä¸ºä¸€ä¸ª StatelessWidgetï¼ŒSingleChildScrollView çš„ä¸»è¦é€»è¾‘åœ¨ä»–çš„<code>build()</code>æ–¹æ³•ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­£å¦‚ä¹‹å‰æ‰€è¨€ï¼ŒSingleChildScrollView æ˜¯ä¾èµ–äºå°è£… Scrollable å®ç°æ»‘åŠ¨æ•ˆæœã€‚æˆ‘ä»¬æ³¨æ„åˆ°åœ¨ Scrollable.viewportBuilder ä¸­ä¼ å…¥çš„æ˜¯_SingleChildViewportï¼Œè¿™ä¸ªç±»å¤„ç†äº† Scrollable ä¼ å…¥çš„ ScrollPosition ä¹Ÿå³è¿™é‡Œçš„ ViewportOffsetï¼š</p>
<h3> _SingleChildViewport</h3>
<p>_SingleChildViewport ç»§æ‰¿è‡ª SingleChildRenderObjectWidgetï¼Œä¸»è¦é€»è¾‘æ˜¯åˆ›å»ºå’Œæ›´æ–° RenderObjectâ€”â€”_RenderSingleChildViewportã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§å¤„ç† offset ä»¥ä¾¿æ›´æ–° content å®ç°æ»‘åŠ¨æ•ˆæœçš„ä¸»è¦é€»è¾‘åœ¨_RenderSingleChildViewport è¿™ä¸ª RenderObject ä¸­ã€‚</p>
<h3> _RenderSingleChildViewport</h3>
<p>å…ˆçœ‹ä¸€ä¸‹_RenderSingleChildViewport çš„ç»§æ‰¿å…³ç³»ï¼š<br>
<code>class _RenderSingleChildViewport extends RenderBox with RenderObjectWithChildMixin&lt;RenderBox&gt; implements RenderAbstractViewport{}</code></p>
<p>ç”±ä¸Šè¿°ä»£ç å¯çŸ¥ï¼Œ_RenderSingleChildViewportï¼š</p>
<ul>
<li>æ˜¯ RenderBoxï¼Œä¹Ÿå°±æ˜¯è¯´å…¶å†…éƒ¨ lay out éµå®ˆ box protocol</li>
<li>RenderObjectWithChildMixin&lt;RenderBox&gt;ï¼ŒRenderObjectWithChildMixin ä¸º RenderObject æä¾›ä¸€å¥—ç®¡ç†å•ä¸ª child çš„æ¨¡å¼ï¼Œå®ƒçš„<strong>æ³›å‹æŒ‡å®šäº† child çš„ç±»å‹åªèƒ½æ˜¯ RenderBox</strong>ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¹‹å‰è¯´ SingleChildScrollView çš„ child åªèƒ½æ˜¯ box widgetã€‚</li>
<li>å®ç°äº† RenderAbstractViewport æ¥å£ï¼Œè¿™ä¸ªæ¥å£è¡¨ç¤º render object æ˜¯å†…éƒ¨æ¯”å®é™…è¦å¤§ï¼Œæä¾›äº†ä¸€äº›æ–¹æ³•ä¾› ScrollPosition å’Œå…¶ä»– viewport è°ƒç”¨ï¼Œæ¥è·å–ä¸€äº›ä½¿æ­¤ viewport åœ¨å±å¹•ä¸Šå¯è§çš„ä¿¡æ¯ã€‚</li>
</ul>
<p>åœ¨ä¿®æ”¹ axisDirectionã€offsetã€cacheExtent ç­‰ä¸‰ä¸ªå±æ€§çš„æ—¶å€™ä¼šè§¦å‘ markNeedsLayout() æ–¹æ³•é‡æ–°è¿›è¡Œ lay outï¼›<br>
åœ¨ä¿®æ”¹ clipBehavior å±æ€§çš„æ—¶å€™åªä¼šè§¦å‘ markNeedsPaint() å’Œ markNeedsSemanticsUpdate() æ–¹æ³•ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨æ¯æ¬¡è®¾ç½® offset çš„æ—¶å€™ï¼Œéƒ½ä¼šå¯¹é½æ·»åŠ ç›‘å¬ï¼Œè¿™æ ·å½“ Scrollable ä¸­ç”±äºç”¨æˆ·æ‰‹åŠ¿æˆ–è€…é€šè¿‡ ScrollController è°ƒç”¨ jumpTo/animateTo ç­‰æ–¹æ³•ä¿®æ”¹äº† ScrollPosition çš„æ—¶å€™ï¼Œéƒ½ä¼šä½¿å¾— Scrollab çš„ viewport ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™é‡Œçš„_RenderSingleChildViewport æ”¶åˆ°é€šçŸ¥ã€ä»è€Œè¿›è¡Œå¯¹åº”å¤„ç†ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é™¤äº†ä¸Šè¿°åœ¨ä¿®æ”¹ offset çš„æ—¶å€™æ·»åŠ /ç§»é™¤ç›‘å¬ï¼Œåœ¨ attach/detach æ–¹æ³•ä¸­ä¹Ÿæœ‰å¯¹åº”æ“ä½œï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šé¢çš„åˆ†ææˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œé™¤äº†è®¾ç½®ä¿®æ”¹ axisDirectionã€offsetã€cacheExtent ç­‰å±æ€§çš„æ—¶å€™ä¼šè§¦å‘ layout å¤–ï¼Œå…¶ä½™æ—¶å€™åªä¼šè§¦å‘é‡æ–° paintã€‚</p>
<h4> layout</h4>
<p>ä¸€èˆ¬æ¥è¯´ Flutter Widget è¦å±•ç¤ºåœ¨å±å¹•ä¸Šéœ€è¦ç»å† buildã€layoutã€paint ä¸‰æ­¥ï¼Œåœ¨åˆ†æ SingleChildScrollView å¦‚ä½•æ ¹æ® offset çš„å˜åŒ–å®ç° scroll æ•ˆæœä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ä»–æ˜¯å¦‚ä½•å®ç° layout çš„ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°åœ¨ SingleChildScrollView å…ˆè®© child åœ¨ä¸»è½´æ–¹å‘å°½å¯èƒ½è‡ªç”±å¸ƒå±€ï¼Œå–å¾—å…¶æœ€å¤§å€¼ï¼Œç„¶åè‡ªèº«åœ¨æ»¡è¶³çˆ¶çº§çº¦æŸçš„æƒ…å†µä¸‹åº”ç”¨ child çš„ sizeï¼šå¦‚æœ child.size åœ¨çˆ¶çº§çº¦æŸå†…å°±ç›´æ¥åº”ç”¨ï¼Œè´Ÿè´£é‡‡ç”¨çˆ¶çº§çš„çº¦æŸã€‚</p>
<p>è¿™æ ·æœ€ç»ˆçš„æ•ˆæœå°±æ˜¯æˆ‘ä»¬çš„ SingleChildScrollView åœ¨ child ä¸è¶…è¿‡çˆ¶çº§çº¦æŸçš„æ—¶å€™åªå æ® child çš„å†…å®¹ï¼Œå½“ child çš„å†…å®¹å¤§äºçˆ¶çº§çº¦æŸæ—¶ï¼ŒSingleChildScrollView è‡ªèº«çš„å°ºå¯¸æ˜¯çˆ¶çº§ç»™å®šçš„æœ€å¤§å°ºå¯¸ï¼Œè€Œ child æœ¬èº«åœ¨ä¸»è½´æ–¹å‘ä¸Šçš„å°ºå¯¸æ˜¯å¤§äº SingleChildScrollView çš„å°ºå¯¸ã€‚è¿™æ ·ä¹Ÿä¸ºæˆ‘ä»¬åç»­é€šè¿‡ç›‘å¬ offset ä¿®æ”¹æ˜¾ç¤ºéƒ¨åˆ† child çš„å†…å®¹å®ç°æ»‘åŠ¨æ•ˆæœæä¾›äº†å¯èƒ½ã€‚</p>
<blockquote>
<p>è¿™ä¹Ÿå‘Šè¯‰æˆ‘ä»¬ SingleChildScrollView çš„çˆ¶çº§éœ€è¦æŒ‡å®šæŒ‡å®šä¸»è½´æ–¹å‘çº¦æŸï¼Œå¦åˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚<br>
æ¯”å¦‚åœ¨ Column ä¸­ç›´æ¥ä½¿ç”¨ SingleChildScrollView å°±ä¼šåœ¨å†…å®¹è¿‡é•¿çš„æ—¶å€™å‘ç”Ÿ<em>overflowed</em>é”™è¯¯å¹¶ä¸”æ— æ³•æ»‘åŠ¨ SingleChildScrollViewï¼Œè¿™æ˜¯å› ä¸º SingleChildScrollView å’Œ child éƒ½æŒ‰ç…§æœ€é•¿çš„å°ºå¯¸å¸ƒå±€ï¼Œå¹¶ä¸”è¿™ä¸ªå°ºå¯¸è¶…è¿‡äº†çˆ¶çº§çº¦æŸã€‚<br>
åœ¨ SingleChildScrollView å¤–å±‚æ·»åŠ  Expanded ä½œä¸ºçˆ¶çº§ï¼Œç›¸å½“äºç»™ä»–æŒ‡å®šäº†ä¸€ä¸ªçº¦æŸï¼ˆå æ®å‰©ä½™ç©ºé—´ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
</blockquote>
<p>ä¹‹åï¼Œåˆæ ¹æ®_viewportExtent ä»¥åŠ_minScrollExtent/_maxScrollExtent åˆ†åˆ«è®¾ç½®äº† viewport å’Œ content çš„èŒƒå›´ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸‰ä¸ªå€¼çš„æ¥å†ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œ_viewportExtent æ˜¯å–å€¼ä¸»è½´æ–¹å‘çš„ size å¤§å°ï¼Œä¹Ÿå°±æ˜¯ SingleChildScrollView çš„å°ºå¯¸ã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>_minScrollExtent é»˜è®¤è¿”å› 0.0ï¼›<br>
_maxScrollExtent è¿”å›çš„æ˜¯ä¸»è½´æ–¹å‘ä¸Š child å‡å» SingleChildScrollView ä¹‹åçš„å°ºå¯¸å’Œ 0.0 ä¹‹é—´çš„æœ€å¤§å€¼ï¼Œæ¢è¨€ä¹‹ï¼Œå¦‚æœ child æ¯” SingleChildScrollView å°ºå¯¸å¤§ï¼Œ_maxScrollExtent å°±æ˜¯å¤šå‡ºæ¥çš„é‚£ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥æ»‘åŠ¨çš„èŒƒå›´ï¼Œå¦åˆ™ä¸º 0.0ï¼Œä¹Ÿå°±æ˜¯ SingleChildScrollView ä¸å¯æ»‘åŠ¨ã€‚</p>
<h4> paint</h4>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ SingleChildScrollView é¡ºåˆ©å¾—åˆ°äº†å°ºå¯¸ï¼Œå‡è®¾ child å°ºå¯¸å¤§äº SingleChildScrollView çš„æœ€å¤§å°ºå¯¸ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·æ»‘åŠ¨å±å¹•å¯¼è‡´ offset æ”¹å˜çš„æ—¶å€™ï¼Œåˆæ˜¯å¦‚ä½•å®ç°æ»‘åŠ¨æ•ˆæœçš„å‘¢ï¼Ÿ</p>
<p>å…ˆçœ‹ä¸€ä¸ªå±æ€§ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹å‡ºï¼Œ_paintOffset æ˜¯æ ¹æ® ScrollPosition è®¡ç®—å‡ºæ¥çš„çœŸæ­£çš„ child å’Œ SingleChildScrollView çš„åç§» offsetã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p>
<p>_RenderSingleChildViewport æ¥æ”¶ä¼ å…¥çš„ childï¼Œå¹¶ç›‘å¬ä¼ å…¥çš„ Offsetï¼Œå½“å…¶å˜åŒ–æ—¶æ‰§è¡Œ markNeedPaint()ï¼›<br>
å…¶å…ˆè®© child åœ¨ä¸»è½´æ–¹å‘å°½å¯èƒ½å¤§çš„è¿›è¡Œ layoutï¼Œç„¶åè‡ªèº«åœ¨çˆ¶çº§çº¦æŸæ¡ä»¶ä¸‹å°½å¯èƒ½æ»¡è¶³ child sizeï¼Œè¿™æ ·å½“ child æ¯”çˆ¶çº§ç»™çš„çº¦æŸå¤§æ—¶ï¼Œchild ä¿æŒè‡ªèº«å¤§å°ï¼Œè€Œ viewport çš„ size åˆ™åœ¨çˆ¶çº§ç»™çš„æœ€å¤§å°ºå¯¸å†…å±•ç¤ºä¸€éƒ¨åˆ† child å†…å®¹ï¼›<br>
å½“ Offset å˜åŒ–æ—¶ï¼ŒæŒ‰ç…§ Offset.pixels è®¡ç®—å‡ºå¯¹åº”çš„ paintOffsetï¼Œé‡æ–°ç»˜åˆ¶ childï¼Œå±•ç¤ºå¦å¤–ä¸€éƒ¨åˆ† child çš„å†…å®¹ï¼Œä»è€Œå®ç°æ»‘åŠ¨æ•ˆæœã€‚</p>
<h4> hitTest</h4>
<p>_RenderSingleChildViewport å°† hitTest ç›´æ¥è½¬å‘ç»™äº† childï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br>
<p>è‡³æ­¤ï¼ŒSingleChildScrollView åŸºäº Scrollableã€ScrollPosition å’Œ_RenderSingleChildView å®Œæˆäº†æ”¯æŒå†…éƒ¨å•ä¸ª box widget çš„æ»‘åŠ¨æ•ˆæœã€‚</p>
<h2> ä¼˜åŠ£å¯¹æ¯”</h2>
<p>ç›¸å¯¹äºä½¿ç”¨ Sliver å®ç°æ»‘åŠ¨æ•ˆæœçš„ Widget æ¥è¯´ï¼ŒSingleChildScrollView ä½¿ç”¨ç®€å•ï¼Œä½¿ç”¨çš„æ˜¯ box protocolï¼Œé€‚ç”¨äº child é€šå¸¸æ˜¯å®Œå…¨å¯è§çš„ï¼Œä½†æ˜¯åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ï¼ˆæ¯”å¦‚ç«–å±å˜ä¸ºæ¨ªå±ç­‰ï¼‰ä¸‹å¯èƒ½æ˜¾ç¤ºä¸å…¨çš„æƒ…å†µï¼ŒSingleChildScrollView å¯ä»¥ä¿è¯åœ¨çˆ¶çº§æ— æ³•å®Œæ•´æ˜¾ç¤º child çš„æ—¶å€™ä½¿å…¶æ”¯æŒæ»‘åŠ¨ã€‚<br>
SingleChildScrollView ä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ­£å¦‚ä¸Šé¢åˆ†æçš„ï¼Œæ— è®º content æ˜¯å¦å¯è§ï¼ŒSingleChildScrollView éƒ½ä¼šå°†å…¶ layout/paintï¼ˆä¹Ÿå°±æ˜¯è¯´<strong>ä¼šå°†æ‰€æœ‰å†…å®¹å…¨éƒ¨åŠ è½½</strong>ï¼‰ï¼Œè¿™æ ·å¦‚æœ content è¶…å‡º viewport çš„éƒ¨åˆ†æ¯”è¾ƒå¤šå°±ä¼šéå¸¸<strong>è€—è´¹æ€§èƒ½</strong>ã€‚</p>
<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œå°±åº”è¯¥è€ƒè™‘ä½¿ç”¨ ListView/GridView/CustomScrollView ç­‰åŸºäº sliver protocol çš„ scrollable widgetã€‚åœ¨ shrinkWrap å±æ€§ä¸º false çš„æƒ…å†µä¸‹ï¼Œviewport ä¼šåªåˆ›å»º<strong>å±å¹•å¯è§éƒ¨åˆ† + viewport å‰åç¼“å­˜åŒºåŸŸ</strong>çš„å†…å®¹ï¼Œåœ¨ content æ»‘å‡ºè¿™éƒ¨åˆ†åŒºåŸŸæ—¶ disposeï¼Œå½“å…¶å†æ¬¡æ»‘å…¥æ—¶å† recreateï¼Œä»è€Œä¿è¯æ€§èƒ½ã€‚</p>
<h2> è¿›é˜¶ä½¿ç”¨</h2>
<h3> ä¸º Column çš„ children å®‰å…¨åº”ç”¨ spacedAroundï¼Œcenter ç­‰æ•ˆæœ</h3>
<p>æƒ³è¦ç»™ Column çš„ children è®¾ç½® spacedAround æ•ˆæœï¼Œåˆéœ€è¦ä¿è¯åœ¨çˆ¶çº§ç©ºé—´ä¸è¶³æ—¶èƒ½å¤Ÿå®Œæ•´æ˜¾ç¤ºæ‰€æœ‰ children çš„å†…å®¹çš„è¯ï¼Œå°±éœ€è¦ç»“åˆ SingleChildScrollViewï¼ˆç©ºé—´ä¸è¶³æ—¶å¯æ»‘åŠ¨ï¼‰ã€LayoutBuilderï¼ˆè·å–çˆ¶çº§çº¦æŸä¿¡æ¯ï¼‰ã€ConstrainedBoxï¼ˆè®¾ç½® Column çº¦æŸï¼‰æ¥å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä½¿ç”¨ ConstrainedBox ç¡®ä¿äº† Column ä¸»è½´æ–¹å‘æœ€å°å°ºå¯¸æ˜¯çˆ¶çº§å¤§å°ï¼š</p>
<ul>
<li>å½“çˆ¶çº§å°ºå¯¸å¤§äº Column çš„ children å°ºå¯¸æ—¶ï¼Œå¤šå‡ºçš„ç©ºéš™ç”± Column æŒ‰ç…§ MainAxisAlignment.spaceAround åŸåˆ™åˆ†é…ï¼Œç”±äº SingleChildScrollView çš„ child å°ºå¯¸å’Œçˆ¶çº§ä¸€è‡´ï¼Œæ‰€éœ€ä¸ä¼šæ»‘åŠ¨ï¼›</li>
<li>å½“çˆ¶çº§å°ºå¯¸å°äº Column çš„ children å°ºå¯¸æ—¶ï¼ŒColumn çš„å°ºå¯¸ä¸º children çš„å°ºå¯¸ä¹‹å’Œï¼ˆç›¸äº’ä¹‹é—´æ²¡æœ‰é—´éš™ï¼‰ï¼Œæ­¤æ—¶ SingleChildScrollView çš„ child å°ºå¯¸å¤§äºçˆ¶çº§å°ºå¯¸ï¼Œæ‰€ä»¥å¯ä»¥ä¸Šä¸‹æ»‘åŠ¨ï¼Œä¿è¯äº† Column çš„ children å¯ä»¥å®Œå…¨æ˜¾ç¤ºã€‚</li>
</ul>
<h3> ä¸º Column çš„ children å®‰å…¨åº”ç”¨ Expandedã€Space ç­‰æ•ˆæœ</h3>
<p>åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œéœ€è¦ç”¨åˆ° Expandedã€Space ç­‰å¡«å…… Column å‰©ä½™çš„ç©ºé—´ä»¥å±•ç¤ºæŸäº›å†…å®¹ï¼Œæ¯”å¦‚ä¸€ç›´ä½äºå±å¹•ä¸‹æ–¹çš„ç‰ˆæƒä¿¡æ¯ï¼Œä½†æ˜¯å½“ Column çš„ children å°ºå¯¸å¤§äºçˆ¶çº§å°ºå¯¸æ—¶ï¼Œåˆä¼šå¯¼è‡´ children å†…å®¹æ— æ³•å®Œæ•´æ˜¾ç¤ºï¼Œå¦‚æœç›´æ¥åœ¨ Column ä¸ŠåŠ ä¸€ä¸ª SingleChildScrollView ä½œä¸ºçˆ¶çº§ï¼Œåˆä¼šå› ä¸º SingleChildScrollView ç»™ child åœ¨ä¸»è½´æ–¹å‘çš„å°ºå¯¸æ— é™åˆ¶ï¼Œè€Œ Expanded åˆè¦æ±‚å æ®æ‰€æœ‰å‰©ä½™ç©ºé—´ä»è€Œå¯¼è‡´å‡ºé”™ã€‚</p>
<p>æ­¤æ—¶å¯ä»¥åœ¨ä¸Šé¢ä¾‹å­çš„åŸºç¡€ä¸Šå¢åŠ  IntrinsicHeight/InstrinsicWidth æ¥è§£å†³æ­¤é—®é¢˜ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢ä¾‹å­ä¸­ï¼Œä½œä¸º SingleChildScrollView å­çº§çš„ Column å†…éƒ¨èƒ½å¤Ÿä½¿ç”¨ Expanded çš„å…³é”®åœ¨äº InstrinsicHeightï¼šå®ƒçš„å®šä¹‰æ˜¯â€œä¸€ä¸ªå°† child è°ƒæ•´ä¸º child å›ºæœ‰é«˜åº¦çš„ widgetâ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“<strong>child å¯èƒ½æœ‰æ— é™çš„é«˜åº¦æ—¶ï¼Œä¸å…¶æ— é™æ‹“å±•ï¼Œå®ƒæ›´å¸Œæœ›å°†è‡ªå·± size å®šä½ä¸€ä¸ªæ›´åŠ åˆç†çš„å›ºæœ‰é«˜åº¦</strong>ï¼ˆExpandedã€Spacer ç­‰é RenderObjectWidget æœ¬èº«æ²¡æœ‰é«˜åº¦ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä¸ä¼šè¢«è®¡ç®—ï¼‰ã€‚</p>
<p>é‚£ä¹ˆï¼Œå½“çˆ¶çº§æŒ‡å®šçš„æœ€å°çº¦æŸ minHeight å¤§äº InstrinsicHeight.child çš„æœ€å¤§å›ºæœ‰é«˜åº¦æ—¶ï¼Œchild å°†æŒ‰ç…§çˆ¶çº§çš„æœ€å°é«˜åº¦è®¾ç½®ï¼›<br>
å½“çˆ¶çº§æŒ‡å®šçš„æœ€å¤§çº¦æŸæ˜¯ double.infinity æ— é™å¤§æ—¶ï¼ŒInstrinsicHeight ä¼šå¼ºåˆ¶å…¶ child çš„å¤§å°ä¸ºå›ºæœ‰é«˜åº¦ã€‚</p>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒIntrinsicHeight/InstrinsicWidth å› ä¸ºè‡³å°‘éœ€è¦å¯¹ child è¿›è¡Œä¸¤æ¬¡ layoutï¼ˆä¸€æ¬¡è·å– intrinsic dimensionsï¼Œä¸€æ¬¡çœŸæ­£çš„æ‰§è¡Œ layoutï¼‰ï¼Œæ‰€ä»¥ä¼š<strong>æ¯”è¾ƒè€—è´¹æ€§èƒ½</strong>ã€‚å› æ­¤åº”å½“ä¿è¯ Column å­çº§æ•°é‡å°½å¯èƒ½å°‘ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ SizeBox ç»™ child æŒ‡å®šå¤§å°ä»¥å‡è½»è®¡ç®— intrinsic dimensions çš„å‹åŠ›ã€‚</p>
<h2> æ€»ç»“</h2>
<p>SingleChildScrollView ä½œä¸ºéµå®ˆ box protocol çš„ scrollable widgetï¼Œä½¿ç”¨ç®€å•ï¼Œé€‚ç”¨äºé¡µé¢å†…å®¹é€šå¸¸ä¸ºå…¨éƒ¨å¯è§ï¼Œä½†ç‰¹æ®Šæƒ…å†µä¸‹å¯èƒ½æ— æ³•å®Œæ•´æ˜¾ç¤ºå› è€Œéœ€è¦æ”¯æŒæ»šåŠ¨çš„æƒ…å†µã€‚</p>
<p>å…¶ child åªæ”¯æŒå¯ä»¥ç”Ÿæˆ RenderBox çš„ Widgetï¼Œä¼šä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰ child å†…å®¹ï¼Œåœ¨å…¶å†…éƒ¨ä½¿ç”¨ ListView ç­‰æ—¶éœ€è¦å¼€å¯ shrinkWrap ä»è€Œå¯¼è‡´å…¶æ‡’åˆ›å»º item å¤±æ•ˆï¼Œæ¯”è¾ƒè€—è´¹æ€§èƒ½ã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœæ˜¯å¤§é‡ itemã€child å†…å®¹è¶…å‡º viewport éƒ¨åˆ†æ—¶ï¼Œåº”å½“è€ƒè™‘ä½¿ç”¨åŸºäº Sliver çš„ ListView/GridView/CustomScrollView ç­‰ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://api.flutter.dev/flutter/widgets/SingleChildScrollView-class.html" target="_blank" rel="noopener noreferrer">SingleChildScrollView_api.flutter.dev</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Hello World</title>
      <link>https://jixiaoyong.github.io/blog/posts/4a17b156.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/4a17b156.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Hello World</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 20 Mar 2016 22:06:06 GMT</pubDate>
      <content:encoded><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener noreferrer">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener noreferrer">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener noreferrer">GitHub</a>.</p>
<h3> Quick Start</h3>
<h4> Create a new post</h4>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener noreferrer">Writing</a></p>
<h4> Run server</h4>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener noreferrer">Server</a></p>
<h4> Generate static files</h4>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener noreferrer">Generating</a></p>
<h4> Deploy to remote sites</h4>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener noreferrer">Deployment</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>JVM å†…å­˜åˆ†é…</title>
      <link>https://jixiaoyong.github.io/blog/posts/f31c11c5.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/f31c11c5.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">JVM å†…å­˜åˆ†é…</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 24 Feb 2018 15:39:19 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æœ¬ç¬”è®°åŸºäºã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºï¼šJVM é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹åŠéƒ¨åˆ†åœ¨çº¿åšå®¢æ•´ç†ã€‚</p>
</blockquote>
<p>JVMï¼šjava virtual machineï¼Œä¸€ä¸ª java ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰æ‹¥æœ‰ä¸€ä¸ª jvm å®ä¾‹</p>
<h2> å†…å­˜</h2>
<p>JVM åŒºåŸŸæ€»ä½“åˆ†ä¸¤ç±»ï¼Œheap åŒºå’Œé heap åŒºï¼š</p>
<p><strong>heap åŒº</strong>ï¼šEden Spaceï¼ˆä¼Šç”¸å›­ï¼‰ã€Survivor Space(å¹¸å­˜è€…åŒº)ã€Tenured Genï¼ˆè€å¹´ä»£ - å…»è€åŒºï¼‰ã€‚<br>
<strong>é heap åŒº</strong>ï¼šCode Cache(ä»£ç ç¼“å­˜åŒº)ã€Perm Genï¼ˆæ°¸ä¹…ä»£ï¼‰ã€Jvm Stack(Java è™šæ‹Ÿæœºæ ˆ)ã€Local Method Statck(æœ¬åœ°æ–¹ æ³•æ ˆ)ã€‚</p>
<h2> å†…å­˜åˆ’åˆ†</h2>
<h3> 1.head</h3>
<p>å †ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜æ”¾æ‰€æœ‰å¯¹è±¡å®ä¾‹ã€æ•°ç»„ï¼ŒGC ä¸»è¦åœºæ‰€ï¼Œä¼š OOM</p>
<p>åˆ†ç±»</p>
<p><strong>1.æ–°ç”Ÿä»£</strong></p>
<ul>
<li>
<p>eden åˆšåˆšåˆ›å»ºçš„å¯¹è±¡ä¼˜å…ˆ</p>
</li>
<li>
<p>s1 ç»å†å‡ æ¬¡ GC</p>
</li>
<li>
<p>s2 ç»å†å‡ æ¬¡ GC</p>
</li>
</ul>
<p><strong>2.è€å¹´ä»£</strong></p>
<ul>
<li>
<p>å­˜æ´»æ—¶é—´é•¿çš„è€å¹´å¯¹è±¡</p>
</li>
<li>
<p>å¤§å¯¹è±¡ï¼Œå¦‚æ•°ç»„ï¼Œå¤§ String...</p>
</li>
</ul>
<h3> 2.stack</h3>
<p>æ ˆï¼Œçº¿ç¨‹ç§æœ‰ï¼Œå­˜æ”¾åŸºæœ¬æ•°æ®å’Œå¯¹è±¡çš„å¼•ç”¨ï¼ŒLIFOï¼Œä¼š OOMï¼ŒStackOverflow</p>
<h4> java virtual machine stack</h4>
<p>çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äº JVM å…è®¸çš„æ·±åº¦ä¼šå¯¼è‡´ Stack Overflow<br>
åœ¨ç¼–è¯‘æœŸå®Œæˆå†…å­˜åˆ†é…ï¼Œå¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œä½†æ˜¯å½“æ‹“å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿå†…å­˜æ—¶ä¼šå¯¼è‡´ OutOfMemory</p>
<p><strong>stack &nbsp;frame</strong></p>
<p>stack frameï¼šæ ˆå¸§ï¼Œæ¯æ‰§è¡Œä¸€ä¸ªæ–¹æ³•å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ ˆå¸§å¹¶å‹å…¥æ ˆä¸­</p>
<ul>
<li>
<p>å±€éƒ¨å˜é‡è¡¨</p>
<ul>
<li>åŸºæœ¬æ•°æ®ç±»å‹</li>
<li>å¯¹è±¡å¼•ç”¨</li>
<li>returnAddress ç±»å‹ï¼ŒæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„ä½ç½®</li>
</ul>
</li>
<li>
<p>æ“ä½œæ•°æ ˆ</p>
</li>
<li>
<p>åŠ¨æ€é“¾æ¥</p>
</li>
<li>
<p>æ–¹æ³•å‡ºå£ç­‰</p>
</li>
</ul>
<h4> native method stack</h4>
<p>ä¸ java è™šæ‹Ÿæœºæ ˆä½œç”¨ç±»ä¼¼ï¼Œä¸è¿‡ native method stack æ˜¯ä¸º native æ–¹æ³•æœåŠ¡ã€‚<br>
jvm å¯ä»¥è‡ªç”±å®ç°å®ƒï¼Œç”šè‡³åœ¨ sun HotSpot VM ä¸­å°†ä»–ä¸è™šæ‹Ÿæœºæ ˆåˆå¹¶<br>
ä¼š OOMï¼ŒstackOverflow</p>
<h3> 3.method area</h3>
<p>æ–¹æ³•åŒºï¼Œçº¿ç¨‹å…±äº«ï¼Œå­˜æ”¾ç±»ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ï¼Œå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ï¼Œä¼š OOM</p>
<p><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong></p>
<p>ç±»åŠ è½½åï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ä¼šæ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä¼š OOM<br>
<code>String.intern()</code>ï¼Œæœ‰è¯¥ string å¯¹è±¡åˆ™è¿”å›ï¼Œæ— åˆ™åˆ›å»ºå¹¶è¿”å›</p>
<blockquote>
<p><code>String.intern()</code>æ–¹æ³•çš„æ³¨æ„äº‹é¡¹ï¼š</p>
<p>JDK1.6 åŠä»¥ä¸‹ï¼šå°†é¦–æ¬¡å‡ºç°çš„å¯¹è±¡å®ä¾‹<strong>å¤åˆ¶</strong>åˆ°æ°¸ä¹…ä»£ï¼Œè¿”å›å…¶å¼•ç”¨</p>
<p>JDK1.7 åŠä»¥ä¸Šï¼šåªä¼š<strong>è®°å½•</strong>ä¸‹é¦–æ¬¡å‡ºç°çš„å®ä¾‹çš„å¼•ç”¨ï¼Œè¿”å›å…¶å¼•ç”¨</p>
<p>æ‰€ä»¥ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ JDK1.6 åŠä»¥ä¸‹è¾“å‡º<code>false</code>ï¼Œåœ¨ JDK1.7 åŠä»¥ä¸Šè¾“å‡º<code>true</code></p>
<p>æ­¤å¤–ï¼Œç”±äº<code>String</code>ç±»æ˜¯<code>final</code>çš„ï¼Œæ¯æ¬¡<code>new String("str")</code>ä¼šäº§ç”Ÿä¸¤ä¸ªå¯¹è±¡ï¼šä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²<code>str</code>æœ¬èº«ï¼Œä¸€ä¸ªæ˜¯å€¼ä¸º<code>str</code>çš„å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<p>ä»¥<code>String s = "Hello";</code>ä¸ºä¾‹ï¼Œè§£é‡Šå‡ ä¸ªæ¦‚å¿µï¼š</p>
<p><strong>å­—é¢é‡</strong> æºç ä¸­è¡¨ç¤ºå…·ä½“çš„å€¼ï¼Œå¦‚<code>Hello</code></p>
<p><strong>ç¬¦å·å¼•ç”¨</strong> ç”¨æ¥æŒ‡ä»£æŸç§å€¼å¾—ç¬¦å·ï¼Œå¦‚<code>s</code></p>
<p><strong>ç›´æ¥å¼•ç”¨</strong> å¯ä»¥å®šä½åˆ°å†…å­˜ä¸­çš„ï¼ˆç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€å˜é‡ï¼‰ç­‰çš„å…·ä½“åœ°å€</p>
<h3> 4.program count</h3>
<p><strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼Œçº¿ç¨‹ç§æœ‰ï¼Œå ç”¨å†…å­˜å°ï¼Œå½“åšå½“å‰çº¿ç¨‹æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚</p>
<p>è‹¥æ‰§è¡Œ java æ–¹æ³•ï¼Œè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„ä½ç½®</p>
<p>è‹¥æ‰§è¡Œçš„æ˜¯ native æ–¹æ³•ï¼Œåˆ™è®¡æ•°å™¨ä¸ºç©º undefinedã€‚</p>
<p>æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ java è™šæ‹Ÿæœºè§„èŒƒå­—æ²¡æœ‰è§„å®šä»»ä½• OOMError çš„åŒºåŸŸ</p>
<h2> å†…å­˜æº¢å‡º</h2>
<blockquote>
<p>ä»¥ Sun HotSpot VM ä¸ºä¾‹</p>
</blockquote>
<h3> 1.java å †æº¢å‡º</h3>
<p>å¯¹è±¡è¿‡å¤šå¯¼è‡´ head å†…å­˜æº¢å‡º</p>
<ol>
<li>æ˜¯å†…å­˜æ³„æ¼ memory leakï¼Œå®šä½æ³„éœ²å¯¹è±¡</li>
<li>æ˜¯å†…å­˜æº¢å‡º memory overflowï¼Œæ£€æŸ¥è™šæ‹Ÿæœºå †å‚æ•°æ˜¯å¦å¯ä»¥è°ƒå¤§ï¼›å»é™¤éå¿…é¡»çš„ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡</li>
</ol>
<h3> 2.è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º</h3>
<ol>
<li>
<p>å•çº¿ç¨‹ï¼ŒStack Overflow</p>
<p>å•çº¿ç¨‹ä¸‹ï¼Œæ ˆå¸§è¿‡å¤§æˆ–è€…è™šæ‹Ÿæœºæ ˆå®¹é‡å¤ªå°ï¼Œå½“å†…å­˜æ— æ³•åˆ†é…æ—¶éƒ½ä¼šå¯¼è‡´ Stack Overflow å¼‚å¸¸</p>
</li>
<li>
<p>å¤šçº¿ç¨‹ï¼Œ</p>
<p>å¤šçº¿ç¨‹æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹æ ˆåˆ†é…çš„å†…å­˜è¶Šå¤§ï¼Œè¶Šå®¹æ˜“å°è¯•å†…å­˜æº¢å‡º OOM</p>
<p>åŸå› ï¼šè™šæ‹Ÿæœºæœ€å¤§å†…å­˜ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œå»æ‰å…±äº«çš„ Head å’Œ MethodArea å çš„å†…å­˜ï¼Œå‰©ä¸‹çš„å†…å­˜/å•ä¸ªçº¿ç¨‹æœ€å¤§æ ˆå†…å­˜=æœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œå½“å•ä¸ªçº¿ç¨‹æœ€å¤§æ ˆå†…å­˜å¢åŠ æ—¶ï¼Œå¯ä»¥äº§ç”Ÿçš„çº¿ç¨‹æ•°å°±ä¼šè¶Šå°‘</p>
</li>
</ol>
<h3> 3.è¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º</h3>
<p>è¿è¡Œæ—¶å¸¸é‡æ± å±äºæ–¹æ³•åŒºï¼Œå½“å¸¸é‡è¿‡å¤šæ—¶ä¼šå¯¼è‡´ OOMï¼Œå¯ä»¥ç”¨ String.intern() æ–¹æ³•å°è¯•</p>
<h3> 4.æ–¹æ³•åŒºæº¢å‡º</h3>
<p>ç»å¸¸åŠ¨æ€ç”Ÿæˆå¤§é‡ Class çš„åº”ç”¨ï¼Œå¦‚ Spring ç­‰æ¡†æ¶ï¼Œéœ€è¦æ³¨æ„ OOM</p>
<h3> 5.æœ¬åœ°ç›´æ¥å†…å­˜æº¢å‡º</h3>
<p>åŸç”Ÿæ–¹æ³•ç›´æ¥æ“ä½œç‰©ç†å†…å­˜æ—¶å¯¼è‡´ç‰©ç†å†…å­˜ä¸å¤Ÿï¼Œäº§ç”Ÿ OOM</p>
<h2> GC åƒåœ¾å›æ”¶</h2>
<p>JVM ä¸­ GC ä¼šæ ¹æ®ä¸åŒæƒ…å†µé‡‡å–ä»¥ä¸‹ä¸€ç³»åˆ—ç®—æ³•ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶</p>
<h3> å›æ”¶ç®—æ³•</h3>
<h4> 1.å¤åˆ¶ç®—æ³•</h4>
<p><strong>åŸç†</strong>ï¼šå†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œåªä½¿ç”¨ä¸€åŠï¼›GC æ—¶å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€åŠå†…å­˜ï¼Œå‰©ä¸‹çš„åˆ™æ¸…ç©º</p>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š1.æ—  STWï¼Œä½†ä¸é€‚åˆå¯¹è±¡è¿‡å¤šçš„æƒ…å†µï¼›2.å†…å­˜åˆ©ç”¨æ•ˆç‡ä½</p>
<h4> 2.æ ‡è®°æ¸…é™¤æ³•</h4>
<p><strong>åŸç†</strong>ï¼šä» GC Roots å¼€å§‹éå†ï¼Œå¯è¾¾æ ‡è®°å­˜æ´»ï¼Œä¸å¯è¾¾åˆ™æœªæ ‡è®°</p>
<p>java ä¸­ï¼ŒGC Roots å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š1.è¦ StopTheWorld é˜²æ­¢æ ‡è®°çš„æ—¶å€™æ–° new çš„å¯¹è±¡æœªè¢«æ ‡è®°è€Œå‡ºé”™ï¼›</p>
<p>2.æ¸…é™¤å¯¹è±¡åå†…å­˜ä¸è¿ç»­ï¼Œä¼šæœ‰ä¸€å®šçš„æµªè´¹</p>
<h4> 3.æ ‡è®°å‹ç¼©æ³•</h4>
<p><strong>åŸç†</strong>ï¼šç±»ä¼¼ã€æ ‡è®°æ¸…é™¤æ³•ã€‘ï¼Œä½†ä¼šå¯¹æ ‡è®°è¿›è¡Œå‹ç¼©ï¼Œå¦‚ a-&gt;b-&gt;cï¼Œä¼šè¢«å‹ç¼©ä¸º a-&gt;cï¼Œå…·ä½“è¯•è®²æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œå¤–çš„å†…å­˜</p>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š1.ä¹Ÿè¦ StopTheWorld</p>
<h4> 4.å¼•ç”¨è®¡æ•°ç®—æ³•</h4>
<p><strong>åŸç†</strong>ï¼šå¼•ç”¨ +1ï¼Œä¸å¼•ç”¨ -1ï¼Œä¸º 0 åˆ™åˆ é™¤ï¼Œä½†æ˜¯ä¼šæœ‰ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œjava æœªä½¿ç”¨</p>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼šç›¸äº’å¾ªç¯ä½¿ç”¨ï¼š<br>
a = b<br>
b = a<br>
é™¤æ­¤ä¹‹å¤–å†æ²¡æœ‰ç”¨åˆ° aï¼Œb çš„åœ°æ–¹ï¼Œä½†æ˜¯ç”±äº aï¼Œb çš„å¼•ç”¨ä¸ä¸º 0 æ‰€ä»¥æ— æ³•è¢«å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æµªè´¹</p>
<h3> å›æ”¶è¿‡ç¨‹</h3>
<p>ä¸€ä¸ªä¸å¯è¾¾å¯¹è±¡åœ¨â€œæ­»ç¼“â€åˆ°â€œæ‰§è¡Œæ­»åˆ‘â€å‰è‡³å°‘ç»å†ä¸¤ä¸ªæ ‡è®°è¿‡ç¨‹</p>
<ol>
<li>
<p>ç¬¬ä¸€æ¬¡æ ‡è®°ï¼Œç­›é€‰ï¼šæ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize() æ–¹æ³•ï¼Œè‹¥æ˜¯åˆ™æ”¾åˆ° F-Queue é˜Ÿåˆ—ä¸­ã€è§¦å‘ã€‘è¯¥æ–¹æ³•ï¼Œä½†ä¸ä¿è¯æ‰§è¡Œå®Œè¯¥æ–¹æ³•ã€‚</p>
<p>å¯ä»¥åœ¨ finlize() æ–¹æ³•ä¸­<strong>è‡ªæ•‘ä¸€æ¬¡</strong>ï¼šåœ¨è¯¥æ–¹æ³•ä¸­å°†<em>è‡ªèº« this</em>èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œè¿™æ ·åœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶ä¼šè¢«ç§»å‡º<em>å³å°†å›æ”¶</em>é›†åˆï¼›ä½†æ˜¯ç”±äº finlize() æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥åªèƒ½è‡ªæ•‘ä¸€æ¬¡ã€‚å¹¶<em>ä¸æ¨èè¯¥æ–¹æ³•</em>ï¼Œè¯¥æ–¹æ³•æ‰€æœ‰å¯ä»¥åšçš„å·¥ä½œï¼Œå¯ä»¥ç”¨<strong>try...finally</strong>æˆ–è€…å…¶ä»–æ–¹æ³•æ›´å¥½çš„å®ç°</p>
</li>
<li>
<p>ç¬¬äºŒæ¬¡æ ‡è®°ï¼Œè‹¥ finalize() æ–¹æ³•ä»¥åŠè°ƒç”¨è¿‡ï¼Œæˆ–è€…ä¸ºé‡å†™è¯¥æ–¹æ³•ï¼Œåˆ™â€œæ²¡å¿…è¦æ‰§è¡Œâ€ï¼Œå¯ä»¥å›æ”¶</p>
</li>
</ol>
<h2> å¯¹è±¡</h2>
<h3> å¯¹è±¡å¼•ç”¨</h3>
<h4> å¼ºå¼•ç”¨ StrongReference</h4>
<p>People p = new People();å“ªæ€•æŠ›å‡º OOM ä¹Ÿä¸ä¼šè¢« GC å›æ”¶çš„å¯¹è±¡</p>
<h4> è½¯å¼•ç”¨ SoftReference</h4>
<p>SoftReference sf = new SoftReference(p);åªè¦æœ‰è¶³å¤Ÿå†…å­˜å°±ä¸ä¼šè¢« GC å›æ”¶ï¼Œè‹¥å†…å­˜ä¸å¤Ÿåˆ™ä¼šè¢« GC å›æ”¶ï¼Œå¸¸ç”¨ä½œæœåŠ¡å™¨ç¼“å­˜</p>
<h4> å¼±å¼•ç”¨ WeakReference</h4>
<p>åœ¨ä¸‹æ¬¡ GC å›æ”¶ä¹‹å‰éƒ½å­˜åœ¨ï¼Œç”¨ä½œ android ç­‰å†…å­˜ç´§å¼ çš„è®¾å¤‡ä¸­çš„ç¼“å­˜</p>
<h4> è™šå¼•ç”¨ PhantomReference</h4>
<p>æ— æ³•å½±å“å…¶ç”Ÿå­˜æ—¶é—´ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–å…¶å®ä¾‹ï¼Œè®¾ç½®è™šå¼•ç”¨åªæ˜¯ä¸ºäº†åœ¨å¯¹è±¡è¢« GC å›æ”¶æ—¶è·å–ç³»ç»Ÿé€šçŸ¥</p>
<h2> è„‘å›¾</h2>
<figure><img src="https://jixiaoyong.github.io/images/blog/2018-02/JVMMemory.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/blog/2018-02/JVMMemory.png" type="image/png"/>
    </item>
    <item>
      <title>JVM ç±»åŠ è½½æœºåˆ¶ä¹‹ ClassLoader</title>
      <link>https://jixiaoyong.github.io/blog/posts/b3994218.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/b3994218.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">JVM ç±»åŠ è½½æœºåˆ¶ä¹‹ ClassLoader</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 15 Apr 2018 08:40:32 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡ä¸º<a href="https://blog.csdn.net/briblue/article/details/54973413" target="_blank" rel="noopener noreferrer">ã€Šä¸€çœ‹ä½ å°±æ‡‚ï¼Œè¶…è¯¦ç»† java ä¸­çš„ ClassLoader è¯¦è§£ - CSDN åšå®¢ã€‹</a>é˜…è¯»ç¬”è®°</p>
</blockquote>
<h2> ç®€è¿°</h2>
<p>JVM æœ‰ä¸‰ç§ç±»åŠ è½½å™¨ï¼š</p>
<ol>
<li><strong>BootStrap ClassLoader</strong> å¯åŠ¨ç±»åŠ è½½å™¨ï¼ŒåŠ è½½æ ¸å¿ƒç±»åº“ï¼Œä¸»è¦åŠ è½½æ ¸å¿ƒç±»åº“ï¼Œ%JRE_HOME%\lib ä¸‹çš„ rt.jarã€resources.jarã€charsets.jar å’Œ class ç­‰ã€‚</li>
<li><strong>Extention ClassLoader</strong> æ‰©å±•ç±»åŠ è½½å™¨ï¼ŒåŠ è½½ç›®å½•%JRE_HOME%\lib\ext ç›®å½•ä¸‹çš„ jar åŒ…å’Œ class æ–‡ä»¶ã€‚</li>
<li><strong>App ClassLoader</strong> åº”ç”¨ç¨‹åºåŠ è½½å™¨ï¼ŒåŠ è½½å½“å‰åº”ç”¨çš„ classpath çš„æ‰€æœ‰ç±»ã€‚</li>
</ol>
<p>é™¤ä»¥ä¸Šä¸‰ç§å¤–ï¼Œè¿˜æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚</p>
<p>æ¯ä¸ªç±»ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œç±»æœ¬èº«ç¡®å®šå…¶å”¯ä¸€æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»åŠ è½½å™¨ä¸åŒï¼Œç±»è‚¯å®šä¸åŒã€‚</p>
<h2> åŠ è½½è¿‡ç¨‹</h2>
<p>åœ¨åŠ è½½ç±»æ—¶ï¼Œé€šè¿‡**â€œåŒäº²å§”æ‰˜â€<strong>æœºåˆ¶ï¼Œä¾æ¬¡ä»</strong>1** -&gt; <strong>3</strong>å‘ä¸ŠæŸ¥è¯¢ï¼Œå†ä»<strong>3</strong>-&gt;<strong>1</strong>ä¾æ¬¡è¿”å›ç»“æœï¼š</p>
<ol>
<li>è°ƒç”¨<code>findLoadedClass(className) </code>æŸ¥è¯¢æ˜¯å¦å·²ç»åŠ è½½è¯¥ç±»</li>
<li>è°ƒç”¨çˆ¶åŠ è½½å™¨çš„<code>loadClass(className,false)</code>ï¼Œè‹¥çˆ¶åŠ è½½å™¨ä¸ºç©ºï¼Œåˆ™è°ƒç”¨<code>BootStrap ClassLoader</code></li>
<li>å¦‚æœè¿˜æ˜¯æ²¡æœ‰åŠ è½½åˆ°è¯¥ç±»ï¼Œè°ƒç”¨<code>findClass(className)</code></li>
</ol>
<p>è¿™æ ·å­ä¿è¯äº†æ¯ä¸ªç±»éƒ½æ˜¯å…ˆç»è¿‡æœ€é¡¶ç«¯çš„ç±»åŠ è½½å™¨<code>BootStrap ClassLoader</code>ï¼Œå¦‚æœæ²¡æœ‰åŠ è½½åˆ°å†ä¾æ¬¡ç»è¿‡<code>Extention ClassLoader</code>ã€<code>App ClassLoader</code> åŠ è½½ï¼Œç¡®ä¿å¦‚ String ç­‰å…³é”®ç±»ä¸ä¼šè¢«è‡ªå®šä¹‰çš„ ClassLoader åŠ è½½è€Œå¯¼è‡´å¼‚å¸¸ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>AppClassLoader</code>å’Œ<code>ExtClassLoader</code>éƒ½ç»§æ‰¿è‡ª<code>URLClassLoader</code></p>
<p><code>AppClassLoader</code>çš„çˆ¶åŠ è½½å™¨æ˜¯<code>ExtClassLoader</code>ï¼Œ<code>ExtClassLoader</code>çš„çˆ¶åŠ è½½å™¨ä¸º<code>null</code>ï¼Œæ•…è€Œä¼šè°ƒç”¨<code>BootStrap ClassLoader</code></p>
<p>ClassLoader å¦‚æœæ²¡æœ‰æŒ‡å®šçˆ¶åŠ è½½å™¨ï¼Œåˆ™é»˜è®¤çš„çˆ¶åŠ è½½å™¨ä¸º<code>AppClassLoader</code>ï¼Œè‡ªå®šä¹‰ ClassLoader ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<h2> è‡ªå®šä¹‰ ClassLoader</h2>
<p>è‡ªå®šä¹‰ ClassLoader ä¸€èˆ¬æ­¥éª¤ï¼š</p>
<ol>
<li>ç»§æ‰¿è‡ª<code>ClassLoader</code></li>
<li>é‡å†™<code>findClass()</code></li>
<li>åœ¨<code>findClass()</code>æ–¹æ³•ä¸­è°ƒç”¨å¹¶è¿”å›<code>defineClass()</code></li>
</ol>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œ<code>defineClass()</code>åˆ™å°†ä¸€ä¸ªå­—èŠ‚æ•°ç»„è½¬åŒ–ä¸ºä¸€ä¸ªç±»çš„å®ä¾‹ï¼ˆConverts an array of bytes into an instance of class with an optional ProtectionDomainï¼‰</p>
<h2> contextClassLoader</h2>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª ClassLoaderï¼š<code>contextClassLoader</code>ï¼Œé€šè¿‡å°†å…¶è®¾ç½®ä¸ºè‡ªå®šä¹‰çš„ ClassLoader å¯ä»¥åœ¨åŠ è½½ç±»çš„æ—¶å€™åšä¸€äº›ç‰¹æ®Šçš„äº‹æƒ…ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“æœä¸ºï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>JVM ç±»åŠ è½½æœºåˆ¶è§£æ</title>
      <link>https://jixiaoyong.github.io/blog/posts/cf83ef31.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/cf83ef31.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">JVM ç±»åŠ è½½æœºåˆ¶è§£æ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 26 Feb 2018 11:28:56 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€è¿°</h2>
<p>æœ¬æ–‡ä»‹ç»äº† java è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶ã€‚</p>
<h2> ç±»åŠ è½½æœºåˆ¶</h2>
<p>JVM ç±»åŠ è½½ä¸€å…± 7 æ­¥ï¼Œå‰äº”æ­¥æ˜¯ç±»åŠ è½½æœºåˆ¶ï¼Œå„ä¸ªæ­¥éª¤æŒ‰ç…§é¡ºåºè¿›è¡Œï¼Œä½†æ˜¯å¹¶éå›ºå®šçš„ 1,2,3 æ­¥ï¼Œåœ¨å®é™…ä¸­æœ‰å¯èƒ½ä»å…¶ä¸­é—´æŸä¸€æ­¥å¼€å§‹ã€‚</p>
<p>ç±»åŠ è½½æœºåˆ¶ä¸€èˆ¬åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<strong>åŠ è½½ Loading -&gt; è¿æ¥ Linking -&gt; åˆå§‹åŒ– Initializing</strong></p>
<figure><img src="https://github.com/jixiaoyong/Notes-Files/blob/master/draw-io/png/JVMClassLoader.png?raw=true" alt="JVM Class Loader" tabindex="0" loading="lazy"><figcaption>JVM Class Loader</figcaption></figure>
<p>å…¶ä¸­<strong>åŠ è½½ã€éªŒè¯ã€å‡†å¤‡å’Œåˆå§‹åŒ–</strong>å‘ç”Ÿçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œä½†<strong>è§£æ</strong>å¯ä»¥åœ¨åˆå§‹åŒ–ä¹‹åå¼€å§‹ï¼ˆjava åŠ¨æ€ç»‘å®šï¼‰</p>
<blockquote>
<p>java ç»‘å®šåˆ†ä¸ºé™æ€ç»‘å®šå’ŒåŠ¨æ€ç»‘å®šï¼š</p>
<ul>
<li><strong>é™æ€ç»‘å®š</strong>ï¼šå³å‰æœŸç»‘å®šã€‚åœ¨ç¨‹åºæ‰§è¡Œå‰æ–¹æ³•å·²ç»è¢«ç»‘å®šï¼Œæ­¤æ—¶ç”±ç¼–è¯‘å™¨æˆ–å…¶å®ƒè¿æ¥ç¨‹åºå®ç°ã€‚é’ˆå¯¹ javaï¼Œç®€å•çš„å¯ä»¥ç†è§£ä¸ºç¨‹åºç¼–è¯‘æœŸçš„ç»‘å®šã€‚java å½“ä¸­çš„æ–¹æ³•åªæœ‰ finalï¼Œstaticï¼Œprivate å’Œæ„é€ æ–¹æ³•æ˜¯å‰æœŸç»‘å®šçš„ã€‚</li>
<li><strong>åŠ¨æ€ç»‘å®š</strong>ï¼šå³æ™šæœŸç»‘å®šï¼Œä¹Ÿå«è¿è¡Œæ—¶ç»‘å®šã€‚åœ¨è¿è¡Œæ—¶æ ¹æ®å…·ä½“å¯¹è±¡çš„ç±»å‹è¿›è¡Œç»‘å®šã€‚åœ¨ java ä¸­ï¼Œå‡ ä¹æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯åæœŸç»‘å®šçš„ã€‚</li>
</ul>
<p><a href="http://blog.csdn.net/ns_code/article/details/17881581" target="_blank" rel="noopener noreferrer">http://blog.csdn.net/ns_code/article/details/17881581</a></p>
</blockquote>
<h2> ç±»åŠ è½½æœºåˆ¶å…·ä½“è¿‡ç¨‹</h2>
<h3> **I.Loading **</h3>
<p><strong>åŠ è½½</strong>ï¼ŒJVM å°†æ–‡ä»¶ï¼ˆclassï¼Œjarï¼Œzipï¼Œç½‘ç»œç­‰ï¼‰ä¸­çš„äºŒè¿›åˆ¶å­—èŠ‚æµä¿å­˜åˆ°è™šæ‹Ÿæœºæ–¹æ³•åŒºå’Œå †ä¸­ï¼Œå¹¶ç”¨è¯¥äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼åˆ›å»ºç±»æˆ–è€…æ¥å£çš„è¿‡ç¨‹ã€‚</p>
<blockquote>
<p>Loading is the process of finding the binary representation of a class or interface type with a particular name and <em>creating</em> a class or interface from that binary representation</p>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-5.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-5.html</a> (<em>è‹±æ–‡æ–‡æ¡£è‹¥æ— ç‰¹æ®Šè¯´æ˜éƒ½æ˜¯å¼•ç”¨å®˜æ–¹æ–‡æ¡£ï¼Œä¸‹åŒ</em>)</p>
</blockquote>
<ol>
<li>
<p>ç”¨<strong>ç±»å…¨é™å®šå</strong>è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</p>
</li>
<li>
<p>å°†å­—èŠ‚æµä¸­<strong>é™æ€å­˜å‚¨ç»“æ„</strong>è½¬åŒ–ä¸º<strong>æ–¹æ³•åŒº</strong>çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</p>
</li>
<li>
<p><u><em>åœ¨<strong>å †</strong>ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ java.lang.Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºæ•°æ®çš„è®¿é—®å…¥å£ã€‚</em></u></p>
<p>ï¼ˆ<s><strong>è¿™å¥è¯å­˜ç–‘</strong> ï¼Œæœ‰äººè¯´<a href="http://blog.csdn.net/ns_code/article/details/17881581" target="_blank" rel="noopener noreferrer">åœ¨å †ä¸­</a> ,ä¹Ÿæœ‰äººè¯´åœ¨<a href="http://gityuan.com/2015/10/25/jvm-class-loading/" target="_blank" rel="noopener noreferrer">æ–¹æ³•åŒº</a> ,å®˜æ–¹æ–‡æ¡£æœªç›¸å…³æè¿°</s></p>
<p><code>2019/01/12 æ›´æ–°</code> Class å¯¹è±¡æ²¡æœ‰æ˜ç¡®è§„å®šå®åœ¨<strong>JAVA å †</strong>ä¸­ï¼Œå¯¹åº” HotSpot è™šæ‹Ÿæœºæ¥è¯´ï¼Œè¯¥å¯¹è±¡åœ¨<strong>æ–¹æ³•åŒº</strong>ä¸­ï¼‰</p>
</li>
</ol>
<p>ç±»åŠ è½½çš„åœ°æ–¹æ˜¯å¼€å‘äººå‘˜å¯æ§æ€§æœ€å¼ºçš„åœ°æ–¹ã€‚é™¤äº†å¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„ ClassLoader å¤–è¿˜å¯ä»¥è‡ªå®šä¹‰ ClassLoaderï¼ˆåæ–‡è¯¦è¿°ï¼‰ã€‚</p>
<p>ç±»åŠ è½½æ ¹æ®åŠ è½½çš„ç±»ä¸åŒåˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>éæ•°ç»„ç±» ä½¿ç”¨ç³»ç»Ÿ/è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å®ŒæˆåŠ è½½</li>
<li>æ•°ç»„ç±» æ•°ç»„ç±»ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ JVM ç›´æ¥åˆ›å»ºï¼Œä½†æ˜¯æ•°ç»„ç±»çš„å…ƒç´ ç±»å‹è¦é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»º</li>
</ul>
<p>æ•°ç»„ç±»çš„å…ƒç´ åŠ è½½ï¼Œæ ¹æ®æ•°ç»„å…ƒç´ çš„ç±»å‹ä¸åŒï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>å¼•ç”¨ç±» é€šè¿‡æ™®é€šç±»åŠ è½½å™¨åŠ è½½ï¼Œå¹¶å°†æ•°ç»„ç”¨è¯¥ç±»åŠ è½½å™¨æ ‡è¯†</li>
<li>éå¼•ç”¨ç±» å°†æ•°ç»„ä¸å¼•å¯¼ç±»åŠ è½½å™¨æ ‡è¯†</li>
</ul>
<p>æ•°ç»„ç±»çš„å¯è§æ€§ä¸å…¶å…ƒç´ ç±»çš„å¯è§æ€§ä¸€è‡´ã€‚</p>
<hr>
<h3> **II.Linking **</h3>
<p><strong>è¿æ¥</strong>ï¼Œæ˜¯å°†ç±»æˆ–è€…æ¥å£ç»„åˆåˆ° java è™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€çš„è¿‡ç¨‹ï¼Œè¿™æ ·ä»–å°±å¯ä»¥è¢«è¿è¡Œã€‚</p>
<blockquote>
<p>Linking is the process of taking a class or interface and combining(ç»„åˆ) it into the run-time state of the Java Virtual Machine so that it can be executed(è¿è¡Œ)</p>
</blockquote>
<p>è¿æ¥ä¸€èˆ¬åˆ†ä¸º 3 éƒ¨åˆ†ï¼šéªŒè¯ Verificationã€å‡†å¤‡ Preparationã€è§£æ Resolutionã€‚</p>
<blockquote>
<p>Linking a class or interface involves(åŒ…æ‹¬) verifying and preparing(éªŒè¯å’Œå‡†å¤‡) that class or interface, its direct(ç›´æ¥) superclass, its direct superinterfaces, and its element type (if it is an array type), if necessary. Resolution of symbolic references in the class or interface is an optional part of linking.</p>
</blockquote>
<h4> <strong>Verification</strong></h4>
<p><strong>éªŒè¯</strong>ï¼Œä¿è¯ class æ–‡ä»¶ä¸­çš„å­—èŠ‚æµä¿¡æ¯ç¬¦åˆè™šæ‹Ÿæœºçš„è¦æ±‚ã€‚</p>
<blockquote>
<p>Verification(<a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-4.html#jvms-4.10" target="_blank" rel="noopener noreferrer">Â§4.10</a>) ensures that the binary representation(äºŒè¿›åˆ¶æ ¼å¼) of a class or interface is structurally correct(ç»“æ„æ­£ç¡®) (<a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-4.html#jvms-4.9" target="_blank" rel="noopener noreferrer">Â§4.9</a>). Verification may cause additional classes and interfaces to be loaded (<a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-5.html#jvms-5.3" target="_blank" rel="noopener noreferrer">Â§5.3</a>) but need not cause them to be verified or prepared.</p>
</blockquote>
<p>éªŒè¯å†…å®¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼ŒéªŒè¯å­—èŠ‚æµç¬¦åˆ class æ–‡ä»¶æ ¼å¼è§„èŒƒï¼›</li>
<li>å…ƒæ•°æ®éªŒè¯</li>
<li>å­—èŠ‚ç éªŒè¯</li>
<li>ç¬¦å·å¼•ç”¨éªŒè¯</li>
</ol>
<h4> **Preparation **</h4>
<p><strong>å‡†å¤‡</strong>ï¼Œåœ¨æ–¹æ³•åŒºå¯¹ç±»å˜é‡åˆ†é…å†…å­˜ï¼Œ<strong>åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼</strong>ï¼ˆâ€œé›¶å€¼â€ï¼‰ã€‚</p>
<p>æ¯”å¦‚ï¼š<code>static int i = 5ï¼›</code>åœ¨è¿™ä¸€æ­¥åªä¼šè¿›è¡Œåˆ°<code>i = 0</code> ï¼Œè€Œ<code>i = 5</code>è¦åœ¨åˆå§‹åŒ–é‚£ä¸€æ­¥æ‰è¿›è¡Œï¼›</p>
<p>ä½†æ˜¯å¦‚æœæ˜¯ final ä¿®é¥°çš„<strong>å¸¸é‡</strong>ï¼Œåˆ™åœ¨æ­¤åˆ†é…å…·ä½“å€¼ã€‚</p>
<blockquote>
<p><em>Preparation</em> involves creating the static fields for a class or interface and initializing such fields to their default values (<a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-2.html#jvms-2.3" target="_blank" rel="noopener noreferrer">Â§2.3</a>, <a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-2.html#jvms-2.4" target="_blank" rel="noopener noreferrer">Â§2.4</a>). This does not require the execution of any Java Virtual Machine code; explicit initializers for static fields are executed as part of initialization (<a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-5.html#jvms-5.5" target="_blank" rel="noopener noreferrer">Â§5.5</a>), not preparation.</p>
</blockquote>
<p>å‡†å¤‡å·¥ä½œå¯èƒ½åœ¨åˆ›å»ºä¹‹åçš„ä»»ä½•æ—¶å€™å‘ç”Ÿï¼Œä½†æ˜¯å¿…é¡»åœ¨åˆå§‹åŒ–ä¹‹å‰å®Œæˆã€‚</p>
<h4> <strong>Resolution</strong></h4>
<p><strong>è§£æ</strong>ï¼Œæ˜¯åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­åŠ¨æ€ç¡®å®šç¬¦å·å¼•ç”¨çš„å…·ä½“å€¼çš„è¿‡ç¨‹ã€‚</p>
<p>æ¯ä¸ªæ ˆå¸§ frame éƒ½æœ‰ä¸€ä¸ª<code>å½“å‰æ–¹æ³•</code>åˆ°<code>è¿è¡Œæ—¶å¸¸é‡æ± </code> çš„å¼•ç”¨ï¼Œç”¨æ¥æ”¯æŒæ–¹æ³•ä»£ç  (method code) çš„<strong>åŠ¨æ€é“¾æ¥ï¼ˆdynamic linkingï¼‰</strong>ã€‚</p>
<p>method codeï¼šè¦è¢«æ‰§è¡Œçš„æ–¹æ³•ä»¥åŠé€šè¿‡ç¬¦å·å¼•ç”¨çš„å˜é‡ã€‚</p>
<blockquote>
<p>Each frame (<a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-2.html#jvms-2.6" target="_blank" rel="noopener noreferrer">Â§2.6</a>) contains a reference to the run-time constant pool (<a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-2.html#jvms-2.5.5" target="_blank" rel="noopener noreferrer">Â§2.5.5</a>) for the type of the current method to support <em>dynamic linking</em> of the method code.</p>
</blockquote>
<p>åŠ¨æ€é“¾æ¥å°†ç¬¦å·å¼•ç”¨ï¼ˆsymbolic referencesï¼‰è½¬åŒ–ä¸ºå…·ä½“æ–¹æ³•çš„è°ƒç”¨ï¼ˆconcrete method referencesï¼‰å³ç›´æ¥å¼•ç”¨ï¼Œæ ¹æ®éœ€è¦åŠ è½½ç±»æ¥è§£ææœªå®šä¹‰çš„ç¬¦å·ï¼Œå°†å˜é‡è®¿é—®è½¬åŒ–ä¸ºè¿è¡Œæ—¶å†…å­˜ï¼ˆruntime locationï¼‰ã€‚</p>
<blockquote>
<p>This late binding of the methods and variables makes changes in other classes that a method uses less likely to break this code.</p>
<p><em>æ–¹æ³•å’Œå˜é‡çš„è¿™ç§åæœŸç»‘å®šï¼Œä½¿å¾—æ–¹æ³•ä½¿ç”¨çš„å…¶ä»–ç±»çš„æ›´æ”¹ä¸å¤ªå¯èƒ½ç ´åè¿™ä¸ªä»£ç ã€‚</em></p>
<p>ç›´æ¥å¼•ç”¨å¯ä»¥ç›´æ¥å®šä½åˆ°å†…å­˜ä¸­æŸä¸€æ®µåœ°å€ï¼›ç¬¦å·å¼•ç”¨åˆ™ä¸ JVM å†…å­˜æ— ç®¡</p>
</blockquote>
<p>è§£æåˆ†ä¸ºï¼š</p>
<ol>
<li>ç±»ï¼Œæ¥å£è§£æ</li>
<li>å­—æ®µè§£æ</li>
<li>ç±»æ–¹æ³•è§£æ</li>
<li>æ¥å£æ–¹æ³•è§£æ</li>
</ol>
<hr>
<h3> <strong>III.Initialization</strong></h3>
<p><strong>åˆå§‹åŒ–</strong> ï¼Œ<em>Initialization</em> of a class or interface consists of executing its class or interface initialization methodï¼ˆæ‰§è¡Œç±»ï¼Œæ¥å£çš„æ„é€ æ–¹æ³•<code>clinit()</code>ï¼‰</p>
<p>ç±»æˆ–æ¥å£åœ¨è¢«åˆå§‹åŒ–ä¹‹å‰ï¼Œå¿…é¡»å…ˆè¢«è¿æ¥ linkedï¼ˆverified, prepared, and optionallyï¼ˆå¯é€‰ï¼‰resolved.ï¼‰ã€‚</p>
<p>åˆå§‹åŒ–æœ‰ä¸”åªæœ‰ä»¥ä¸‹äº”ç§æƒ…å†µï¼š</p>
<ul>
<li><code>new</code>ã€è¯»å–/è®¾ç½®ç±»ï¼ˆåªæœ‰ç›´æ¥å®šä¹‰å…¶çš„ç±»æ‰ä¼šï¼Œå­ç±»ç­‰ä¸å—å½±å“ï¼‰çš„é™æ€å˜é‡ï¼ˆfinal ä¿®é¥°çš„å¸¸é‡é™¤å¤–ï¼‰ã€æ‰§è¡Œé™æ€æ–¹æ³•</li>
<li><code>java.lang.reflect</code>åå°„è°ƒç”¨ç±»</li>
<li>åˆå§‹åŒ–æ—¶ï¼Œå¦‚æœçˆ¶ç±»æœªåˆå§‹åŒ–ï¼Œå…ˆè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ï¼ˆæ¥å£ç±»é™¤å¤–ï¼‰</li>
<li>è™šæ‹Ÿæœºç­‰å¯åŠ¨æ—¶æ‰§è¡Œä¸»ç±»çš„<code>main()</code>æ–¹æ³•æ—¶ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–ä¸»ç±»</li>
<li>JDK1.7 åŠ¨æ€æ”¯æŒæ—¶ï¼Œå¦‚æœ<code>java.lang.invoke.MethodHandle</code>å®ä¾‹æœ€åè§£æç»“æœ<code>REF_get/put/invokeStaticçš„æ–¹æ³•å¥æŸ„å¯¹åº”çš„ç±»æœªè¢«åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–å¯¹åº”çš„ç±»</code></li>
</ul>
<p>ä»¥ä¸Š 5 ç§ç§°ä¸ºå¯¹ä¸€ä¸ªç±»çš„<strong>ä¸»åŠ¨å¼•ç”¨</strong>ï¼Œå…¶ä½™ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œç§°ä¸º<strong>è¢«åŠ¨å¼•ç”¨</strong></p>
<p><code>clinit()</code> ,æœ‰<strong>ç±»å˜é‡èµ‹å€¼ï¼Œé™æ€è¯­å¥å—</strong>ä¼šç”±ç¼–è¯‘å™¨åˆå¹¶ä¸º<code>clinit()</code>æ–¹æ³•ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š</p>
<ol>
<li>ç±» çˆ¶ç±»çš„<code>clinit()</code>æ–¹æ³•ä¼šå…ˆäºå­ç±»æ‰§è¡Œ</li>
<li>æ¥å£ æ¥å£<code>clinit()</code>æ–¹æ³•æ— éœ€è°ƒç”¨çˆ¶ç±»æ¥å£çš„<code>clinit()</code>æ–¹æ³•ï¼›æ¥å£çš„å®ç°ç±»ä¹Ÿæ— éœ€æ‰§è¡Œæ¥å£çš„<code>clinit()</code>æ–¹æ³•</li>
</ol>
<p><code>clinit()</code> æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨åŒä¸€ä¸ªç±»åŠ è½½å™¨ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹çš„ä¸­åªä¼šæœ‰<strong>ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€æ¬¡<code>clinit()</code></strong>ï¼Œå…¶ä½™çº¿ç¨‹é˜»å¡ç­‰å¾…</p>
<p><code>clinit()</code>å’Œ<code>init()</code>ä¸åŒå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>init</strong>æ˜¯å¯¹è±¡æ„é€ å™¨æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç¨‹åºæ‰§è¡Œ new ä¸€ä¸ªå¯¹è±¡è°ƒç”¨è¯¥å¯¹è±¡ç±»çš„ constructor æ–¹æ³•æ—¶æ‰ä¼šæ‰§è¡Œ init æ–¹æ³•<u>ï¼ˆæ˜¯åœ¨<strong>new å¯¹è±¡</strong>çš„æ—¶å€™<strong>åˆå§‹åŒ–éé™æ€å˜é‡</strong>ï¼‰</u>ï¼›</p>
<p>è€Œ clinit æ˜¯ç±»æ„é€ å™¨æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨ jvm è¿›è¡Œç±»<strong>åŠ è½½â€”â€“éªŒè¯â€”-è§£æâ€”â€“åˆå§‹åŒ–</strong>ï¼Œä¸­çš„åˆå§‹åŒ–é˜¶æ®µ jvm ä¼šè°ƒç”¨ clinit æ–¹æ³•<u>ï¼ˆæ˜¯åœ¨<strong>JVM åˆå§‹åŒ–ç±»</strong>çš„æ—¶å€™<strong>åˆå§‹åŒ–é™æ€å˜é‡</strong>ï¼‰</u>ã€‚</p>
<p><a href="http://blog.csdn.net/u013309870/article/details/72975536" target="_blank" rel="noopener noreferrer">http://blog.csdn.net/u013309870/article/details/72975536</a></p>
</blockquote>
<p>å¦‚æœç±»æ²¡æœ‰é™æ€èµ‹å€¼ã€é™æ€è¯­å¥å—ç­‰åˆ™ä¸ä¼šæœ‰<code>clinit()</code>æ–¹æ³•ã€‚</p>
<p><code>clinit()</code>å…ˆäº<code>init()</code>æ‰§è¡Œã€‚</p>
<h2> å‚è€ƒæ–‡çŒ®</h2>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-5.html" target="_blank" rel="noopener noreferrer">Java Virtual Machine Specification Chapter 5. Loading, Linking, and Initializing</a></p>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-2.html#jvms-2.5.2" target="_blank" rel="noopener noreferrer">Chapter&nbsp;2.&nbsp;The Structure of the Java Virtual Machine</a></p>
<p><a href="http://blog.csdn.net/ns_code/article/details/17881581" target="_blank" rel="noopener noreferrer">ã€æ·±å…¥ Java è™šæ‹Ÿæœºã€‘ä¹‹å››ï¼šç±»åŠ è½½æœºåˆ¶</a></p>
<p><a href="http://blog.csdn.net/zhangliangzi/article/details/51319033" target="_blank" rel="noopener noreferrer">JVM ç±»åŠ è½½æœºåˆ¶è¯¦è§£ï¼ˆä¸€ï¼‰JVM ç±»åŠ è½½è¿‡ç¨‹</a></p>
<p><a href="http://gityuan.com/2015/10/25/jvm-class-loading/" target="_blank" rel="noopener noreferrer">Jvm ç³»åˆ— 3â€”ç±»çš„åŠ è½½ - Gityuan åšå®¢ | è¢è¾‰è¾‰åšå®¢ </a></p>
<p><a href="http://wiki.jikexueyuan.com/project/java-vm/class-loading-mechanism.html" target="_blank" rel="noopener noreferrer">ç±»åŠ è½½æœºåˆ¶ - æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº - æå®¢å­¦é™¢ Wiki </a></p>
<p><a href="http://blog.csdn.net/javazejian/article/details/70768369" target="_blank" rel="noopener noreferrer">æ·±å…¥ç†è§£ Java ç±»å‹ä¿¡æ¯ (Class å¯¹è±¡) ä¸åå°„æœºåˆ¶ - CSDN åšå®¢</a></p>
<p><a href="http://blog.csdn.net/u013309870/article/details/72975536" target="_blank" rel="noopener noreferrer">æ·±å…¥ç†è§£ jvm--Java ä¸­ init å’Œ clinit åŒºåˆ«å®Œå…¨è§£æ - CSDN åšå®¢</a></p>
]]></content:encoded>
      <enclosure url="https://github.com/jixiaoyong/Notes-Files/blob/master/draw-io/png/JVMClassLoader.png?raw=true" type="image/"/>
    </item>
    <item>
      <title>Java ç¬”è®°ä¹‹ HashMap ä¿å­˜æ•°æ®</title>
      <link>https://jixiaoyong.github.io/blog/posts/ff927bd4.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/ff927bd4.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java ç¬”è®°ä¹‹ HashMap ä¿å­˜æ•°æ®</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 15 Dec 2019 08:41:35 GMT</pubDate>
      <content:encoded><![CDATA[<img src="https://images.pexels.com/photos/159644/art-supplies-brushes-rulers-scissors-159644.jpeg?cs=srgb&amp;dl=art-supplies-arts-and-crafts-ballpens-159644.jpg&amp;fm=jpg" class="full-image">
<p>Photo by **<a href="https://www.pexels.com/@pixabay?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" target="_blank" rel="noopener noreferrer">Pixabay </a>**from <strong><a href="https://www.pexels.com/photo/pencils-in-stainless-steel-bucket-159644/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" target="_blank" rel="noopener noreferrer">Pexels</a></strong></p>
<p><code>HashMap</code>ä½¿ç”¨ç”±<code>Node&lt;K,V&gt;</code>ï¼ˆç»§æ‰¿è‡ª<code>Map.Entry&lt;K,V&gt;</code>ï¼‰ç»„æˆçš„<strong>æ•°ç»„</strong><code>table</code>ä¿å­˜æ•°æ®ã€‚</p>
<p>åœ¨<code>table</code>ä¸­ä¿å­˜æ•°æ®æ—¶æ ¹æ®<code>key</code>çš„<code>hashCode</code>è®¡ç®—åˆ°ä¸€ä¸ª<strong>éšæœºä¿å­˜ä½ç½®ï¼ˆä½†éƒ½åœ¨<code>table</code>æ•°ç»„çš„å¤§å°èŒƒå›´å†…ï¼‰</strong>ï¼Œå½“å­˜å‚¨çš„<strong>æ•°æ®æ€»é‡</strong>è¶…è¿‡åŠ è½½ç³»æ•°<code>loadFactor</code>è§„å®šçš„<strong>é˜ˆå€¼</strong>æ—¶åˆ™å¯¹<code>table</code>è¿›è¡Œ<strong>æ‰©å®¹</strong>ã€‚</p>
<h2> HashMap æœ‰ä»¥ä¸‹å…¨å±€å˜é‡</h2>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p><code>loadFactor</code>ï¼šé»˜è®¤çš„è´Ÿè½½å› å­<strong>0.75</strong>æ˜¯å¯¹ç©ºé—´å’Œæ—¶é—´æ•ˆç‡çš„ä¸€ä¸ªå¹³è¡¡é€‰æ‹©ï¼Œå»ºè®®å¤§å®¶ä¸è¦ä¿®æ”¹ï¼Œé™¤éåœ¨æ—¶é—´å’Œç©ºé—´æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼š</p>
<p>å¦‚æœå†…å­˜ç©ºé—´å¾ˆå¤šè€Œåˆå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é™ä½è´Ÿè½½å› å­ Load factor çš„å€¼ï¼›</p>
<p>ç›¸åï¼Œå¦‚æœå†…å­˜ç©ºé—´ç´§å¼ è€Œå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥å¢åŠ è´Ÿè½½å› å­<code>loadFactor</code>çš„å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥å¤§äº 1ã€‚</p>
<p><a href="https://tech.meituan.com/2016/06/24/java-hashmap.html" target="_blank" rel="noopener noreferrer">https://tech.meituan.com/2016/06/24/java-hashmap.html</a></p>
</blockquote>
<p>æ¯ä¸ª<code>Node</code>åŒ…å«äº†ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ‰§è¡Œ<code>hashMap.put("k", "v");</code>æ—¶ï¼Œä¼šå…ˆè®¡ç®—<code>key</code>çš„<code>hash</code>å€¼</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> <code>V put(K key, V value)</code></h2>
<p>ä½¿ç”¨<code>HashMap</code>ä¿å­˜æ•°æ®æ—¶ï¼š</p>
<ol>
<li>
<p>ä½¿ç”¨<code>hash(Object key)</code>è®¡ç®—<code>key</code>çš„<code>hash</code>å€¼</p>
</li>
<li>
<p>é€šè¿‡<code>hash</code>å€¼è®¡ç®—<code>value</code>åº”è¯¥ä¿å­˜çš„ä½ç½®<code>i</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤æ—¶ä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ (<strong>åªæœ‰<code>table</code>ä¸ºç©ºï¼Œæˆ–è€…å½“å‰å­˜å‚¨çš„æ•°æ®æ€»æ•°<code>size</code>å¤§äºé˜ˆå€¼<code>threshold</code>æ—¶æ‰ä¼šæ‰©å®¹</strong><code>resize()</code>)</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>æ¥ä¸‹æ¥ä¼šæ’å…¥æ•°æ®</p>
<ul>
<li>æŒ‡å®šä½ç½®ä¸ºç©ºï¼ˆæ²¡æœ‰<em>hash å†²çª</em>ï¼‰ï¼Œæˆ–å·²æœ‰<code>key</code>ç›¸åŒçš„å€¼ï¼šåˆ™ç›´æ¥æ’å…¥<code>value</code></li>
<li>å·²ç»å­˜åœ¨å€¼å¹¶ä¸”æ•°é‡å¤§äº 8ï¼šåˆ™å°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼ˆJDK1.8ï¼‰ï¼Œå¦åˆ™ä»¥é“¾è¡¨å½¢å¼ä¿å­˜æ•°æ®</li>
<li>åœ¨ç§»é™¤æ•°æ®æ—¶ï¼Œå¦‚æœçº¢é»‘æ ‘æ•°é‡å°äº 6ï¼šåˆ™å°†çº¢é»‘æ ‘è½¬åŒ–ä¸ºé“¾è¡¨</li>
</ul>
</li>
</ol>
<blockquote>
<p>åœ¨ JDK1.7 ä¸­ï¼Œæ•°æ®ä»¥æ•°ç»„æˆ–é“¾è¡¨å½¢å¼ä¿å­˜ï¼ŒJDK1.8 ä¸­åˆ™æ–°å¢äº†çº¢é»‘æ ‘ã€‚</p>
<p>å‘ç”Ÿ hash å†²çªæ—¶ï¼ŒJDK1.7 é‡‡ç”¨é‡‡ç”¨å¤´æ’æ³•ï¼Œå¯èƒ½ä¼šäº§ç”Ÿé€†åºå’Œç¯å½¢é“¾è¡¨ï¼›JDK1.8 é‡‡ç”¨å°¾æ’æ³•ï¼Œç›´æ¥æ’å…¥é“¾è¡¨æˆ–çº¢é»‘æ ‘å°¾éƒ¨ã€‚</p>
<p>å…·ä½“ JDK1.7 ä¸ 1.8 å¯¹æ¯”æŸ¥çœ‹<a href="https://blog.csdn.net/qq_36520235/article/details/82417949" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a></p>
</blockquote>
<h2> <code>V get(Object key)</code></h2>
<p>ä½¿ç”¨<code>HashMap</code>è·å–æ•°æ®æ—¶ï¼š</p>
<ol>
<li>
<p>è®¡ç®— key çš„<code>hashå€¼</code></p>
</li>
<li>
<p>æŸ¥æ‰¾å¯¹åº”ä½ç½®çš„<code>node</code></p>
<ul>
<li>
<p><code>null</code>ï¼šè¿”å›<code>null</code></p>
</li>
<li>
<p><code>node</code>ä¸ä¸ºç©ºä¸”<code>key</code>ä¸€è‡´ï¼šè¿”å›è¯¥<code>node</code></p>
</li>
<li>
<p><code>node</code>ä¸ä¸ºç©ºä¸”<code>key</code>ä¸ä¸€è‡´ï¼š</p>
<p>å¦‚æœæ˜¯<em>é“¾è¡¨</em>ï¼šéå†é“¾è¡¨æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ä¸<code>key</code>ä¸€è‡´çš„<code>node</code></p>
<p>å¦‚æœæ˜¯<em>æ ‘</em>ï¼šéå†æ ‘æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ä¸<code>key</code>ä¸€è‡´çš„<code>node</code></p>
</li>
</ul>
</li>
</ol>
<h2> <code>V remove(Object key)</code></h2>
<p>ä½¿ç”¨<code>HashMap</code>ç§»é™¤æ•°æ®æ—¶ï¼š</p>
<p>å…¶å¤§ä½“è¿‡ç¨‹ä¸<code>get(Object key)</code>ç±»ä¼¼ï¼Œéå†æ‰¾åˆ°å¯¹åº”çš„<code>node</code>å¹¶åˆ é™¤ã€‚</p>
<h2> è®¡ç®—ç´¢å¼•</h2>
<p>ä¸€ä¸ª<code>key</code>å¯¹åº”çš„ç´¢å¼•<code>index</code>æ˜¯ç”±è¿™ä¸ª<code>key</code>çš„<code>hash()</code>å€¼å¯¹<code>HashMap</code>çš„æ•°ç»„é•¿åº¦<code>length</code>çš„ä½™æ•°ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆæœ‰**åœ¨<code>Length</code>ä¸º 2<sup>n</sup>**æ—¶ï¼š</p>
<p>hash % 2<sup>n</sup> =  hash &amp; ( 2<sup>n</sup> - 1)</p>
<blockquote>
<p>hash % 2<sup>n</sup> = hash - (hash / 2<sup>n</sup>) * 2<sup>n</sup><br>
= hash - (hash&gt;&gt;n) * 2<sup>n</sup><br>
= hash &amp; ( 2<sup>n</sup> - 1)</p>
</blockquote>
<p>è€Œ<code>HashMap</code>çš„é•¿åº¦<code>Length</code>åˆåªèƒ½æ˜¯ 2<sup>n</sup>ï¼Œæ‰€ä»¥ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2> ä¿å­˜å€¼</h2>
<ul>
<li>
<p>å½“<code>table</code>ä¸ºç©ºæˆ–è€…é•¿åº¦è¶…è¿‡åŠ è½½å› å­<code>DEFAULT_LOAD_FACTOR</code>è§„å®šçš„å®¹é‡ (é»˜è®¤å®¹é‡ä¸º 16ï¼ŒåŠ è½½å› å­ä¸º 0.75) æ—¶ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚</p>
</li>
<li>
<p>å½“<code>table[index]</code>ä¸ºç©ºæ—¶ï¼Œç›´æ¥æ–°å»º<code>Node</code>å¹¶ä¿å­˜åˆ°<code>table[index]</code>ä¸­ã€‚</p>
</li>
<li>
<p>å½“<code>table[index]</code>ä¸ä¸ºç©ºæ—¶ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯åŒä¸€ä¸ª<code>key</code>åˆ™è¦†ç›–æ—§çš„å€¼</li>
<li>å¦‚æœæ˜¯ä¸åŒçš„<code>key</code>åˆ™å…ˆå°è¯•ä»¥é“¾è¡¨ä¿å­˜æ•°æ®</li>
<li>å¦‚æœæ˜¯ä¸åŒçš„<code>key</code>ï¼Œå¹¶ä¸”é“¾è¡¨é•¿åº¦è¶…è¿‡<code>MIN_TREEIFY_CAPACITY</code>è§„å®šçš„é•¿åº¦ï¼ˆé»˜è®¤ 64ï¼‰ï¼Œåˆ™å°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ (JDK1.8 æ–°å¢)</li>
</ul>
</li>
</ul>
<h2> åºåˆ—åŒ–</h2>
<p>åœ¨<a href="#HashMap%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">ç¬¬ä¸€èŠ‚</a>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>HashMap</code>çš„å¾ˆå¤šå˜é‡éƒ½è¢«æ ‡è®°ä¸º<code>transient</code>ï¼Œè¿™è¡¨ç¤ºåœ¨<code>Serializable</code>åºåˆ—åŒ–æ—¶ä¸ä¸»åŠ¨å»åºåˆ—åŒ–è¿™äº›å€¼ï¼Œé‚£è¿™æ ·å²‚ä¸æ˜¯æ²¡æ³•ååºåˆ—åŒ–è¿™äº›æ•°æ®äº†ï¼Ÿ</p>
<p>å…¶å®åœ¨åé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<strong><code>HashMap</code>åœ¨<code>writeObject()</code>æ–¹æ³•ä¸­ä¸»åŠ¨ä¿å­˜äº†éƒ¨åˆ†æ•°æ®</strong>ï¼ˆåŸå› æ˜¯é»˜è®¤çš„<code>Serializable</code>ç”±äºä¸åŒ JVM å®ç°å¯¹åŒä¸€å¯¹è±¡å¦‚<code>String</code>çš„<code>HashCode</code>ä¸ä¸€å®šä¸€è‡´ï¼Œä¼šå¯¼è‡´ä¸¥é‡çš„é—®é¢˜â€”â€”<code>HashMap</code>åŸºäº<code>hash</code>å€¼ä¿å­˜æ•°æ®ï¼‰ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹¶åœ¨<code>readObject()</code>æ¢å¤äº†è¿™äº›å€¼ã€‚</p>
<h2> ä½è¿ç®—</h2>
<table>
<thead>
<tr>
<th>ä½è¿ç®—</th>
<th>ç¬¦å·</th>
<th>è®¡ç®—</th>
</tr>
</thead>
<tbody>
<tr>
<td>æŒ‰ä½ä¸</td>
<td>&amp;</td>
<td>ç›¸åŒä¸º 1ï¼Œä¸åŒä¸º 0</td>
</tr>
<tr>
<td>æŒ‰ä½æˆ–</td>
<td>|</td>
<td>æœ‰ 1 åˆ™ 1</td>
</tr>
<tr>
<td>æŒ‰ä½å¼‚æˆ–</td>
<td>^</td>
<td>ç›¸åŒä¸º 0ï¼Œä¸åŒä½ 1</td>
</tr>
<tr>
<td>æŒ‰ä½å–å</td>
<td>~</td>
<td></td>
</tr>
<tr>
<td>å·¦ç§»</td>
<td>&lt;&lt;</td>
<td>ç›¸å½“äºä¹˜ä»¥ 2<sup>n</sup></td>
</tr>
<tr>
<td>å³ç§»</td>
<td><code>&gt;&gt;</code></td>
<td>ç›¸å½“äºé™¤ä»¥ 2<sup>n</sup></td>
</tr>
<tr>
<td>æ— ç¬¦å·å³ç§»</td>
<td><code>&gt;&gt;&gt;</code></td>
<td></td>
</tr>
</tbody>
</table>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://www.zhihu.com/question/28562088/answer/111668116" target="_blank" rel="noopener noreferrer">HashCode è®¡ç®—æ‰°åŠ¨åˆ†æ - å…³äº hashMap çš„ä¸€äº›æŒ‰ä½ä¸è®¡ç®—çš„é—®é¢˜ï¼Ÿ - èƒ–å›çš„å›ç­” - çŸ¥ä¹ </a></p>
<p><a href="http://baijiahao.baidu.com/s?id=1646023968436883100&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener noreferrer">ä¸€æ–‡è¯»æ‡‚ Java ä¹‹ HashMap ç´¢å¼•ä½ç½®è®¡ç®—</a></p>
<p><a href="https://blog.csdn.net/changhangshi/article/details/82114727" target="_blank" rel="noopener noreferrer">hashMap åœ¨ jdk1.7 ä¸ jdk1.8 ä¸­çš„åŸç†åŠä¸åŒ</a></p>
<p><a href="https://blog.csdn.net/qq_36520235/article/details/82417949" target="_blank" rel="noopener noreferrer">çœŸå®é¢è¯•é¢˜ä¹‹ï¼šHashmap çš„ç»“æ„ï¼Œ1.7 å’Œ 1.8 æœ‰å“ªäº›åŒºåˆ«</a></p>
<p><a href="https://tech.meituan.com/2016/06/24/java-hashmap.html" target="_blank" rel="noopener noreferrer">Java 8 ç³»åˆ—ä¹‹é‡æ–°è®¤è¯† HashMap</a></p>
<p><a href="http://www.blogjava.net/killme2008/archive/2009/04/15/265721.html" target="_blank" rel="noopener noreferrer">java.util.HashMap æºç è¦ç‚¹æµ…æ</a></p>
<p><a href="https://coderanch.com/t/469720/java/HashMap-Entry-transient" target="_blank" rel="noopener noreferrer">Why HashMap.Entry is transient?</a></p>
<p><a href="https://segmentfault.com/q/1010000000630486" target="_blank" rel="noopener noreferrer">Java ä¸­ HashMap å…³é”®å­— transient çš„ç–‘æƒ‘</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Java ç¬”è®°ä¹‹åŒ¿åå†…éƒ¨ç±»å’Œ final</title>
      <link>https://jixiaoyong.github.io/blog/posts/875283bd.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/875283bd.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java ç¬”è®°ä¹‹åŒ¿åå†…éƒ¨ç±»å’Œ final</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 20 Dec 2019 14:02:16 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ä¸ºä»€ä¹ˆ<code>åŒ¿åå†…éƒ¨ç±»</code>ä½¿ç”¨<code>å±€éƒ¨å¼•ç”¨</code>è¦ç”¨<code>final</code>ï¼Ÿ</h2>
<p>å…ˆè¯´ç»“è®ºï¼š</p>
<p>ç”±äº JAVA åŒ¿åå†…éƒ¨ç±»çš„å®ç°å¹¶ä¸æ˜¯çœŸæ­£çš„é—­åŒ…ï¼Œè€Œæ˜¯åœ¨ç”Ÿæˆå†…éƒ¨ç±»çš„æ—¶å€™<strong>å°†å±€éƒ¨å˜é‡çš„å¼•ç”¨æ‹·è´äº†ä¸€ä»½åˆ°å†…éƒ¨ç±»ä¸­</strong>ã€‚å¦‚æœä¸å°†è¿™ä¸ªå¤–éƒ¨ç±»è®¾ç½®ä¸º<code>final</code>çš„è¯ï¼Œå¤–éƒ¨ç±»æˆ–è€…å†…éƒ¨ç±»ä¿®æ”¹è¿™ä¸ªå±€éƒ¨å˜é‡åï¼Œå¦å¤–ä¸€å¤„ä½¿ç”¨çš„ä»ç„¶æ˜¯ä¿®æ”¹å‰çš„å€¼ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿé—®é¢˜ï¼Œè€Œå¦‚æœå°†å…¶ä¿®æ”¹ä¸º<code>final</code>åˆ™ä¿è¯äº†å±€éƒ¨å˜é‡ä¸å†…éƒ¨ç±»ä½¿ç”¨çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚</p>
<h2> JDK1.8 åå±€éƒ¨å˜é‡ä¸è¦æ±‚ç”¨<code>final</code>äº†ï¼Ÿ</h2>
<p>ä¸å¯¹ï¼Œä»ç„¶æ˜¯è¦æ±‚<code>final</code>çš„ã€‚</p>
<p>åªä¸è¿‡ç¼–è¯‘å™¨åˆ¤æ–­è¯¥å±€éƒ¨å˜é‡ä¸ä¼šå†è¢«ä¿®æ”¹æ—¶ï¼ˆ<em>effectively final</em> äº‹å®ä¸Šçš„<code>final</code>ï¼‰ï¼Œå¯ä»¥çœç•¥ã€‚</p>
<blockquote>
<p>Any local variable, formal parameter, or exception parameter used but not declared in an inner class <strong>must either be declared final or be effectively final</strong> (Â§4.12.4), or a compile-time error occurs where the use is attempted.</p>
<p>Any local variable used but not declared in an inner class must be definitely assigned (Â§16 (Definite Assignment)) before the body of the inner class, or a compile-time error occurs.</p>
<p><a href="https://docs.oracle.com/javase/specs/jls/se13/html/jls-8.html#jls-8.1.3" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/specs/jls/se13/html/jls-8.html#jls-8.1.3</a></p>
</blockquote>
<h2> ä¸ºä»€ä¹ˆå¤–éƒ¨ç±»çš„å…¨å±€å˜é‡ä¸éœ€è¦<code>final</code>ï¼Ÿ</h2>
<p>å› ä¸ºå…¨å±€å˜é‡æ˜¯é€šè¿‡ä¼ å…¥å†…éƒ¨ç±»çš„**å¤–éƒ¨ç±»å¼•ç”¨<code>this$0</code>**æ¥å¼•ç”¨çš„ (è€Œéç›´æ¥å¤åˆ¶å…¨å±€å˜é‡çš„å€¼)ï¼Œè¿™æ ·å†…éƒ¨ç±»å’Œå¤–éƒ¨ç±»æŒæœ‰çš„æ˜¯åŒä¸€ä¸ªå…¨éƒ¨å˜é‡ï¼Œè‡ªç„¶ä¸ä¼šå­˜åœ¨ä¸¤å¤„æ›´æ–°ä¸åŒæ­¥çš„é—®é¢˜ã€‚</p>
<h2> æºç è§£æ</h2>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–è¯‘åå¦‚ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†çœ‹çœ‹å†…éƒ¨ç±»<code>OutClass$1</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://www.runoob.com/w3cnote/inner-lambda-final.html" target="_blank" rel="noopener noreferrer">https://www.runoob.com/w3cnote/inner-lambda-final.html</a></p>
<p><a href="https://stackoverflow.com/questions/4732544/why-are-only-final-variables-accessible-in-anonymous-class/4732617#4732617" target="_blank" rel="noopener noreferrer">Why are only final variables accessible in anonymous class?--stackoverflow</a></p>
<p><a href="https://www.zhihu.com/question/21395848/answer/110829597" target="_blank" rel="noopener noreferrer">java ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»çš„å‚æ•°å¼•ç”¨æ—¶ finalï¼Ÿ - èƒ–å›çš„å›ç­” - çŸ¥ä¹</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Java ç¬”è®°ä¹‹è®¡ç®— Java å¯¹è±¡çš„å¤§å°åŠå…¶åº”ç”¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/b0793c74.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/b0793c74.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java ç¬”è®°ä¹‹è®¡ç®— Java å¯¹è±¡çš„å¤§å°åŠå…¶åº”ç”¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 21 Dec 2019 01:44:32 GMT</pubDate>
      <content:encoded><![CDATA[<h2> åŸç†</h2>
<p><strong>æ³¨æ„ é™¤éç‰¹æ®Šè¯´æ˜ï¼Œä»¥ä¸‹æ‰€è¯´çš„è®¡ç®— Java å¯¹è±¡å¤§å°ï¼Œä¸æ¶‰åŠè¯¥å¯¹è±¡æ‰€æŒæœ‰çš„å¯¹è±¡æœ¬èº«çš„å¤§å°ï¼Œåªè®¡ç®—è¯¥ Java å¯¹è±¡æœ¬èº«çš„å¤§å°ï¼ˆå…¶ä¸­å¼•ç”¨ç±»å‹å¯¹è±¡å¤§å°åªè®¡ç®—ä¸º 4 bytesï¼‰ï¼Œå¦‚æœè¦éå†è®¡ç®— Java å¯¹è±¡å¤§å°ï¼ˆåŒ…å«å…¶æŒæœ‰å¯¹è±¡çš„å¤§å°ï¼‰å¯ä»¥å‚è€ƒ<a href="https://www.javaworld.com/article/2077408/sizeof-for-java.html" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç«  Sizeof for Java</a></strong></p>
<p>ä¸€ä¸ª Java å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¤§å°åŒ…æ‹¬ä»¥ä¸‹ (ä»¥ 64 ä½ JVM å¯ç”¨å‹ç¼©ä¸ºä¾‹ï¼Œç»¼åˆ<a href="https://blog.csdn.net/ITer_ZC/article/details/41822719" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>å’Œ<a href="https://blog.csdn.net/u013380694/article/details/102739636" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>çš„ä¿¡æ¯æ•´ç†)ï¼š</p>
<table>
<thead>
<tr>
<th>åˆ†ç±»</th>
<th>å¤§å°ï¼ˆbyteï¼‰</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯¹è±¡å¤´</td>
<td>8</td>
<td>ä¿å­˜å¯¹è±¡çš„ class ä¿¡æ¯ã€IDã€åœ¨è™šæ‹Ÿæœºä¸­çš„çŠ¶æ€</td>
</tr>
<tr>
<td>Oop æŒ‡é’ˆ</td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>æ•°æ®åŒº</td>
<td></td>
<td>å¯¹è±¡å®é™…åŒ…å«çš„æ•°æ®ï¼Œå¼•ç”¨ç±»å‹å¤§å°ä¸º 4 bytes</td>
</tr>
<tr>
<td>æ•°ç»„é•¿åº¦</td>
<td>4</td>
<td>åªæœ‰æ•°ç»„å¯¹è±¡æ‰æœ‰</td>
</tr>
<tr>
<td>8 æ¯”ç‰¹å¯¹é½</td>
<td></td>
<td>å°†å¯¹è±¡æ€»å¤§å°å¯¹é½åˆ° 8 å­—èŠ‚æ‰€éœ€çš„å¡«å……</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ­¤å¤–ï¼Œå¦‚æœæ˜¯ï¼ˆéé™æ€ï¼‰å†…éƒ¨ç±»çš„è¯ï¼Œç”±äºä»–é»˜è®¤æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œæ‰€ä»¥ä¼šæ¯”æ™®é€šç±»çš„å¯¹è±¡å¤š 4 ä¸ª byteã€‚</p>
<p><a href="https://stackoverflow.com/a/12193259/8389461" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/12193259/8389461</a></p>
</blockquote>
<p>å¯ä»¥å‚ç…§<a href="https://www.jianshu.com/p/9d729c9c94c4" target="_blank" rel="noopener noreferrer">è¿™å¼ å›¾</a></p>
<figure><img src="https://jixiaoyong.github.io/images/20191221191518.webp" alt="å›¾ç‰‡æ¥è‡ª https://www.jianshu.com/p/9d729c9c94c4" tabindex="0" loading="lazy"><figcaption>å›¾ç‰‡æ¥è‡ª <a href="https://www.jianshu.com/p/9d729c9c94c4" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/9d729c9c94c4</a></figcaption></figure>
<p>å…¶ä¸­ï¼Œæ•°æ®åŒºå ç”¨çš„å¤§å°å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆå›¾ç‰‡æ¥è‡ªäº<a href="https://speakerdeck.com/romainguy/android-memories?slide=29" target="_blank" rel="noopener noreferrer">android-memories</a>ï¼‰</p>
<figure><img src="https://jixiaoyong.github.io/images/20191221104050.png" alt="Size of data from speakerdeck.com" tabindex="0" loading="lazy"><figcaption>Size of data from <a href="http://speakerdeck.com" target="_blank" rel="noopener noreferrer">speakerdeck.com</a></figcaption></figure>
<p>##ç¤ºä¾‹</p>
<p>æ ¹æ®<a href="https://speakerdeck.com/romainguy" target="_blank" rel="noopener noreferrer">Romain Guy</a>åœ¨<a href="https://speakerdeck.com/romainguy/android-memories?slide=34" target="_blank" rel="noopener noreferrer">SpeakerDeck</a>ä¸­çš„è¯´æ³•ï¼š</p>
<blockquote>
<p>ä¸€ä¸ªç©ºçš„ class å ç”¨äº† 4+8=12 ä¸ª byte çš„å†…å­˜ï¼Œå†åŠ ä¸Š 8 æ¯”ç‰¹å¯¹é½ï¼Œå®é™…å ç”¨å¤§å°ä¸º 16 æ¯”ç‰¹ã€‚</p>
</blockquote>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>å ç”¨å¤§å°ï¼š</p>
<table>
<thead>
<tr>
<th>Allocation</th>
<th>Size in bytes</th>
</tr>
</thead>
<tbody>
<tr>
<td>dlmalloc å¼•ç”¨</td>
<td>4</td>
</tr>
<tr>
<td>Object overheadï¼ˆå¯¹è±¡å¤´ï¼‰</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>Total = 4 + 8 =12 bytes</p>
<p>ç»è¿‡<em>8-byte aligned</em>åï¼štotal = 16 bytes</p>
<p><a href="https://speakerdeck.com/romainguy/android-memories?slide=34" target="_blank" rel="noopener noreferrer">https://speakerdeck.com/romainguy/android-memories?slide=34</a></p>
</blockquote>
<p>æ­¤å¤–è¿˜æœ‰<strong>åŒ…å«äº†æ•°æ®çš„å¯¹è±¡</strong>å¤§å°è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20191221171816.png" alt="å›¾ç‰‡æ¥è‡ª https://speakerdeck.com/romainguy/android-memories?slide=42" tabindex="0" loading="lazy"><figcaption>å›¾ç‰‡æ¥è‡ª <a href="https://speakerdeck.com/romainguy/android-memories?slide=42" target="_blank" rel="noopener noreferrer">https://speakerdeck.com/romainguy/android-memories?slide=42</a></figcaption></figure>
<p>å¯¹äºæ•°ç»„çš„å¤§å°è®¡ç®—ï¼ˆå‚è€ƒ<a href="https://www.cnblogs.com/zhanjindong/p/3757767.html" target="_blank" rel="noopener noreferrer">ä¸€ä¸ª Java å¯¹è±¡åˆ°åº•å ç”¨å¤šå¤§å†…å­˜ï¼Ÿ</a>å’Œ<a href="https://speakerdeck.com/romainguy/android-memories?slide=54" target="_blank" rel="noopener noreferrer">romainguy/android-memories</a>ï¼Œåè€…å…³äºæ•°ç»„å¤§å°çš„è®¡ç®—ä¸­<code>width&amp;padding = 8 </code>çš„æ„ä¹‰å­˜ç–‘ï¼‰:</p>
<p>æŒ‰ç…§å¼€å¤´çš„å…¬å¼ï¼š<code>æ•°ç»„å¤§å° = 8 å¯¹è±¡å¤´ + 4 OopæŒ‡é’ˆ + 4 æ•°ç»„å¤§å°æ ‡è®°length + æ•°ç»„æ•°æ®å ç”¨å¤§å° + 8æ¯”ç‰¹å¯¹é½ </code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> è®¡ç®—å¯¹è±¡å¤§å°çš„å·¥å…·</h2>
<p>å…·ä½“çš„å¦‚ä½•è®¡ç®— Java ä¸­ Object å¤§å°ï¼Œå¯ä»¥å‚è€ƒ<a href="https://stackoverflow.com/a/52682/8389461" target="_blank" rel="noopener noreferrer">stackoverflow çš„è¿™ä¸ªå›ç­”</a>ï¼ˆ<a href="https://github.com/cirosantilli/java-cheat/tree/a907ad2243dce2109c54d27323f9387065b5ca5c/instrument" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>æœ‰ä¸€ä»½ Github ä¸Šé¢çš„å®ç°æºç ï¼‰</p>
<p>å¯ä»¥å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://blog.csdn.net/ITer_ZC/article/details/41822719" target="_blank" rel="noopener noreferrer">èŠèŠ JVMï¼ˆä¸‰ï¼‰ä¸¤ç§è®¡ç®— Java å¯¹è±¡å¤§å°çš„æ–¹æ³•</a></p>
<p><a href="https://www.iteye.com/blog/brandnewuser-2113828" target="_blank" rel="noopener noreferrer">å‡†ç¡®è®¡ç®— Java ä¸­å¯¹è±¡çš„å¤§å°</a></p>
<p><a href="https://www.cnblogs.com/zhanjindong/p/3757767.html" target="_blank" rel="noopener noreferrer">ä¸€ä¸ª Java å¯¹è±¡åˆ°åº•å ç”¨å¤šå¤§å†…å­˜ï¼Ÿ</a></p>
<p>è¿™é‡Œæä¾›ä¸€ä¸ªå®ä¾‹ï¼ˆ<a href="https://github.com/cirosantilli/java-cheat/tree/a907ad2243dce2109c54d27323f9387065b5ca5c/instrument" target="_blank" rel="noopener noreferrer">å‚è€ƒè‡ªè¿™é‡Œ</a>ï¼‰ï¼š</p>
<p><code>Sizeof.java</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Makefile</code></p>
<div class="language-makefile line-numbers-mode" data-ext="makefile"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä½¿ç”¨æ—¶å…ˆæ–°å»ºä¸€ä¸ª Java ç±»ï¼Œåœ¨å…¶ä¸­è°ƒç”¨<code>sizeof()</code>æ–¹æ³•ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å®é™…åº”ç”¨</h2>
<h3> <code>String</code>æœ€é•¿ä¸º 65534</h3>
<p><code>String s = â€œâ€;</code>ä¸­ï¼Œåœ¨ç¼–è¯‘æœŸæœ€å¤šå¯ä»¥æœ‰ 65534 ä¸ªå­—ç¬¦</p>
<blockquote>
<p><s>åŸå› æ˜¯ï¼ŒJava ä¸­çš„ UTF-8 ç¼–ç çš„ Unicode å­—ç¬¦ä¸²åœ¨å¸¸é‡æ± ä¸­ä»¥<code>CONSTANT_Utf8</code>ç±»å‹è¡¨ç¤ºï¼Œå¸¸é‡æ± ä¸­çš„æ‰€æœ‰å­—é¢é‡å‡ ä¹éƒ½æ˜¯é€šè¿‡<code>CONSTANT_Utf8_info</code>æè¿°çš„ã€‚</s></p>
<p><s>è¿™é‡Œé¢çš„<code>u2 length</code>è¡¨æ˜äº†è¯¥ç±»å‹å­˜å‚¨æ•°æ®çš„é•¿åº¦ï¼Œè€Œ<code>u2</code>æ˜¯æ— ç¬¦å·çš„ 16 ä½æ•´æ•°ï¼Œå› æ­¤ç†è®ºä¸Šå…è®¸çš„çš„æœ€å¤§é•¿åº¦æ˜¯<code>2^16=65536</code>ã€‚è€Œ Java class æ–‡ä»¶æ˜¯ä½¿ç”¨ä¸€ç§å˜ä½“<code>UTF-8</code>æ ¼å¼æ¥å­˜æ”¾å­—ç¬¦çš„ï¼Œ<code>null</code> å€¼ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œå› æ­¤åªå‰©ä¸‹<code> 65536ï¼ 2 ï¼ 65534</code>ä¸ªå­—èŠ‚ã€‚</s></p>
<div class="language-c line-numbers-mode" data-ext="c"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰€ä»¥ï¼Œåœ¨ Java ä¸­ï¼Œæ‰€æœ‰éœ€è¦ä¿å­˜åœ¨å¸¸é‡æ± ä¸­çš„æ•°æ®ï¼Œé•¿åº¦æœ€å¤§ä¸èƒ½è¶…è¿‡ 65535ï¼Œè¿™å½“ç„¶ä¹ŸåŒ…æ‹¬å­—ç¬¦ä¸²çš„å®šä¹‰</strong></p>
<p>ä¸Šé¢æåˆ°çš„è¿™ç§ String é•¿åº¦çš„é™åˆ¶æ˜¯<em>ç¼–è¯‘æœŸçš„é™åˆ¶</em>ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨<code>String s= â€œâ€;</code>è¿™ç§å­—é¢å€¼æ–¹å¼å®šä¹‰çš„æ—¶å€™æ‰ä¼šæœ‰çš„é™åˆ¶ã€‚</p>
<p>String åœ¨<em>è¿è¡ŒæœŸ</em>æœ‰æ²¡æœ‰é™åˆ¶å‘¢ï¼Œç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œå°±æ˜¯æˆ‘ä»¬å‰æ–‡æåˆ°çš„é‚£ä¸ª<code>Integer.MAX_VALUE </code>ï¼Œè¿™ä¸ªå€¼çº¦ç­‰äº 4Gï¼Œåœ¨è¿è¡ŒæœŸï¼Œå¦‚æœ String çš„é•¿åº¦è¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œå°±å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚(åœ¨ jdk 1.9 ä¹‹å‰ï¼‰</p>
<p><a href="https://blog.csdn.net/u013380694/article/details/102739636" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/u013380694/article/details/102739636</a></p>
</blockquote>
<p><strong>ä¸€ä¸ª String å¯¹è±¡ï¼Œå ç”¨å¤§å°ï¼ˆJDK1.8ï¼‰ä¸º 24 bytes</strong>ï¼ˆä¸è®¡ç®—æŒæœ‰çš„ char æ•°ç»„å ç”¨çš„å¤§å°ï¼‰ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†åŠ ä¸Šåœ¨ 64 ä½ JVM ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡å…·æœ‰ 12 bytes çš„<code>å¯¹è±¡å¤´+å¼•ç”¨</code>ï¼Œè¦æ±‚å¯¹é½åˆ° 8 çš„å€æ•° (æ¥æº<a href="https://www.baeldung.com/java-size-of-object#1-objects-references-and-wrapper-classes" target="_blank" rel="noopener noreferrer">2.1. Objects, References and Wrapper Classes</a>)ï¼Œæ‰€ä»¥ä¸€ä¸ª String å¯¹è±¡çš„å¤§å°æ˜¯ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3> æšä¸¾ç±» enum</h3>
<h4> æšä¸¾ç±»å¤§å°çš„è®¡ç®—</h4>
<p>æšä¸¾ç±»ä¸­çš„æ¯ä¸ªæšä¸¾éƒ½æ˜¯è¯¥æšä¸¾ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬ç”¨<code>javap</code>æŸ¥çœ‹å…¶ç¼–è¯‘åçš„å­—èŠ‚ç å¯ä»¥çœ‹åˆ°ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç®€å•è®¡ç®—ä¸€ä¸‹è¿™ä¸ª<code>EnumClazz</code>çš„å¤§å°ï¼ˆä¸å«å¼•ç”¨å¯¹è±¡çš„å¤§å°ï¼‰ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ¯ä¸ªæšä¸¾ç±»çš„å€¼ï¼ˆä»¥<code>EnumClazz.Day</code>ä¸ºä¾‹ï¼‰çš„å¤§å°ï¼š</p>
<p><code>enum</code>ç±»çš„æ¯ä¸ªå€¼å®é™…ä¸Šéƒ½ç»§æ‰¿è‡ª<code>java.lang.Enum</code>ç±»ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—<code>EnumClazz.Day</code>çš„å¤§å°ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬ä¾‹ä¸­<strong>æ¯ä¸€ä¸ªæšä¸¾ç±»å€¼å ç”¨ 24 bytes</strong>ï¼Œç”±æ­¤å¯ä»¥è®¡ç®—å‡º<code>EnumClazz</code>å®é™…å ç”¨çš„å¤§å°åº”è¯¥æ˜¯ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4> Android ä¸­æ˜¯å¦åº”è¯¥ä½¿ç”¨æšä¸¾</h4>
<p>å…³äº Android ä¸­ä½¿ç”¨æšä¸¾å’Œå¸¸é‡æ‰€å ç”¨çš„å¤§å°å¯¹æ¯”<em>RomainGuy</em>æœ‰<a href="https://speakerdeck.com/romainguy/android-memories?slide=67" target="_blank" rel="noopener noreferrer">ä¸‹å›¾</a>çš„å¯¹æ¯”ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20191221172243.png" alt="https://speakerdeck.com/romainguy/android-memories?slide=67" tabindex="0" loading="lazy"><figcaption><a href="https://speakerdeck.com/romainguy/android-memories?slide=67" target="_blank" rel="noopener noreferrer">https://speakerdeck.com/romainguy/android-memories?slide=67</a></figcaption></figure>
<p>å…³äºæ˜¯å¦åº”è¯¥åœ¨ Android ä¸­ä½¿ç”¨æšä¸¾ç±»ï¼Œå¯ä»¥å‚è€ƒä¸‹æ–‡ï¼š</p>
<p><a href="https://www.liaohuqiu.net/cn/posts/android-enum-memory-usage/" target="_blank" rel="noopener noreferrer">https://www.liaohuqiu.net/cn/posts/android-enum-memory-usage/</a></p>
<p><a href="https://stackoverflow.com/a/29972028/8389461" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/29972028/8389461</a></p>
<p>æ€»ç»“èµ·æ¥å…¶ç»“è®ºå°±æ˜¯ï¼š</p>
<p><strong>å½“éœ€è¦ç”¨åˆ°æšä¸¾ç±»çš„ç‰¹æ€§æ—¶ï¼Œæ¯”å¦‚éè¿ç»­åˆ¤æ–­ï¼Œæ–¹æ³•é‡è½½ç­‰æ—¶å°±ä½¿ç”¨æšä¸¾ï¼Œå¦åˆ™å°±ä½¿ç”¨å ç”¨å†…å­˜æ›´å°çš„å¸¸é‡ç±»ã€‚</strong></p>
<h3> SparseArray&amp;ArrayMap VS HashMap</h3>
<p><code>HashMap</code>çš„æ•°æ®æ˜¯ç»è¿‡åŒ…è£…åä¿å­˜åœ¨<code>HashMap.Node&lt;K,V&gt;</code>æ•°ç»„ä¸­ã€‚</p>
<p>ä¸‹é¢æ˜¯<code>HashMap</code>çš„ç»“æ„ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†çœ‹çœ‹ Android æä¾›çš„<code>android.util.SparseArray</code>ç±» (å…·ä½“åˆ†æå¯å‚è€ƒï¼š<a href="https://juejin.im/entry/57c3e8c48ac24700634bd3cf" target="_blank" rel="noopener noreferrer">SparseArray çš„ä½¿ç”¨åŠå®ç°åŸç†</a>)</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†ç»“åˆ<a href="https://developer.android.google.cn/reference/android/util/SparseArray" target="_blank" rel="noopener noreferrer">å®˜æ–¹çš„æè¿°</a>ï¼Œ<code>SparseArray</code>ç±»å¾ˆæ˜æ˜¾è¦æ¯”<code>HashMap</code>å ç”¨æ›´å°‘çš„å†…å­˜ï¼š</p>
<ul>
<li>å°†<code>KEY</code>å’Œ<code>VALUE</code>ç›´æ¥ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œé¿å…äº†å°†å…¶åŒ…è£…ä¸ºä¸€ä¸ª<code>Node</code>å¯¹è±¡çš„å¼€é”€</li>
<li>ç”±äº<code>SparseArray</code>ç±»çš„ key æ˜¯<code>int</code>ç±»å‹è€Œéè¢«è‡ªåŠ¨è£…ç®±åçš„<code>Integer</code>å¯¹è±¡ï¼Œæ‰€ä»¥å½“åŒæ ·ä½¿ç”¨<code>int</code>ç±»å‹çš„<code>key</code>ä¿å­˜æ•°æ®æ—¶ï¼Œ<code>SparseArray</code>ç±»çš„<code>key</code>è¦å ç”¨æ›´å°‘çš„å†…å­˜ã€‚</li>
</ul>
<blockquote>
<p><code>SparseArray</code> is intended to be more memory-efficient than a <a href="https://developer.android.google.cn/reference/java/util/HashMap" target="_blank" rel="noopener noreferrer"><code>HashMap</code></a>, because it <strong>avoids auto-boxing keys</strong> and its data structure <strong>doesn't rely on an extra entry</strong> object for each mapping.</p>
<p><a href="https://developer.android.google.cn/reference/android/util/SparseArray" target="_blank" rel="noopener noreferrer">https://developer.android.google.cn/reference/android/util/SparseArray</a></p>
</blockquote>
<p>ä½†æ˜¯ï¼Œ<code>SparseArray</code>æœ‰ä»¥ä¸‹å±€é™æ€§ï¼š</p>
<ul>
<li>
<p>åœ¨æ¯æ¬¡<code>put/get/remove</code>çš„æ—¶å€™éƒ½éœ€è¦ä½¿ç”¨äºŒåˆ†æ³• (<code>ContainerHelpers.binarySearch(mKeys, mSize, key)</code>) æŸ¥æ‰¾æ˜¯å¦å·²ç»å­˜åœ¨<code>KEY</code>å¯¹åº”çš„å€¼ï¼ˆæœ‰çš„è¯æŸ¥æ‰¾å…¶ä½ç½®ï¼‰</p>
</li>
<li>
<p>åœ¨æ·»åŠ å’Œåˆ é™¤ item çš„æ—¶å€™éƒ½éœ€è¦åœ¨æ•°ç»„ä¸­å¢åˆ æ¡ç›®ï¼ˆè€—æ—¶ï¼Œå°½ç®¡ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œ<code>SparseArray</code>åœ¨åˆ é™¤æ—¶åªæ˜¯å°†å¯¹äºçš„å€¼æ ‡è®°ä¸º<code>DELETED</code>ï¼Œåœ¨ä¸‹æ¬¡æ›´æ–°è¯¥<code>KEY</code>å¯¹äºçš„å€¼æ—¶ç›´æ¥è¦†ç›–ï¼Œæˆ–è€…åœ¨<code>GC</code>æ—¶åˆ é™¤ï¼‰ã€‚</p>
<p><code>  private static final Object DELETED = new Object();</code></p>
<p>HashMap çš„åˆ é™¤æ¶‰åŠåˆ°æ•°ç»„ã€é“¾è¡¨å’Œçº¢é»‘æ ‘ï¼ˆJDK1.8ï¼‰</p>
</li>
<li>
<p><strong>åœ¨å®¹çº³æ•°ç™¾ä¸ªé¡¹ç›®æ—¶æ€§èƒ½ä¼šæ¯” HashMap å°å¤§çº¦ 50%</strong>ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ¯å½“éœ€è¦<strong>å¢é•¿æ•°ç»„</strong>æˆ–<strong>è·å–æ•°ç»„å¤§å°</strong>æˆ–<strong>è·å–æ¡ç›®å€¼</strong>æ—¶ï¼Œéƒ½å¿…é¡»æ‰§è¡Œåƒåœ¾å›æ”¶ GCã€‚</p>
</blockquote>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹å¯ä»¥æ›¿æ¢ HashMap çš„ (æ•°æ®æ¥è‡ª<a href="https://stackoverflow.com/a/31413003/8389461" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>)ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼Œè¿˜æœ‰<code>android.util.ArrayMap</code>å…¶ç‰¹æ€§ä¸<code>SparseArray</code>ç±»ä¼¼ï¼ˆ<strong>ä¸¤è€…å ç”¨å†…å­˜å°ï¼Œä½†æ˜¯æ…¢å¹¶ä¸”æœ€å¥½ä¸è¦ç”¨æ¥å­˜å‚¨å¤§å®¹é‡çš„æ•°æ®</strong>ï¼‰ï¼Œåªä¸è¿‡å®ƒæ”¯æŒ key å€¼ä¸ºå…¶ä»–ç±»å‹ï¼Œå ç”¨å†…å­˜å¤§å°åœ¨<code>SparseArray</code>å’Œ<code>HashMap</code>ä¹‹é—´ (å‚è€ƒ<a href="https://blog.csdn.net/u010687392/article/details/47809295" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>)ï¼Œæ­¤å¤–<code>ArrayMap</code>çš„ API å’Œ<code>HashMap</code>ç±»ä¼¼ã€‚</p>
<blockquote>
<p>æ ¹æ®<a href="https://speakerdeck.com/romainguy" target="_blank" rel="noopener noreferrer">Romain Guy</a>çš„<a href="https://speakerdeck.com/romainguy/android-memories?slide=94" target="_blank" rel="noopener noreferrer">è®¡ç®—</a>ï¼š</p>
<p>ä¿å­˜ 1000 ä¸ª int å¯¹è±¡çš„<code>SparseArray</code> å ç”¨å¤§å°ä¸ºï¼š8072 bytes</p>
<p>ä¿å­˜ 1000 ä¸ªå¯¹è±¡çš„<code>HashMap&lt;Integer,Integer&gt;</code> å ç”¨å¤§å°ä¸ºï¼š64136 bytes</p>
<p>å‡ ä¹ç›¸å·® 8 å€ï¼</p>
</blockquote>
<p>ç»¼ä¸Šï¼Œ<strong>å½“è¦ä¿å­˜çš„æ•°æ®é‡æ¯”è¾ƒå°ï¼ˆå°äºå‡ åƒä¸ªï¼‰çš„æ—¶å€™ï¼Œå¦‚æœ KEY æ˜¯åŸºæœ¬ç±»å‹ï¼Œæ¨èä½¿ç”¨<code>SparseArray</code>åŠå…¶è¡ç”Ÿç±»ä»¥èŠ‚çœå†…å­˜ï¼Œå¦‚æœ KEY æ˜¯å…¶ä»–ç±»å‹åˆ™ä½¿ç”¨<code>ArrayMap</code>;å¦åˆ™ä½¿ç”¨<code>HashMap</code>æ›´åŠ é«˜æ•ˆ</strong>ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p>é™¤æ–‡ç« ä¸­ç½—åˆ—çš„é“¾æ¥å¤–ï¼š</p>
<p><a href="https://blog.csdn.net/u013380694/article/details/102739636" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/u013380694/article/details/102739636</a></p>
<p><a href="https://www.javaworld.com/article/2077408/sizeof-for-java.html" target="_blank" rel="noopener noreferrer">Sizeof for Java -- javaworld.com</a></p>
<p><a href="https://speakerdeck.com/romainguy/android-memories" target="_blank" rel="noopener noreferrer">RomainGuy-Android Memories</a>ï¼ˆæ¨èï¼‰</p>
<p><a href="https://stackoverflow.com/a/31413003/8389461" target="_blank" rel="noopener noreferrer">SparseArray vs HashMap</a></p>
<p><a href="https://blog.csdn.net/u010687392/article/details/47809295" target="_blank" rel="noopener noreferrer">Android å†…å­˜ä¼˜åŒ–ï¼ˆä½¿ç”¨ SparseArray å’Œ ArrayMap ä»£æ›¿ HashMapï¼‰</a></p>
<p><a href="https://juejin.im/entry/57c3e8c48ac24700634bd3cf" target="_blank" rel="noopener noreferrer">SparseArray çš„ä½¿ç”¨åŠå®ç°åŸç†</a></p>
<p><a href="https://developer.android.google.cn/reference/android/util/SparseArray" target="_blank" rel="noopener noreferrer">SparseArray -- developer.android.google.cn</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20191221191518.webp" type="image/webp"/>
    </item>
    <item>
      <title>Java ç¬”è®°ä¹‹ ThreadLocal</title>
      <link>https://jixiaoyong.github.io/blog/posts/9a8e41a8.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/9a8e41a8.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java ç¬”è®°ä¹‹ ThreadLocal</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 20 Dec 2019 04:54:48 GMT</pubDate>
      <content:encoded><![CDATA[<p><code>ThreadLocal</code>æ˜¯<code>Thread</code>ä¸­ç”¨æ¥ä¿å­˜<strong>çº¿ç¨‹ç§æœ‰å˜é‡</strong>çš„æ•°æ®ç»“æ„ã€‚</p>
<p>ä¸€ä¸ª<code>ThreadLocal</code>åªèƒ½ä¿å­˜ä¸€ä¸ªå€¼ï¼Œæœ‰<code>set/get/remove</code>æ–¹æ³•ã€‚</p>
<p>åœ¨<code>Thread</code>æœ‰ä¸€ä¸ª<code>threadLocals</code>ï¼ˆ<code>ThreadLocal.ThreadLocalMap</code>ï¼‰å˜é‡ï¼Œè¯¥å˜é‡æ˜¯ä¸€ä¸ªå®šåˆ¶çš„ Hash Mapï¼Œç”¨æ¥ä¿å­˜çº¿ç¨‹ç§æœ‰çš„æ•°æ®ï¼ˆç±»å‹ä¸º<code>ThreadLocal&lt;?&gt; Key, Object Value</code>ï¼‰ã€‚</p>
<h2> ç‰¹ç‚¹</h2>
<ol>
<li>
<p>ä¸€ä¸ª<code>Thread</code>å¯ä»¥æœ‰å¤šä¸ª<code>ThreadLocal</code>å˜é‡</p>
</li>
<li>
<p><strong>ä¸åŒ<code>Thread</code>å¯ä»¥é€šè¿‡ä¸€ä¸ª<code>ThreadLocal</code>å˜é‡åˆ†åˆ«ä¿å­˜ä¸åŒçš„å˜é‡è€Œäº’ä¸å½±å“</strong>ã€‚</p>
</li>
<li>
<p>å¦‚æœä¸åŒçš„<code>Thread</code>ä½¿ç”¨çš„<code>ThreadLocal</code>å˜é‡ä¿å­˜çš„æ˜¯<strong>åŒä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å¯¹è±¡</strong>ï¼ˆå‡è®¾ä¸º<code>obj</code>ï¼‰ï¼Œæ— è®ºè¿™äº›<code>Thread</code>ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ª<code>ThreadLocal</code>å¯¹è±¡è¿˜æ˜¯å®Œå…¨ä¸åŒçš„<code>ThreadLocal</code>å¯¹è±¡ï¼Œåªè¦<code>obj</code>æŒ‡å‘çš„å¯¹è±¡æ”¹å˜ï¼Œå…¶ä½™çº¿ç¨‹ä¸­çš„<code>ThreadLocal</code>å¯¹è±¡ä¹Ÿä¼šè®¿é—®åˆ°<code>obj</code>çš„æœ€æ–°å€¼ã€‚</p>
</li>
</ol>
<h2> ä½¿ç”¨ä¸è§£æ</h2>
<p>å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ª<code>ThreadLocal</code>å¹¶ä¸ºä¹‹èµ‹å€¼æ—¶</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ—¶å€™å°±ä¼šè°ƒç”¨<code>set()</code>æ–¹æ³•ï¼ˆæ–¹å¼ 1ï¼‰æˆ–è€…<code>setInitialValue()</code>æ–¹æ³•ï¼ˆæ–¹å¼ 2ï¼‰ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•åˆ°æœ€åéƒ½ç›¸å½“äºè°ƒç”¨äº†<code>Thread</code>å¯¹è±¡çš„<code>threadLocals</code>çš„<code>set(ThreadLocal&lt;?&gt; key, Object value)</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ€ç»ˆä»¥<code>ThreadLocal</code>å¯¹è±¡ä¸º KEYï¼Œå°†æ•°æ®ä¿å­˜åˆ°äº†<code>Thread</code>å¯¹è±¡è‡ªå·±çš„<code>threadLocals</code>ä¸­ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥å³ä½¿æ˜¯<strong>åŒä¸€ä¸ª<code>ThreadLocal</code>å¯¹è±¡ï¼Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è¿›è¡Œ<code>set/get/remove</code>éƒ½åªæ˜¯æ›´æ–°äº†æœ¬çº¿ç¨‹ä¸­<code>ThreadLocal</code>å¯¹è±¡å¯¹åº”çš„å€¼</strong>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å†…å­˜æ³„æ¼</h2>
<p>åœ¨<code>ThreadLocal.ThreadLocalMap</code>ä¸­ï¼Œæœ€ç»ˆç”¨æ¥ä¿å­˜<code>ThreadLocal</code>ä»¥åŠå¯¹åº”å€¼çš„æ˜¯ä¸€ä¸ª<code>Entry</code>æ•°ç»„ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œ<code>Entry</code>å¯¹<code>ThreadLocal</code>æ˜¯<strong>å¼±å¼•ç”¨</strong>ï¼ŒæŒ‰ç…§â€œå¼ºè½¯å¼±è™šâ€å¼•ç”¨çš„ç­‰çº§æ¥åˆ’åˆ†ï¼Œæ¯æ¬¡ GC çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ª<code>ThreadLocal</code>å¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨ï¼Œå°±ä¼šè¢«å›æ”¶æ‰ï¼Œè¿™æ—¶å¦‚æœè¯¥<code>Thread</code>è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆ<code>threadLocals</code>ä¸­ä¿å­˜çš„<code>ThreadLocal&lt;?&gt; k</code>å·²ç»è¢«å›æ”¶äº†ï¼Œä½†æ˜¯<code>Object v</code>å¯¹è±¡ä»ç„¶ä¿å­˜åœ¨<code>threadLocals</code>ä¸­ä½†æ˜¯æ²¡æœ‰åŠæ³•å†è®¿é—®åˆ°ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<p>è§£å†³æ–¹æ³•å‚è€ƒï¼š</p>
<blockquote>
<p>ä½¿ç”¨<code>ThreadLocal</code>æ—¶ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼çš„å‰ææ¡ä»¶ï¼š</p>
<p>â‘ <code>ThreadLocal</code>å¼•ç”¨è¢«è®¾ç½®ä¸º<code>null</code>ï¼Œä¸”åé¢æ²¡æœ‰<code>setï¼Œget,remove</code>æ“ä½œã€‚</p>
<p>â‘¡ çº¿ç¨‹ä¸€ç›´è¿è¡Œï¼Œä¸åœæ­¢ã€‚ï¼ˆçº¿ç¨‹æ± ï¼‰</p>
<p>â‘¢ è§¦å‘äº†åƒåœ¾å›æ”¶ã€‚ï¼ˆMinor GC æˆ– Full GCï¼‰</p>
<p>æˆ‘ä»¬çœ‹åˆ°<code>ThreadLocal</code>å‡ºç°å†…å­˜æ³„æ¼æ¡ä»¶è¿˜æ˜¯å¾ˆè‹›åˆ»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦ç ´åå…¶ä¸­ä¸€ä¸ªæ¡ä»¶å°±å¯ä»¥é¿å…å†…å­˜æ³„æ¼ï¼Œå•ä½†ä¸ºäº†æ›´å¥½çš„é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿæˆ‘ä»¬ä½¿ç”¨<code>ThreadLocal</code>æ—¶éµå®ˆä»¥ä¸‹ä¸¤ä¸ªå°åŸåˆ™ï¼š</p>
<p>â‘ <code>ThreadLocal</code>ç”³æ˜ä¸º<code>private static final</code>ã€‚ <code>Private</code>ä¸<code>final </code>å°½å¯èƒ½ä¸è®©ä»–äººä¿®æ”¹å˜æ›´å¼•ç”¨ï¼Œ <code>Static </code>è¡¨ç¤ºä¸ºç±»å±æ€§ï¼Œåªæœ‰åœ¨ç¨‹åºç»“æŸæ‰ä¼šè¢«å›æ”¶ã€‚</p>
<p>â‘¡<code>ThreadLocal</code>ä½¿ç”¨ååŠ¡å¿…è°ƒç”¨<code>remove</code>æ–¹æ³•ã€‚æœ€ç®€å•æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ä½¿ç”¨åå°†å…¶ç§»é™¤ã€‚</p>
<p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸º CSDN åšä¸»ã€Œpony-ziã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/zzg1229059735/article/details/82715741" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/zzg1229059735/article/details/82715741</a></p>
</blockquote>
<h2> æ€»ç»“</h2>
<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œæ‰€è°“çš„<em>é€šè¿‡<code>ThreadLocal</code>å®ç°çº¿ç¨‹æœ¬åœ°å˜é‡ä¸å…¶ä»–çº¿ç¨‹éš”ç¦»</em>ï¼Œæ˜¯åœ¨åˆ›å»º<code>ThreadLocal</code>çš„æ—¶å€™ï¼Œ<strong>ä¿å­˜çš„å°±æ˜¯å±äºå½“å‰çº¿ç¨‹çš„ç‹¬ç«‹çš„å˜é‡ï¼Œå¹¶ä¸”ä¹‹åçš„ä¿®æ”¹ä¹Ÿä¸ä¼šï¼ˆæ— æ³•ï¼‰ä¿®æ”¹åˆ°å…¶ä»–çº¿ç¨‹ä¸­å¯¹åº”çš„å€¼</strong>ï¼Œä½†å¦‚æœ<code>ThreadLocal</code>æœ¬èº«ä¿å­˜çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™è¿™ä¸ªå¯¹è±¡åœ¨æ‰€æœ‰çš„çº¿ç¨‹ä¸­è¿˜æ˜¯å…±äº«çš„ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://www.cnblogs.com/whoislcj/p/5811989.html" target="_blank" rel="noopener noreferrer">Android çº¿ç¨‹ç®¡ç†ä¹‹ ThreadLocal ç†è§£åŠåº”ç”¨åœºæ™¯</a></p>
<p><a href="https://blog.csdn.net/shenyo/article/details/80391818" target="_blank" rel="noopener noreferrer">ThreadLocal æ·±å…¥åˆ†æï¼ˆJdk 1.8ï¼‰</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Java ä¸­ä¸‰ç§å¸¸ç”¨çš„æ’åºæ–¹æ³•</title>
      <link>https://jixiaoyong.github.io/blog/posts/1fd30f6e.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/1fd30f6e.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java ä¸­ä¸‰ç§å¸¸ç”¨çš„æ’åºæ–¹æ³•</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 20 Dec 2016 15:25:05 GMT</pubDate>
      <content:encoded><![CDATA[<p>ä»Šå¤©é‡æ–°å­¦ä¹ ç±»ä¸‰ç§æ’åºæ–¹æ³•ï¼ŒæŒ‰ç…§æ’åºé€Ÿåº¦ä¾æ¬¡æ˜¯å†’æ³¡æ’åºï¼Œé€‰æ‹©æ’åºå’Œæ’å…¥æ’åºã€‚<br>
ä»¥ä¸‹ç¤ºä¾‹çš†ä¸ºä»å°åˆ°å¤§çš„æ’åº</p>
<h2> 1.å†’æ³¡æ’åº</h2>
<p>æ¯ä¸€æ¬¡æ¯”è¾ƒéƒ½å¯èƒ½è¦äº¤æ¢å…ƒç´ ã€‚<br>
å†’æ³¡æ’åºçš„æ€æƒ³æ˜¯ï¼š<br>
æ¯ä¸€è½®å¼€å§‹çš„æ—¶å€™ï¼Œå°†ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆaï¼‰å¼€å§‹ä¸å…¶åçš„å…ƒç´ ï¼ˆbï¼‰ä¾æ¬¡è¿›è¡Œæ¯”è¾ƒï¼Œå°†è¾ƒå¤§çš„å…ƒç´ ï¼ˆè®¾ä¸º mï¼‰æ”¾åˆ°åé¢ï¼Œå¹¶å°† m ä¸å…¶åçš„å¦å¤–ä¸€ä¸ªå…ƒç´ ç»§ç»­è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ²¡æœ‰æ’å¥½åºçš„å…ƒç´ ã€‚<br>
åœ¨æ¥ä¸‹æ¥ä¸€è½®çš„æ’åºä¸­ï¼Œåˆšæ‰ä»¥åŠä¹‹å‰é€‰å‡ºæ¥çš„ã€å·²ç»æ’å¥½é¡ºåºçš„æœ€å¤§å€¼ä¸ç”¨å‚ä¸æ’åºã€‚<br>
ä¾æ¬¡ç±»æ¨ï¼Œæ€»å…±éå† n-1 è½®ï¼Œå³å¯å®Œæˆæ’åºã€‚<br>
å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>

<h2> 2.é€‰æ‹©æ’åº</h2>
<p>æ¯æ¬¡æ¯”è¾ƒçš„æ—¶å€™ä¸äº¤æ¢<br>
é€‰æ‹©æ’åºçš„æ€æƒ³ï¼š<br>
æ¯æ¬¡æ¯”è¾ƒçš„æ—¶å€™æ‰¾åˆ°çš„ä¸¤ä¸ªæ•°ä¸­çš„è¾ƒå¤§å€¼å¹¶è®°ä¸‹å…¶ä½ç½®ï¼Œç­‰åˆ°å½“å‰ä¸€è½®çš„éå†å®Œæˆä¹‹åï¼Œå°†æœ€åä¸€ä¸ªæœªæ’åºå…ƒç´ ä¸è¿™ä¸€è½®éå†æ‰¾åˆ°çš„æœ€å¤§å€¼äº¤æ¢<br>
æœ€å¤šäº¤æ¢ n-1 æ¬¡<br>
ä»£ç å¦‚ä¸‹ï¼š</p>

<h2> 3.æ’å…¥æ’åºæ³•</h2>
<p>æ’å…¥æ’åºæ³•æ€æƒ³ï¼š<br>
å°†å¾…æ’åºçš„å…ƒç´ åˆ†ä¸ºæœ‰åºå’Œæ— åºä¸¤ç§ï¼Œåˆšå¼€å§‹æ’åºçš„æ—¶å€™å‡è®¾åªæœ‰ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå…¶ä½™ n-1 ä¸ªå…ƒç´ éƒ½æ˜¯æ— åºçš„ï¼›<br>
æ’åºå¼€å§‹çš„æ—¶ï¼Œå°†æ— åºéƒ¨åˆ†çš„ä¸€ä¸ªå…ƒç´ ï¼ˆaï¼‰ä¸æœ‰åºéƒ¨åˆ†çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆbï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœ a&lt;bï¼Œåˆ™å°† a ä¸ b äº¤æ¢ï¼Œå†å°† a ä¸ä¸‹ä¸€ä¸ªæœ‰åºå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼›å¦åˆ™ï¼Œå°† a åŠ åˆ° b åé¢ï¼Œä½œä¸ºæœ‰åºéƒ¨åˆ†çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚<br>
æ¥ç€å†ä»æ— åºéƒ¨åˆ†å–å‡ºä¸€ä¸ªå…ƒç´ ä¸æœ‰åºéƒ¨åˆ†çš„å…ƒç´ ä¾æ¬¡æ¯”è¾ƒï¼Œç›´è¾¾æ‰€æœ‰å…ƒç´ éƒ½ä¸ºæœ‰åºå…ƒç´ ã€‚<br>
éå† n-1 æ¬¡<br>
ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Java ä¸­çš„æ³›å‹</title>
      <link>https://jixiaoyong.github.io/blog/posts/b2cdb69e.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/b2cdb69e.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java ä¸­çš„æ³›å‹</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 03 Nov 2018 03:01:34 GMT</pubDate>
      <content:encoded><![CDATA[<p>Java ä¸­çš„æ³›å‹å®ç°äº†<strong>å‚æ•°ç±»å‹åŒ–</strong>çš„æ¦‚å¿µã€‚</p>
<p>ä¸»è¦æœ‰ä»¥ä¸‹å½¢å¼ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ¬æ–‡ä¸»è¦è®°å½• Java æ³›å‹ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„çŸ¥è¯†ç‚¹ã€‚</p>
<h2> æ³›å‹ç‰¹æ€§</h2>
<p>æ³›å‹åœ¨ Java SE5 è¢«å¼•å…¥ï¼Œå¯ä»¥åœ¨ç±»å’Œæ–¹æ³•ä¸­ï¼Œå°†ç±»å‹ä½œä¸ºç±»å‹å‚æ•°ä¼ å…¥ã€‚</p>
<p>æ³›å‹ç±»å‹å‚æ•°ä¼šåœ¨å®é™…è¿è¡Œæ—¶è¢«<strong>æ“¦é™¤</strong>åˆ°ä»–çš„ç¬¬ä¸€ä¸ªè¾¹ç•Œã€‚å¦‚<code>&lt;T&gt;</code>ä¼šè¢«æ“¦é™¤ä¸º<code>Objet</code>ï¼Œè€Œ<code>&lt;T extends ClazzA&gt;</code>åˆ™ä¼šè¢«æ“¦é™¤ä¸º<code>ClazzA</code>ã€‚</p>
<h2> éœ€è¦æ³¨æ„çš„åœ°æ–¹</h2>
<h3> ä¸èƒ½æœ‰æ³›å‹æ•°ç»„</h3>
<p>è¿™æ˜¯å› ä¸º Java ä¸­ Object[]é»˜è®¤ä¸ºæ‰€æœ‰æ•°ç»„çš„çˆ¶ç±»ï¼Œå¦‚ä¸‹ä»£ç è™½ç„¶åœ¨ç¼–è¯‘æœŸä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶ä¼šè¢«æ£€æŸ¥å‡º objArr æŒ‡å‘çš„æ•°ç»„å®é™…ç±»å‹ï¼ˆStringï¼‰å’Œè¦èµ‹äºˆçš„ç±»å‹ï¼ˆIntegerï¼‰ä¸ä¸€è‡´è€ŒæŠ¥é”™ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°ç»„åªèƒ½å­˜æ”¾<strong>å®šä¹‰çš„å®é™…ç±»å‹</strong>ä»¥åŠä»–ä»¬çš„<strong>å­ç±»å‹</strong>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œå¦‚æœæ”¯æŒæ³›å‹æ•°ç»„ï¼šç”±äºæ³›å‹ç±»å‹å‚æ•°ä¼šåœ¨è¿è¡Œæ—¶è¢«æ“¦é™¤ï¼Œå¯¼è‡´å³ä½¿åˆ°äº†è¿è¡Œæ—¶ä¹Ÿæ— æ³•å‘ç°è¿™ä¸ªé”™è¯¯ï¼Œä»è€Œä¼šå¯¼è‡´é”™è¯¯ã€‚</p>
<p>å¦‚ä¸‹ï¼ŒåŠ å…¥æ”¯æŒæ³›å‹å‚æ•°ï¼Œåˆ™ objArr1 ä¸­å®é™…ä¿å­˜çš„ç±»å‹ï¼ˆMap&lt;String,Integer&gt;ï¼‰ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ç”±äº objArr1 å’Œ objArr2 éƒ½æ˜¯ Object ç±»å‹çš„æ•°ç»„ï¼Œç¼–è¯‘é€šè¿‡ï¼›åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œç”±äº Map ä¸­çš„æ³›å‹å‚æ•°ç±»å‹å·²ç»è¢«æ“¦é™¤ï¼Œä¹Ÿæ— æ³•åŒºåˆ† objArr1 å’Œ objArr2 ä¸­å®é™…æŒ‡å‘çš„ä¸¤ä¸ª Map&lt;K,V&gt;æ•°ç»„ï¼Œä¹Ÿæ˜¯åˆæ³•çš„ï¼Œè¿™æ ·åŸæœ¬å®šä¹‰çš„æ˜¯ Map&lt;String,Integer&gt;æ•°ç»„ï¼Œå´å¯ä»¥ä¿å­˜ä»»ä½•ç±»ä¼¼çš„ Mapï¼Œè€Œè¿™æœ¬æ¥æ˜¯ä¸å…è®¸çš„ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>Collections ç±»é€šè¿‡ä¸€ç§åˆ«æ‰­çš„æ–¹æ³•ç»•è¿‡äº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ Collections ç±»ç¼–è¯‘æ—¶ä¼šäº§ç”Ÿç±»å‹æœªæ£€æŸ¥è½¬æ¢çš„è­¦å‘Šã€‚</p>
<p><code>ArrayList</code>å…·ä½“å®ç°çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºä½•è¿™äº›ä»£ç åœ¨è®¿é—® <code>backingArray</code>æ—¶æ²¡æœ‰äº§ç”Ÿ <code>ArrayStoreException</code>å‘¢ï¼Ÿæ— è®ºå¦‚ä½•ï¼Œéƒ½ä¸èƒ½å°† <code>Object</code>æ•°ç»„èµ‹ç»™ <code>String</code>æ•°ç»„ã€‚å› ä¸ºæ³›å‹æ˜¯é€šè¿‡æ“¦é™¤å®ç°çš„ï¼Œ<code>backingArray</code>çš„ç±»å‹å®é™…ä¸Šå°±æ˜¯ <code>Object[]</code>ï¼Œå› ä¸º <code>Object</code>ä»£æ›¿äº† <code>V</code>ã€‚</p>
<p><strong>è¿™æ„å‘³ç€ï¼šå®é™…ä¸Šè¿™ä¸ªç±»æœŸæœ› <code>backingArray</code>æ˜¯ä¸€ä¸ª <code>Object</code>æ•°ç»„ï¼Œä½†æ˜¯ç¼–è¯‘å™¨è¦è¿›è¡Œé¢å¤–çš„ç±»å‹æ£€æŸ¥ï¼Œä»¥ç¡®ä¿å®ƒåŒ…å« <code>V</code>ç±»å‹çš„å¯¹è±¡ã€‚</strong></p>
<p>æ¥æºï¼š<a href="https://www.ibm.com/developerworks/cn/java/j-jtp01255.html" target="_blank" rel="noopener noreferrer">https://www.ibm.com/developerworks/cn/java/j-jtp01255.html</a></p>
</blockquote>
<h2> æ³›å‹å®¹å™¨</h2>
<p>ç”±äºæ³›å‹çš„ç±»å‹åœ¨è¿è¡Œæ—¶ä¼šè¢«æ“¦é™¤ï¼Œæ‰€ä»¥å°†ç±»å‹æ£€æŸ¥æ”¾åˆ°äº†ç¼–è¯‘æœŸã€‚</p>
<p><code>List&lt;Clazz&gt;</code> æ³›å‹åˆ—è¡¨åªèƒ½ä¿å­˜æŒ‡å®šæ³›å‹ç±»å‹<code>T</code>çš„æ•°æ®ï¼Œè€Œä¸èƒ½ä¿å­˜å…¶å­ç±»ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯èƒ½ä¿å­˜ Fruit çš„å®¹å™¨åº”è¯¥ä¹Ÿè¦èƒ½å®‰å…¨çš„ä¿å­˜ Appleï¼Œä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç±»ä¼¼äºæ•°ç»„ä¸­<code>Object[] arr = Apple[]</code>çš„å‘ä¸Šè½¬å‹ï¼Œå¯ä»¥ä½¿ç”¨<code>?</code>å¼•å…¥åå˜ã€‚</p>
<h3> åå˜</h3>
<p><code>List&lt;? extends T&gt;</code> å¯ä»¥<strong>åˆæ³•çš„æŒ‡å‘ä¸€ä¸ª<code>List&lt; SubT&gt;</code></strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå®Œæˆè‡ªåŠ¨<strong>å‘ä¸Šè½¬å‹</strong>ï¼Œæˆä¸ºå¯ä»¥æŒæœ‰<strong>æŸä¸ªè¯¸å¦‚ T æˆ–è€… T çš„å­ç±»</strong>çš„ Listï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¸çŸ¥é“è¿™ä¸ª<strong>ç±»</strong>å…·ä½“æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥æ‹’ç»å‘å…¶ä¸­ä¼ é€’ä»»ä½•ç±»å‹å¯¹è±¡ï¼Œå³ä½¿ Object ä¹Ÿä¸è¡Œã€‚</p>
<p>å¯ä»¥è¿™ä¹ˆæƒ³ï¼Œ<code>&lt;? extends T&gt;</code>è¡¨ç¤ºçš„æ˜¯ T çš„å­ç±»ï¼Œé‚£ä¹ˆ<code>List&lt;? extends T&gt;</code> ä¿å­˜çš„ä¾¿æ˜¯<strong>T çš„æŸä¸ªå­ç±»</strong>ï¼Œæ‰€ä»¥ä¸èƒ½ä¿å­˜ Object æˆ–è€… T ç­‰ç±»å‹ï¼Œåˆç”±äºåˆ—è¡¨ä¸èƒ½ä¿å­˜ä¸åŒçš„ç±»å‹ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½ä¿å­˜ä»»ä½• T çš„å­ç±»ï¼Œå³å®¹å™¨å°†æ•°ç»„åœ¨è¿è¡Œæ—¶æ‰ä¼šæœ‰çš„ç±»å‹æ£€æŸ¥æ”¾åˆ°äº†ç¼–è¯‘æœŸï¼ˆåŸå› æ˜¯è¿è¡Œæ—¶ç±»å‹ä¼šè¢«æ“¦é™¤ï¼‰ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> é€†å˜</h3>
<p><code>List&lt;? super T&gt;</code> <strong>ä¸»åŠ¨å£°æ˜</strong>é€šé…ç¬¦<code>?</code>çš„è¶…ç±»å‹ä¸º<code>T</code>,å³ List ä¿å­˜çš„æ˜¯<strong>T çš„æŸä¸ªçˆ¶ç±»</strong>ï¼Œé‚£ä¹ˆ List ä¹Ÿå¯ä»¥å®‰å…¨çš„ä¿å­˜<strong>T æˆ–è€… T çš„å­ç±»</strong>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://www.zhihu.com/question/20928981/answer/39234969" target="_blank" rel="noopener noreferrer">java ä¸ºä»€ä¹ˆä¸æ”¯æŒæ³›å‹æ•°ç»„ï¼Ÿ - ylxfc çš„å›ç­” - çŸ¥ä¹</a></p>
<p><a href="https://www.oracle.com/technetwork/cn/articles/java/juneau-generics-2255374-zhs.html" target="_blank" rel="noopener noreferrer">Oracle Java æ³›å‹åŸç†</a></p>
<p><a href="https://www.ibm.com/developerworks/cn/java/j-jtp01255.html" target="_blank" rel="noopener noreferrer">Java ç†è®ºå’Œå®è·µ - äº†è§£æ³›å‹ - è¯†åˆ«å’Œé¿å…å­¦ä¹ ä½¿ç”¨æ³›å‹è¿‡ç¨‹ä¸­çš„é™·é˜±</a></p>
<p><a href="https://www.jianshu.com/p/2bf15c5265c5" target="_blank" rel="noopener noreferrer">Java æ³›å‹ï¼ˆäºŒï¼‰åå˜ä¸é€†å˜</a></p>
<p>ã€ŠJava ç¼–ç¨‹æ€æƒ³ ç¬¬ 4 ç‰ˆã€‹</p>
]]></content:encoded>
    </item>
    <item>
      <title>Java åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ Singleton</title>
      <link>https://jixiaoyong.github.io/blog/posts/36721083.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/36721083.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ Singleton</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 14 Feb 2018 10:34:16 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€ä»‹</h2>
<p>åœ¨ç¼–ç ä¸­å¸¸å¸¸ä¼šç”¨åˆ°å•ä¾‹ï¼Œæ¥ç¡®ä¿ç±»æœ‰ä¸€ä¸ªå”¯ä¸€çš„å¯¹è±¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å°†æ„é€ æ–¹æ³•ç§æœ‰åŒ–æ—¢å¯ä»¥å®ç°ï¼Œä½†å½“è€ƒè™‘åˆ°å¤šçº¿ç¨‹æ—¶äº‹æƒ…ä¼šå˜å¾—æœ‰äº›å¤æ‚ï¼Œæœ¬æ–‡è®¨è®ºçš„æ­£æ˜¯å‡ ç§å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å®ç°å•ä¾‹çš„æ–¹æ³•ã€‚</p>
<h2> 1.æ™®é€šå•ä¾‹</h2>
<p>ç§æœ‰åŒ–æ„é€ æ–¹æ³•ï¼Œå¯¹å¤–æä¾›ä¸€ä¸ªå…¬æœ‰ã€é™æ€çš„æ–¹æ³•ï¼Œåœ¨å…¶å†…éƒ¨åˆ¤æ–­ç±»å¯¹è±¡æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦çš„è¯ç”Ÿæˆç±»å¯¹è±¡å†è¿”å›ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œåœ¨è€ƒè™‘å¤šçº¿ç¨‹æ—¶ï¼Œç”±äº java ä»£ç æ˜¯ä¸€è¡Œè¡Œè¿›è¡Œçš„ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ t1ã€t2ï¼Œå½“ as ä¸º null çš„æ—¶å€™ t1 æ‰§è¡Œåˆ° tag1 ä½ç½®ï¼Œåˆ¤æ–­ä¸º trueï¼Œäºæ˜¯å‡†å¤‡æ‰§è¡Œ tag2ï¼Œå°±åœ¨æ­¤æ—¶ï¼Œcup è°ƒåº¦ t2 å¼€å§‹æ‰§è¡Œ tag1ï¼Œæ­¤æ—¶ t1 å°šæœªæ‰§è¡Œ tag2ï¼Œæ‰€ä»¥åœ¨ t2 ä¸­ tag1 åˆ¤æ–­ä¸º true,t2 ä¹Ÿå¼€å§‹æ‰§è¡Œ tag2 ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡,è¿™æ ·å½“ t1 å†æ¬¡æ‰§è¡Œ tag2 æ—¶å°±ä¼šå†ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™æ ·å°±åŒæ—¶å­˜åœ¨å¤šä¸ªç±»çš„å¯¹è±¡ã€‚</p>
<h2> 2.åŒæ­¥é”</h2>
<p>å¯¹ä¸Šé¢çš„ä»£ç ç¨ä½œä¼˜åŒ–,å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº† synchronizedï¼Œå¯¹åˆ¤æ–­æ˜¯å¦éœ€è¦åˆå§‹åŒ–è¿›è¡Œäº†åŒæ­¥é”ï¼Œè¿™æ ·å½“çº¿ç¨‹ t1 è®¿é—®æ—¶ï¼Œè¯­å¥è¢«é”å®šï¼Œt2 è¿è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œåªèƒ½ç­‰ t1 è¿è¡Œå®Œè¿™æ®µè¯­å¥å¹¶é‡Šæ”¾ä¹‹åï¼Œæ‰èƒ½ç»§ç»­è®¿é—®ï¼Œæ­¤æ—¶ as å·²ç»è¢«èµ‹äºˆäº†å¯¹è±¡ï¼Œæ‰€ä»¥ä¸ä¼šå†ç»§ç»­æ–°å»ºï¼Œè¿™æ ·å°±ä¿è¯äº†å•ä¾‹ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯è¿™æ ·ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªçº¿ç¨‹æ¯æ¬¡è·å–å•ä¾‹éƒ½è¦è¿›å…¥åŒæ­¥é”ï¼Œè¿™æ ·ç´¯è®¡ä¸‹æ¥å¿…ç„¶å½±å“æ•ˆç‡ã€‚</p>
<h2> 3.åŒé‡æ£€æŸ¥é”å®š</h2>
<p>é‚£ä¹ˆåœ¨åˆ¤æ–­ as ä¸º null åï¼Œå¯¹ as çš„åˆå§‹åŒ–è¿›è¡ŒåŒæ­¥é”å‘¢ï¼Ÿ</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·å­ï¼Œå½“åˆ¤æ–­ as ä¸º null æ—¶ï¼Œæ‰ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼ŒåŒæ—¶ç”±äºåˆå§‹åŒ–è¿‡ç¨‹åŠ é”ï¼Œæ‰€ä»¥ t1 å’Œ t2 æ— æ³•åŒæ—¶è®¿é—®åˆå§‹åŒ–è¯­å¥ tag2ï¼Œä¹Ÿä¿è¯äº†åªèƒ½åˆ›å»ºä¸€ä¸ªå•ä¾‹ã€‚</p>
<p>çœ‹èµ·æ¥å¾ˆå®Œç¾ï¼Œä½†æ˜¯ç”±äº java è¯­è¨€çš„ç‰¹æ€§ï¼Œåœ¨è¯¥æ®µä»£ç ç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€æ—¶ï¼Œä¸Šè¿°æ–¹æ³•ä¼šè¢«ç¼–è¯‘ä¸ºç±»ä¼¼ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p>
<div class="language-c line-numbers-mode" data-ext="c"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆï¼Œå½“ t1 æ‰§è¡Œåˆ°è¯­å¥ 2ï¼Œè€Œ t2 å¼€å§‹æ‰§è¡Œè¯­å¥ 1 æ—¶ï¼Œæ­¤æ—¶ç”±äº as å·²ç»åˆ†é…äº†å†…å­˜ä¸ä¸º nullï¼Œæ‰€ä»¥ t2 ç›´æ¥æ‰§è¡Œè¯­å¥ 4ï¼Œæ­¤æ—¶ t2 è·å–åˆ°çš„æ˜¯ä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œæ„é€ æ–¹æ³•çš„ ASingleton å¯¹è±¡ï¼Œæ˜¾ç„¶è¿™æ ·ååˆ†å±é™©ã€‚åœ¨çº¿ç¨‹å¤æ‚çš„æƒ…å†µä¸‹å¾ˆå®¹æ˜“å‡ºç°é—®é¢˜ã€‚</p>
<p>ä¸‹é¢æä¾›äº†ä¸¤ä¸ªç»“å±€æ€è·¯ï¼Œä¸ºç®€ä¾¿èµ·è§ï¼Œå°†å…¶ç®€å•åˆ†ä¸ºâ€œé¥¿æ±‰æ¨¡å¼â€å’Œâ€œæ‡’æ±‰æ¨¡å¼â€ï¼ˆå…¶å®ä¸Šè¿°æ–¹æ³•ä¹Ÿå¯åˆ†ä¸ºè¿™ä¸¤ä¸ªæ¨¡å¼ï¼Œbutï¼Œwho cares...ï¼‰ã€‚</p>
<h2> 4.é¥¿æ±‰æ¨¡å¼å®ç°å•ä¾‹</h2>
<p>é¥¿æ±‰æ¨¡å¼ï¼Œå³åœ¨å£°æ˜çš„æ—¶å€™å°±å°†å¯¹è±¡åˆå§‹åŒ–ã€‚</p>
<p>è¿™æ ·å®ç°å•ä¾‹çš„åŸç†æ˜¯ç±»çš„é™æ€å˜é‡å…¨å±€å”¯ä¸€ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯è¿™æ ·ä»ç„¶æœ‰ä¸ªé—®é¢˜ï¼Œå¯èƒ½åœ¨ç”¨åˆ° ASingleton ç±»çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦ç«‹å³è·å–åˆ°å…¶å•ä¾‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¥¿æ±‰æ¨¡å¼ä»ç„¶æœ‰æµªè´¹èµ„æºçš„å«Œç–‘ã€‚</p>
<h2> 5.æ‡’æ±‰æ¨¡å¼å®ç°å•ä¾‹</h2>
<p>æ‡’æ±‰æ¨¡å¼ï¼Œåªæœ‰è¦ç”¨åˆ°è¯¥å®ä¾‹æ—¶ï¼Œæ‰è·å–è¯¥å•ä¾‹ã€‚</p>
<p>è¿™æ¬¡æˆ‘ä»¬ç”¨åˆ°çš„æ—¶é™æ€å†…éƒ¨ç±»ï¼Œé™æ€å†…éƒ¨ç±»ä¸ç±»çš„é™æ€å˜é‡ä¸åŒï¼Œåªæœ‰æ˜ç¡®è°ƒç”¨é™æ€å†…éƒ¨ç±»çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–é™æ€å†…éƒ¨ç±»ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å—¯ï¼Œè‡³æ­¤å·²ç»å®Œæˆäº† java å®ç°å•ä¾‹çš„ç»å¤§éƒ¨åˆ†æ–¹æ³•ï¼Œä½†å…¶å®è¿˜æœ‰ä¸€å¼ æ›´åŠ ç®€æ´çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ç”¨ enmu å®ç°ã€‚</p>
<h2> 6.enmu å®ç°å•ä¾‹</h2>
<p>ç”±äºæšä¸¾ç±»å‹çš„å¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æ˜¯å®ç°å•ä¾‹çš„è¾ƒä¼˜é€‰æ‹©ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œandroid å¼€å‘è€…è¦æ³¨æ„ï¼Œæšä¸¾å ç”¨çš„å†…å­˜æ˜¯æ™®é€šå•ä¾‹çš„ä¸¤å€å¤šï¼Œæ‰€ä»¥ï¼Œå¹¶ä¸æ¨èåœ¨ android ä¸­ä½¿ç”¨ã€‚</p>
<p>å…³äºæšä¸¾çš„æ›´è¯¦ç»†èµ„æ–™ï¼Œå‚é˜…(æ·±å…¥ç†è§£ Java æšä¸¾ç±»å‹(enum))[<a href="http://blog.csdn.net/javazejian/article/details/71333103#t7" target="_blank" rel="noopener noreferrer">http://blog.csdn.net/javazejian/article/details/71333103#t7</a>]</p>
]]></content:encoded>
    </item>
    <item>
      <title>Java åå°„ç®€å•åº”ç”¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/3e9e8cb1.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/3e9e8cb1.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java åå°„ç®€å•åº”ç”¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 16 Jan 2018 13:28:57 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€ä»‹</h2>
<p>åå°„ï¼Œç”¨æ¥åœ¨è¿è¡Œæ—¶è·å–ç»™å®šç±»çš„æ„é€ å‡½æ•°ï¼Œå˜é‡ï¼Œæ–¹æ³•ï¼Œå¹¶å¯¹å…¶ä½œä»¥ä¿®æ”¹ï¼Œè€Œä¸å¿…åœ¨ç¼–è¯‘æ—¶è·å–è¯¥ç±»ã€‚</p>
<blockquote>
<p>Reflection allows programmatic access to information about the fields, methods and constructors of loaded classes, and the use of reflected fields, methods, and constructors to operate on their underlying counterparts, within security restrictions.</p>
<p>--<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/package-summary.html" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/package-summary.html</a></p>
</blockquote>
<h2> ç®€å•ä½¿ç”¨</h2>
<p>å®šä¹‰ä¸€ä¸ªå¾…åå°„çš„ç±» ATestClass.java</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ TestReflect.java ä¸­åå°„</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å°ç»“</h2>
<p>åå°„çš„ç”¨æ³•è¾ƒä¸ºç®€å•</p>
<ul>
<li>é€šè¿‡<code>Class.froName()</code> è·å– Class å¯¹è±¡<code>clazz</code> ï¼Œè·å–è¦åå°„çš„ Class å¯¹è±¡<code>aTestClsObj</code></li>
<li>é€šè¿‡<code>clazz</code> è·å–è¦åå°„ Class çš„å˜é‡ã€æ–¹æ³•</li>
<li>é€šè¿‡<code>aTestClsObj</code> æ“ä½œè¿™äº›å˜é‡ï¼Œæ–¹æ³•</li>
</ul>
<p>å…¶ä¸­éœ€è¦æ³¨æ„çš„æœ‰</p>
<ul>
<li><code>f.setAccessible(true);</code> æ–¹æ³•å¯ä»¥è§£é™¤<code>private</code> é™åˆ¶ï¼Œè¿›è€Œå¯ä»¥æ“ä½œç±»çš„ç§æœ‰å˜é‡ï¼Œæ–¹æ³•</li>
<li><code>clazz.getXXX()</code> æ–¹æ³•è·å–<strong>å…¨éƒ¨å…¬æœ‰</strong>å˜é‡ã€æ–¹æ³•ï¼Œ<strong>åŒ…æ‹¬çˆ¶ç±»æˆ–æ¥å£</strong>çš„ xxï¼Œ<code>clazz.getDeclaredXXX()</code> æ–¹æ³•è·å–<strong>å…¨éƒ¨</strong> å˜é‡ã€æ–¹æ³•ï¼ŒåŒ…æ‹¬ç§æœ‰çš„ï¼Œå®ç°æ¥å£çš„æ–¹æ³•ï¼Œ<strong>ä½†æ˜¯ä¸åŒ…æ‹¬çˆ¶ç±»çš„</strong></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Java å®ç° AES åŠ å¯†è§£å¯†åº”ç”¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/375fcf66.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/375fcf66.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java å®ç° AES åŠ å¯†è§£å¯†åº”ç”¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 22 Jan 2018 15:51:19 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€ä»‹</h2>
<p>æœ€è¿‘æ‰‹æœºä¸­æ¶‰åŠåˆ°ç”¨æˆ·è´¦æˆ·å¯†ç ä¿å­˜çš„é—®é¢˜ï¼Œé€‰ç”¨ AES åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†åï¼Œå†é€šè¿‡ SharedPreferences ä¿å­˜åœ¨æ‰‹æœºç«¯ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç» AES çš„åŠ å¯†ã€è§£å¯†ç”¨æ³•ã€‚</p>
<h2> ä»£ç </h2>
<p>åˆå§‹åŒ–ç§˜é’¥</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŠ å¯†</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£å¯†</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŠ å¯†å’Œè§£å¯†çš„ç»“æœéƒ½æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ— æ³•ç›´æ¥è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿˜éœ€è¦å°†äºŒè¿›åˆ¶ä¸åå…­è¿›åˆ¶äº’è½¬</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·å°±å¯ä»¥åœ¨åˆå§‹åŒ–ä¸€ä¸ª key åï¼Œå¯¹æ–‡æœ¬è¿›è¡ŒåŠ å¯†å’Œè§£å¯†</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒæ–‡çŒ®</h2>
<p><a href="http://blog.csdn.net/hbcui1984/article/details/5201247" target="_blank" rel="noopener noreferrer">JAVA å®ç° AES åŠ å¯† - CSDN åšå®¢</a></p>
<p><a href="https://github.com/jixiaoyong/AndroidNote/tree/master/code/2018-1-22/encryption" target="_blank" rel="noopener noreferrer">æºç  github é“¾æ¥</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Java å¹¶å‘ç¼–ç¨‹ç¬”è®°</title>
      <link>https://jixiaoyong.github.io/blog/posts/b4abf652.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/b4abf652.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java å¹¶å‘ç¼–ç¨‹ç¬”è®°</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 28 Oct 2019 10:26:46 GMT</pubDate>
      <content:encoded><![CDATA[<h2> Thread.join()</h2>
<p><code>cThread.join()</code>æ–¹æ³•ä½¿å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°å­çº¿ç¨‹<code>cThread</code>æ‰§è¡Œå®Œæ¯•åï¼Œå½“å‰çº¿ç¨‹æ‰ä¼šæ¢å¤è¿è¡Œã€‚</p>
<p>å®ç°åŸç†ï¼š</p>
<ol>
<li>
<p><code> join()</code>æ–¹æ³•è°ƒç”¨äº†<code>join(0)</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><code> join(long millis)</code>æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œæœ€åä¼šé€šè¿‡è°ƒç”¨<code>wait()</code>æ–¹æ³•æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼ˆå³<code>è°ƒç”¨çº¿ç¨‹</code>ï¼‰ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨å­çº¿ç¨‹<code>cThread</code>çš„<code>notify()</code>æˆ–è€…<code>notifyAll()</code>æ–¹æ³•</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>å­çº¿ç¨‹<code>run()</code>æ‰§è¡Œå®Œæ¯•åï¼Œç³»ç»Ÿåœ¨å…³é—­è¯¥å­çº¿ç¨‹å‰ï¼Œä¼šè°ƒç”¨å…¶<code>exit()</code>æ–¹æ³•ï¼Œç»§è€Œåœ¨<code>ThreadGroup.threadTerminated(Thread t)</code>ä¸­å”¤é†’è¢«é˜»å¡çš„è°ƒç”¨çº¿ç¨‹ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ol>
<h2> notify() å’Œ notifyAll() çš„åŒºåˆ«åŒºåˆ«</h2>
<p>å…ˆäº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼š</p>
<p><strong>é”æ± </strong>ï¼šæŸä¸ª<code>Thread</code>è°ƒç”¨æŸä¸ªå¯¹è±¡çš„åŒæ­¥æ–¹æ³•ï¼ˆ<code>synchronized</code>ï¼‰ï¼Œä½†è¿˜æ²¡è·å–åˆ°è¯¥å¯¹è±¡çš„é”æ—¶ï¼Œä¼šè¿›å…¥é”æ± å’Œå…¶ä»–ç±»ä¼¼çš„çº¿ç¨‹ä¸€èµ·ç«äº‰è¯¥å¯¹è±¡çš„é”ã€‚</p>
<p><strong>ç­‰å¾…æ± </strong>ï¼šå½“æŸä¸ª<code>Thread</code>è°ƒç”¨æŸä¸ªå¯¹è±¡çš„<code>wait()</code>æ–¹æ³•é‡Šæ”¾æ‰è¯¥å¯¹è±¡çš„é”è¿›å…¥é˜»å¡åï¼ˆwaiting on this object's monitorï¼‰ï¼Œä¼šè¿›å…¥ç­‰å¾…æ± ã€‚ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹ä¸ä¼šç«äº‰è¯¥å¯¹è±¡çš„é”ã€‚</p>
<p><code>notify()</code>æ–¹æ³•ä¼šä»ç­‰å¾…æ± ä¸­å”¤é†’ä¸€ä¸ªæŒ‡å®šçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å¯ä»¥å†æ¬¡å›åˆ°é”æ± ç«äº‰è¯¥å¯¹è±¡çš„é”ï¼Œ<strong>ä½†å¯èƒ½ä¼šå¯¼è‡´æ­»é”</strong>ï¼ˆå¦‚æœå”¯ä¸€å”¤é†’çš„çº¿ç¨‹é˜»å¡äº†å¹¶ä¾èµ–å…¶ä»–çº¿ç¨‹å”¤é†’ï¼Œä½†å…¶ä»–çº¿ç¨‹éƒ½åœ¨ç­‰å¾…æ± æ— æ³•ç«äº‰é”ï¼Œå¯¼è‡´æ­»é”ï¼‰ã€‚</p>
<p><code>notifyAll()</code>æ–¹æ³•åˆ™ä¼šå”¤é†’æ‰€æœ‰åœ¨ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹ï¼Œä¹‹åä»–ä»¬éƒ½å¯ä»¥å›åˆ°é”æ± ç«äº‰è¯¥å¯¹è±¡çš„é”ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://juejin.im/post/5b3054c66fb9a00e4d53ef75#heading-2" target="_blank" rel="noopener noreferrer">Java Thread çš„ join() ä¹‹åˆ¨æ ¹é—®åº•</a></p>
<p><a href="https://www.zhihu.com/question/37601861/answer/145545371" target="_blank" rel="noopener noreferrer">java ä¸­çš„ notify å’Œ notifyAll æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ - å¤§ç‹å«æˆ‘æ¥å·¡å±±çš„å›ç­” - çŸ¥ä¹</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Java æ³¨è§£</title>
      <link>https://jixiaoyong.github.io/blog/posts/3f6454bb.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/3f6454bb.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java æ³¨è§£</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 21 Jan 2018 12:53:07 GMT</pubDate>
      <content:encoded><![CDATA[<p>æ³¨è§£ï¼Œ<em>æ˜¯æè¿° Java ä»£ç çš„ä»£ç ï¼Œå®ƒèƒ½å¤Ÿè¢«ç¼–è¯‘å™¨è§£æï¼Œå‘ç¼–è¯‘å™¨ã€è™šæ‹Ÿæœºè¯´æ˜ä¸€äº›äº‹æƒ…ï¼Œå°±åƒ java ä¸­ç»™ç¨‹åºå‘˜çœ‹çš„æ³¨é‡Šä¸€æ ·</em>ã€‚</p>
<p>Android åº”ç”¨å¼€å‘è¿™æ–¹é¢æ¯”è¾ƒç«çš„æ˜¯<a href="http://jakewharton.github.io/butterknife/" target="_blank" rel="noopener noreferrer">Butter Knife</a> ,æœ¬æ–‡è®²è¿°å¦‚ä½•è‡ªå®šä¹‰æ³¨è§£æ›¿æ¢ findViewById()ã€‚</p>
<p>å®ç°<strong>æ³¨è§£ï¼ˆannotationï¼‰<strong>çš„æ€è·¯ï¼šé€šè¿‡</strong>åå°„</strong>è·å–åˆ°ç±»ä¸­ä½¿ç”¨æ³¨è§£çš„å˜é‡ï¼Œæ–¹æ³•ï¼Œå†è°ƒç”¨ä¸åŒçš„æ–¹æ³•å¯¹è¿™äº›å˜é‡ï¼Œæ–¹æ³•è¿›è¡Œå¤„ç†ä»¥è¾¾åˆ°ç›®çš„ã€‚</p>
<p>ä¸»è¦æ¶‰åŠä¸‰æ–¹é¢ï¼š</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªæ³¨è§£ç±»</li>
<li>å®šä¹‰ä¸€ä¸ªæ³¨è§£å¸®åŠ©ç±»</li>
<li>ä½¿ç”¨æ³¨è§£</li>
</ul>
<h2> java å…ƒæ³¨è§£</h2>
<p>java è¯­è¨€æœ‰å››ä¸ªé¢„ç•™çš„æ³¨è§£ï¼Œç”¨æ¥ç”Ÿæˆå…¶ä»–è‡ªå®šä¹‰çš„æ³¨è§£ï¼š</p>
<ul>
<li>@Target</li>
</ul>
<p>è¯´æ˜æ³¨è§£æ‰€èƒ½ä¿®é¥°çš„èŒƒå›´ã€‚å…¶å€¼ä¸€èˆ¬ä¸º <a href="http://ElementType.xxx" target="_blank" rel="noopener noreferrer">ElementType.xxx</a>ï¼Œä¸»è¦æœ‰ï¼š</p>
<ol>
<li>CONSTRUCTOR æè¿°æ„é€ å™¨</li>
<li>FIELD æè¿°åŸŸ</li>
<li>LOCAL_VARIABLE æè¿°å±€éƒ¨å˜é‡</li>
<li>METHOD æè¿°æ–¹æ³•</li>
<li>PACKAGE æè¿°åŒ…</li>
<li>PARAMETER æè¿°å‚æ•°</li>
<li>TYPE æè¿°ç±»ï¼Œæ¥å£ï¼Œenum å£°æ˜</li>
</ol>
<ul>
<li>@Retention</li>
</ul>
<p>è¯´æ˜æ³¨è§£å­˜æ´»çš„ç”Ÿå‘½å‘¨æœŸï¼Œå…¶å€¼ä¸€èˆ¬ä¸º <a href="http://RetentionPolicy.xxx" target="_blank" rel="noopener noreferrer">RetentionPolicy.xxx</a>ï¼Œä¸»è¦æœ‰</p>
<ol>
<li>SOURCE ä»…æºæ–‡ä»¶æœ‰æ•ˆï¼Œè¢«ç¼–è¯‘å™¨ä¸¢å¼ƒ</li>
<li>CLASS åœ¨ class æ–‡ä»¶ä¸­æœ‰æ•ˆï¼Œå¯èƒ½è¢«è™šæ‹Ÿæœºå¿½ç•¥</li>
<li>RUNTIME åœ¨è¿è¡Œæ—¶æœ‰æ•ˆï¼Œåœ¨ class è¢«è£…è½½æ—¶è¢«è·å–</li>
</ol>
<ul>
<li>@Documented</li>
</ul>
<blockquote>
<p>ç”¨äºæè¿°å…¶å®ƒç±»å‹çš„ annotation åº”è¯¥è¢«ä½œä¸ºè¢«æ ‡æ³¨çš„ç¨‹åºæˆå‘˜çš„å…¬å…± API</p>
</blockquote>
<p>è¡¨ç¤ºæ˜¯å¦å°†æ³¨è§£ä¿¡æ¯æ·»åŠ åœ¨ java æ–‡æ¡£ä¸­ã€‚æœ‰è¯¥æ³¨è§£åˆ™ä¼šè¢« Javadoc å·¥å…·æ–‡æ¡£åŒ–</p>
<p>æ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ï¼Œæ²¡æœ‰å€¼</p>
<ul>
<li>@Inherited</li>
</ul>
<p>è¡¨ç¤ºè¯¥æ ‡è®°ä¼šè¢«æ ‡è®°çš„ class çš„å­ç±»ç»§æ‰¿ï¼Œåœ¨æŸ¥æ‰¾è¯¥æ³¨è§£æ—¶ï¼Œå¦‚æœå½“å‰ç±»æ²¡æœ‰ï¼Œä¼šè‡ªåŠ¨å‘ä¸Šåˆ°å…¶çˆ¶ç±»ä¸­æŸ¥æ‰¾ï¼Œç›´åˆ°<em>è¯¥æ³¨è§£ç±»å‹è¢«æ‰¾åˆ°æˆ–æ˜¯æŸ¥æ‰¾å®Œäº† Object ç±»è¿˜æœªæ‰¾åˆ°</em></p>
<p>æ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ï¼Œæ²¡æœ‰å€¼</p>
<p><strong>æ³¨è§£ä¸èƒ½ç»§æ‰¿å…¶ä»–æ³¨è§£æˆ–æ¥å£</strong></p>
<h2> å†…å»ºæ³¨è§£</h2>
<p>java ä¸­å¸¸è§çš„å†…å»ºæ³¨è§£ï¼š</p>
<ul>
<li><code>@Override</code> é‡å†™çˆ¶ç±»æ–¹æ³•</li>
<li><code>@Deprecated</code> ä¸èµæˆä½¿ç”¨çš„ api</li>
<li><code>@SuppressWarnings() </code> å¿½ç•¥æŒ‡å®šè­¦å‘Š</li>
</ul>
<p>å‚æ•°å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>deprecation</td>
<td>ä½¿ç”¨äº†è¿‡æ—¶çš„ç±»æˆ–æ–¹æ³•æ—¶çš„è­¦å‘Š</td>
</tr>
<tr>
<td>unchecked</td>
<td>æ‰§è¡Œäº†æœªæ£€æŸ¥çš„è½¬æ¢æ—¶çš„è­¦å‘Š</td>
</tr>
<tr>
<td>fallthrough</td>
<td>å½“ Switch ç¨‹åºå—è¿›å…¥è¿›å…¥ä¸‹ä¸€ä¸ª case è€Œæ²¡æœ‰ Break æ—¶çš„è­¦å‘Š</td>
</tr>
<tr>
<td>path</td>
<td>åœ¨ç±»è·¯å¾„ã€æºæ–‡ä»¶è·¯å¾„ç­‰æœ‰ä¸å­˜åœ¨è·¯å¾„æ—¶çš„è­¦å‘Š</td>
</tr>
<tr>
<td>serial</td>
<td>å½“å¯åºåˆ—åŒ–çš„ç±»ç¼ºå°‘ serialVersionUID å®šä¹‰æ—¶çš„è­¦å‘Š</td>
</tr>
<tr>
<td>finally</td>
<td>ä»»æ„ finally å­å¥ä¸èƒ½æ­£å¸¸å®Œæˆæ—¶çš„è­¦å‘Š</td>
</tr>
<tr>
<td>all</td>
<td>ä»¥ä¸Šæ‰€æœ‰æƒ…å†µçš„è­¦å‘Š</td>
</tr>
</tbody>
</table>
<h2> è‡ªå®šä¹‰æ³¨è§£</h2>
<h3> æ³¨è§£ç±»</h3>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>æ³¨è§£å‚æ•°æ”¯æŒæ•°æ®ç±»å‹å¦‚ä¸‹ï¼š</p>
<p>1.æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆint,float,boolean,byte,double,char,long,short)<br>
2.String ç±»å‹<br>
3.Class ç±»å‹<br>
4.enum ç±»å‹<br>
5.Annotation ç±»å‹ 6.ä»¥ä¸Šæ‰€æœ‰ç±»å‹çš„æ•°ç»„</p>
</blockquote>
<h3> æ³¨è§£å¸®åŠ©ç±»</h3>
<p>ä¸»è¦æä¾›ä½¿ç”¨æ³¨è§£çš„æ–¹æ³•ï¼Œä»£ç ä¸­çš„æ³¨è§£æ›¿æ¢ä¸ºçœŸæ­£è¦å®ç°çš„é€»è¾‘ï¼Œä¸ºæ³¨è§£å’Œä½¿ç”¨æ³¨è§£çš„ç±»æ­å»ºä¸€ä¸ªæ¡¥æ¢ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ä½¿ç”¨æ³¨è§£</h3>
<p>åœ¨ç±»ä¸­é€šè¿‡<code>@xxx()</code> ä½¿ç”¨æ³¨è§£ï¼Œå¹¶é€šè¿‡å¸®åŠ©ç±»çœŸæ­£å®ç°æ³¨è§£é€»è¾‘</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒæ–‡ç« </h2>
<ul>
<li><a href="http://www.importnew.com/23816.html" target="_blank" rel="noopener noreferrer">Java æ ¸å¿ƒæŠ€æœ¯ç‚¹ä¹‹æ³¨è§£ - ImportNew</a></li>
<li><a href="http://gityuan.com/2016/01/23/java-annotation/" target="_blank" rel="noopener noreferrer">java æ³¨è§£--gityuan</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Java ç¬”è®°ä¹‹ YYYY æ ¼å¼åŒ–æ—¥æœŸ</title>
      <link>https://jixiaoyong.github.io/blog/posts/87a89a43.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/87a89a43.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java ç¬”è®°ä¹‹ YYYY æ ¼å¼åŒ–æ—¥æœŸ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 07 Jan 2020 03:38:54 GMT</pubDate>
      <content:encoded><![CDATA[<p>æœ€è¿‘çœ‹åˆ°ä¸€ä¸ª<a href="https://v2ex.com/t/633650?p=1" target="_blank" rel="noopener noreferrer">å¸–å­</a>ï¼Œè¡¨ç¤ºæœ‰äººä»¥<code>"YYYY-MM-dd"</code>æ ¼å¼åŒ–æ—¥æœŸæ—¶ï¼Œåœ¨<code>2019-12-30</code>æ—¶å‡ºç°<code>2020-12-30</code>çš„ BUGã€‚</p>
<p>æœ¬æ–‡æ¥ç®€å•åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæƒ…å†µã€‚</p>
<p>æ ¹æ®<a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#year" target="_blank" rel="noopener noreferrer">JDK æ–‡æ¡£å…³äºæ—¥æœŸçš„å®šä¹‰</a>ï¼Œ<code>y</code>è¡¨ç¤ºçš„æ˜¯æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„å¹´ä»½ï¼Œè€Œ<code>Y</code>è¡¨ç¤ºçš„æ˜¯<code>Week year</code>ã€‚</p>
<p>å…ˆäº†è§£å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š</p>
<h2> Week year</h2>
<p><code>Week year</code>è¡¨ç¤ºçš„æ˜¯<strong>è¿™ä¸ªå‘¨æ‰€å±çš„å¹´ä»½</strong>ã€‚</p>
<blockquote>
<p>A <em>week year</em> is in sync with a <code>WEEK_OF_YEAR</code> cycle. All weeks between the first and last weeks (inclusive) have the same <em>week year</em> value. Therefore, the first and last days of a week year may have different calendar year values.</p>
<p>æ¥æºï¼š<a href="https://docs.oracle.com/javase/7/docs/api/java/util/GregorianCalendar.html#week_year" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/7/docs/api/java/util/GregorianCalendar.html#week_year</a></p>
</blockquote>
<h2> WEAK_OF_YEAR</h2>
<p>æŒ‡çš„æ˜¯è¿™ä¸€å¹´æ‰€æœ‰çš„å‘¨ï¼Œä»ç¬¬ 01 å‘¨å¼€å§‹åˆ°è¯¥å¹´æœ€åä¸€å‘¨ã€‚</p>
<p>è¦æ³¨æ„è¿™ä¸ªå‘¨ä¸ä¸€å®šæ˜¯è‡ªç„¶å‘¨ï¼Œæ‰€åŒ…å«çš„æ—¥æœŸä¹Ÿä¸ä¸€å®šå…¨éƒ¨éƒ½æ˜¯å½“å¹´çš„æ—¥æœŸã€‚</p>
<blockquote>
<p>Values calculated for the <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Calendar.html#WEEK_OF_YEAR" target="_blank" rel="noopener noreferrer"><code>WEEK_OF_YEAR</code></a> field range from 1 to 53. The first week of a calendar year is the earliest seven day period starting on <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Calendar.html#getFirstDayOfWeek()" target="_blank" rel="noopener noreferrer"><code>getFirstDayOfWeek()</code></a> that contains at least <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Calendar.html#getMinimalDaysInFirstWeek()" target="_blank" rel="noopener noreferrer"><code>getMinimalDaysInFirstWeek()</code></a> days from that year.</p>
</blockquote>
<h2> ç¬¬ 01 å‘¨</h2>
<p>æ ¹æ®è¿™ä»½<a href="https://docs.oracle.com/javase/7/docs/api/java/util/GregorianCalendar.html#week_year" target="_blank" rel="noopener noreferrer">JDK æ–‡æ¡£</a>ï¼Œå½“ <code>getFirstDayOfWeek()</code> is <code>MONDAY</code>ï¼ˆ2ï¼‰ and <code>getMinimalDaysInFirstWeek()</code> is 4 æ—¶ï¼ŒJAVA åˆ¤æ–­å‘¨æ—¥æœŸçš„æ ‡å‡†ä¸<a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank" rel="noopener noreferrer">ISO_8601</a>å…¼å®¹ï¼š</p>
<blockquote>
<p>ç¬¬ 01 å‘¨æœ‰å‡ ä¸ªç›¸äº’ç­‰æ•ˆä¸”å…¼å®¹çš„æè¿°ï¼š</p>
<p>ä¸€å¹´ä¸­ç¬¬ä¸€ä¸ªæ˜ŸæœŸå››çš„æ˜ŸæœŸï¼ˆæ­£å¼çš„ ISO å®šä¹‰ï¼‰ï¼Œ</p>
<p>1 æœˆ 4 æ—¥è¿™ä¸€å‘¨ï¼Œ</p>
<p>èµ·å§‹å¹´ä»½ä¸­å¤§éƒ¨åˆ†ï¼ˆå››å¤©æˆ–ä»¥ä¸Šï¼‰çš„ç¬¬ä¸€å‘¨ï¼Œä»¥åŠ</p>
<p>ä» 12 æœˆ 29 æ—¥è‡³ 1 æœˆ 4 æ—¥çš„æ˜ŸæœŸä¸€å¼€å§‹çš„ä¸€å‘¨ã€‚</p>
<p>æ¥æºï¼š<a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/ISO_8601</a></p>
</blockquote>
<p>æŒ‰ç…§ JAVA æ–‡æ¡£ä¸­çš„å®šä¹‰ï¼Œæ¯å¹´æœ€å¼€å§‹çš„å‡ å¤©å’Œæœ€åçš„å‡ å¤©çš„<code>Week year</code>ä¸ä¸€å®šæ˜¯å½“å¹´çš„å¹´ä»½å€¼ï¼Œè€Œæ˜¯å—åˆ°æ¯å¹´çš„<em>ç¬¬ 01 å‘¨/æœ€åä¸€å‘¨</em>çš„å½±å“ã€‚</p>
<p>JAVA ä¸­åˆ¤æ–­å‘¨ä¸»è¦å—åˆ°<code>Calendar</code>å¯¹è±¡çš„<code>getFirstDayOfWeek()</code>å’Œ<code>getMinimalDaysInFirstWeek()</code>è¿™ä¸¤ä¸ªæœ¬åœ°å€¼çš„å½±å“ã€‚</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>getFirstDayOfWeek() </code>æŒ‡å®šä¸€å‘¨çš„ç¬¬ä¸€å¤©ï¼Œæ¯”å¦‚ï¼Œç¾å›½ä¸€å‘¨ä»<code>SUNDAY</code> å¼€å§‹ï¼Œæ³•å›½åˆ™æ˜¯<code>MONDAY</code> ã€‚</li>
<li><code>getMinimalDaysInFirstWeek()</code> ä¸€å¹´ç¬¬ä¸€å‘¨æ‰€éœ€æœ€å°çš„å¤©æ•°ã€‚æ¯”å¦‚ 1 è¡¨ç¤ºåªè¦åŒ…å«ç¬¬ä¸€å¤©å°±ç®—è¯¥å¹´çš„ç¬¬ä¸€å‘¨ï¼Œè€Œ 7 è¡¨ç¤ºåªæœ‰å®Œæ•´çš„ä¸€å‘¨éƒ½åœ¨è¯¥å¹´æ‰ç®—è¯¥å¹´çš„ç¬¬ä¸€å‘¨ã€‚</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šçœŸæ­£å½±å“æˆ‘ä»¬æ ¼å¼åŒ–æ—¥æœŸç»“æœçš„æ˜¯<code>SimpleDateFormat</code>ä¸­çš„<code>calendar</code>å¯¹è±¡å¯¹åº”çš„å€¼ã€‚</p>
<p>è€Œé€šè¿‡æ‰“å°è¿™ä¸ª<code>simpleDateFormat.calendar</code>ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥å¯ä»¥å¾—å‡ºç»“è®ºï¼ŒJAVA<strong>é»˜è®¤åªè¦æ¬¡å¹´çš„ 1 æœˆ 1 æ—¥åœ¨åœ¨è¿™ä¸ªè·¨å¹´å‘¨ï¼Œé‚£ä¹ˆæœ¬å‘¨æ‰€æœ‰æ—¥æœŸçš„<code>Week year</code>éƒ½æ˜¯æ¬¡å¹´çš„</strong>ï¼ˆ<code>JDK1.7</code>ï¼‰ã€‚</p>
<h2> é—®é¢˜åˆ†æ</h2>
<p>æœ‰äº†ä»¥ä¸ŠçŸ¥è¯†ï¼Œæˆ‘ä»¬å†çœ‹çœ‹<code>2019-12-30</code>ä»¥<code>YYYY</code>æ ¼å¼åŒ–ä¸ºä»€ä¹ˆä¼šå‡ºç°é—®é¢˜ï¼š</p>
<p>å…ˆçœ‹ä¸€ä¸‹è¿™äº›æ—¥æœŸå¯¹åº”çš„æ˜ŸæœŸï¼š</p>
<table>
<thead>
<tr>
<th>å‘¨æ—¥</th>
<th>å‘¨ä¸€</th>
<th>å‘¨äºŒ</th>
<th>å‘¨ä¸‰</th>
<th>å‘¨å››</th>
<th>å‘¨äº”</th>
<th>å‘¨å…­</th>
</tr>
</thead>
<tbody>
<tr>
<td>29</td>
<td>30</td>
<td>31</td>
<td><strong>1</strong></td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>é¦–å…ˆæ ¹æ® JDK é»˜è®¤çš„<code>ç¬¬01å‘¨</code>çš„å®šä¹‰ï¼Œ<code>2020-01-01</code>æ‰€åœ¨çš„å‘¨ä¸º<code>2020çš„ç¬¬ä¸€å‘¨</code>ï¼Œæ‰€ä»¥<code>2019-12-29åˆ°2020-01-04</code>éƒ½å±äºæ˜¯<code>2020å¹´çš„ç¬¬01å‘¨</code>ã€‚</p>
<p>å†æ ¹æ®<code>YYYY</code>è¡¨ç¤ºçš„æ˜¯<code>Week year</code>çš„ç»“è®ºï¼Œå¯ä»¥çŸ¥é“ï¼Œå½“ä½¿ç”¨<code>YYYY</code>æ ¼å¼åŒ–æ—¶ï¼Œ<code>2019-12-29åˆ°2020-01-04</code>éƒ½ä¼šå¾—åˆ°<code>2020</code>ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œå¦‚æœæˆ‘ä»¬æŠŠç¬¬ä¸€å‘¨æœ€å°å¤©æ•°<code>minimalDaysInFirstWeek</code>æ”¹ä¸º<code>5</code>å¤©ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™ä¸€å‘¨å±äº<code>2020</code>å¹´çš„å¤©æ•°ï¼ˆä»å‘¨æ—¥åˆ°å‘¨ä¸€ï¼Œåªæœ‰ 1 å·åˆ° 4 å· 4 å¤©ï¼‰ä¸å¤Ÿ 5 å¤©ï¼Œæ‰€ä»¥è¿™ä¸€å‘¨è¢«åˆ’å½’ä¸º<code>2019</code>å¹´çš„ç¬¬<code>53å‘¨</code>ï¼Œ<code>2019-12-29åˆ°2020-01-04</code>çš„<code>week year</code>éƒ½æ˜¯å±äº<code>2019</code>ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æ¯”å¦‚ä¸‹é¢è¿™ä¸ª<a href="https://blog.csdn.net/bewilderment/article/details/48391717" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹</a>ä¸­çš„<code>2010-12-26</code>ã€‚</p>
<figure><img src="https://img-blog.csdn.net/20150912103324519?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>æŒ‰ç…§<code>JDK1.7</code>é»˜è®¤ç®—æ³•ï¼Œä¸€å‘¨ä»å‘¨æ—¥ï¼ˆ<code>2010-12-26</code>ï¼‰å¼€å§‹ï¼Œå¹¶ä¸”å½“å¹´çš„ 1 æœˆ 1 æ—¥ï¼ˆ<code>2011-01-01</code>ï¼‰æ‰€åœ¨å‘¨ä¸ºè¯¥å¹´ç¬¬ä¸€å‘¨ï¼Œæ‰€ä»¥<code>2010-12-26åˆ°2011-01-01</code>éƒ½è¢«åˆ’åˆ°äº†<code>2011</code>å¹´çš„ç¬¬ä¸€å‘¨ã€‚</p>
<p>ä½†å¦‚æœæŒ‰ç…§<a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank" rel="noopener noreferrer">ISO_8601</a>çš„æ ‡å‡†ï¼Œä¸€å‘¨ä»å‘¨ä¸€å¼€å§‹ï¼Œå¹¶ä¸”èµ·å§‹å¹´ä»½åŒ…å«çš„å¤©æ•°è‡³å°‘è¦æœ‰<code>4</code>å¤©ï¼š</p>
<p>åˆ™å¾ˆæ˜æ˜¾<code>2010-12-26</code>å±äº<code>2010</code>å¹´çš„<code>51å‘¨</code>ï¼Œè€Œ<code>2010-12-27åˆ°2011-01-02</code>éƒ½å±äº<code>2010</code>å¹´çš„ç¬¬<code>52å‘¨</code>ï¼ˆå±äº 2020 å¹´çš„åªæœ‰ 2 å¤©ï¼Œä¸æ»¡è¶³ç¬¬ä¸€å‘¨çš„æ¡ä»¶ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>å‘¨ä¸€</th>
<th>å‘¨äºŒ</th>
<th>å‘¨ä¸‰</th>
<th>å‘¨å››</th>
<th>å‘¨äº”</th>
<th>å‘¨å…­</th>
<th>å‘¨æ—¥</th>
</tr>
</thead>
<tbody>
<tr>
<td>20</td>
<td>21</td>
<td>22</td>
<td>23</td>
<td>24</td>
<td>25</td>
<td>26</td>
</tr>
<tr>
<td>27</td>
<td>28</td>
<td>29</td>
<td>30</td>
<td>31</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
<h2> æ€»ç»“</h2>
<p>ç»“åˆä»¥ä¸Šç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ JAVA ä¸­ï¼ˆ<code>JDK1.7</code>ï¼‰ï¼š</p>
<ul>
<li>
<p><code>â€œYYYYâ€ </code>è¡¨ç¤º<code>Week year</code></p>
</li>
<li>
<p>æ¯å¹´æœ€å¼€å§‹çš„å‡ å¤©å’Œæœ€åçš„å‡ å¤©çš„<code>Week year</code>ä¸ä¸€å®šæ˜¯å½“å¹´çš„å€¼ï¼Œè€Œæ˜¯å—åˆ°å½“å¹´çš„ç¬¬ä¸€å‘¨/æœ€åä¸€å‘¨çš„å½±å“ã€‚</p>
</li>
<li>
<p>JAVA å‘¨çš„åˆ¤æ–­ä¸<code>simpleDateFormat.calendar.minimalDaysInFirstWeek</code>å’Œ<code>simpleDateFormat.calendar.firstDayOfWeek</code>æœ‰å…³ã€‚</p>
<p>è€Œè¿™ä¸¤ä¸ªå€¼éƒ½å±äºæœ¬åœ°åŒ–å€¼ï¼Œ<strong>åœ¨å›½å†…å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€å¹´ 1 æœˆ 1 æ—¥æ‰€åœ¨çš„å‘¨å°±æ˜¯å½“å¹´çš„ç¬¬ä¸€å‘¨ã€‚</strong></p>
</li>
<li>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹<code>minimalDaysInFirstWeek</code>å’Œ<code>firstDayOfWeek</code>æ¥æ›´æ”¹<code>YYYY</code>æ ¼å¼åŒ–çš„å€¼ã€‚</p>
</li>
</ul>
<h2> é™„å½•</h2>
<p>JDK ä¸­æ—¥æœŸæ ¼å¼åŒ–çš„å‚æ•°åŠå«ä¹‰ï¼ˆæ¥è‡ª <a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#month%EF%BC%89%EF%BC%9A" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#monthï¼‰ï¼š</a></p>
<table>
<thead>
<tr>
<th>Letter</th>
<th>Date or Time Component</th>
<th>Presentation</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>G</code></td>
<td>Era designator</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#text" target="_blank" rel="noopener noreferrer">Text</a></td>
<td><code>AD</code></td>
</tr>
<tr>
<td><code>y</code></td>
<td>Year</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#year" target="_blank" rel="noopener noreferrer">Year</a></td>
<td><code>1996</code>; <code>96</code></td>
</tr>
<tr>
<td><code>Y</code></td>
<td>Week year</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#year" target="_blank" rel="noopener noreferrer">Year</a></td>
<td><code>2009</code>; <code>09</code></td>
</tr>
<tr>
<td><code>M</code></td>
<td>Month in year</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#month" target="_blank" rel="noopener noreferrer">Month</a></td>
<td><code>July</code>; <code>Jul</code>; <code>07</code></td>
</tr>
<tr>
<td><code>w</code></td>
<td>Week in year</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>27</code></td>
</tr>
<tr>
<td><code>W</code></td>
<td>Week in month</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>D</code></td>
<td>Day in year</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>189</code></td>
</tr>
<tr>
<td><code>d</code></td>
<td>Day in month</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>10</code></td>
</tr>
<tr>
<td><code>F</code></td>
<td>Day of week in month</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>E</code></td>
<td>Day name in week</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#text" target="_blank" rel="noopener noreferrer">Text</a></td>
<td><code>Tuesday</code>; <code>Tue</code></td>
</tr>
<tr>
<td><code>u</code></td>
<td>Day number of week (1 = Monday, ..., 7 = Sunday)</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>a</code></td>
<td>Am/pm marker</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#text" target="_blank" rel="noopener noreferrer">Text</a></td>
<td><code>PM</code></td>
</tr>
<tr>
<td><code>H</code></td>
<td>Hour in day (0-23)</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>k</code></td>
<td>Hour in day (1-24)</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>24</code></td>
</tr>
<tr>
<td><code>K</code></td>
<td>Hour in am/pm (0-11)</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>h</code></td>
<td>Hour in am/pm (1-12)</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>12</code></td>
</tr>
<tr>
<td><code>m</code></td>
<td>Minute in hour</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>30</code></td>
</tr>
<tr>
<td><code>s</code></td>
<td>Second in minute</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>55</code></td>
</tr>
<tr>
<td><code>S</code></td>
<td>Millisecond</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#number" target="_blank" rel="noopener noreferrer">Number</a></td>
<td><code>978</code></td>
</tr>
<tr>
<td><code>z</code></td>
<td>Time zone</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#timezone" target="_blank" rel="noopener noreferrer">General time zone</a></td>
<td><code>Pacific Standard Time</code>; <code>PST</code>; <code>GMT-08:00</code></td>
</tr>
<tr>
<td><code>Z</code></td>
<td>Time zone</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#rfc822timezone" target="_blank" rel="noopener noreferrer">RFC 822 time zone</a></td>
<td><code>-0800</code></td>
</tr>
<tr>
<td><code>X</code></td>
<td>Time zone</td>
<td><a href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html#iso8601timezone" target="_blank" rel="noopener noreferrer">ISO 8601 time zone</a></td>
<td><code>-08</code>; <code>-0800</code>; <code>-08:00</code></td>
</tr>
</tbody>
</table>
<h2> å‚è€ƒèµ„æ–™</h2>
<p>æ„Ÿè°¢è¿™ç¯‡æ–‡ç« ï¼Œè®©æˆ‘æ¨ç¿»äº†ä¸Šä¸€æ¬¡çš„ç»“è®ºï¼Œå‘ç°äº†çœŸæ­£çš„åŸå› ï¼š<a href="https://blog.csdn.net/bewilderment/article/details/48391717" target="_blank" rel="noopener noreferrer">JAVA ä¸­çš„ SimpleDateFormat yyyy å’Œ YYYY çš„åŒºåˆ«</a></p>
<p><a href="https://docs.oracle.com/javase/7/docs/api/java/util/GregorianCalendar.html#week_year" target="_blank" rel="noopener noreferrer">GregorianCalenda jdk1.7</a></p>
<p>åœ¨çº¿æ˜¾ç¤ºæœ¬å‘¨æ˜¯ä¸€å¹´ç¬¬å‡ å‘¨çš„ç½‘ç«™ï¼š<a href="https://www.epochconverter.com/weeknumbers" target="_blank" rel="noopener noreferrer">What's the Current Week Number?</a></p>
]]></content:encoded>
      <enclosure url="https://img-blog.csdn.net/20150912103324519?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" type="image/"/>
    </item>
    <item>
      <title>Java ç¬”è®°ä¹‹åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼šSerializableã€Externalizable å’Œ Parcelable</title>
      <link>https://jixiaoyong.github.io/blog/posts/9d9183ec.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/9d9183ec.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java ç¬”è®°ä¹‹åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼šSerializableã€Externalizable å’Œ Parcelable</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 24 Dec 2019 01:38:59 GMT</pubDate>
      <content:encoded><![CDATA[<img src="https://images.pexels.com/photos/2881229/pexels-photo-2881229.jpeg?cs=srgb&amp;dl=white-and-blue-cables-2881229.jpg&amp;fm=jpg" class="full-image">
<p>Photo by <a href="https://www.pexels.com/@pixabay?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" target="_blank" rel="noopener noreferrer">Pixabay </a> from <a href="https://www.pexels.com/photo/close-up-of-telephone-booth-257736/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" target="_blank" rel="noopener noreferrer">Pexels</a></p>
<p><strong>åºåˆ—åŒ–</strong>ï¼šæŒ‡å°†<code>Javaå¯¹è±¡</code>è½¬åŒ–ä¸º<code>å­—èŠ‚æµ</code>ä»¥ä¾¿åœ¨ç½‘ç»œã€æ–‡ä»¶ä¸­ä¿å­˜ã€ä¼ è¾“ã€‚</p>
<p><strong>ååºåˆ—åŒ–</strong>ï¼šæŒ‡çš„æ˜¯ä»<code>å­—èŠ‚æµ</code>ä¸­æ¢å¤<code>Javaå¯¹è±¡</code>ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦è®¨è®º Android å’Œ Java ä¸­å®ç°åºåˆ—åŒ–çš„ 4 ç§æ–¹å¼ï¼Œå¹¶æ¢è®¨ä¸€ä¸‹å…¶å®ç°åŸç†ã€‚</p>
<p>Android &amp; Java ä¸­å®ç°åºåˆ—åŒ–çš„æ–¹å¼æœ‰ï¼š</p>
<ul>
<li><code>android.os.Parcelable</code> Android å¹³å°ç‰¹æœ‰ï¼Œéœ€è¦è‡ªå·±å®ç°å…·ä½“ç»†èŠ‚ï¼Œæ€§èƒ½æ¶ˆè€—å°ï¼Œåªèƒ½åœ¨å†…å­˜ä¸­å­˜åœ¨</li>
<li><code>java.io.Serializable</code> å®ç°ç®€å•ï¼Œåªéœ€è¦å®ç°<code>Serializable</code>æ¥å£å³å¯ï¼Œå¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ã€ç½‘ç»œç­‰</li>
<li><code>java.io.Externalizable</code> éœ€è¦è‡ªå·±å®ç°å…·ä½“ç»†èŠ‚</li>
<li><a href="https://github.com/twitter/Serial/blob/master/README-CHINESE.rst/" target="_blank" rel="noopener noreferrer"><code>Twitter Serial</code></a> Twitter å‡ºå“çš„é«˜æ€§èƒ½åºåˆ—åŒ–æ–¹æ¡ˆï¼Œå®ƒåŠ›æ±‚å¸®åŠ©å¼€å‘è€…å®ç°é«˜æ€§èƒ½å’Œé«˜å¯æ§çš„åºåˆ—åŒ–è¿‡ç¨‹ã€‚ï¼ˆæœ¬æ–‡ä¸è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ<a href="https://www.jianshu.com/p/1b42608478c0" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç« </a>ï¼‰</li>
</ul>
<h2> Serializable</h2>
<p><code>Serializable</code>æ¥å£æ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œåªæ˜¯ä¸€ä¸ªæ ‡è®°â€”â€”è¡¨ç¤ºè¿™ä¸ªç±»å¯ä»¥ç”¨æ¥<code>åºåˆ—åŒ–/ååºåˆ—åŒ–</code>ï¼ˆç”±<code>ObjectOutputStream/ObjectInputStream</code>å®ç°å…·ä½“ç»†èŠ‚ï¼‰ã€‚</p>
<p>ä¸€ä¸ªç±»æ²¡æœ‰å®ç°<code>Serializableæ¥å£</code>ï¼Œæˆ–è€…åŒ…å«æ²¡æœ‰<code>å®ç°Serializableæ¥å£çš„å˜é‡</code>ï¼Œåˆ™ä¼šåºåˆ—åŒ–å¤±è´¥<code>NotSerializableException</code>ã€‚</p>
<h3> serialVersionUID</h3>
<p>ä½¿ç”¨<code>serialVersionUID</code>æ ‡è®°å½“å‰<code>Serializable</code>çš„ç‰ˆæœ¬ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”¨å¯¹è±¡çš„<code>hashCode()</code>æŒ‡å®š<code>serialVersionUID</code>ï¼Œè¯¥å€¼ä¼šåœ¨ç±»å‘ç”Ÿæ”¹å˜æ—¶å˜åŒ–ï¼Œä»è€Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚</p>
<p>è€Œå¦‚æœ<code>serialVersionUID</code>ä¸€è‡´ï¼Œå³ä½¿ç±»ç»“æ„æœ‰å˜åŒ–ï¼Œä¹Ÿä¼šååºåˆ—åŒ–ï¼ˆç»™æ–°å¢çš„å˜é‡é»˜è®¤å€¼ï¼‰ï¼Œæ‰€ä»¥æœ€å¥½èµ‹äºˆä¸€ä¸ªé»˜è®¤çš„å€¼ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3> readResolve()</h3>
<p>å¦‚æœ<code>class</code>å®ç°äº†<code>readResolve()</code>æ–¹æ³•ï¼Œä¼šåœ¨ååºåˆ—åŒ–æ—¶ç”¨åˆ°å¹¶è¿”å›è¿™é‡Œæä¾›çš„å¯¹è±¡ï¼ˆååºåˆ—åŒ–å¾—åˆ°çš„å¯¹è±¡ä¼šè¢«ä¸¢å¼ƒï¼‰ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸ªç‰¹æ€§æˆ‘ä»¬å¯ä»¥ç¡®ä¿åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿèƒ½å®ç°<strong>å•ä¾‹</strong>ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯æ ¹æ®ä¸‹é¢çš„è¯´æ³•ï¼Œè¦å®ç°å¯ä»¥åºåˆ—åŒ–çš„å•ä¾‹æœ€ç®€å•å®‰å…¨çš„ï¼Œè¿˜æ˜¯ä½¿ç”¨æšä¸¾ï¼š</p>
<blockquote>
<p><strong>äº‹å®ä¸Šï¼Œå¦‚æœä¾èµ– readResolve è¿›è¡Œå®ä¾‹æ§åˆ¶ï¼Œå¸¦æœ‰å¯¹è±¡å¼•ç”¨ç±»å‹çš„æ‰€æœ‰å®ä¾‹åŸŸåˆ™éƒ½å¿…é¡»å£°æ˜ä¸º transient çš„</strong>ã€‚å¦åˆ™ï¼Œåˆ©ç”¨<code>readResolve()</code>æ–¹æ³•å®ç°çš„å•ä¾‹ä¹Ÿä¼šé­å—åˆ°æ”»å‡»ã€‚</p>
<p>å®ç°å¯åºåˆ—åŒ–æœ€ç®€å•å®‰å…¨çš„æ–¹å¼æ˜¯é‡‡ç”¨æšä¸¾çš„å½¢å¼ï¼Œåº”è¯¥å°½å¯èƒ½é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚å¦‚æœé‡‡ç”¨<code>readResolve</code>å®ç°çš„è¯ï¼Œè¦ç¡®ä¿è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹åŸŸéƒ½ä¸º<code>åŸºæœ¬ç±»å‹</code>ï¼Œæˆ–è€…æ˜¯<code>transient</code>çš„ã€‚</p>
<p><a href="https://cl0610.github.io/effective-java-learning/%E7%AC%AC%E5%8D%81%E7%AB%A0%20%E5%BA%8F%E5%88%97%E5%8C%96/77.%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%8C%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%85%88%E4%BA%8EreadResolve.html" target="_blank" rel="noopener noreferrer">77.å•ä¾‹æ¨¡å¼ï¼Œæšä¸¾ç±»å‹ä¼˜å…ˆäº readResolve</a></p>
</blockquote>
<h3> è‡ªå®šä¹‰åºåˆ—åŒ–è¿‡ç¨‹</h3>
<p>å¦‚æœæƒ³è¦è‡ªå·±å¤„ç†åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œå¯ä»¥å®ç°ä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•å®ç°<code>è¯»/å†™</code><strong>è¯¥ç±»è‡ªèº«çš„å±æ€§</strong>ï¼ˆ<code>All non-static and non-transient fields of the current class, include private</code>ï¼‰ï¼Œç„¶ååœ¨è°ƒç”¨è¯¸å¦‚<code>out.writeObject(string);</code>ç­‰æ–¹æ³•<strong>ä¿å­˜å…¶ä»–å˜é‡</strong>ã€‚</p>
<blockquote>
<p>The method does not need to concern itself with the state belonging to its superclasses or subclasses.</p>
</blockquote>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>readObjectNoData</code>æ–¹æ³•ä¸»è¦ç”¨åœ¨åºåˆ—åŒ–æµå’Œæˆ‘ä»¬è¦ååºåˆ—åŒ–çš„ç±»ä¸ä¸€è‡´æ—¶åˆå§‹åŒ–ä¸€äº›å¿…è¦çš„çŠ¶æ€ã€‚</p>
<blockquote>
<p>è¿™ç§æƒ…å†µå¯èƒ½å‡ºç°åœ¨æ¥æ”¶æ–¹ä½¿ç”¨äº†ä¸€ä¸ªä¸å‘é€æ–¹ä¸åŒç‰ˆæœ¬çš„ç±»ã€‚æ¥æ”¶æ–¹çš„ç‰ˆæœ¬å¤šæ‰©å±•äº†ä¸€äº›å­—æ®µï¼Œè€Œå‘é€æ–¹çš„ç‰ˆæœ¬æ²¡æœ‰è¿™äº›å­—æ®µã€‚è¿˜æœ‰ä¸€ç§å¯èƒ½å°±æ˜¯åºåˆ—åŒ–æµè¢«ç¯¡æ”¹äº†ã€‚è¿™æ—¶ï¼Œæ— è®ºæ˜¯æ¶æ„çš„æµè¿˜æ˜¯ä¸å®Œæ•´çš„æµï¼Œéƒ½å¯ä»¥ç”¨ <code>readObjectNoData</code> æ–¹æ³•æ¥å°†åºåˆ—åŒ–å¾—åˆ°çš„å¯¹è±¡åˆå§‹åŒ–åˆ°æ­£ç¡®çš„çŠ¶æ€ã€‚<br>
ä½œè€…ï¼šç¦å°”é©¬æ—<br>
é“¾æ¥ï¼š<a href="https://juejin.im/post/5d7206c5f265da03ab427181" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5d7206c5f265da03ab427181</a></p>
</blockquote>
<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>ObjectOutputStream</code>çš„<code>putFields()</code>å’Œ<code>ObjectInputStream</code>çš„<code>readFields()</code>å†™å…¥/è¯»å–å˜é‡ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•å¯ä»¥<em>åŠ å¯†/è§£å¯†</em>éƒ¨åˆ†å˜é‡ï¼Œæˆ–è€…åœ¨åºåˆ—åŒ–çš„æ—¶å€™<em>åªå¤„ç†éƒ¨åˆ†å˜é‡</em>ã€‚</p>
<p>å…·ä½“ä½¿ç”¨æ–¹æ³•è§å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<code>putFields()/readFields()</code>æ–¹æ³•åˆ†åˆ«ä¸èƒ½ä¸<code>defaultWriteObject/defaultReadObject</code>ä¸€èµ·ä½¿ç”¨ï¼›</p>
<p><code>putFields.put()</code>ä¹‹åå¿…é¡»è°ƒç”¨<code>out.writeFields()</code>æ–¹æ³•</p>
<p>å¹¶ä¸”ï¼Œæ²¡æœ‰åœ¨<code>putFields()</code>ä¸­åŠ å…¥çš„æ•°æ®ï¼Œåœ¨<code>readObject</code>ä¸­åªèƒ½è·å–åˆ°è¯¥ç±»å‹çš„é»˜è®¤å€¼</p>
</blockquote>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> çˆ¶ç±»æœªç»§æ‰¿ Serializable çš„ç±»çš„åºåˆ—åŒ–</h3>
<p>å¦‚æœä¸€ä¸ªç±»å®ç°äº†åºåˆ—åŒ–ï¼Œä½†ä»–çš„çˆ¶ç±»æ²¡æœ‰å®ç°åºåˆ—åŒ–ï¼Œé‚£ä¹ˆçˆ¶ç±»<strong>å¿…é¡»è¦æœ‰ä¸€ä¸ªå…¬å¼€çš„æ— å‚æ„é€ å‡½æ•°</strong>ï¼Œå¦åˆ™ååºåˆ—åŒ–æ—¶ä¼šå‡ºé”™ã€‚</p>
<p>æ­¤æ—¶ååºåˆ—åŒ–æ—¶ï¼Œçˆ¶ç±»çš„å˜é‡å€¼ï¼ˆ<code>public, protected, and (if accessible) package fields</code>ï¼‰éƒ½ä¼šæ˜¯<strong>é»˜è®¤çš„å€¼</strong>æˆ–è€…æ˜¯åœ¨<strong>çˆ¶ç±»æ— å‚æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–çš„å€¼</strong>ï¼ˆå³ä½¿è¿™äº›å€¼åœ¨å­ç±»å¯¹è±¡ä¸­å·²ç»è¢«ä¿®æ”¹äº†ï¼‰ã€‚</p>
<p>è¦æƒ³ä½¿å¾—è¿™äº›å€¼ä¹Ÿå¯ä»¥æ”¯æŒåºåˆ—åŒ–ï¼Œå¯ä»¥é€šè¿‡<code>writeObject/readObject</code>è‡ªå·±å¤„ç†è¿™äº›å€¼çš„åºåˆ—åŒ–ã€‚</p>
<p>åä¹‹ï¼Œå¦‚æœä¸€ä¸ªç±»å®ç°äº†<code>Serializable</code>æ¥å£ï¼Œé‚£ä¹ˆä»–çš„å­ç±»ä¹Ÿè‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚</p>
<h3> å®ç°</h3>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨<code>Serializable</code>å®ç°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç®€å•ç¤ºä¾‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> å¤šæ¬¡åºåˆ—åŒ–åŒä¸€ä¸ªå¯¹è±¡</h3>
<p>è¿”åºåˆ—åŒ–è¯»å–çš„è¿‡ç¨‹åœ¨<code>readResolve()</code>æ–¹æ³•ä¸€èŠ‚å·²ç»æ¶‰åŠåˆ°äº†ï¼Œæˆ‘ä»¬åœ¨çœ‹ä¸€ä¸‹ä¿å­˜çš„éƒ¨åˆ†ï¼Œè¿™é‡Œä¼šæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„ç°è±¡ï¼š</p>
<blockquote>
<p>Java åºåˆ—åŒ–æœºåˆ¶ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼Œå…·æœ‰ç‰¹å®šçš„å­˜å‚¨è§„åˆ™ï¼Œå½“å†™å…¥æ–‡ä»¶çš„ä¸ºåŒä¸€å¯¹è±¡æ—¶ï¼Œå¹¶ä¸ä¼šå†å°†å¯¹è±¡çš„å†…å®¹è¿›è¡Œå­˜å‚¨ï¼Œè€Œåªæ˜¯å†æ¬¡å­˜å‚¨ä¸€ä»½å¼•ç”¨ã€‚</p>
<p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html" target="_blank" rel="noopener noreferrer">https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html</a></p>
</blockquote>
<p>è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šå½“ä½¿ç”¨åŒä¸€ä¸ª<code>ObjectOutputStreamå¯¹è±¡</code>åºåˆ—åŒ–<code>åŒä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡</code>æ—¶ï¼Œå³ä½¿åœ¨ç¬¬ä¸€æ¬¡åºåˆ—åŒ–å¹¶ä¿å­˜åä¿®æ”¹äº†è¿™ä¸ªå¯¹è±¡çš„éƒ¨åˆ†å±æ€§ï¼Œå½“å†æ¬¡åºåˆ—åŒ–æ—¶ä¿å­˜çš„<strong>åªæ˜¯å‰ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨</strong>â€”â€”ä¹Ÿå°±æ˜¯è¯´å°†å®Œå…¨ç›¸åŒä¸€ä¸ªå¯¹è±¡ä¿å­˜äº†ä¸¤æ¬¡ï¼Œ<strong>ç¬¬äºŒæ¬¡åšçš„ä¿®æ”¹åœ¨åºåˆ—åŒ–çš„æ—¶å€™å¹¶æ²¡æœ‰ä¿å­˜</strong>ã€‚</p>
<p>æˆ‘ä»¬å†™ä¸ªç®€å•çš„ DEMO éªŒè¯ä¸€ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æºç ä¸­çœ‹åˆ°åŸå› ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåœ¨ä¿å­˜åŒä¸€ä¸ªå¯¹è±¡æ—¶è¦æ³¨æ„ä½¿ç”¨ä¸åŒçš„<code>ObjectOutputStream</code>å¯¹è±¡ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨<code>writeUnshared</code>æ–¹æ³•ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ä¼˜ç¼ºç‚¹</h3>
<ul>
<li>ç®€å•ï¼Œåªéœ€è¦å®ç°æ¥å£</li>
<li>åºåˆ—åŒ–çš„å­—èŠ‚æµå¯ä»¥åœ¨æ–‡ä»¶ã€ç½‘ç»œä¸­ä¼ é€’ï¼Œå¯ä»¥æŒä¹…åŒ–ä¿å­˜</li>
<li>æ€§èƒ½å·®ï¼Œåºåˆ—åŒ–è¿‡ç¨‹å¤§é‡ä½¿ç”¨åå°„å’Œä¸´æ—¶å˜é‡</li>
</ul>
<h2> Externalizable</h2>
<p><code>Externalizable</code>ç»§æ‰¿è‡ª<code>Serializable</code>ã€‚</p>
<p>ç”¨æˆ·éœ€è¦é€šè¿‡<code>writeExternal(ObjectOutput out)</code>å’Œ<code>readExternal(ObjectInput in)</code>å®ç°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç»†èŠ‚ï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªæ˜ç¡®å®ç°çš„**<code>public no-arg constructor</code>**</p>
<h3> å®ç°</h3>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> åŸç†</h3>
<p>çœ‹æºç å¯ä»¥çŸ¥é“ï¼Œå¦‚æœæ£€æµ‹åˆ°å½“å‰å¯¹è±¡æ˜¯<code>Externalizable</code>æ—¶ï¼Œå°±ä¼šå»è°ƒç”¨è¯¥å¯¹è±¡çš„<code>writeExternalæ–¹æ³•</code>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ä¼˜ç¼ºç‚¹</h3>
<ul>
<li>æ¯”<code>Serializable</code>éº»çƒ¦ï¼Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–éƒ½éœ€è¦ç”¨æˆ·è‡ªå·±å®ç°</li>
<li>çµæ´»ï¼Œå¯ä»¥è‡ªå®šä¹‰è¦å‚ä¸åˆ°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å˜é‡</li>
</ul>
<h2> Parcelable</h2>
<p><code>Parcelable</code>æ˜¯ Android ä¸ºäº†è§£å†³<code>Serializable</code>æ€§èƒ½é—®é¢˜è€Œæ¨å‡ºçš„ï¼Œä¸»è¦ç”¨åœ¨ Android çš„<code>Intent</code>æˆ–<code>çº¿ç¨‹é—´é€šä¿¡</code>ä¸­ã€‚</p>
<p><code>Parcelable</code>é€šè¿‡<code>Parcel</code>ä¼ è¾“åˆ°<code>IBinder</code>ä¸­ï¼Œä»è€Œå®ç°è·¨è¿›ç¨‹ä¼ è¾“ã€‚</p>
<blockquote>
<p>å¯¹äº<code>kotlin</code>è¯­è¨€æ¥è¯´ï¼ŒAndroid Studio è‡ªåŠ¨ç”Ÿæˆçš„<code>Parcelable</code>ä»£ç ä¸ä¼šå¤„ç† val å˜é‡ï¼ˆå› ä¸ºè¿™äº›å˜é‡ä¸ä¼šå˜åŒ–ï¼‰</p>
<p>æ­¤å¤–ï¼Œ<code>Parcelable</code>åœ¨ååºåˆ—åŒ–æ—¶ï¼Œè°ƒç”¨<code>parcel.readParcelable(classLoader)</code>ä¼ å…¥çš„æ˜¯<code>ClassLoader</code>ã€‚</p>
</blockquote>
<h3> å®ç°</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª<code>Parcelable</code>çš„å®ç°ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> åŸç†</h3>
<p>åŸç†å‚è€ƒè¿™ç¯‡æ–‡ç« <a href="https://www.kancloud.cn/xcy396/android_tech/1296524" target="_blank" rel="noopener noreferrer">Parcelable æºç åˆ†æ</a></p>
<h3> ä¼˜ç¼ºç‚¹</h3>
<ul>
<li>æ€§èƒ½å¥½ï¼Œ<code>Parcelable</code>æ¥å£æ¯”<code>Serializable</code>æ¥å£æ•ˆç‡æ›´é«˜ï¼Œæ€§èƒ½æ–¹é¢é«˜å‡º 10 å¤šå€ [^Parcelable æºç åˆ†æ]:</li>
<li>è¾ƒå¤æ‚ï¼Œéœ€è¦è‡ªå·±å®ç°å¯¹è±¡çš„åºåˆ—åŒ–å†…å®¹</li>
</ul>
<h2> æ€»ç»“</h2>
<p>ä¸€èˆ¬éœ€è¦æŒä¹…åŒ–ä¿å­˜æ•°æ®æˆ–åœ¨ç½‘ç»œé—´ä¼ è¾“æ—¶æ¨èä½¿ç”¨<code>Serializable</code>æˆ–è€…<code>Externalizable</code>ã€‚</p>
<p>åœ¨ Android ä¸­<code>Activity</code>ä¹‹é—´ç­‰ä¼ é€’å¯¹è±¡ï¼Œä»¥åŠè·¨è¿›ç¨‹ä¼ é€’å¯¹è±¡ç­‰æ—¶ä½¿ç”¨<code>Parcelable</code>ä»¥èŠ‚çœæ€§èƒ½ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="http://darryrzhong.xyz/2019/09/15/Android%E4%B9%8B%E5%BA%8F%E5%88%97%E5%8C%96%E8%AF%A6%E8%A7%A3/" target="_blank" rel="noopener noreferrer">Android ä¹‹åºåˆ—åŒ–è¯¦è§£</a></p>
<p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html" target="_blank" rel="noopener noreferrer">Java åºåˆ—åŒ–çš„é«˜çº§è®¤è¯†</a></p>
<p><a href="https://juejin.im/post/5d7206c5f265da03ab427181#heading-0" target="_blank" rel="noopener noreferrer">ã€åŸåˆ›ã€‘ï¼ˆè¯‘ï¼‰Java åºåˆ—åŒ–é­”æ³•æ–¹æ³•åŠä½¿ç”¨ç¤ºä¾‹</a></p>
<p><a href="https://www.javacodegeeks.com/2019/08/serialization-everything-java-serialization-explained.html" target="_blank" rel="noopener noreferrer">What is Serialization? Everything You Need to Know About Java Serialization Explained With Example</a></p>
<p><a href="https://juejin.im/post/5ce3cdc8e51d45777b1a3cdf#heading-0" target="_blank" rel="noopener noreferrer">java åºåˆ—åŒ–ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†</a></p>
<p><a href="https://blog.csdn.net/qq_16628781/article/details/70049623" target="_blank" rel="noopener noreferrer">Java ä¹‹ Serializable/Externalizable åºåˆ—åŒ–å’Œååºåˆ—åŒ–</a></p>
<p><a href="https://cl0610.github.io/effective-java-learning/%E7%AC%AC%E5%8D%81%E7%AB%A0%20%E5%BA%8F%E5%88%97%E5%8C%96/77.%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%8C%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%85%88%E4%BA%8EreadResolve.html" target="_blank" rel="noopener noreferrer">77.å•ä¾‹æ¨¡å¼ï¼Œæšä¸¾ç±»å‹ä¼˜å…ˆäº readResolve</a></p>
<p>Pareclable å®ç°åŸç†ï¼š<a href="https://juejin.im/post/5a3b24ab6fb9a04515440bd7" target="_blank" rel="noopener noreferrer">Parcelable æœ€å¼ºè§£æ</a></p>
<p>Parcelable ä½¿ç”¨ï¼š<a href="https://www.jianshu.com/p/32a2ec8f35ae" target="_blank" rel="noopener noreferrer">è¯¦ç»†ä»‹ç» Android ä¸­ Parcelable çš„åŸç†å’Œä½¿ç”¨æ–¹æ³•</a></p>
<p><a href="https://www.kancloud.cn/xcy396/android_tech/1296524" target="_blank" rel="noopener noreferrer">Parcelable æºç åˆ†æ</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Java çº¿ç¨‹å®‰å…¨ä¸ volatile å’Œ synchronize</title>
      <link>https://jixiaoyong.github.io/blog/posts/24967ad4.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/24967ad4.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Java çº¿ç¨‹å®‰å…¨ä¸ volatile å’Œ synchronize</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 12 Jan 2019 07:54:46 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>Java å¤šçº¿ç¨‹ç¼–ç ä¸­ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨çš„å®è´¨æ˜¯ä¿è¯å¯¹æ•°æ®æ“ä½œçš„åŸå­æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹å¯¹æ•°æ®çš„æ“ä½œèƒ½å¤ŸåŠæ—¶çš„æ›´æ–°åˆ°å…¶ä»–ä½¿ç”¨è¯¥æ•°æ®çš„çº¿ç¨‹ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹å› ä¸ºæ“ä½œçš„æ•°æ®å€¼ä¸ä¸€è‡´è€Œäº§ç”Ÿé”™è¯¯ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20190112144856.png" alt="çº¿ç¨‹ã€ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜ä¸‰è€…äº¤äº’å…³ç³»â€”â€”æ·±å…¥ç†è§£ JAVA è™šæ‹Ÿæœº" tabindex="0" loading="lazy"><figcaption>çº¿ç¨‹ã€ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜ä¸‰è€…äº¤äº’å…³ç³»â€”â€”æ·±å…¥ç†è§£ JAVA è™šæ‹Ÿæœº</figcaption></figure>
<p>ç”±äº Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰è§„å®šï¼Œæ‰€æœ‰çº¿ç¨‹å…¬ç”¨çš„æ•°æ®ä¿å­˜åœ¨ä¸»å†…å­˜ä¸­ï¼Œè€Œçº¿ç¨‹åœ¨ä½¿ç”¨æ—¶å…ˆä»ä¸»å†…å­˜ä¸­å–åˆ°çº¿ç¨‹ç§æœ‰çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä¹‹åå†åœ¨ä½¿ç”¨å®Œæ¯•ååŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹ä¹Ÿç”¨åˆ°äº†è¯¥æ•°æ®åˆ™å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œå› æ­¤åœ¨çº¿ç¨‹æ“ä½œæ•°æ®æ—¶éœ€è¦è€ƒè™‘çº¿ç¨‹å¹¶å‘æ—¶æ“ä½œæ•°æ®çš„åŒæ­¥é—®é¢˜ã€‚</p>
<p><code>volatile</code>å’Œ<code>synchronize</code>å› æ­¤è€Œç”Ÿã€‚</p>
<h2> volatile</h2>
<p><code>volatile</code>ä¿®é¥°çš„å˜é‡æœ‰ä¸¤ä¸ªç‰¹æ€§ï¼š</p>
<ul>
<li>å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ æ™®é€šå˜é‡åˆ™éœ€è¦ç­‰çº¿ç¨‹æ“ä½œå®Œæ¯•ï¼Œå°†ç»“æœä»å·¥ä½œå†…å­˜å†™å…¥åˆ°ä¸»å†…å­˜ä¸­æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹å¯è§ï¼Œvolatile ä¿®é¥°çš„å˜é‡ä¼šåœ¨ä¿®æ”¹åé€šçŸ¥å…¶ä»–çº¿ç¨‹è¯¥å˜é‡å·²ç»è¢«æ›´æ”¹ï¼Œä»è€Œè®©å…¶ä»–çº¿ç¨‹å†å»ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°çš„å€¼</li>
<li>ç¦æ­¢æŒ‡ä»¤é‡æ’ä¼˜åŒ–</li>
</ul>
<p><code>volatile</code>ä¿®é¥°çš„å˜é‡æ‰§è¡Œæ•ˆç‡å’Œæ™®é€šå˜é‡å·®åˆ«ä¸å¤§ï¼Œå…¶å†™æ“ä½œå› ä¸ºè¦æ’å…¥å†…å­˜å±éšœï¼Œæ‰€ä»¥ä¼šç¨å¾®æ…¢ä¸€äº›</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>
<p>ç”±äº Java è¿ç®—çš„å…·ä½“å®ç°å¹¶éåŸå­æ€§çš„ï¼Œæ•…è€Œè™½ç„¶<code>volatile</code>ä¿®é¥°çš„å˜é‡åœ¨æ‰€æœ‰çº¿ç¨‹å¯è§ï¼Œä½†æ˜¯å¹¶å‘ä¸‹å¹¶ä¸çº¿ç¨‹å®‰å…¨ã€‚</p>
<blockquote>
<p>Java ä»£ç ç¼–è¯‘æˆ class æ–‡ä»¶åå¯ä»¥çœ‹åˆ°ï¼Œç±»ä¼¼<code>c = c + 1</code>è¿™æ ·çš„è¯­å¥ï¼Œä¼šè¢«åˆ†ä¸ºï¼šè¯»å–<code>c</code>çš„å€¼ï¼›è®¡ç®—<code>c+1</code>çš„å€¼ï¼›å°†ç»“æœèµ‹äºˆ<code>c</code>è¿™å‡ æ­¥æ¥å®Œæˆã€‚æ‰€ä»¥åœ¨æ­¤æœŸé—´å¦‚æœæœ‰å…¶ä»–çš„çº¿ç¨‹è®¿é—®è¿™æ®µä»£ç ï¼Œå°±ä¼šå‘ç”Ÿå†²çªã€‚</p>
</blockquote>
</li>
<li>
<p>Java ä¼šé€šè¿‡<strong>æŒ‡ä»¤é‡æ’</strong>æ¥ä¼˜åŒ–ä»£ç </p>
<blockquote>
<p>æŒ‡ä»¤é‡æ’ æŒ‡å¯¹äºå˜é‡çš„èµ‹å€¼ä¼šåœ¨å®šä¹‰è¯¥å˜é‡å’Œä½¿ç”¨è¯¥å˜é‡çš„å€¼ä¹‹é—´çš„ä»»æ„ä½ç½®æ‰§è¡Œï¼Œä¸ä¸€å®šå’Œä»£ç ä¸­çš„é¡ºåºä¸€è‡´</p>
</blockquote>
<p><code>volatile</code>ä¿®é¥°çš„å˜é‡åˆ™ä¼šæ’å…¥<em>å†…å­˜å±éšœ</em>ï¼Œä»è€Œå®ç°å±è”½æŒ‡ä»¤é‡æ’çš„æ•ˆæœ</p>
</li>
</ul>
<h2> synchronize</h2>
<p><code>synchronize</code>å®ç°çš„åŸç†æ˜¯<strong>é”å®šæŒ‡å®šçš„å¯¹è±¡</strong>ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™é”å®šå¯¹åº”çš„ç±»å¯¹è±¡æˆ– class å¯¹è±¡ï¼‰ï¼Œç„¶åé˜»å¡å…¶ä»–çº¿ç¨‹è¿›å…¥ï¼ˆè·å–åˆ°è¯¥é”çš„çº¿ç¨‹å¯ä»¥å¤šæ¬¡é‡å…¥ï¼‰ã€‚</p>
<p>ç”±äº Java çš„çº¿ç¨‹å®ç°æ˜¯æ˜ å°„åˆ°ç³»ç»Ÿçº¿ç¨‹çš„ï¼Œé˜»å¡å’Œå”¤é†’éœ€è¦ç”±ç³»ç»Ÿå†…æ ¸å®Œæˆï¼Œä¼šæ¶ˆè€—å¤§é‡çš„æ—¶é—´ï¼Œå› æ­¤<code>synchronize</code>æ˜¯<strong>é‡é‡çº§æ“ä½œ</strong>ã€‚</p>
<h2> JMM ä¸ä¸‰ä¸ªç‰¹å¾</h2>
<p>JMM çš„è®¾è®¡æ˜¯å›´ç»•ç€<strong>åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§</strong>ä¸‰ä¸ªç‰¹å¾è¿›è¡Œçš„ã€‚</p>
<ul>
<li>
<p><strong>åŸå­æ€§</strong> JVM ä¸­çš„<code>read,load,assign,use,store,write</code>æ“ä½œå’Œ<code>synchronize</code></p>
</li>
<li>
<p><strong>å¯è§æ€§</strong> ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹äº†å…±äº«å˜é‡çš„å€¼æ—¶ï¼Œå…¶ä½™çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªæ›´æ”¹ã€‚é€šè¿‡<code>synchronize</code>ï¼Œ<code>final</code>å’Œ<code>volatile</code>ä¿è¯ã€‚</p>
<p><code>final</code>è¦ä¿è¯å¯è§æ€§çš„å‰ææ˜¯è¦è¢«<strong>å®‰å…¨çš„æ„å»ºå‡ºæ¥</strong>ï¼Œé¿å…**â€œthis å¼•ç”¨é€ƒé€¸â€**</p>
<blockquote>
<p><strong>this å¼•ç”¨é€ƒé€¸</strong> å¯¹è±¡è¿˜æ²¡æœ‰è¢«æ„é€ å®Œæˆï¼Œä»–çš„<code>thiså¼•ç”¨</code>å°±å·²ç»è¢«å‘å¸ƒå‡ºå»äº†ã€‚</p>
<p>åœ¨æ„é€ å‡½æ•°ä¸­ç”Ÿæˆå†…éƒ¨ç±»ï¼Œç”±äºå†…éƒ¨ç±»è‡ªåŠ¨æŒæœ‰å¤–éƒ¨ç±»çš„<code>thiså¼•ç”¨</code>ï¼Œå¦‚æœæœ‰å¯¹è±¡åœ¨å†…éƒ¨ç±»è¯­å¥ä¹‹åæ„é€ ï¼Œåˆ™å°±æœ‰å¯èƒ½å‘ç”Ÿâ€œå†…éƒ¨ç±»è®¿é—®è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡è¿˜æ²¡æœ‰æ„é€ å®Œæ¯•â€çš„æƒ…å†µã€‚</p>
</blockquote>
</li>
<li>
<p><strong>æœ‰åºæ€§</strong> é€šè¿‡<code>synchronize</code>,<code>volatile</code>ä¿è¯ã€‚</p>
</li>
</ul>
<p>çº¿ç¨‹ä»å†…éƒ¨è§‚å¯Ÿæ—¶æœ‰åºï¼ˆçº¿ç¨‹å†…æ˜¯ä¸²è¡Œçš„è¯­ä¹‰ï¼‰ï¼Œçº¿ç¨‹å¤–éƒ¨è§‚å¯Ÿæ˜¯æ— åºï¼ˆç”±æŒ‡ä»¤é‡æ’ã€å·¥ä½œå†…å­˜ä¸ä¸»å†…å­˜åŒæ­¥å»¶è¿Ÿå¯¼è‡´ï¼‰</p>
<h2> å®ç°çº¿ç¨‹å®‰å…¨</h2>
<p>å®ç°çº¿ç¨‹å®‰å…¨æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<h3> äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰</h3>
<p>äº’æ–¥åŒæ­¥çš„æ€æƒ³æ˜¯ï¼šå¤šä¸ªçº¿ç¨‹ä½¿ç”¨åŒä¸€ä¸ªå…±äº«æ•°æ®æ—¶ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨</p>
<p>æœ‰ä¸¤ç§é€”å¾„ï¼š</p>
<ul>
<li><code>synchronize</code> ï¼ˆåŸç”Ÿè¯­æ³•å±‚ï¼‰ï¼Œä¼˜å…ˆä½¿ç”¨</li>
<li><code>ReentrantLock</code> é‡å…¥é”ï¼ˆAPI å±‚ï¼‰ï¼ŒåŠŸèƒ½æœ‰ï¼š1.ç­‰å¾…å¯ä¸­æ–­ï¼ˆå¯ä»¥æ”¾å¼ƒç­‰å¾…ï¼‰2.å…¬å¹³é” å¤šä¸ªçº¿ç¨‹ç”³è¯·é”æ—¶å¿…é¡»æŒ‰ç…§ç”³è¯·æ—¶é—´é¡ºåºè·å¾—é” 3.é”ç»‘å®šå¤šä¸ªæ¡ä»¶</li>
</ul>
<h3> éé˜»å¡åŒæ­¥</h3>
<p>å‡å°‘äº†é˜»å¡/å”¤é†’çš„è€—æ—¶ï¼Œåœ¨æ“ä½œæ—¶è¿›è¡Œ CASï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰ï¼Œåœ¨å†²çªå‘ç”Ÿçš„æ—¶å€™ä¸æ–­å°è¯•æ‰§è¡Œæ‰€éœ€æ“ä½œï¼Œç›´åˆ°æ‰§è¡ŒæˆåŠŸã€‚</p>
<p>ä½†æ˜¯æœ‰ä¸€ä¸ªé€»è¾‘æ¼æ´ï¼šå¦‚æœåœ¨ç¬¬ä¸€æ¬¡æ“ä½œå¤±è´¥åˆ°ç¬¬äºŒæ¬¡å†æ¬¡å°è¯•æ“ä½œä¹‹é—´ï¼Œ<em>å…¶ä»–çº¿ç¨‹å¯¹é½è¿›è¡Œäº†æ“ä½œä½†æ˜¯è¯¥æ•°æ®æœ€ç»ˆæ²¡æœ‰è¢«å˜åŒ–</em>ï¼Œå½“ç¬¬äºŒæ¬¡å†æ¬¡å°è¯•æ—¶ï¼Œå…¶å®å·²ç»è¢«å…¶ä»–çº¿ç¨‹è®¿é—®è¿‡äº†ã€‚</p>
<h3> æ— åŒæ­¥æ–¹æ¡ˆ</h3>
<p>ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸ä¸€å®šéœ€è¦åŒæ­¥ï¼Œå½“çº¿ç¨‹æ“ä½œçš„æ•°æ®ä¸æ˜¯å…±äº«æ•°æ®æ—¶ï¼Œå³ä½¿ä¸åŒæ­¥ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<ul>
<li><strong>å¯é‡å…¥ä»£ç </strong> æŒ‡åœ¨ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸­æ–­å…¶è¿è¡Œå¹¶è¿è¡Œå…¶ä»–çš„çº¿ç¨‹ï¼Œå½“å†æ¬¡è¿”å›ç»§ç»­æ‰§è¡Œè¯¥ä»£ç æ—¶ä¸ä¼šå½±å“åˆ°å…¶æ‰§è¡Œç»“æœçš„ä»£ç ã€‚è¿™ç§ä»£ç ä¸€èˆ¬æ²¡æœ‰ç”¨åˆ°å †ä¸­çš„å…¬ç”¨èµ„æºã€‚</li>
<li><strong>çº¿ç¨‹æœ¬åœ°å­˜å‚¨</strong> å…±äº«æ•°æ®å€¼å­˜åœ¨äºåŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œå¦‚æ¯ä¸ªçº¿ç¨‹çš„ ThreadLocal å¯¹è±¡</li>
</ul>
<h2> é”ä¼˜åŒ–</h2>
<p>JDK1.6 ä»¥åï¼Œåœ¨ HotSpot è™šæ‹Ÿæœºä¸Šå®ç°äº†è®¸å¤šé”ä¼˜åŒ–æŠ€æœ¯ï¼š</p>
<ul>
<li>
<p>è‡ªæ—‹é”</p>
<p>å®ç°é˜»å¡åŒæ­¥æ—¶ï¼Œé˜»å¡å’Œå”¤é†’ä¼šå¾ˆè€—æ—¶ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥å…ˆå¯¹å…¶è¿›è¡Œ<em>å¿™å¾ªç¯</em>ï¼Œå¦‚æœè¿˜ä¸è¡Œå†å»æ‰§è¡Œé˜»å¡æ“ä½œ</p>
<p><em>è‡ªé€‚åº”è‡ªæ—‹</em> ç”± JVM æ™ºèƒ½å†³å®šè‡ªæ—‹æ¬¡æ•°</p>
</li>
<li>
<p>é”æ¶ˆé™¤</p>
<p>JVM ä¼šè‡ªåŠ¨å–å‡ºä¸å¿…è¦çš„é”</p>
</li>
<li>
<p>é”ç²—åŒ–</p>
<p>å¦‚æœä¸€æ®µä»£ç ä¸­æœ‰è¿ç»­çš„é”ï¼Œåˆ™ JVM ä¼šå°†è¿™äº›é”åˆå¹¶ä¸ºä¸€ä¸ªå¤§é”</p>
</li>
<li>
<p>è½»é‡çº§é”</p>
<p>è½»é‡çº§é”æ¶ˆè€—æ¯”ä¼ ç»Ÿé”æœºåˆ¶å°ï¼Œä¼šä¼˜å…ˆå°è¯•ä½¿ç”¨è½»é‡çº§é”ï¼Œå¦‚æœä¸è¡Œï¼Œåœ¨å‡çº§ä¸ºäº’æ–¥é”</p>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šå‡å°‘æ¶ˆè€—ï¼Œä½†å¦‚æœå­˜åœ¨é”ç«äº‰ï¼Œåˆ™é™¤äº†äº’æ–¥é”çš„å¼€é”€å¤–ï¼Œè¿˜æœ‰è½»é‡çº§é”çš„å¼€é”€</p>
</li>
<li>
<p>åå‘é”</p>
<p>åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹æ¶ˆé™¤åŒæ­¥</p>
</li>
<li>
<p>ä¹è§‚é”</p>
<p>è¯»å–æ•°æ®æ—¶é»˜è®¤è¯¥å¯¹è±¡ä¸ä¼šè¢«å…¶ä»–å¯¹è±¡æ›´æ”¹è€Œä¸åŠ é”ï¼Œæ¯æ¬¡å†™æ•°æ®æ—¶å¯¹æ¯”å½“å‰å€¼ä¸æŒæœ‰å€¼æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´æ—¶æ‰å»æ›´æ–°æ•°æ®</p>
</li>
</ul>
<h2> å‚è€ƒèµ„æ–™</h2>
<p>ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºâ€”â€”JVM é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹å‘¨å¿—æ˜</p>
<p><a href="https://blog.csdn.net/u010571316/article/details/77993309" target="_blank" rel="noopener noreferrer">this å¼•ç”¨é€ƒé€¸â€”â€”èœ¡ç¬”å°å‹‹</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20190112144856.png" type="image/png"/>
    </item>
    <item>
      <title>Kotlin å­¦ä¹ ç¬”è®° 1</title>
      <link>https://jixiaoyong.github.io/blog/posts/135b2780.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/135b2780.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Kotlin å­¦ä¹ ç¬”è®° 1</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 09 Feb 2018 08:18:01 GMT</pubDate>
      <content:encoded><![CDATA[<p>è¿™æ˜¯æˆ‘åœ¨å­¦ä¹  Bennyhuoï¼ˆ <a href="https://github.com/enbandari/Kotlin-Tutorials" target="_blank" rel="noopener noreferrer">github</a> ï¼‰çš„ kotlin å…¥é—¨è§†é¢‘æ—¶çš„ä¸€äº›ç¬”è®°ï¼Œæ¯”è¾ƒååŸºç¡€ï¼Œç”¨äºæŸ¥ç¼ºè¡¥æ¼ã€‚</p>
<ul>
<li>
<p>xx.map() &amp; xx.flatMap()</p>
<p>xx.flatMap() ç”¨äºè¿”å›<strong>å¯è¿­ä»£</strong>çš„æ•°ç»„ï¼Œè€Œ xx.map() åˆ™æ˜¯ä»»ä½•<strong>å¯è¿­ä»£</strong>æ•°æ®éƒ½æœ‰çš„ç”¨æ¥éå†çš„æ–¹æ³•ã€‚</p>
</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>
<p>enum class æšä¸¾ç±»å‹</p>
<p>åˆ†ä¸ºæœ‰å‚å’Œæ— å‚ï¼Œæšä¸¾å˜é‡ä»¥<code>,</code>åˆ†éš”ï¼Œå¦‚æœ enum è¿˜æœ‰æ–¹æ³•æˆ–è€…ä¼´ç”Ÿå¯¹è±¡ï¼Œåˆ™æœ€åä¸€ä¸ªå˜é‡åä¸º<code>;</code>ï¼Œå¦åˆ™å¯ä¸º<code>,</code>ã€<code>;</code>æˆ–è€…æ²¡æœ‰ã€‚</p>
</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ æœ‰å‚çš„æƒ…å†µå¦‚ä¸‹</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ ä½¿ç”¨ï¼šé€šè¿‡ enum çš„ valueOf() æ–¹æ³•è·å–æšä¸¾å¯¹è±¡å®ä¾‹</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>
<p>companion object ä¼´ç”Ÿå¯¹è±¡</p>
<p>åœ¨ç±»çš„å®šä¹‰ï¼Œå¯ä»¥ç›´æ¥ç”¨<code>ç±»å.æ–¹æ³•å()</code>è°ƒç”¨ï¼Œç›¸å½“äº java ä¸­çš„é™æ€æ–¹æ³•</p>
<p>ä¸€ä¸ªç±»ä¸­åªèƒ½æœ‰ä¸€ä¸ªä¼´ç”Ÿå¯¹è±¡</p>
</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>
<p>object ä¿®é¥°çš„ç±»</p>
<p>ç­‰åŒäºåªæœ‰ä¸€ä¸ªå®ä¾‹çš„ç±»ï¼Œç›¸å½“äº java ä¸­çš„é™æ€ç±»ï¼Œæ‰€æœ‰æ–¹æ³•å¯ä»¥ç›´æ¥ç”¨ç±»åè°ƒç”¨</p>
</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>
<p>fun ClassName.funName() ä¸ºç±»æ·»åŠ æ–°çš„æ–¹æ³•</p>
<p>å¯¹äºä¸èƒ½ç›´æ¥ä¿®æ”¹çš„ç±»ï¼Œæœ‰éœ€è¦å¯¹å…¶å¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª<code>ClassName.funName()</code>çš„æ–¹æ³•æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚</p>
</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ åœ¨ä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡<code>Country</code>çš„å¯¹è±¡è°ƒç”¨<code>syaNum()</code>æ–¹æ³•</p>
<ul>
<li>
<p>data class æ•°æ®ç±»</p>
<p>å¯ä»¥æœ‰æ–¹æ³•ï¼Œæ–¹ä¾¿å¤åˆ¶ã€‚</p>
<p>å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”å‚æ•°éƒ½éœ€è¦ç”¨ var/val ä¿®é¥°</p>
</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul>
<li>æ–‡ä»¶è¯»å–
<ul>
<li>resource ç›®å½•ä¸‹çš„æ–‡ä»¶è¯»å–</li>
</ul>
</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul>
<li>
<p>ä¸ RxJava ç»“åˆ</p>
<p>ç»Ÿè®¡æ–‡æœ¬ä¸­å­—æ¯ä¸ªæ•°ï¼ŒåŸºäº RxJava 1.2.1</p>
</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Kotlin å­¦ä¹ ç¬”è®° 2</title>
      <link>https://jixiaoyong.github.io/blog/posts/8a52763a.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/8a52763a.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Kotlin å­¦ä¹ ç¬”è®° 2</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 11 Feb 2018 03:38:43 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å°¾é€’å½’ä¼˜åŒ–</h2>
<p>æŠŠé€’å½’é€šè¿‡ç¼–è¯‘å™¨è½¬åŒ–ä¸ºè¿­ä»£ï¼Œä»è€Œé¿å… Stack Overflow</p>
<p>â€œä»¥æ—¶é—´æ¢å–ç©ºé—´â€</p>
<p>æ™®é€šé€’å½’ï¼š</p>
<p>è°ƒç”¨å‡½æ•°ä¹‹åï¼Œè¿˜éœ€è¦ä½¿ç”¨å…¶è¿”å›å€¼ä¾›è‡ªå·±ä½¿ç”¨ï¼Œå³è‡ªèº«è¿”å›å€¼ä¾èµ–äºä¸‹ä¸€çº§å‡½æ•°ï¼Œä¸€èˆ¬æ˜¯è°ƒç”¨è‡ªèº«çš„ä»£ç åé¢ï¼Œè¿˜æœ‰å…¶ä»–çš„ä»£ç è¦æ‰§è¡Œã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°¾é€’å½’ï¼š<br>
è°ƒç”¨è‡ªèº«ä¹‹åï¼Œæ— éœ€å†è¿”å›å½“å‰å‡½æ•°ï¼Œå°†å¤„ç†ç»“æœä»¥å…¶ä»–å½¢å¼è¿”å›ã€‚<br>
æ™®é€šé€’å½’å’Œå°¾é€’å½’éƒ½å­˜åœ¨æ ˆæº¢å‡ºé£é™©ï¼ˆæœªä¼˜åŒ–å‰ï¼Œä¾‹å­ä¸­çš„å‡½æ•°è®¡ç®— 10000 åˆ° 100000 çš„é˜¶ä¹˜æ—¶ä¼šæº¢å‡ºï¼‰ï¼Œkotlin æä¾›äº†ä¸€ç§å°¾é€’å½’ä¼˜åŒ–çš„æ–¹æ³•â€”â€”<code>tailrec</code>ï¼Œä½¿å¾—ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°†é€’å½’è½¬åŒ–ä¸ºè¿­ä»£ï¼Œä»è€Œé¿å…æ ˆæº¢å‡ºã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ¬ä¾‹ä¸­ä¼ å…¥<code>fun2()</code>çš„<code>Result</code>å®ä¾‹ä¿å­˜äº†è®¡ç®—ç»“æœ</p>
<h2> sealed class å¯†å°ç±»</h2>
<p>å¯†å°ç±»çš„æ‰€æœ‰å­ç±»å¿…é¡»åœ¨ä¸€ä¸ªæ–‡ä»¶ (xx.kt) ä¸­ï¼Œä»–çš„å­ç±»æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥å½“<code>when()</code>çš„æ—¶å€™ä¸éœ€è¦<code>else</code>ã€‚</p>
<p>æŸç§æ„ä¹‰ä¸Šä»–ä»¬åƒæ˜¯ä¸€ç§<code>enum class</code>ï¼Œåªä¸è¿‡ä»–çš„å­ç±»å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ã€‚</p>
<blockquote>
<p>Sealed classes are used for representing restricted class hierarchies, when a value can have one of the types from a limited set, but cannot have any other type. They are, in a sense, an extension of enum classes: the set of values for an enum type is also restricted, but each enum constant exists only as a single instance, whereas a subclass of a sealed class can have multiple instances which can contain state.</p>
</blockquote>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> kotlin æŠ›å‡ºå¼‚å¸¸</h2>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2> kotlin ä¸­çš„æ³›å‹</h2>
<p><code>out</code> åå˜ï¼Œä½¿ç”¨å­ç±»æ³›å‹çš„å¯¹è±¡å¯ä»¥èµ‹å€¼ç»™ä½¿ç”¨çˆ¶ç±»æ³›å‹çš„å¯¹è±¡ï¼Œç›¸å½“äº<code>extend</code>ï¼Œç”¨äºæ–¹æ³•çš„è¿”å›å€¼ï¼ˆç”Ÿäº§è€…ï¼‰æ—¶ä½¿ç”¨</p>
<p><code>in</code> é€†å˜ï¼Œä½¿ç”¨çˆ¶ç±»æ³›å‹çš„å¯¹è±¡å¯ä»¥èµ‹å€¼ç»™ä½¿ç”¨å­ç±»æ³›å‹çš„å¯¹è±¡ï¼Œç›¸å½“äº<code>super</code>ï¼Œç”¨äºæ–¹æ³•çš„å‚æ•°ï¼ˆæ¶ˆè´¹è€…ï¼‰æ—¶ä½¿ç”¨</p>
<p>ä¸å˜ï¼Œå½“æ³›å‹å³å½“æ¶ˆè´¹è€…ï¼Œåˆå½“ç”Ÿäº§è€…æ—¶ï¼Œä¸ç”¨<code>in</code>æˆ–è€…<code>out</code></p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æ˜Ÿå·æŠ•å°„</h2>
<blockquote>
<p>ä½ å¯¹ç±»å‹å‚æ•°ä¸€æ— æ‰€çŸ¥ï¼Œä½†ä»ç„¶å¸Œæœ›ä»¥å®‰å…¨çš„æ–¹å¼ä½¿ç”¨å®ƒã€‚</p>
</blockquote>
<p><strong>å®‰å…¨çš„ä½¿ç”¨</strong>ï¼Œåˆ™è¡¨ç¤ºè¯¥ç±»<code>Group&lt;T&gt;</code>æ»¡è¶³</p>
<blockquote>
<p>1.å­ç±»è‡³å°‘æ¥æ”¶å’Œçˆ¶ç±»ä¸€æ ·èŒƒå›´çš„å‚æ•° &gt;= ---&gt; çˆ¶ç±»å…¥å‚ä¸º Noting ä¸èƒ½å®‰å…¨å†™å…¥</p>
<p>2.å­ç±»æœ€å¤šè¿”å›å’Œçˆ¶ç±»ä¸€æ ·èŒƒå›´çš„å‚æ•° &lt;= ---&gt; çˆ¶ç±»å‡ºå‚ä¸º Any? å¯ä»¥å®‰å…¨è¯»å–</p>
</blockquote>
<p>åˆ™æœ‰ä»¥ä¸‹ä¸‰ç§å®ç°æ–¹å¼</p>
<figure><img src="https://jixiaoyong.github.io/images/20191022194750.png" alt="in-out-star-projection-approaches" tabindex="0" loading="lazy"><figcaption>in-out-star-projection-approaches</figcaption></figure>
<p>å…¶ä¸­ï¼š</p>
<p><code>Group&lt;in Noting&gt;</code> çš„<code>fetch()</code>æ–¹æ³•ä¸€ç›´è¿”å›<code>Any?</code></p>
<p><code>Group&lt;out Any?&gt;</code> çš„<code>T</code>éœ€è¦ä¸å®é™…çš„<code>Group</code>çš„<code>T</code>ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p>
<p><code>Group&lt;*&gt;</code> æ—¢èƒ½<code>insert</code>æ­£ç¡®è¿”å›å¯¹åº”çš„ç±»å‹ï¼Œä¹Ÿä¸ç”¨å®æ—¶ä¿®æ”¹</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å§”æ‰˜</h2>
<p>å§”æ‰˜æ˜¯å°†é‡å¤å‡ºç°çš„ä»£ç æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20191023194526.png" alt="å§”æ‰˜ç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>å§”æ‰˜ç¤ºæ„å›¾</figcaption></figure>
<ul>
<li>ç±»å§”æ‰˜ï¼š</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ · B ä¾¿å¯ä»¥å°†<code>Interface</code>ä¸­æ–¹æ³•çš„å®ç°å§”æ‰˜ç»™ç±»<code>A</code>çš„å¯¹è±¡<code>a</code></p>
<ul>
<li>å§”æ‰˜å±æ€§ï¼š</li>
</ul>
<p>å°†åŒä¸€ç±»å‹çš„å±æ€§çš„<code>get</code>ã€<code>set</code>æ–¹æ³•æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹å®ç°ï¼Œå¯ä»¥åœ¨åŠ å…¥<code>å…¶å®ƒæ“ä½œ</code></p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>å§”æ‰˜ç±»çš„åˆå§‹åŒ–å‡½æ•°ï¼š</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>Map å§”æ‰˜ï¼š</li>
</ul>
<p>å°†ç±»çš„<code>å±æ€§</code>åç§°å’Œ<code>map</code>ä¸­çš„<code>key</code>ä¸€ä¸€å¯¹åº”ï¼Œä»è€Œå°†å¯¹äº<code>value</code>èµ‹å€¼ç»™<code>å±æ€§</code></p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>veroable</li>
</ul>
<p>å¯ä»¥æ‹¦æˆªèµ‹å€¼æ“ä½œ</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ä¸­ç¼€å‡½æ•°</h2>
<p>éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li>æˆå‘˜å‡½æ•°æˆ–æ‹“å±•å‡½æ•°</li>
<li>åªæœ‰ä¸€ä¸ªå‚æ•°</li>
<li>infix å£°æ˜</li>
</ol>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> inline å†…è”å‡½æ•°</h2>
<p><code>inline</code>ä¿®é¥°çš„å‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶å°†å­—èŠ‚ç åŠ¨æ€æ’å…¥åˆ°è¢«åˆ°è°ƒç”¨çš„åœ°æ–¹ã€‚</p>
<p><code>inline</code>ä¿®é¥°çš„å‡½æ•°çš„<code>lambdaå‚æ•°</code>å¦‚æœè¿è¡Œåœ¨è¯¥å‡½æ•°å†…éƒ¨çš„*<code>å­å‡½æ•°/å…¶ä»–ç¯å¢ƒ</code>*ï¼Œåˆ™ä¸å…è®¸è¿™ä¸ª lambda å‡½æ•°<strong>éå±€éƒ¨è¿”å›</strong>ï¼ˆå› ä¸ºæ²¡æœ‰åŠæ³•ä»è¯¥ <code>å­å‡½æ•°/å…¶ä»–ç¯å¢ƒ</code> ä¸­ç›´æ¥é€€å‡º lambda æ‰€åœ¨çš„å¤–å±‚å‡½æ•°ï¼‰ï¼Œå¯¹äºè¿™ç§ lambda å‡½æ•°éœ€è¦æ·»åŠ **<code>crossinline</code>**ä¿®é¥°ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kotlin ä¹Ÿå­˜åœ¨ Java æ³›å‹æ‰€å…·æœ‰çš„<strong>ç±»å‹æ“¦é™¤</strong>é—®é¢˜ï¼Œä¸ºäº†ä¼˜åŒ–è¯¥é—®é¢˜ï¼Œinline å‡½æ•°å¯ä»¥ç»“åˆ<code>reified</code>å®ç°<strong>å®ä½“åŒ–ç±»å‹å‚æ•°</strong></p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>**åŸç†ï¼š**å†…è”å‡½æ•°ä¼šç›´æ¥è¢«æ’å…¥åˆ°è¢«è°ƒç”¨çš„åœ°æ–¹ï¼Œè€Œ<code>reified</code>ä¿®é¥°çš„ç±»å‹å‚æ•°ä¼šä¿è¯å°†ç”¨æˆ·è°ƒç”¨æ—¶å†™çš„ç±»å‹<code>String</code>åŒæ—¶ä¹Ÿå†™å…¥åˆ°è¢«è°ƒç”¨çš„åœ°æ–¹ï¼Œå¦‚æ­¤ä¾¿æ²¡æœ‰å‘ç”Ÿç±»å‹æ“¦é™¤ã€‚</p>
<h2> coroutines åç¨‹</h2>
<p>åç¨‹å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ threadï¼Œä»–è¿è¡Œåœ¨çº¿ç¨‹å½“ä¸­ï¼Œç”±ç”¨æˆ·æ§åˆ¶ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚</p>
<p>åœ¨ Android ä¸­ä½¿ç”¨åç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨ IO æ“ä½œåŠç½‘ç»œè¯·æ±‚ç­‰éœ€è¦æ ¹æ®è€—æ—¶æ“ä½œæ›´æ–°ç•Œé¢çš„éœ€æ±‚æ—¶ï¼Œå¯ä»¥å°† IO æ“ä½œå’Œç•Œé¢æ“ä½œä¸²è¡Œï¼Œé¿å…åˆ‡æ¢çº¿ç¨‹ã€å›è°ƒåµŒå¥—ç­‰å¯¼è‡´ä»£ç å¯è¯»æ€§æŸ¥çš„é—®é¢˜ã€‚</p>
<p>å¦‚é…åˆæ”¯æŒåç¨‹çš„ retrofitï¼Œæˆ‘ä»¬å¯ä»¥å°†ç½‘ç»œè¯·æ±‚ç®€åŒ–å¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>kotlin åç¨‹éœ€è¦å•ç‹¬æ·»åŠ ä¾èµ–ï¼š</p>
<div class="language-groovy line-numbers-mode" data-ext="groovy"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€ä¸ªçˆ¶åç¨‹æ€»æ˜¯ç­‰å¾…æ‰€æœ‰çš„å­åç¨‹æ‰§è¡Œç»“æŸï¼Œçˆ¶åç¨‹è¢«å–æ¶ˆçš„æ—¶å€™ï¼Œæ‰€æœ‰å®ƒçš„å­åç¨‹ä¹Ÿä¼šè¢«é€’å½’çš„å–æ¶ˆã€‚</p>
<h3> åç¨‹ä¸­<code>runBlocking</code>ä¸<code>coroutineScope</code>çš„åŒºåˆ«</h3>
<p>ç›¸åŒç‚¹ï¼š</p>
<p>ä¾æ¬¡æ‰§è¡Œå†…éƒ¨ä»£ç ï¼Œå¦‚æœ<code>ä»£ç 1</code>æ˜¯å¯åŠ¨åç¨‹ï¼Œé‚£ä¹ˆå¯åŠ¨è¯¥å­åç¨‹åï¼Œç»§ç»­æ‰§è¡Œ<code>ä»£ç 1</code>åé¢çš„ä»£ç ç›´åˆ°æœ€åä¸€è¡Œï¼ˆç±»ä¼¼å¯åŠ¨æ–°çº¿ç¨‹ï¼Œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼‰ï¼Œç„¶åå†ç­‰å¾…æ‰€æœ‰å†…éƒ¨åç¨‹ç»“æŸï¼Œæ‰ä¼šé€€å‡ºã€‚</p>
<p>ä¸åŒç‚¹ï¼š</p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/run-blocking.html" target="_blank" rel="noopener noreferrer"><strong><code>runBlocking</code></strong></a>ï¼šä¼šè¿è¡Œä¸€ä¸ªæ–°çš„åç¨‹çº¿ç¨‹ï¼Œå¹¶é˜»å¡å…¶æ‰€åœ¨<code>çº¿ç¨‹</code>,ç›´åˆ°å…¶å†…éƒ¨æ‰€æœ‰åç¨‹/å­åç¨‹æ‰§è¡Œå®Œæ¯•æ‰ä¼šé€€å‡ºã€‚è®¾è®¡ç”¨æ¥ä»¥é˜»å¡çš„æ–¹å¼æ‰§è¡Œåç¨‹ä»£ç ï¼Œä¸åº”è¯¥åœ¨åç¨‹ä¸­ä½¿ç”¨ã€‚</p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/coroutine-scope.html" target="_blank" rel="noopener noreferrer"><strong><code>coroutineScope</code></strong></a>ï¼šä¸ä¼šé˜»å¡å…¶æ‰€åœ¨çº¿ç¨‹ï¼Œè¦åœ¨åç¨‹ä¸­ä½¿ç”¨ï¼Œå½“å…¶å†…éƒ¨æ‰€æœ‰åç¨‹/å­åç¨‹æ‰§è¡Œå®Œæ¯•æ‰ä¼šé€€å‡ºã€‚è®¾è®¡ç”¨æ¥æ‰§è¡Œå¹¶è¡Œæ“ä½œï¼Œä¸€æ—¦æœ‰å­åç¨‹å¤±è´¥ï¼Œåˆ™å…¶ä»–å­åç¨‹éƒ½ä¼šè¢«å–æ¶ˆï¼Œæ•´ä¸ªä»£ç å—æ‰§è¡Œå¤±è´¥ã€‚</p>
<h3> åç¨‹çš„æ€ç»´å¯¼å›¾</h3>
<iframe width="853" height="480" src="https://embed.coggle.it/diagram/Xb_CZoumpCamgUAj/1235701ea5f157867e045f0f5ac28f886effdb5fa1e27b72afa5266e6e3e8891" frameborder="0" allowfullscreen=""></iframe>
<p>éœ€è¦è¯´æ˜çš„æ˜¯</p>
<p><code>Dispatchers.Unconfined</code> éå—é™ï¼Œä¸ä¼šé™å®šåç¨‹è¿è¡Œçš„çº¿ç¨‹ï¼Œè€Œæ˜¯éšç¯å¢ƒåˆ‡æ¢</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> åç¨‹å±€éƒ¨å˜é‡</h3>
<p>é€šè¿‡<code>ThreadLocal</code>ã€<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-thread-context-element/index.html" target="_blank" rel="noopener noreferrer"><code>ThreadContextElement</code></a>ï¼Œé…åˆ<code>asContextElement("value")</code>æ–¹æ³•å®ç°ã€‚å’Œåç¨‹æ‰€åœ¨çš„çº¿ç¨‹æ²¡æœ‰å…³ç³»ã€‚</p>
<p>ç›´æ¥ä¿®æ”¹<code>ThreadLocal</code>çš„å€¼ï¼Œä¼šåœ¨åˆ‡æ¢åç¨‹çš„æ—¶å€™å¤±æ•ˆï¼ˆä¼šè¢«æ”¹ä¸ºåˆ‡æ¢åˆ°çš„åç¨‹æ‰€ä½¿ç”¨çš„çš„å€¼ï¼‰ï¼Œå½“å†æ¬¡åˆ‡å›æœ¬åç¨‹æ—¶ï¼Œè¢«é‡ç½®ä¸ºä¸Šä¸€ä¸ªé€šè¿‡<code>asContextElement("value")</code>æ–¹æ³•æ›´æ–°çš„å€¼æˆ–è€…<code>null</code>ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šï¼‰ã€‚</p>
<blockquote>
<p>åŸç†ï¼š<strong>å¯åŠ¨å’Œæ¢å¤æ—¶ä¿å­˜<code>ThreadLocal</code>åœ¨å½“å‰çº¿ç¨‹çš„å€¼ï¼Œå¹¶ä¿®æ”¹ä¸º valueï¼ŒæŒ‚èµ·å’Œç»“æŸæ—¶ä¿®æ”¹å½“å‰çº¿ç¨‹<code>ThreadLocal</code>çš„å€¼ä¸ºä¹‹å‰ä¿å­˜çš„å€¼</strong></p>
<p>â€”â€” <a href="https://johnnyshieh.me/posts/kotlin-coroutine-concurrency/" target="_blank" rel="noopener noreferrer">Kotlin Coroutines(åç¨‹) å®Œå…¨è§£æï¼ˆäº”ï¼‰ï¼Œåç¨‹çš„å¹¶å‘</a></p>
</blockquote>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> åœ¨ Android ä¸­ä½¿ç”¨</h3>
<p>Kotlin å®˜æ–¹æ¨èä¸€ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://typealias.com/guides/star-projections-and-how-they-work/" target="_blank" rel="noopener noreferrer">Star-Projections and How They Work</a></p>
<p><a href="https://blog.csdn.net/u013064109/article/details/83507076" target="_blank" rel="noopener noreferrer">Kotlin çš„ç‹¬é—¨ç§˜ç± Reified å®åŒ–ç±»å‹å‚æ•° (ä¸‹ç¯‡)</a></p>
<p><a href="https://www.kotlincn.net/docs/reference/coroutines/coroutines-guide.html" target="_blank" rel="noopener noreferrer">Kotlin åç¨‹å®˜ç½‘</a></p>
<p><a href="https://johnnyshieh.me/posts/kotlin-coroutine-concurrency/" target="_blank" rel="noopener noreferrer">Kotlin Coroutines(åç¨‹) å®Œå…¨è§£æï¼ˆäº”ï¼‰ï¼Œåç¨‹çš„å¹¶å‘</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20191022194750.png" type="image/png"/>
    </item>
    <item>
      <title>Kotlin å­¦ä¹ ç¬”è®° 3</title>
      <link>https://jixiaoyong.github.io/blog/posts/fd5546ac.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/fd5546ac.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Kotlin å­¦ä¹ ç¬”è®° 3</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 24 Dec 2019 01:38:59 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡ä¸ºç¬”è®°æ€§è´¨ï¼Œå°šæœªæˆæ–‡ï¼Œå¾…æ•´ç†</p>
</blockquote>
<h2> å¼‚æ­¥æµ</h2>
<ol>
<li>lazy æ–¹å¼åˆ›å»ºä¸€ä¸ªåºåˆ—ï¼Œåªæœ‰åœ¨è®¿é—®çš„æ—¶å€™æ‰ç”Ÿäº§å¯¹åº”çš„é¡¹ç›®</li>
</ol>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2">
<li>
<p>ä½¿ç”¨ Flow æµåœ¨ä¸é˜»å¡ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå»¶è¿Ÿç”Ÿäº§å¤šä¸ªå€¼å¹¶è¿”å›</p>
<p>å½“æµåœ¨ä¸€ä¸ªå¯å–æ¶ˆçš„æŒ‚èµ·å‡½æ•°ï¼ˆä¾‹å¦‚ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/delay.html" target="_blank" rel="noopener noreferrer">delay</a>ï¼‰ä¸­æŒ‚èµ·çš„æ—¶å€™å–æ¶ˆï¼Œå¦åˆ™ä¸èƒ½å–æ¶ˆã€‚</p>
</li>
</ol>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flow-of.html" target="_blank" rel="noopener noreferrer">flowOf</a> æ„å»ºå™¨å®šä¹‰äº†ä¸€ä¸ªå‘å°„å›ºå®šå€¼é›†çš„æµã€‚</p>
<p>ä½¿ç”¨ <code>.asFlow()</code> æ‰©å±•å‡½æ•°ï¼Œå¯ä»¥å°†å„ç§é›†åˆä¸åºåˆ—è½¬æ¢ä¸ºæµã€‚</p>
<p>å¯ä»¥ä½¿ç”¨æ“ä½œç¬¦è½¬æ¢æµï¼Œå°±åƒä½¿ç”¨é›†åˆä¸åºåˆ—ä¸€æ ·ã€‚è¿‡æ¸¡æ“ä½œç¬¦åº”ç”¨äºä¸Šæ¸¸æµï¼Œå¹¶è¿”å›ä¸‹æ¸¸æµã€‚è¿™äº›æ“ä½œç¬¦ä¹Ÿæ˜¯å†·æ“ä½œç¬¦ï¼Œå°±åƒæµä¸€æ ·ã€‚è¿™ç±»æ“ä½œç¬¦ï¼ˆ<code>map</code>ã€<code>fliter</code>...ï¼‰æœ¬èº«ä¸æ˜¯æŒ‚èµ·å‡½æ•°ï¼Œä½†æ˜¯å¯ä»¥è°ƒç”¨æŒ‚èµ·å‡½æ•°<code>suspend</code>ã€‚å®ƒè¿è¡Œçš„é€Ÿåº¦å¾ˆå¿«ï¼Œè¿”å›æ–°çš„è½¬æ¢æµçš„å®šä¹‰ã€‚</p>
<p>åœ¨æµè½¬æ¢æ“ä½œç¬¦ä¸­ï¼Œæœ€é€šç”¨çš„ä¸€ç§ç§°ä¸º <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/transform.html" target="_blank" rel="noopener noreferrer">transform</a>ã€‚å®ƒå¯ä»¥ç”¨æ¥æ¨¡ä»¿ç®€å•çš„è½¬æ¢ï¼Œä¾‹å¦‚ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/map.html" target="_blank" rel="noopener noreferrer">map</a> ä¸ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/filter.html" target="_blank" rel="noopener noreferrer">filter</a>ï¼Œä»¥åŠå®æ–½æ›´å¤æ‚çš„è½¬æ¢ã€‚ä½¿ç”¨ <code>transform</code> æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow-collector/emit.html" target="_blank" rel="noopener noreferrer">å‘å°„</a> ä»»æ„å€¼ä»»æ„æ¬¡</p>
<p>é™é•¿è¿‡æ¸¡æ“ä½œç¬¦ï¼ˆä¾‹å¦‚ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/take.html" target="_blank" rel="noopener noreferrer">take</a>ï¼‰åœ¨æµè§¦åŠç›¸åº”é™åˆ¶çš„æ—¶å€™ä¼šå°†å®ƒçš„æ‰§è¡Œå–æ¶ˆã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµæ„é€ å™¨ä¸­çš„åç¨‹ä¸Šä¸‹æ–‡é»˜è®¤å’Œ collect çš„åç¨‹ä¸Šä¸‹æ–‡ä¸€è‡´ï¼Œå¦‚æœå¼ºè¡Œè½¬æ¢ä¸Šä¸‹æ–‡ä¼šå‡ºé”™ã€‚</p>
<p>è€Œä½¿ç”¨<code>flowOn()</code>åˆ™å¯ä»¥æŒ‡å®šæµåˆ›å»ºçš„åç¨‹ä¸Šä¸‹æ–‡ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ flow çš„ç”Ÿäº§å’Œæ”¶é›†å¾ˆæ¶ˆè€—æ—¶é—´æ—¶ï¼Œå¯ä»¥ç”¨<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/buffer.html" target="_blank" rel="noopener noreferrer"><code>buffer()</code></a>å‡½æ•°å°†<code>buffer()</code>ä¹‹å‰çš„ä»£ç åœ¨ä¸€ä¸ªå•ç‹¬çš„åç¨‹è¿è¡Œï¼Œcollect åˆ™åœ¨è°ƒç”¨åç¨‹è¿è¡Œï¼Œè¿™æ ·å°† flow çš„æ„å»ºã€æ”¶é›†ç”±ä¸²è¡Œè½¬åŒ–ä¸ºå¹¶è¡Œå¯ä»¥èŠ‚çº¦æ—¶é—´ï¼ˆå¦‚æœæ„å»ºè¿è¡Œçš„å¿«ï¼Œåˆ™ä¼šæŒ‚èµ·ç›´åˆ° collect èµ¶ä¸Šæ¥ï¼‰ã€‚</p>
<blockquote>
<p>It will use two coroutines for execution of the code. A coroutine <code>Q</code> that calls this code is going to execute <code>collect</code>, and the code before <code>buffer</code> will be executed in a separate new coroutine <code>P</code> concurrently with <code>Q</code></p>
</blockquote>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> åˆå¹¶ conflate</h2>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/conflate.html" target="_blank" rel="noopener noreferrer">conflate</a> operator can be used to skip intermediate values when a collector is too slow to process them.</p>
<p>å½“ collect æ¯”æ„å»ºæ…¢çš„æ—¶å€™ï¼Œå°±åªä¼šè¯·æ±‚æœ€æ–°çš„å€¼ï¼Œè€Œè·³è¿‡ä¸­é—´ç”Ÿäº§çš„è¿™äº›å€¼ã€‚</p>
<p>æ¯”å¦‚ï¼Œæ„å»ºå™¨ç”Ÿäº§äº† 1ï¼Œ2ï¼Œ... ,100 è¿™äº›æ•°ï¼Œè€Œ collect è¯»å–çš„æ…¢ï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™æ˜¯ 1ï¼Œç­‰å¤„ç†å®Œå†è¯»å–çš„æ—¶å€™æ„å»ºå™¨ç”Ÿäº§çš„æ˜¯ 5ï¼Œé‚£ä¹ˆ collect å°±è¯»å– 5ï¼Œä¸­é—´çš„ 2ï¼Œ3ï¼Œ4 éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<p>Conflation is one way to speed up processing when both the emitter and collector are slow . The other way is to cancel a slow collector and restart it every time a new value is emitted.</p>
<p><code>collectLatest</code>å¯ä»¥ä¿è¯æ¯æ¬¡éƒ½è·å–æœ€æ–°çš„å€¼ï¼Œå¦‚æœ collect æ¯”ç”Ÿäº§æ…¢ï¼Œé‚£ä¹ˆå½“æ–°çš„å€¼ç”Ÿäº§å‡ºæ¥æ—¶ï¼Œcollect ä¼šè¢«å–æ¶ˆï¼Œå¹¶ä¸”å»å¤„ç†æœ€æ–°çš„å€¼ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ç»„åˆå¤šä¸ªæµ</h2>
<p><code>zip</code>å°†ä¸¤ä¸ªæµâ€œå‹ç¼©â€ä¸ºä¸€ä¸ªæµï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ flow è¡¨ç¤ºå˜é‡æˆ–æ“ä½œçš„æœ€æ–°å€¼æ—¶ (å‚è§å…³äºåˆå¹¶çš„ç›¸å…³ç« èŠ‚) ï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œä¾èµ–äºç›¸åº”æµçš„æœ€æ–°å€¼çš„è®¡ç®—ï¼Œå¹¶åœ¨ä»»ä½•ä¸Šæ¸¸æµå‘å‡ºå€¼æ—¶é‡æ–°è®¡ç®—å®ƒã€‚ç›¸åº”çš„æ“ä½œç¬¦æ—ç§°ä¸ºè”åˆæ“ä½œç¬¦ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/combine.html" target="_blank" rel="noopener noreferrer"><code>combine</code></a>ã€‚å³æ¯ä¸ªæ„å»ºå€¼å‘ç”Ÿå˜åŒ–æ—¶éƒ½ä¼šè§¦å‘ collectã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-concat.html" target="_blank" rel="noopener noreferrer"><code>flatMapConcat</code></a> å¯ä»¥å°† flow çš„å†…å®¹â€œæŠ¹å¹³â€ï¼ˆå³å‡è®¾åŸå…ˆä¸º<code>Array&lt;Array&lt;Int&gt;&gt;</code>ï¼Œåˆ™æŠ¼å¹³åä¸ºï¼š<code>Array&lt;Int&gt;</code>ï¼‰ã€‚ä¸²è¡Œæ‰§è¡Œï¼Œå³å…ˆæ‰§è¡Œä»£ç å—ï¼Œç„¶åå¯¹å…¶<code>flatMapConcat</code>ï¼Œç„¶å collectï¼Œä¹‹åå†æ‰§è¡Œä¸‹ä¸€è½®çš„ Flow é¡¹ç›®ã€‚</p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-merge.html" target="_blank" rel="noopener noreferrer"><code>flatMapMerge</code></a> æŒ‰é¡ºåºè°ƒç”¨å®ƒçš„ä»£ç å—ï¼Œä½†æ˜¯åŒæ—¶æ”¶é›†ç»“æœæµï¼Œè¿™ç›¸å½“äºé¦–å…ˆæ‰§è¡Œä¸€ä¸ªé¡ºåºæ˜ å°„ï¼Œç„¶åå¯¹ç»“æœè°ƒç”¨ flattonmergeã€‚å¹¶è¡Œæ‰§è¡Œï¼Œå…ˆä¾æ¬¡å¯¹ Flow é¡¹ç›®è°ƒç”¨ä»£ç å—ï¼Œç„¶åå“ªä¸ªå€¼å…ˆå‡ºæ¥ï¼Œå°±å…ˆå¯¹å…¶è°ƒç”¨ <code>flatMapMerge</code>ï¼Œç„¶å collectã€‚</p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-latest.html" target="_blank" rel="noopener noreferrer"><code>flatMapLatest</code></a> ç±»ä¼¼ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/collect-latest.html" target="_blank" rel="noopener noreferrer"><code>collectLatest</code></a> ï¼Œæ¯æ¬¡æ–°å€¼å‡ºæ¥å°±ä¼šå–æ¶ˆè¿˜æ²¡æœ‰å¤„ç†ç»“æŸçš„æ—§æµçš„æ“ä½œã€‚</p>
<h2> æµå¼‚å¸¸</h2>
<p>æµçš„å¼‚å¸¸æœ‰å¦‚ä¸‹æ•è·æ–¹å¼ï¼š</p>
<ol>
<li>
<p><a href="https://kotlinlang.org/docs/reference/exceptions.html" target="_blank" rel="noopener noreferrer"><code>try/catch</code></a> block</p>
</li>
<li>
<p>é€æ˜æ•è· <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/catch.html" target="_blank" rel="noopener noreferrer">catch</a> ï¼Œåªä¼šæ•è·å‘é€åœ¨ä»–ä¹‹å‰çš„å¼‚å¸¸</p>
</li>
<li>
<h4> å£°æ˜å¼æ•è· å°† collect çš„ä¸»è¦é€»è¾‘æ”¾åˆ° onEach ä¸­ï¼Œä¿è¯ onEach åœ¨ catch ä¹‹å‰</h4>
</li>
</ol>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æµå®Œæˆ</h2>
<ol>
<li>
<p><code>try</code>/<code>finally</code></p>
</li>
<li>
<p><code>onCompletion()</code></p>
</li>
</ol>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œä¸”ä»–è¿˜å¯ä»¥åˆ¤æ–­æ˜¯å¦æ˜¯å¼‚å¸¸é€€å‡ºã€‚ä½†æ˜¯åªæ˜¯åˆ¤æ–­ï¼Œå¹¶ä¸ä¼šå¤„ç†ã€æ‹¦æˆªå¼‚å¸¸ï¼Œå¹¶ä¸”åªèƒ½å¤„ç†ä¸Šæ¸¸çš„å¼‚å¸¸ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> launchIn(this) ä¸ collect</h2>
<p><code>collect</code>åçš„ä»£ç åªæœ‰åœ¨ collect æ‰§è¡Œå®Œåæ‰èƒ½æ‰§è¡Œï¼Œè€Œ<code>launchIn</code>å¯ä»¥æŒ‡å®šå…¶åœ¨å•ç‹¬çš„åç¨‹ç¨‹åºä¸­å¯åŠ¨æµçš„é›†åˆï¼Œä»è€Œä¸ä¼šé˜»å¡å½“å‰åç¨‹ã€‚</p>
<h2> Channel</h2>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/index.html" target="_blank" rel="noopener noreferrer">Channel</a> ç±»ä¼¼äº BlockingQueueã€‚ä½†ä»–çš„æ“ä½œæ˜¯æŒ‚èµ·çš„ã€‚<br>
Channel æä¾›äº†åœ¨åç¨‹ä¹‹é—´ä¼ é€’å¤šä¸ªå€¼çš„æ–¹æ³•</p>
<p><code>send</code> å‘é€ ç¼“å­˜åŒºå·²æ»¡æˆ–ä¸å­˜åœ¨æ—¶è°ƒç”¨æ–¹ä¼šè¢«æŒ‚èµ·</p>
<p><code>channel.receive()</code> æ¥æ”¶</p>
<p><code>channel.close()</code> å…³é—­é€šé“ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„å…ƒç´ è¿›å…¥é€šé“</p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/produce.html" target="_blank" rel="noopener noreferrer"><code>CoroutineScope.produce</code></a> Launches new coroutine to produce a stream of values by sending them to a channel and returns a reference to the coroutine as a <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-receive-channel/index.html" target="_blank" rel="noopener noreferrer">ReceiveChannel</a>. This resulting object can be used to <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-receive-channel/receive.html" target="_blank" rel="noopener noreferrer">receive</a> elements produced by this coroutine. åœ¨æ–°çš„åç¨‹ä¸­ç”Ÿäº§å¹¶è¿”å›äº†ä¸€ä¸ª<code>ReceiveChannel&lt;T&gt;</code>å¯¹è±¡ã€‚</p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/consume-each.html" target="_blank" rel="noopener noreferrer"><code>ReceiveChannel&lt;E&gt;.consumeEach</code></a> éå† ReceiveChannel çš„ item æ‰§è¡ŒæŒ‡å®š actionï¼Œå¹¶åœ¨å—æ‰§è¡Œå®Œæ¯•åæ¶ˆè€—æ‰è¿™ä¸ª ReceiveChannelï¼ˆè°ƒç”¨ cancel()ï¼‰ã€‚</p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-receive-channel/index.html" target="_blank" rel="noopener noreferrer">ReceiveChannel</a>.<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-receive-channel/cancel.html" target="_blank" rel="noopener noreferrer">cancel()</a> å–æ¶ˆæ¥æ”¶æ¥è‡ªè¿™ä¸ªé€šé“çš„å‰©ä½™å…ƒç´ ï¼Œå…³é—­é€šé“å¹¶ä»ä¸­åˆ é™¤æ‰€æœ‰ç¼“å­˜çš„å…ƒç´ ã€‚</p>
<p><code>tickerChannel</code> å®šæ—¶è¿”å›<code>Unit</code>çš„<code>channel</code>ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> Flow/Channel/Sequence çš„åŒºåˆ«</h2>
<p><code>Flow</code>æ˜¯ç”¨æ¥å¼‚æ­¥è¿”å›å¤šä¸ªå€¼ï¼Œå…¶å†…éƒ¨æ“ä½œå¯ä»¥æŒ‚èµ·</p>
<p><code>Channel</code> ç”¨æ¥åœ¨åç¨‹ä¹‹é—´ä¼ é€’å¤šä¸ªå€¼ï¼ˆtransfer a stream of valuesï¼‰</p>
<p><code>Sequence</code> ç”¨æ¥é€ä¸ªåœ¨ item ä¸­å»¶è¿Ÿæ‰§è¡Œå®Œæ•´æ“ä½œï¼Œç›¸æ¯”äº<code>list</code>ç­‰æ•´ä½“æ‰§è¡Œå®Œæ¯•æ‰è¿›è¡Œä¸‹ä¸€çº§æ“ä½œçš„â€œå¼“â€å­—å‹ï¼Œ<code>Sequence</code>å¤šçº§æ“ä½œæ˜¯é€ä¸ª item ä¾æ¬¡å®Œæ•´æ‰§è¡Œå¤šçº§æ“ä½œçš„â€œå‡ â€å­—å‹ã€‚</p>
<h2> ç®¡é“</h2>
<p>ç®¡é“æŒ‡ï¼š1.ä¸€ä¸ªåç¨‹åœ¨æµä¸­å¼€å§‹ç”Ÿäº§æ— ç©·å¤šä¸ªå…ƒç´  2.å¦ä¸€ä¸ªæˆ–å¤šä¸ªåç¨‹æ¶ˆè´¹è¿™äº›æµ</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ²¡æœ‰ç¼“å†²çš„é€šé“ï¼šå¦‚æœå‘é€å…ˆè¢«è°ƒç”¨ï¼Œåˆ™å®ƒå°†è¢«æŒ‚èµ·ç›´åˆ°æ¥æ”¶è¢«è°ƒç”¨ï¼Œå¦‚æœæ¥æ”¶å…ˆè¢«è°ƒç”¨ï¼Œå®ƒå°†è¢«æŒ‚èµ·ç›´åˆ°å‘é€è¢«è°ƒç”¨ã€‚</p>
<p>å¸¦ç¼“å†²çš„é€šé“ï¼š <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel.html" target="_blank" rel="noopener noreferrer">Channel()</a> å·¥å‚å‡½æ•°ä¸ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/produce.html" target="_blank" rel="noopener noreferrer">produce</a> å»ºé€ å™¨é€šè¿‡ä¸€ä¸ªå¯é€‰çš„å‚æ•° <code>capacity</code> æ¥æŒ‡å®š <em>ç¼“å†²åŒºå¤§å°</em>ã€‚ç¼“å†²å…è®¸å‘é€è€…åœ¨è¢«æŒ‚èµ·å‰å‘é€å¤šä¸ªå…ƒç´ ï¼Œå°±åƒ <code>BlockingQueue</code> æœ‰æŒ‡å®šçš„å®¹é‡ä¸€æ ·ï¼Œå½“ç¼“å†²åŒºè¢«å æ»¡çš„æ—¶å€™å°†ä¼šå¼•èµ·é˜»å¡ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‘é€å’Œæ¥æ”¶æ“ä½œæ˜¯ <em>å…¬å¹³çš„</em> å¹¶ä¸”å°Šé‡è°ƒç”¨å®ƒä»¬çš„å¤šä¸ªåç¨‹ã€‚å®ƒä»¬éµå®ˆå…ˆè¿›å…ˆå‡ºåŸåˆ™ã€‚</p>
<p>è®¡æ—¶å™¨é€šé“æ˜¯ä¸€ç§ç‰¹åˆ«çš„ä¼šåˆé€šé“ï¼Œæ¯æ¬¡ç»è¿‡ç‰¹å®šçš„å»¶è¿Ÿéƒ½ä¼šä»è¯¥é€šé“è¿›è¡Œæ¶ˆè´¹å¹¶äº§ç”Ÿ <code>Unit</code> ã€‚å¦‚æœåœ¨é—´éš”è¿˜æ²¡åˆ°çš„æ—¶å€™è°ƒç”¨<code>tickerChannel.receive()</code>åˆ™ä¼šè¿”å›<code>null</code>ã€‚äº§ç”Ÿçš„é—´éš”ç”±<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-ticker-mode/index.html" target="_blank" rel="noopener noreferrer"><code>TickerModel</code></a>æ§åˆ¶</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>coroutineContext.cancelChildren()</code> // å–æ¶ˆæ‰€æœ‰çš„å­åç¨‹æ¥è®©ä¸»åç¨‹ç»“æŸ</p>
<h2> å¼‚å¸¸</h2>
<h3> å¼‚å¸¸çš„ä¼ æ’­</h3>
<p>åç¨‹æ„å»ºå™¨æœ‰ä¸¤ç§é£æ ¼ï¼šè‡ªåŠ¨çš„ä¼ æ’­å¼‚å¸¸ï¼ˆ<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/launch.html" target="_blank" rel="noopener noreferrer">launch</a> ä»¥åŠ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/actor.html" target="_blank" rel="noopener noreferrer">actor</a>ï¼‰æˆ–è€…å°†å®ƒä»¬æš´éœ²ç»™ç”¨æˆ·ï¼ˆ<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/async.html" target="_blank" rel="noopener noreferrer">async</a> ä»¥åŠ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/produce.html" target="_blank" rel="noopener noreferrer">produce</a>ï¼‰ã€‚å‰è€…å¯¹å¾…å¼‚å¸¸æ˜¯ä¸å¤„ç†çš„ï¼Œç±»ä¼¼äº Java çš„ <code>Thread.uncaughtExceptionHandler</code>ï¼Œè€Œåè€…ä¾èµ–ç”¨æˆ·æ¥æœ€ç»ˆæ¶ˆè€—å¼‚å¸¸ï¼Œæ¯”å¦‚è¯´ï¼Œé€šè¿‡ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-deferred/await.html" target="_blank" rel="noopener noreferrer">await</a> æˆ– <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-receive-channel/receive.html" target="_blank" rel="noopener noreferrer">receive</a></p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-exception-handler/index.html" target="_blank" rel="noopener noreferrer">CoroutineExceptionHandler</a> ä»…åœ¨é¢„è®¡ä¸ä¼šç”±ç”¨æˆ·å¤„ç†çš„å¼‚å¸¸ä¸Šè°ƒç”¨ï¼Œæ‰€ä»¥åœ¨ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/async.html" target="_blank" rel="noopener noreferrer">async</a> æ„å»ºå™¨ä¸­æ³¨å†Œå®ƒæ²¡æœ‰ä»»ä½•æ•ˆæœã€‚</p>
<p>åç¨‹å†…éƒ¨ä½¿ç”¨ <code>CancellationException</code> æ¥è¿›è¡Œå–æ¶ˆï¼Œè¿™ä¸ªå¼‚å¸¸ä¼šè¢«æ‰€æœ‰çš„å¤„ç†è€…å¿½ç•¥ï¼Œæ‰€ä»¥é‚£äº›å¯ä»¥è¢« <code>catch</code> ä»£ç å—æ•è·çš„å¼‚å¸¸ä»…ä»…åº”è¯¥è¢«ç”¨æ¥ä½œä¸ºé¢å¤–è°ƒè¯•ä¿¡æ¯çš„èµ„æºã€‚</p>
<p>å¦‚æœåç¨‹é‡åˆ°é™¤ <code>CancellationException</code> ä»¥å¤–çš„å¼‚å¸¸ï¼Œå®ƒå°†å–æ¶ˆå…·æœ‰è¯¥å¼‚å¸¸çš„çˆ¶åç¨‹ã€‚è¿™ç§è¡Œä¸ºä¸èƒ½è¢«è¦†ç›–ï¼Œä¸”å®ƒè¢«ç”¨æ¥æä¾›ä¸€ä¸ªç¨³å®šçš„åç¨‹å±‚æ¬¡ç»“æ„æ¥è¿›è¡Œ<a href="https://github.com/Kotlin/kotlinx.coroutines/blob/master/docs/composing-suspending-functions.md#structured-concurrency-with-async" target="_blank" rel="noopener noreferrer">ç»“æ„åŒ–å¹¶å‘</a>è€Œæ— éœ€ä¾èµ– <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-exception-handler/index.html" target="_blank" rel="noopener noreferrer">CoroutineExceptionHandler</a> çš„å®ç°ã€‚ä¸”å½“æ‰€æœ‰çš„å­åç¨‹è¢«ç»ˆæ­¢çš„æ—¶å€™ï¼ŒåŸæœ¬çš„å¼‚å¸¸è¢«çˆ¶åç¨‹æ‰€å¤„ç†ã€‚</p>
<p>åº”è¯¥å°†<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-exception-handler/index.html" target="_blank" rel="noopener noreferrer">CoroutineExceptionHandler</a> æ€»æ˜¯è¢«è®¾ç½®åœ¨ç”± <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-global-scope/index.html" target="_blank" rel="noopener noreferrer">GlobalScope</a> å¯åŠ¨çš„åç¨‹ä¸­ã€‚å°†å¼‚å¸¸å¤„ç†è€…è®¾ç½®åœ¨ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/run-blocking.html" target="_blank" rel="noopener noreferrer">runBlocking</a> ä¸»ä½œç”¨åŸŸå†…å¯åŠ¨çš„åç¨‹ä¸­æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå°½ç®¡å­åç¨‹å·²ç»è®¾ç½®äº†å¼‚å¸¸å¤„ç†è€…ï¼Œä½†æ˜¯ä¸»åç¨‹ä¹Ÿæ€»æ˜¯ä¼šè¢«å–æ¶ˆçš„ã€‚</p>
<p>å¼‚å¸¸è¢«æŠ›å‡ºåï¼Œæ‰€æœ‰åŒçº§çš„å­åç¨‹éƒ½ä¼šè¢«å…³é—­ï¼Œç„¶åå¼‚å¸¸ä¼ é€’ç»™çˆ¶åç¨‹ï¼Œç›´åˆ°å¼‚å¸¸è¢«å¤„ç†ã€‚</p>
<p>ä¸€ä¸ªåç¨‹çš„å¤šä¸ªå­åç¨‹æŠ›å‡ºå¼‚å¸¸å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿé€šå¸¸çš„è§„åˆ™æ˜¯â€œç¬¬ä¸€ä¸ªå¼‚å¸¸èµ¢å¾—äº†èƒœåˆ©â€œã€‚</p>
<h3> ç›‘ç£</h3>
<p>æ™®é€šçš„å–æ¶ˆ æ˜¯ä¸€ç§åŒå‘æœºåˆ¶ï¼Œåœ¨åç¨‹çš„æ•´ä¸ªå±‚æ¬¡ç»“æ„ä¹‹é—´ä¼ æ’­ã€‚</p>
<p>SupervisorJob å®ƒç±»ä¼¼äºå¸¸è§„çš„ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-job.html" target="_blank" rel="noopener noreferrer">Job</a>ï¼Œä½†ä»–çš„å–æ¶ˆåªä¼šå‘ä¸‹ä¼ æ’­</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5> ç›‘ç£ä½œä¸š</h5>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-supervisor-job.html" target="_blank" rel="noopener noreferrer">SupervisorJob</a> å¯ä»¥è¢«ç”¨äºè¿™äº›ç›®çš„ã€‚å®ƒç±»ä¼¼äºå¸¸è§„çš„ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-job.html" target="_blank" rel="noopener noreferrer">Job</a>ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯ï¼šSupervisorJob çš„å–æ¶ˆåªä¼šå‘ä¸‹ä¼ æ’­ã€‚è¿™æ˜¯éå¸¸å®¹æ˜“ä»ç¤ºä¾‹ä¸­è§‚å¯Ÿåˆ°çš„ï¼š</p>
<h5> ç›‘ç£ä½œç”¨åŸŸ</h5>
<p>å¯¹äº<em>ä½œç”¨åŸŸ</em>çš„å¹¶å‘ï¼Œ<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/supervisor-scope.html" target="_blank" rel="noopener noreferrer">supervisorScope</a> å¯ä»¥è¢«ç”¨æ¥æ›¿ä»£ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/coroutine-scope.html" target="_blank" rel="noopener noreferrer">coroutineScope</a> æ¥å®ç°ç›¸åŒçš„ç›®çš„ã€‚å®ƒåªä¼šå•å‘çš„ä¼ æ’­å¹¶ä¸”å½“å­ä½œä¸šè‡ªèº«æ‰§è¡Œå¤±è´¥çš„æ—¶å€™å°†å®ƒä»¬å…¨éƒ¨å–æ¶ˆã€‚å®ƒä¹Ÿä¼šåœ¨æ‰€æœ‰çš„å­ä½œä¸šæ‰§è¡Œç»“æŸå‰ç­‰å¾…ï¼Œå°±åƒ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/coroutine-scope.html" target="_blank" rel="noopener noreferrer">coroutineScope</a> æ‰€åšçš„é‚£æ ·ã€‚</p>
<h5> ç›‘ç£åç¨‹ä¸­çš„å¼‚å¸¸</h5>
<p>å¸¸è§„çš„ä½œä¸šå’Œç›‘ç£ä½œä¸šä¹‹é—´çš„å¦ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯å¼‚å¸¸å¤„ç†ã€‚æ¯ä¸€ä¸ªå­ä½œä¸šåº”è¯¥é€šè¿‡å¼‚å¸¸å¤„ç†æœºåˆ¶å¤„ç†è‡ªèº«çš„å¼‚å¸¸ã€‚è¿™ç§å·®å¼‚æ¥è‡ªäºå­ä½œä¸šçš„æ‰§è¡Œå¤±è´¥ä¸ä¼šä¼ æ’­ç»™å®ƒçš„çˆ¶ä½œä¸šçš„äº‹å®ã€‚</p>
<h3> åç¨‹çš„çº¿ç¨‹å®‰å…¨</h3>
<ol>
<li>
<p>ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>ä»¥ç»†ç²’åº¦é™åˆ¶çº¿ç¨‹</p>
</li>
<li>
<p>ä»¥ç²—ç²’åº¦é™åˆ¶çº¿ç¨‹</p>
<p>2ã€3 éƒ½æ˜¯ä¿è¯å°†å¯¹å…±äº«å˜é‡çš„æ“ä½œé™åˆ¶åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œä»è€Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
</li>
<li>
<p>äº’æ–¥</p>
<p>ç±»ä¼¼äºçº¿ç¨‹çš„é”ï¼Œåç¨‹çš„ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.sync/-mutex/index.html" target="_blank" rel="noopener noreferrer">Mutex</a> çš„ lock å’Œ unlock æ–¹æ³•å¯ä»¥ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªåç¨‹è®¿é—®æŒ‡å®šä»£ç ã€‚Mutex ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚</p>
</li>
<li>
<p>Actors</p>
<p>ä¸€ä¸ª <a href="https://en.wikipedia.org/wiki/Actor_model" target="_blank" rel="noopener noreferrer">actor</a> æ˜¯ç”±åç¨‹ã€è¢«é™åˆ¶å¹¶å°è£…åˆ°è¯¥åç¨‹ä¸­çš„çŠ¶æ€ä»¥åŠä¸€ä¸ªä¸å…¶å®ƒåç¨‹é€šä¿¡çš„ <em>é€šé“</em> ç»„åˆè€Œæˆçš„ä¸€ä¸ªå®ä½“ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-completable-deferred/index.html" target="_blank" rel="noopener noreferrer">CompletableDeferred</a> é€šä¿¡åŸè¯­è¡¨ç¤ºæœªæ¥å¯çŸ¥ï¼ˆå¯ä¼ è¾¾ï¼‰çš„å•ä¸ªå€¼ã€‚</p>
<p>åœ¨ä½¿ç”¨æ—¶ï¼Œç”±äº actor æ˜¯ä¸€ä¸ªåç¨‹ï¼Œ<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-send-channel/send.html" target="_blank" rel="noopener noreferrer"><code> SendChannel .send()</code></a> æ–¹æ³•ä¼šåœ¨é€šé“ç¼“å­˜æ»¡çš„æ—¶å€™æŒ‚èµ·è°ƒç”¨æ–¹ï¼Œä»è€Œæœ€ç»ˆä¿è¯äº†<code>counter++</code>æ–¹æ³•æ˜¯ä¾æ¬¡æ‰§è¡Œçš„ï¼Œä¸ä¼šäº§ç”Ÿå¹¶å‘é—®é¢˜ã€‚</p>
<p>actor åœ¨é«˜è´Ÿè½½ä¸‹æ¯”é”æ›´æœ‰æ•ˆï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹å®ƒæ€»æ˜¯æœ‰å·¥ä½œè¦åšï¼Œè€Œä¸”æ ¹æœ¬ä¸éœ€è¦åˆ‡æ¢åˆ°ä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚</p>
</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼Œ<a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/actor.html" target="_blank" rel="noopener noreferrer">actor</a> åç¨‹æ„å»ºå™¨æ˜¯ä¸€ä¸ªåŒé‡çš„ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/produce.html" target="_blank" rel="noopener noreferrer">produce</a> åç¨‹æ„å»ºå™¨ã€‚ä¸€ä¸ª actor ä¸å®ƒæ¥æ”¶æ¶ˆæ¯çš„é€šé“ç›¸å…³è”ï¼Œè€Œä¸€ä¸ª producer ä¸å®ƒå‘é€å…ƒç´ çš„é€šé“ç›¸å…³è”ã€‚</p>
</blockquote>
<h2> Select è¡¨è¾¾å¼</h2>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.selects/select.html" target="_blank" rel="noopener noreferrer">select</a> è¡¨è¾¾å¼å…è®¸æˆ‘ä»¬ä½¿ç”¨å…¶ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-receive-channel/on-receive.html" target="_blank" rel="noopener noreferrer">onReceive</a> å­å¥ <em>åŒæ—¶</em> ä»ä¸¤ä¸ªç”Ÿäº§è€…æ¥æ”¶æ•°æ®ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/on-receive-or-null.html" target="_blank" rel="noopener noreferrer">onReceiveOrNull</a> å¯ä»¥å…è®¸ä¸ºç©ºï¼Œè¿™æ ·å¯ä»¥åœ¨å…³é—­é€šé“æ—¶æ‰§è¡Œç‰¹å®šæ“ä½œ</p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-send-channel/on-send.html" target="_blank" rel="noopener noreferrer">onSend</a> å­å¥ å‘é€æ¶ˆæ¯</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Select å»¶è¿Ÿå€¼å¯ä»¥ä½¿ç”¨ <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-deferred/on-await.html" target="_blank" rel="noopener noreferrer">onAwait</a> å­å¥æŸ¥è¯¢</p>
<iframe width="853" height="480" src="https://embed.coggle.it/diagram/Xb_CZoumpCamgUAj/1235701ea5f157867e045f0f5ac28f886effdb5fa1e27b72afa5266e6e3e8891" frameborder="0" allowfullscreen=""></iframe>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://blog.csdn.net/u013064109/article/details/83507076" target="_blank" rel="noopener noreferrer">Kotlin çš„ç‹¬é—¨ç§˜ç± Reified å®åŒ–ç±»å‹å‚æ•° (ä¸‹ç¯‡)</a></p>
<p><a href="https://www.kotlincn.net/docs/reference/coroutines/flow.html" target="_blank" rel="noopener noreferrer">Kotlin åç¨‹ ä¸­æ–‡å®˜ç½‘--å¼‚æ­¥æµ</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Kotlin ç¬”è®°ä¹‹ Flow</title>
      <link>https://jixiaoyong.github.io/blog/posts/10414aef.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/10414aef.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Kotlin ç¬”è®°ä¹‹ Flow</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 25 Feb 2021 04:20:12 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p><code>Flow</code>æ˜¯ Kotlin åç¨‹åº“ä¸­çš„åº“ï¼Œç”¨äº<strong>å¼‚æ­¥è¿”å›å¤šä¸ªå€¼</strong>ï¼Œå®˜æ–¹ä»‹ç»æ˜¯å‚è€ƒ<code>RxJava</code>ç­‰å“åº”å¼æµå®ç°çš„ï¼Œä½†æ˜¯â€œ<em>æ‹¥æœ‰å°½å¯èƒ½ç®€å•çš„è®¾è®¡ï¼Œå¯¹ Kotlin ä»¥åŠæŒ‚èµ·å‹å¥½ä¸”éµä»ç»“æ„åŒ–å¹¶å‘</em>â€ã€‚æœ¬æ–‡ä¸»è¦å‚è€ƒ<a href="https://www.kotlincn.net/docs/reference/coroutines/flow.html" target="_blank" rel="noopener noreferrer">Flow ä¸­æ–‡æ–‡æ¡£</a>ï¼Œæ¢³ç†äº†å­¦ä¹ è¿‡ç¨‹ä¸­çš„è¦ç‚¹å’Œç†è§£ï¼Œä»¥ä¾¿æ—¥åæŸ¥éªŒã€‚</p>
<h2> æ­£æ–‡</h2>
<p>å¯¹äºå¼‚æ­¥è¿”å›å¤šä¸ªå€¼çš„éœ€æ±‚ï¼Œé›†åˆï¼ˆå¦‚<code>List</code>ç­‰ï¼‰åªèƒ½ä¸€æ¬¡æ€§è¿”å›å¤šä¸ªå€¼ï¼Œè€Œåºåˆ—ï¼ˆ <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.sequences/index.html" target="_blank" rel="noopener noreferrer"><code>Sequence</code></a> ï¼‰åªæ”¯æŒé˜»å¡ä»£ç ï¼Œ<code>Flow</code>åˆ™æ”¯æŒæŒ‚èµ·å‡½æ•°å¼‚æ­¥è¿”å›å¤šä¸ªå€¼ã€‚</p>
<h3> åˆ›å»º Flow</h3>
<ol>
<li>
<p><code>flow{...}</code></p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><code>.asFlow()</code></p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p><code>flowOf{}</code></p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
</ol>
<p>å› ä¸º<strong>æµåªä¼šåœ¨è¢«æ”¶é›†çš„æ—¶å€™æ‰ä¼šè¢«å¯åŠ¨</strong>ï¼ˆæŒ‡æ‰§è¡Œç±»ä¼¼<code>flow{...}</code>ä¸­çš„å†…å®¹ï¼‰ï¼Œæ‰€ä»¥ä¸Šè¿°<code>simple()</code>åœ¨è¢«è°ƒç”¨æ—¶ä¼šå°½å¿«è¿”å›ä¸”ä¸ç­‰å¾…ï¼Œæ‰€ä»¥æ— éœ€<code>suspend</code>ä¿®é¥°ã€‚</p>
<h3> æµçš„æ”¶é›†/æœ«ç«¯æµæ“ä½œç¬¦</h3>
<ul>
<li>
<p><code>collect{...}</code> æ”¶é›†<code>emit</code>å‘é€çš„å€¼</p>
<p>é…åˆ<code>onEach{}</code>å¯ä»¥å°†<code>collect</code>ä¸­æ‰§è¡Œçš„ä»£ç æ”¾åˆ°<code>onEach</code>ä¸­ã€‚</p>
</li>
<li>
<p><code>collectLatest{...}</code> æ”¶é›†<code>emit</code>å‘é€çš„å€¼ï¼Œä½†æ¯æ¬¡æ–°çš„<code>emit</code>åˆ°æ¥æ—¶ï¼Œå–æ¶ˆä¹‹å‰çš„æ”¶é›†å™¨ï¼Œåˆ›å»ºæ–°çš„æ”¶é›†å™¨ï¼ˆç”¨æ–°çš„å€¼æ‰§è¡Œ<code>{...}</code>ä¸­çš„ä»£ç ï¼‰</p>
</li>
<li>
<p><code>launchIn</code> æŒ‡å®šåœ¨å•ç‹¬çš„åç¨‹ä¸­å¯åŠ¨æµçš„æ”¶é›†ï¼Œè¿™æ ·å°±å¯ä»¥ç«‹å³ç»§ç»­è¿›ä¸€æ­¥æ‰§è¡Œä»£ç ï¼Œä¸ä¼šæŒ‚èµ·åé¢çš„åç¨‹ä»£ç ã€‚</p>
</li>
<li>
<p><code>single()</code> åªæ¥å— flow å‘é€çš„ä¸€ä¸ªå€¼ï¼Œ0 ä¸ªæˆ–å¤šä¸ªéƒ½ä¼šæŠ¥é”™</p>
</li>
<li>
<p><code>first{...}</code> æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼</p>
</li>
<li>
<p><code>reduce()</code> æ±‚å’Œ</p>
</li>
<li>
<p><code>fold(initial,{...})</code> åœ¨åˆå§‹å€¼<code>initial</code>çš„åŸºç¡€ä¸Šæ±‚å’Œ</p>
</li>
<li>
<p><code>toList</code>ã€<code>toSet</code></p>
</li>
</ul>
<h3> è¿‡æ¸¡æµæ“ä½œç¬¦</h3>
<p>è¿‡æ¸¡æ“ä½œç¬¦åº”ç”¨äºä¸Šæ¸¸æµï¼Œå¹¶è¿”å›ä¸‹æ¸¸æµã€‚å°±åƒæµä¸€æ ·ã€‚è¿™ç±»æ“ä½œç¬¦æœ¬èº«ä¸æ˜¯æŒ‚èµ·å‡½æ•°ã€‚å®ƒè¿è¡Œçš„é€Ÿåº¦å¾ˆå¿«ï¼Œè¿”å›æ–°çš„è½¬æ¢æµçš„å®šä¹‰ã€‚</p>
<ul>
<li><code>map{}</code></li>
<li><code>filter{}</code></li>
<li><code>take(n)</code> é™é•¿æ“ä½œç¬¦ï¼Œåªå–å‰ n ä¸ªå‘å°„çš„å€¼</li>
</ul>
<h3> æµä¸Šä¸‹æ–‡</h3>
<p>æµé»˜è®¤è¿è¡Œåœ¨æ”¶é›†å™¨æä¾›çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡<code>flowOn </code>æ›´æ”¹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> å±•å¹³æµ</h3>
<p>å°†åµŒå¥—æœ‰<code>Flow</code>çš„<code>Flow</code>ï¼ˆå¦‚<code>Flow&lt;Flow&lt;String&gt;&gt;</code>ï¼‰<strong>å±•å¹³</strong>ä¸ºå•ä¸ªæµï¼ˆå¦‚<code>Flow&lt;String&gt;</code>ï¼‰ã€‚</p>
<ul>
<li>
<p><code>flatMapConcat</code> å°†æ”¶é›†åˆ°çš„æµäº¤ç»™<code>{...}</code>å¤„ç†åï¼Œç­‰å¾…å†…éƒ¨æµå¤„ç†å®Œæ¯•åï¼Œå†å»è¯·æ±‚ä¸‹ä¸€ä¸ªæµ</p>
</li>
<li>
<p><code>flatMapMerge</code> å…ˆé¡ºåºæ”¶é›†æ‰€æœ‰æµï¼Œå†åŒæ—¶æ”¶é›†ç»“æœæµ</p>
</li>
<li>
<p><code>flatMapLatest{...}</code> ç±»ä¼¼äº<code>collectLatest{...}</code>ï¼Œåœ¨æ–°æµå‘å‡ºçš„æ—¶å€™ï¼Œç«‹å³å–æ¶ˆ<code>{...}</code>ä¸­æ‰€æœ‰çš„ä»£ç </p>
</li>
<li>
<p><code>flattenConcat</code> ä¾æ¬¡å±•å¹³æµ</p>
</li>
<li>
<p><code>flattenMerge{...}</code> å¹¶å‘æ‹¼æ¥ï¼Œå…ˆæ‰§è¡Œ<code>{...}</code>ä¸­çš„æ–¹æ³•ï¼Œå†æ‰§è¡Œ<code>collect</code>ç­‰æ–¹æ³•ï¼Œé¡ºåºä¼šä¹±ã€‚</p>
</li>
</ul>
<h3> å¼‚å¸¸å¤„ç†</h3>
<ul>
<li>
<p><code>try/catch</code></p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><code>catch()</code></p>
<p><strong>é€æ˜æ•è·</strong>ï¼šåªæ•è·ä¸Šæ¸¸å¼‚å¸¸ï¼Œå…¶ä¹‹åçš„å¼‚å¸¸ä¸ä¼šè¢«å¤„ç†ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å£°æ˜å¼æ•è·</strong>ï¼šå°†<code>collect</code>çš„ä»£ç ç§»åŠ¨åˆ°<code>onEach</code>ä¸­ï¼Œå°†å…¶æ”¾åˆ°<code>catch</code>ä¹‹å‰ï¼Œä»è€Œä½¿å…¶è¢«<code>catch</code>æ•è·ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ul>
<h3> æµå–æ¶ˆ</h3>
<ul>
<li><code>flow { ... }</code> åˆ›å»ºçš„æµçš„ç¹å¿™å¾ªç¯é»˜è®¤å¯ä»¥å–æ¶ˆ</li>
<li>å…¶ä»–æµå¦‚æœéœ€è¦å–æ¶ˆï¼Œå¯ä»¥æ·»åŠ  <code>.onEach { currentCoroutineContext().ensureActive() }</code> æˆ–è€…<code>.cancellable()</code></li>
</ul>
<h3> æµå®Œæˆ</h3>
<ul>
<li>
<p>å‘½ä»¤å¼</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>å£°æ˜å¼</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>onCompletion</code>çš„å¯ç©ºå‚æ•° <code>Throwable</code> å¯ä»¥ç”¨äºç¡®å®šæµæ”¶é›†æ˜¯æ­£å¸¸å®Œæˆï¼ˆä¸º<code>null</code>ï¼‰è¿˜æ˜¯æœ‰å¼‚å¸¸å‘ç”Ÿã€‚ä»–ä¸ä¼šå¤„ç†å¼‚å¸¸ã€‚</p>
</li>
</ul>
<h3> å…¶ä½™æ“ä½œ</h3>
<ul>
<li>
<p><code>buffer()</code> ç¼“å†²å‘å°„é¡¹ï¼Œæ”¶é›†å®Œæˆåå†ä¼ ç»™ä¸‹ä¸€æ­¥</p>
</li>
<li>
<p><code>conflate()</code> åˆå¹¶å‘å°„é¡¹ï¼Œä¼šä¸¢å¼ƒæ¥ä¸åŠå¤„ç†çš„ä¸­é—´å€¼ï¼Œåªè·å–å¹¶å¤„ç†æœ€æ–°çš„å€¼</p>
</li>
<li>
<p><code>zip()</code> åˆå¹¶ä¸¤ä¸ªæµçš„å€¼ï¼Œä¸¤ä¸ªæµä¸­çš„å€¼ä¸€ä¸€å¯¹åº”</p>
<p>ä¾‹å¦‚<code>(1,2,3) 3så‘å°„ä¸€æ¬¡,(a,b,c) 4så‘å°„ä¸€æ¬¡</code>ç›´æ¥æ‹¼æ¥ï¼Œåˆå¹¶ä¹‹åä¸º <code>(1a,2b,3c)</code></p>
</li>
<li>
<p><code>combine()</code> ç»“åˆä¸¤ä¸ªæµçš„å€¼ï¼Œä»»æ„ä¸€ä¸ªæµä¸­çš„å€¼å‘ç”Ÿå˜åŒ–éƒ½ä¼šè§¦å‘æ‰§è¡Œè®¡ç®—</p>
<p>ä¾‹å¦‚<code>(1,2,3) 3så‘å°„ä¸€æ¬¡,(a,b,c) 4så‘å°„ä¸€æ¬¡</code>ç›´æ¥æ‹¼æ¥ï¼Œåˆå¹¶ä¹‹åä¸º <code>(1a,2a,2b,3b,3c)</code></p>
</li>
</ul>
<h2> å‚è€ƒæ–‡çŒ®</h2>
<p><a href="https://www.kotlincn.net/docs/reference/coroutines/flow.html" target="_blank" rel="noopener noreferrer">Kotlin Flow ä¸­æ–‡æ–‡æ¡£</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Lambda è¡¨è¾¾å¼åœ¨ kotlin ä¸­çš„åº”ç”¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/53875104.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/53875104.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Lambda è¡¨è¾¾å¼åœ¨ kotlin ä¸­çš„åº”ç”¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Fri, 09 Feb 2018 03:09:06 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ä¸€ä¸ªä¾‹å­</h2>
<p><strong>æ™®é€šå†™æ³•</strong>ï¼š</p>
<ol>
<li>å®šä¹‰ä¸€ä¸ªæ¥å£ OnClickListener</li>
</ol>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol>
<li>å®šä¹‰æ–¹æ³• SetOnClickListener</li>
</ol>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰çš„æ–¹æ³•å’Œ Java ä¸­å†™æ³•ç±»ä¼¼ï¼Œåœ¨ä½¿ç”¨è¯¥æ–¹æ³•æ—¶ä¹Ÿç±»ä¼¼ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>lambda å†™æ³•</strong>ï¼š</p>
<p>å®šä¹‰åªéœ€è¦ä¸€æ­¥ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ ç®€æ´ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>æ–¹æ³•æœ€åä¸€ä¸ªå‚æ•°æ˜¯ lambda è¡¨è¾¾å¼æ—¶ï¼Œlambda è¡¨è¾¾å¼çš„æ–¹æ³•<code>{}</code>å¯ä»¥æ”¾åˆ°<code>()</code>çš„åé¢ï¼Œå¦‚æœåªæœ‰è¿™ä¸€ä¸ªå‚æ•°æ—¶ï¼Œ<code>()</code>ä¹Ÿå¯ä»¥çœç•¥</p>
</blockquote>
<p>å½“æ–¹æ³•åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶ï¼Œå¯ä»¥çœç•¥å‚æ•°ï¼Œè¿˜ç”¨<code>it</code>ä»£æ›¿ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç”šè‡³æ›´åŠ ç®€æ´ï¼Œå¦‚æœè¦æ‰§è¡Œçš„æ–¹æ³•å’Œ listener å®šä¹‰çš„æ–¹æ³•è¿”å›å€¼ç±»å‹ç›¸åŒï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨è¯¥æ–¹æ³•ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2> lambda</h2>
<p>lambda åœ¨ Java8 ä¸­å¼•è¿›ï¼Œå¯ä»¥å¾ˆå¥½çš„æ›¿ä»£åŒ¿åå†…éƒ¨ç±»ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ã€‚</p>
<p>lambda è¡¨è¾¾å¼å½¢å¼å¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>lambda è¡¨è¾¾å¼æ€»æ˜¯è¢«å¤§æ‹¬å·æ‹¬ç€ï¼Œå®Œæ•´è¯­æ³•å½¢å¼çš„å‚æ•°å£°æ˜æ”¾åœ¨å¤§æ‹¬å·å†…ï¼Œå¹¶æœ‰å¯é€‰çš„ç±»å‹æ ‡æ³¨ï¼Œå‡½æ•°ä½“è·Ÿåœ¨ä¸€ä¸ª <code>-&gt;</code> ç¬¦å·ä¹‹åã€‚å¦‚æœæ¨æ–­å‡ºçš„è¯¥ lambda çš„è¿”å›ç±»å‹ä¸æ˜¯ <code>Unit</code>ï¼Œé‚£ä¹ˆè¯¥ lambda ä¸»ä½“ä¸­çš„æœ€åä¸€ä¸ªï¼ˆæˆ–å¯èƒ½æ˜¯å•ä¸ªï¼‰è¡¨è¾¾å¼ä¼šè§†ä¸ºè¿”å›å€¼ã€‚</p>
<p><a href="http://kotlincn.net" target="_blank" rel="noopener noreferrer">kotlincn.net</a> <a href="http://www.kotlincn.net/docs/reference/lambdas.html#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0%E5%92%8C-lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F" target="_blank" rel="noopener noreferrer">é«˜é˜¶å‡½æ•°å’Œ lambda è¡¨è¾¾å¼</a></p>
</blockquote>
<p>ä½¿ç”¨ lambda çš„å½¢å¼å¦‚ä¸‹<code>() -&gt; {}</code>,<code>()</code>å†…æ˜¯å‚æ•°ï¼Œ<code>{}</code>æ˜¯å‡½æ•°å…·ä½“çš„è¡Œä¸ºã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­æ¥è‡ª <a href="http://importNew.com" target="_blank" rel="noopener noreferrer">importNew.com</a>,<a href="http://www.importnew.com/16436.html" target="_blank" rel="noopener noreferrer">Java8 lambda è¡¨è¾¾å¼ 10 ä¸ªç¤ºä¾‹</a></p>
<h2> å°çŸ¥è¯†ç‚¹</h2>
<ul>
<li>xx.map()</li>
</ul>
<p>å‡¡æ˜¯<strong>å¯è¿­ä»£</strong>çš„æ•°æ®éƒ½å¯ä»¥ä½¿ç”¨<code>map()</code>å‡½æ•°</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿˜å¯ä»¥æ›´ç®€æ´ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>xx.flatMap()</li>
</ul>
<p>è¿”å›<strong>å¯è¿­ä»£</strong>çš„æ•°ç»„ï¼Œå¯ä»¥å’Œ<code>xx.map()</code>ä¸€èµ·ä½¿ç”¨</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>LeetCode ç¬”è®°--é‡å»ºäºŒå‰æ ‘</title>
      <link>https://jixiaoyong.github.io/blog/posts/a64dc0bc.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/a64dc0bc.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">LeetCode ç¬”è®°--é‡å»ºäºŒå‰æ ‘</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 20 Feb 2020 03:14:24 GMT</pubDate>
      <content:encoded><![CDATA[<p>äºŒå‰æ ‘çš„éå†æ ¹æ®æ ¹èŠ‚ç‚¹ä¸å·¦å³å­èŠ‚ç‚¹çš„éå†é¡ºåºçš„ä¸åŒåˆ†ä¸ºä¸‰ç§ï¼š</p>
<ul>
<li>
<p>å‰åºéå†</p>
<p>æ ¹å·¦å³ï¼šå…ˆéå†æ ¹èŠ‚ç‚¹ï¼Œå†å·¦å­æ ‘ï¼Œå†å³å­æ ‘ï¼ˆå…ˆä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œè®°å½•å·¦èŠ‚ç‚¹ç›´åˆ°æ²¡æœ‰ï¼‰</p>
<p>ç¬¬ä¸€ä¸ªä¸ºæ ¹èŠ‚ç‚¹</p>
</li>
<li>
<p>ä¸­åºéå†</p>
<p>å·¦æ ¹å³ï¼šå…ˆå·¦å­æ ‘ï¼Œå†æ ¹å­æ ‘ï¼Œå†å³å­æ ‘ï¼ˆä»æ ‘çš„æœ€å·¦è¾¹çš„èŠ‚ç‚¹å¼€å§‹éå†ï¼‰</p>
</li>
<li>
<p>ååºéå†</p>
<p>å·¦å³æ ¹ï¼šå…ˆå·¦å­æ ‘ï¼Œåå³å­æ ‘ï¼Œå†æ ¹èŠ‚ç‚¹</p>
<p>æœ€åä¸€ä¸ªä¸ºæ ¹èŠ‚ç‚¹</p>
</li>
</ul>
<p>åœ¨éå†çš„æ—¶å€™ï¼Œå½“çˆ¶èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹æ—¶ï¼Œä¾ç„¶è¦éµå¾ªä»¥ä¸Šä¸‰ç§éå†çš„å…ˆåé¡ºåºï¼ˆæ²¡æœ‰è¯¥å­èŠ‚ç‚¹åˆ™ä¸å†™å†…å®¹ï¼‰ï¼Œä»¥ä¿è¯æŸä¸€ä¾§çš„å­æ ‘ï¼ˆâ€œå·¦è¾¹çš„å­æ ‘â€æˆ–â€œå³è¾¹çš„å­æ ‘â€ï¼‰æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«å®Œå…¨éå†ï¼Œä¹‹åæ‰å¯ä»¥æ ¹æ®éå†çš„è§„åˆ™åˆ‡æ¢åˆ°ä¸‹ä¸€å­æ ‘ã€‚</p>
<p>å¦‚å¦‚ä¸‹å­æ ‘ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‰åºéå†ï¼šGDAFEMHZ</p>
<p>ä¸­åºéå†ï¼šADEFGHMZ</p>
<p>åç»­éå†ï¼šAEFDHZMG</p>
<h2> å¸¸è§åº”ç”¨</h2>
<p>ä¸€èˆ¬éƒ½æ˜¯ç»™å®šä¸­åºæ’åºï¼Œå†åŠ ä¸Šä¸€ä¸ªå‰åºæ’åºã€åç»­æ’åºæ¥é€†å‘ç”ŸæˆäºŒå‰æ ‘ã€‚</p>
<p>æ ¹æ®ä¹‹å‰çš„çŸ¥è¯†ï¼Œæ­¤ç±»é¢˜çš„è§£ç­”æ€è·¯ä¸€èˆ¬ä¸ºï¼š</p>
<p>å…ˆæ ¹æ®å‰åºæ’åºã€åç»­æ’åºçš„ç‰¹ç‚¹ï¼Œæ‰¾åˆ°æ ¹èŠ‚ç‚¹ï¼Œä¹‹åå†æ ¹æ®æ‰¾åˆ°çš„æ ¹èŠ‚ç‚¹å°†ä¸­åºæ’åºåˆ†ä¸ºå·¦ã€å³å­æ ‘ä¸¤ä¸ªéƒ¨åˆ†ã€‚è¿™æ ·å¾ªç¯ç›´åˆ°æ•´ä¸ªæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¢«éå†å®Œæ¯•ï¼Œå®Œæ•´çš„äºŒå‰æ ‘ä¹Ÿä¼šè¢«å»ºç«‹èµ·æ¥ã€‚</p>
<p>æˆ‘ä»¬ä»¥ä¸‹é¢è¿™ä¸ªäºŒå‰æ ‘ä¸ºä¾‹ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://www.jianshu.com/p/9e8922486154" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/9e8922486154</a></p>
<p><a href="https://charlesliuyx.github.io/2018/10/22/%5B%E7%9B%B4%E8%A7%82%E7%AE%97%E6%B3%95%5D%E6%A0%91%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" target="_blank" rel="noopener noreferrer">ã€ç›´è§‚ç®—æ³•ã€‘äºŒå‰æ ‘éå†ç®—æ³•æ€»ç»“</a></p>
<p><a href="https://jingyan.baidu.com/album/cdddd41cb8d79753ca00e144.html?picindex=1" target="_blank" rel="noopener noreferrer">çŸ¥é“ä¸­åºå’Œååºéå†ï¼Œç”»äºŒå‰æ ‘å’Œå†™å‡ºå‰åºéå† </a></p>
<p><a href="https://leetcode-cn.com/problems/zhong-jian-er-cha-shu-lcof/" target="_blank" rel="noopener noreferrer">leetcode-é‡å»ºäºŒå‰æ ‘</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Linuxä¸‹é…ç½®Gitï¼Œä½¿ç”¨AndroidStudioåŒæ­¥å·¥ç¨‹åˆ°Github</title>
      <link>https://jixiaoyong.github.io/blog/posts/25db0a11.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/25db0a11.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Linuxä¸‹é…ç½®Gitï¼Œä½¿ç”¨AndroidStudioåŒæ­¥å·¥ç¨‹åˆ°Github</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 28 Apr 2016 22:06:06 GMT</pubDate>
      <content:encoded><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•åœ¨ linux ç¯å¢ƒä¸‹å®‰è£…å’Œé…ç½® git ä¸ github ï¼Œå¹¶ä¸”ä½¿ç”¨ Android Studio å°†æœ¬åœ°çš„é¡¹ç›®åŒæ­¥åˆ° github ä¸Šé¢ã€‚</p>
<h2> å®‰è£… git</h2>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2> é…ç½® git å’Œ github</h2>
<ul>
<li>
<p>åˆ›å»º Github è´¦å·</p>
</li>
<li>
<p>ç”Ÿæˆ ssh key</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p>åœ¨ github ä¸Šé¢æ·»åŠ  ssh key</p>
</li>
</ul>
<p>è¿›å…¥ Account Settings â€“&gt; SSH Keys â€“&gt; Add SSH Key æ·»åŠ  SSH Keys ï¼š<br>
åå­—èµ·ä¸€ä¸ªå®¹æ˜“è¯†åˆ«çš„åå­—ï¼Œkey æ˜¯ç”Ÿæˆçš„ <code>/home/username/.ssh/id_rsa.pub.</code> ä¸­çš„å†…å®¹ï¼Œç›´æ¥ç²˜è´´åˆ°æŒ‡å®šä½ç½®å°±è¡Œ</p>
<ul>
<li>
<p>æµ‹è¯• ssh key æ˜¯å¦æˆåŠŸ</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
</ul>
<p>æç¤ºå¦‚<code>Youâ€™ve successfully authenticated, but GitHub does not provide shell access</code>åˆ™è¯´æ˜æˆåŠŸè¿æ¥ github</p>
<ul>
<li>
<p>é…ç½® Github</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ul>
<h2> ç”¨ Android Studio åŒæ­¥å·¥ç¨‹åˆ° Github</h2>
<ul>
<li>
<p>å¯åŠ¨ android studio</p>
<p>è¿›å…¥<code>android studio/bin</code>ï¼Œç»ˆç«¯è¾“å…¥<code>./studio.sh</code></p>
</li>
<li>
<p>é€‰æ‹© <code>VCS ---&gt; Import into Version Control --&gt; Share Project on Github</code></p>
</li>
</ul>
<p>ç¬¬ä¸€æ¬¡è¿›å…¥ä¼šè¦æ±‚è¾“å…¥ github çš„è´¦å·å’Œå¯†ç  æŒ‰ç…§è¦æ±‚è¾“å…¥å³å¯<br>
æ­¤åè¿˜ä¼šè¦æ±‚ä½ è¾“å…¥ä¸€ä¸ªæœ¬åœ°å¯†ç ï¼Œå½“ä¸‹æ¬¡åŒæ­¥çš„æ—¶å€™éœ€è¦è¾“å…¥<br>
ä¹‹åå°±è¿›å…¥åˆ°é€‰æ‹©åŒæ­¥çš„ä»“åº“ï¼Œæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œå¼€å§‹åŒæ­¥å°±å¯ä»¥äº†</p>
<p><strong>åˆ°è¿™é‡Œå°±é¡ºåˆ©çš„åœ¨ Android Studio ä¸Šé¢å°†å·¥ç¨‹åŒæ­¥åˆ° Github ä¸Šé¢äº†</strong></p>
<hr>
<p><strong>ä»¥ä¸‹ä¸ºåŸæ–‡æåˆ°çš„å…¶ä»–æ–¹æ³•ï¼Œæ‘˜å½•å¦‚ä¸‹ï¼Œä»¥å¤‡åç”¨ï¼š</strong></p>
<h2> åˆ©ç”¨ Git ä»æœ¬åœ°ä¸Šä¼ åˆ° GitHub</h2>
<p>ç¬¬ä¸€æ­¥ï¼š è¿›å…¥è¦æ‰€è¦ä¸Šä¼ æ–‡ä»¶çš„ç›®å½•</p>
<p>è¾“å…¥å‘½ä»¤ <code>git init</code></p>
<p>ç¬¬äºŒæ­¥ï¼š åˆ›å»ºä¸€ä¸ªæœ¬åœ°ä»“åº“ origin</p>
<p>ä½¿ç”¨å‘½ä»¤</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>youname</code>æ˜¯ä½ çš„ GitHub çš„ç”¨æˆ·åï¼Œ<code>yourRepo</code>æ˜¯ä½ è¦ä¸Šä¼ åˆ° GitHub çš„ä»“åº“</p>
<p>ç¬¬ä¸‰æ­¥ï¼š æ¯”å¦‚ä½ è¦æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ xxx åˆ°æœ¬åœ°ä»“åº“ï¼Œä½¿ç”¨å‘½ä»¤ <code>git add xxx</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>git add .</code> è‡ªåŠ¨åˆ¤æ–­æ·»åŠ å“ªäº›æ–‡ä»¶</p>
<p>ç„¶åæŠŠè¿™ä¸ªæ·»åŠ æäº¤åˆ°æœ¬åœ°çš„ä»“åº“ï¼Œä½¿ç”¨å‘½ä»¤ <code>git commit -m</code>è¯´æ˜è¿™æ¬¡çš„æäº¤</p>
<p>æœ€åæŠŠæœ¬åœ°ä»“åº“ origin æäº¤åˆ°è¿œç¨‹çš„ GitHub ä»“åº“ï¼Œä½¿ç”¨å‘½ä»¤ <code>git push origin master</code></p>
<h2> ä» GitHub å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°</h2>
<p>ç¬¬ä¸€æ­¥ï¼š åˆ° GitHub çš„æŸä¸ªä»“åº“ï¼Œç„¶åå¤åˆ¶å³è¾¹çš„æœ‰ä¸ª<code>HTTPS clone url</code></p>
<p>ç¬¬äºŒæ­¥ï¼š å›åˆ°è¦å­˜æ”¾çš„ç›®å½•ä¸‹ï¼Œä½¿ç”¨å‘½ä»¤ <code>git clone https://github.com/chenguolin/scrapy.git</code>ï¼Œè¿™é‡Œçš„ url åªæ˜¯ä¸€ä¸ªä¾‹å­</p>
<p>ç¬¬ä¸‰æ­¥ï¼š å¦‚æœæœ¬åœ°çš„ç‰ˆæœ¬ä¸æ˜¯æœ€æ–°çš„ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>git fetch origin</code>ï¼Œorigin æ˜¯æœ¬åœ°ä»“åº“</p>
<p>ç¬¬å››æ­¥ï¼š æŠŠæ›´æ–°çš„å†…å®¹åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>git merge origin/master</code></p>
<p>å¦‚æœä½ ä¸æƒ³æ‰‹åŠ¨å»åˆå¹¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ï¼š<br>
<code>git pull &lt;æœ¬åœ°ä»“åº“&gt; master</code> // è¿™ä¸ªå‘½ä»¤å¯ä»¥æ‹‰å»æœ€æ–°ç‰ˆæœ¬å¹¶è‡ªåŠ¨åˆå¹¶</p>
<h2> GitHub çš„åˆ†æ”¯ç®¡ç†</h2>
<ul>
<li>åˆ›å»º</li>
</ul>
<p>1 åˆ›å»ºä¸€ä¸ªæœ¬åœ°åˆ†æ”¯ï¼š <code>git branch &lt;æ–°åˆ†æ”¯åå­—&gt;</code></p>
<p>2 å°†æœ¬åœ°åˆ†æ”¯åŒæ­¥åˆ° GitHub ä¸Šé¢ï¼š <code>git push &lt;æœ¬åœ°ä»“åº“å&gt; &lt;æ–°åˆ†æ”¯å&gt;</code></p>
<p>3 åˆ‡æ¢åˆ°æ–°å»ºç«‹çš„åˆ†æ”¯ï¼š <code>git checkout &lt;æ–°åˆ†æ”¯å&gt;</code></p>
<p>4 ä¸ºä½ çš„åˆ†æ”¯åŠ å…¥ä¸€ä¸ªæ–°çš„è¿œç¨‹ç«¯ï¼š <code>git remote add &lt;è¿œç¨‹ç«¯åå­—&gt; &lt;åœ°å€&gt;</code></p>
<p>5 æŸ¥çœ‹å½“å‰ä»“åº“æœ‰å‡ ä¸ªåˆ†æ”¯: <code>git branch</code></p>
<ul>
<li>åˆ é™¤</li>
</ul>
<p>1 ä»æœ¬åœ°åˆ é™¤ä¸€ä¸ªåˆ†æ”¯ï¼š <code>git branch -d &lt;åˆ†æ”¯åç§°&gt;</code></p>
<p>2 åŒæ­¥åˆ° GitHub ä¸Šé¢åˆ é™¤è¿™ä¸ªåˆ†æ”¯ï¼š <code>git push &lt;æœ¬åœ°ä»“åº“å&gt; :&lt;GitHubç«¯åˆ†æ”¯&gt;</code></p>
<h2> è¯´æ˜</h2>
<p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ä»Šå¤©åœ¨ linux ä¸‹å®‰è£… git ï¼Œä¸Šä¼ å·¥ç¨‹åˆ° github ä¸Šé¢æ—¶çš„æ­¥éª¤çš„æ€»ç»“ï¼Œå¤§éƒ¨åˆ†å†…å®¹éƒ½å‚è€ƒ/æ‘˜å½•è‡ªä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼Œæ„Ÿè°¢åŸä½œè€…çš„åˆ†äº«ï¼ŒåŸæ–‡ä¿¡æ¯åŠé“¾æ¥å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Linux ä¸‹ Git å’Œ GitHub ä½¿ç”¨æ–¹æ³•æ€»ç»“<br>
[æ—¥æœŸï¼š2014-03-07] æ¥æºï¼šLinux ç¤¾åŒº ä½œè€…ï¼šchenguolin<br>
<a href="http://www.linuxidc.com/Linux/2014-03/97821.htm" target="_blank" rel="noopener noreferrer">http://www.linuxidc.com/Linux/2014-03/97821.htm</a></p>
</blockquote>
]]></content:encoded>
    </item>
    <item>
      <title>Linux ä¸‹é…ç½® JDK å’Œ AndroidStudio å¼€å‘ç¯å¢ƒ</title>
      <link>https://jixiaoyong.github.io/blog/posts/ca532ade.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/ca532ade.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Linux ä¸‹é…ç½® JDK å’Œ AndroidStudio å¼€å‘ç¯å¢ƒ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 27 Apr 2016 22:06:06 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ä¸‹è½½ JDK å¹¶è§£å‹</h2>
<ul>
<li>åˆ°å®˜ç½‘ä¸‹è½½ jdk</li>
<li>ä¸‹è½½åˆ°çš„ JDK æ–‡ä»¶è§£å‹</li>
</ul>
<h2> è®¾ç½®ç¯å¢ƒå˜é‡</h2>
<p>ç®¡ç†å‘˜æƒé™è¿›å…¥ etc/environment å†™å…¥ä»¥ä¸‹ä»£ç </p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2> é…ç½® alternatives</h2>
<p>æ‰“å¼€ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ°è¿™é‡Œ JDK çš„ç¯å¢ƒå°±é…ç½®å¥½äº†</p>
<h2> è¿è¡Œ Android Studio</h2>
<p>è¿›å…¥ android studio/bin ç›®å½•ä¸‹ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œ</p>
<p>è¾“å…¥ <code>./studio.sh</code></p>
<p>åˆ°è¿™é‡Œï¼Œå°±å¯ä»¥æ­£å¸¸è¿è¡Œ android studio äº†</p>
]]></content:encoded>
    </item>
    <item>
      <title>Linuxå¸¸ç”¨å‘½ä»¤</title>
      <link>https://jixiaoyong.github.io/blog/posts/d0edc1ed.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/d0edc1ed.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Linuxå¸¸ç”¨å‘½ä»¤</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 14 Jan 2019 12:16:53 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å¤åˆ¶ï¼Œåˆ é™¤ï¼Œç§»åŠ¨</h2>
<p><code>cp</code>æ‹·è´ï¼Œ<code>rm</code>åˆ é™¤ï¼Œ<code>mv</code>ç§»åŠ¨ã€‚</p>
<p><code>-r</code>è¡¨ç¤ºé€’å½’ <code>-f</code>å¼ºåˆ¶ï¼Œæ— æç¤º</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> åˆ‡æ¢ç›®å½•</h2>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æ–°å»ºæ–‡ä»¶ã€æ–‡ä»¶å¤¹</h2>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Linux æ–‡ä»¶å’Œç›®å½•åå­—é™¤äº†â€œ/â€éƒ½åˆæ³•ï¼Œä½†æ˜¯å°½é‡ä¸è¦ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¹‹ç±»çš„ç¬¦å·ï¼Œå› ä¸ºæœ‰å¯èƒ½ä¼šåœ¨è¿›è¡Œæ­£åˆ™åŒ¹é…æ—¶é€ æˆè¯¯åˆ ç­‰é—®é¢˜</p>
<p>å‡è®¾å½“å‰ç›®å½•æœ‰æ–‡ä»¶<code>f1,f2,f3</code>å’Œ<code>f[123]</code><br>
æ‰§è¡Œï¼š<code>rm f[123]</code>æœ¬æ¥æ˜¯å¸Œæœ›åˆ é™¤<code>f[123]</code>,ä½†æ˜¯ç”±äºæ­£åˆ™åŒ¹é…ï¼Œä¼šå…ˆåˆ é™¤<code>f1,f2,f3</code>è¿™ä¸‰ä¸ªæ–‡ä»¶ã€‚</p>
<h2> æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯</h2>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å¸¸ç”¨ç›®å½•</h2>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æ–‡ä»¶ç›¸å…³</h2>
<h3> ls</h3>
<p><strong><code>ls</code></strong> å±•ç¤ºå½“å‰ç›®å½•ä¸‹æ–‡ä»¶ä¿¡æ¯ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>l</code>å±•ç¤ºç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œ<code>a </code>å±•ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰ï¼Œ<code> h</code> å±•ç¤ºå¸¦å•ä½çš„æ–‡ä»¶å¤§å°ï¼Œ <code>d</code>å±•ç¤ºå½“å‰ç›®å½•æœ¬èº«ä¿¡æ¯</p>
<h3> chmod</h3>
<p><strong><code>chmod</code></strong> æ›´æ”¹æƒé™</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>mode</code>ç»„æˆå¦‚ä¸‹ï¼š<code>[èŒƒå›´] [æ“ä½œ] [æƒé™]</code></p>
<p><code>èŒƒå›´</code>ï¼š<code>u</code>ç”¨æˆ·ã€<code>g</code>ç¾¤ç»„ã€<code>o</code>å…¶ä»–ã€<code>a</code>ä»¥ä¸Šæ‰€æœ‰ï¼ˆugoï¼‰</p>
<p><code>æ“ä½œ</code>ï¼š<code>+</code> å¢åŠ ã€<code>-</code> å‡å»ã€<code>=</code> ç­‰äº</p>
<p><code>æƒé™</code>ï¼š<code>r</code> è¯»æƒé™<code>4</code>ã€<code> w</code> å†™æƒé™<code>2</code>ã€ <code>x</code> æ‰§è¡Œæƒé™<code>1</code> ã€æ— æƒé™ <code>0</code></p>
<p><strong>æƒé™éªŒè¯</strong> ï¼š root ç”¨æˆ·å¯ä»¥è®¿é—®ä»»ä½•ç”¨æˆ·æ–‡ä»¶ï¼Œä¸å—æƒé™é™åˆ¶ï¼›æ™®é€šç”¨æˆ·éœ€è¦éªŒè¯æƒé™</p>
<p><em>è¦è¯»å–æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼Œä¹Ÿéœ€è¦æ‰§è¡Œæƒé™<code>x</code></em></p>
<h3> æ–‡ä»¶æƒé™ä¸ umask</h3>
<p>Linux åˆ›å»ºæ–°é¡¹ç›®æ—¶é»˜è®¤çš„æƒé™åˆ†åˆ«æ˜¯ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œç»è¿‡ umaskï¼ˆæ­¤å¤„ä¸º 0022ï¼‰é®ç›–åï¼Œå˜æˆäº† 755 ï¼Œ644ï¼Œè¿™æ‰æ˜¯çœŸæ­£åˆ›å»ºåçš„ç»“æœ</p>
<p>å¯ä»¥é€šè¿‡<code>umaskæŸ¥çœ‹</code>umask çš„å€¼ï¼Œä¸€èˆ¬åªå»å…¶<strong>å 3 ä½</strong>ï¼Œé®ç›–çš„åŸåˆ™æ˜¯ä»åŸå…ˆçš„æƒé™ä¸­<strong>å‡å»</strong>umask ä¸­çš„æƒé™ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> æŸ¥çœ‹ã€ç®¡ç†å½“å‰ç”¨æˆ·ä¿¡æ¯</h3>
<p><code>users</code> å’Œ<code>whoami</code>è¾“å‡ºå½“å‰ç”¨æˆ·å</p>
<p>å¢ã€åˆ ã€æ”¹ç”¨æˆ·ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<code>userdel -r username</code>åœ¨åˆ é™¤ç”¨æˆ·æ—¶ï¼Œä¹Ÿä¼šåˆ é™¤ç”¨æˆ·å¯¹åº”çš„ä¸»ç›®å½•<code>home</code></p>
<p><code>groups</code> æŸ¥çœ‹ç”¨æˆ·æ‰€åœ¨ç¾¤ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ˜¯ä¸»è¦ç¾¤ç»„ï¼Œå…¶ä½™æ˜¯æ¬¡è¦ç¾¤ç»„ã€‚</p>
<p><em>ä¸»è¦ç¾¤ç»„</em> åœ¨ç”¨æˆ·åˆ›å»ºæ–°çš„æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶ç¾¤ç»„æƒé™ä¸€é¡¹é»˜è®¤ä¸ºè¯¥ç¾¤ç»„</p>
<p><code>who</code> ã€<code>w</code>å¯ä»¥æŸ¥çœ‹ç”¨æˆ·ç›¸å…³ä¿¡æ¯</p>
<p><code>id</code> æŸ¥çœ‹æŸäººæˆ–è€…è‡ªå·±ç›¸å…³çš„<code>UIDã€GID</code></p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>GID</code> ç³»ç»Ÿ &lt;500 ï¼Œç”¨æˆ· &gt;500</p>
<h3> æ”¹å¯†ç </h3>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3> æ–‡ä»¶æ‰“åŒ…ã€å‹ç¼©å’Œè§£å‹ç¼©</h3>
<p><code>.gz</code> å‹ç¼©åæ ¼å¼ï¼Œ<code>.tar </code>æ‰“åŒ…åæ ¼å¼ï¼Œ<code>tar.gz</code>å…ˆæ‰“åŒ…åå‹ç¼©çš„æ ¼å¼ï¼ˆå¸¸ç”¨ï¼‰</p>
<h4> gzip</h4>
<p>gzip å‹ç¼©ä¼šåˆ é™¤æºæ–‡ä»¶,</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>#</code> å‹ç¼©ç­‰çº§</p>
<p><code>v</code> æ˜¾ç¤ºå‹ç¼©å‰åå‹ç¼©æ¯”</p>
<p><code>t</code> æ ¡éªŒæ˜¯å¦æ˜¯ gzip å‹ç¼©çš„æ–‡ä»¶</p>
<p><code>c</code> å‹ç¼©æ–‡ä»¶å¹¶è¾“å‡ºåˆ°å±å¹•</p>
<p><code>d</code> è§£å‹æ–‡ä»¶</p>
<p>ä½¿ç”¨:</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4> tar</h4>
<p>æ‰“åŒ…ï¼Œåœ¨å‹ç¼©æ–‡ä»¶å¤¹æ—¶ï¼Œä¸€èˆ¬ä¸ºäº†æ•ˆç‡éƒ½ä¼šå…ˆæ‰“åŒ…ï¼Œåœ¨å‹ç¼©ï¼Œç”±æ­¤å½¢æˆçš„æ ¼å¼ä¸€èˆ¬æ˜¯ç±»ä¼¼<code>*.tar.gz*</code>çš„åç¼€ã€‚</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>c</code> å»ºç«‹æ‰“åŒ…æ–‡æ¡£</p>
<p><code>x</code> è§£åŒ…<code> -C</code> è¾“å‡ºç›®å½•</p>
<p><code>t</code> æŸ¥çœ‹æ‰“åŒ…æ–‡ä»¶çš„å†…å®¹</p>
<p><code>j</code> / <code>z</code> ä½¿ç”¨<code>bz2</code> / <code>gzip</code> å‹ç¼©ã€è§£å‹</p>
<p><code>v</code> è¾“å‡ºä¿¡æ¯</p>
<p><code>f</code> åé¢ç´§è·Ÿè¦æ“ä½œçš„æ–‡ä»¶</p>
<h2> bash shell</h2>
<p>bash æ˜¯ç”¨æˆ·å’Œå†…å®¹äº¤äº’çš„æ¡¥æ¢ <code>ç”¨æˆ· â†” bash â†” Unixå†…æ ¸</code></p>
<p><code>env</code> æŸ¥çœ‹ç¯å¢ƒå˜é‡</p>
<p><code>type</code> æŸ¥çœ‹ç±»å‹</p>
<p><code>which</code> æŸ¥çœ‹æŒ‡ä»¤çš„ä½ç½®</p>
<p><code>clear</code> ã€ <code>cls</code> æ¸…å±</p>
<p><strong>bash shell è®¾ç½®</strong></p>
<h3> è‡ªå®šä¹‰å˜é‡</h3>
<p><code>key=value</code> å¢åŠ ä¸€ä¸ªå€¼ä¸º<code>value</code>çš„å˜é‡<code>key</code></p>
<p>å…¶ä¸­ï¼Œå¦‚æœ value æœ‰ç©ºæ ¼çš„è¯éœ€è¦ç”¨å¼•å·åŒ…ä½ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>echo $KEYâ€‹ </code>å¯ä»¥è¾“å‡º<code>KEY</code>çš„å€¼</p>
<p><code>set</code> æŸ¥çœ‹æ‰€æœ‰å˜é‡</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3> åˆ«åé…ç½®</h3>
<p><code>alias</code> æŸ¥çœ‹æ‰€æœ‰åˆ«å</p>
<p><code>alias newCmd=oldCmd</code>ä½¿ç”¨<code>newCmd</code>è¡¨ç¤º<code>oldCmd</code></p>
<p><code>unalias newCmd</code> åˆ é™¤åˆ«å</p>
<p>å¦‚:<code>alias cls=clear</code>,æ‰§è¡Œ<code>cls</code>å°±ç­‰äºæ‰§è¡Œ<code>clear</code></p>
<h3> ç¯å¢ƒå˜é‡</h3>
<p><code>export KEY=VALUE</code> å°†å€¼ä¸º<code>VALUE</code>çš„<code>KEY</code>æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼ˆæœ¬æ¬¡ shell æœ‰æ•ˆï¼‰</p>
<p>æ­¤å¤–è¿˜å¯ä»¥å†™åˆ°ä¸€äº›æ–‡ä»¶ä¸­ï¼Œåœ¨å¼€æœºã€ç™»å½•ã€æ³¨é”€ç™»å½•æ—¶è°ƒç”¨æ‰§è¡Œâ€”â€”è‡ªåŠ¨æ‰§è¡Œè„šæœ¬**<code>shell startup scripts</code>**</p>
<h3> shell startup scripts</h3>
<p>å¼€æœºæ—¶æ‰§è¡Œï¼š</p>
<ul>
<li>
<p><code>/etc/profile</code></p>
</li>
<li>
<p><code>/ect/profile.d/*.sh</code></p>
</li>
<li>
<p><code>~/.bash_profile , ~/.bash_login , ~/.profile</code>è¿™ä¸‰ä¸ªåªè¦å…¶ä¸­ä¸€ä¸ªæˆåŠŸæ‰§è¡Œäº†ï¼Œåé¢çš„å°±ä¸ä¼šæ‰§è¡Œï¼Œ<code>~/.bash_profile</code>ä¼šæ‰§è¡Œ<code>~/.bashrc</code></p>
</li>
<li>
<p><code>/etc/.bashrc</code></p>
</li>
</ul>
<p>æœªç™»å½•æ—¶ä¼šæ‰§è¡Œï¼š</p>
<ul>
<li><code>~/.bashrc</code></li>
<li><code>/etc/bashrc</code></li>
<li><code>/etc/profile.d/*.sh</code></li>
</ul>
<p>æ³¨é”€æ—¶æ‰§è¡Œ<code>~/bash_logout</code></p>
<p><strong>åœ¨ä¿®æ”¹äº†ä»¥ä¸Šæ–‡ä»¶åï¼Œå¯ä»¥ä½¿ç”¨<code>source path_to_file</code>æˆ–è€…é‡æ–°ç™»å½•ä½¿å…¶ç«‹å³ç”Ÿæ•ˆ</strong></p>
<h2> æ ‡å‡†è¾“å…¥è¾“å‡ºç­‰</h2>
<table>
<thead>
<tr>
<th>ä»£ç ç¼–å·</th>
<th>åç§°</th>
<th>ä»£ç </th>
<th>ä½œç”¨å¯¹è±¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>æ ‡å‡†è¾“å…¥</td>
<td>stdin</td>
<td>é”®ç›˜ç­‰</td>
</tr>
<tr>
<td>1</td>
<td>æ ‡å‡†è¾“å‡º</td>
<td>stdout</td>
<td>å±å¹•ç­‰</td>
</tr>
<tr>
<td>2</td>
<td>æ ‡å‡†é”™è¯¯</td>
<td>stderr</td>
<td>å±å¹•ç­‰</td>
</tr>
</tbody>
</table>
<p>å®šå‘</p>
<ul>
<li><code>&lt;</code>å’Œ<code>&lt;&lt;</code> è¾“å…¥å’Œ è¿½åŠ è¾“å…¥</li>
<li><code>&gt;</code> å’Œ<code>&gt;&gt;</code> è¾“å‡º å’Œè¿½åŠ è¾“å‡º</li>
</ul>
<p>ä½¿ç”¨ï¼š<code>ls -al | &gt;&gt; result.txt</code>å°†<code>ls</code>çš„å†…å®¹è¿½åŠ è¾“å‡ºåˆ°<code>result.txt</code>æ–‡ä»¶ä¸­ã€‚</p>
<p><code>|</code>å«åšç®¡é“ï¼Œå¯ä»¥å°†å‰è€…çš„<strong>æ ‡å‡†è¾“å‡º</strong>å½“åšåè€…çš„è¾“å…¥ã€‚</p>
<p><code>cmd0 &amp;&amp; cmd1</code> å‰è€…æ‰§è¡ŒæˆåŠŸæ‰ä¼šæ‰§è¡Œåè€…ï¼›</p>
<p><code>cmd0 || cmd1</code> å‰è€…æ‰§è¡Œå¤±è´¥æ‰ä¼šæ‰§è¡Œåè€…ã€‚</p>
<h2> grep</h2>
<p>æŸ¥è¯¢å†…å®¹</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>c</code> è®¡ç®—æ¬¡æ•°</p>
<p><code>i</code> å¿½ç•¥å¤§å°å†™</p>
<p><code>n</code> è¡Œå·</p>
<p><code>v</code> æ˜¾ç¤ºæ²¡æœ‰è¯¥å­—ç¬¦çš„è¡Œå·</p>
<p><code>'key' </code>å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼</p>
<p><code>--color=auto</code> å¯¹æŸ¥æ‰¾åˆ°çš„æ–‡æœ¬æ˜¾ç¤ºé¢œè‰²</p>
<h2> sort</h2>
<p>æ’åºï¼Œé»˜è®¤ä»¥ç¬¬ä¸€åˆ—æ’åº</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>f</code> å¿½ç•¥å¤§å°å†™</p>
<p><code>b</code>å¿½ç•¥æœ€å‰é¢çš„ç©ºæ ¼ï¼ˆè¦æ˜¯æ’åºä¸ç”Ÿæ•ˆæ—¶å¯ä»¥è¯•ä¸€ä¸‹ï¼Œæ¨èï¼‰</p>
<p><code>k</code> ä»¥ç¬¬å‡ åˆ—ä¸ºæ ‡å‡†æ’åºï¼Œé»˜è®¤ç¬¬ä¸€åˆ—</p>
<p><code>n</code> ä»¥æ•°ç»„æ’åº</p>
<p><code>r</code> é€†åº</p>
<p><code>t</code> å¾…æ’åºçš„æ–‡ä»¶çš„åˆ†éš”ç¬¦ï¼Œé»˜è®¤æ˜¯ tab</p>
<p><code>M</code> ä»¥è‹±æ–‡æœˆä»½æ’åº</p>
<h2> wc</h2>
<p>ç»Ÿè®¡å­—ç¬¦æ•°</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>l</code> è¡Œ</p>
<p><code>w</code> è¯</p>
<p><code>m</code> å­—ç¬¦</p>
]]></content:encoded>
    </item>
    <item>
      <title>OKHttpUtils åˆ†æ</title>
      <link>https://jixiaoyong.github.io/blog/posts/6ff87ae7.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/6ff87ae7.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">OKHttpUtils åˆ†æ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 17 Mar 2019 05:32:21 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>æœ¬æ–‡æ˜¯å¯¹å¼ é¸¿æ´‹çš„ OKHttp è¾…åŠ©ç±»<a href="https://github.com/hongyangAndroid/okhttputils" target="_blank" rel="noopener noreferrer"><strong>okhttputils</strong></a>ç®€è¦åˆ†æï¼Œä»¥ä¾¿å­¦ä¹ å¦‚ä½•å°è£…å¸¸è§å·¥å…·çš„æ€æƒ³ï¼Œå»ºè®®é…åˆæºç é£Ÿç”¨ã€‚</p>
<p>ä¸»è¦æ¶‰åŠç±»ï¼š</p>
<ul>
<li>OkHttpUtils</li>
<li>OkHttpRequestBuilder</li>
<li>OkHttpRequest</li>
<li>RequestCall</li>
<li>Callback</li>
</ul>
<h2> åŸºç¡€</h2>
<p><a href="https://github.com/square/okhttp" target="_blank" rel="noopener noreferrer">OkHttp</a>æ˜¯å¯ä»¥ç”¨äº Android å’Œ Java çš„ Http æ¡†æ¶ï¼Œç»å…¸çš„ä½¿ç”¨åˆ†ä¸º 3 æ­¥ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è™½ç„¶æ•´ä½“çš„é€»è¾‘å·²ç»å¾ˆç®€å•äº†ï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸å¯èƒ½å¯¹æ¯ä¸ªç½‘ç»œè¯·æ±‚éƒ½å†™ä¸€æ¬¡ä¸Šè¿°ä»£ç ï¼Œæ‰€ä»¥å°±éœ€è¦å¯¹é½è¿›è¡Œå¿…è¦çš„å°è£…ä»¥ç®€åŒ–ç½‘ç»œè¯·æ±‚æµç¨‹ã€‚</p>
<p>okhttputils å°±åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”å°†ä¸Šè¿°ç¬¬äºŒæ­¥å¸¸è§ç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹ä¹ŸåŠ å…¥é“¾å¼è°ƒç”¨ä¸­ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ è¿è´¯ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<code>9~10</code>è¡Œç›¸å½“äº OKHttp æ­¥éª¤ 2 åˆ›å»ºç½‘ç»œè¯·æ±‚ï¼Œ<code>11~14</code>åˆ™å°±æ˜¯æ­¥éª¤ 3 æ‰§è¡Œç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹ã€‚</p>
<p>æ¯æ¬¡ä½¿ç”¨ç½‘ç»œè¯·æ±‚æ—¶åªéœ€è¦é€‰æ‹©<code>get</code>ã€<code>post</code>ç­‰æ–¹æ³•è·å–å¹¶é…ç½®ç›¸åº”<code>builder</code>ï¼Œç„¶åé€‰æ‹©<code>execute</code>æ‰§è¡Œå³å¯ã€‚</p>
<h2> å®ç°åˆ†æ</h2>
<p>é‚£ä¹ˆ okhttputils æ˜¯å¦‚ä½•å®ç°è¿™ä¸€ç‚¹çš„å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆçœ‹çœ‹<code>OkHttpUtils</code>çš„ç»“æ„ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20190317141417.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>å¯ä»¥çœ‹åˆ°å¤§ä½“ä¸Šå¯ä»¥å°†å…¶åˆ†ä¸º 3 ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>OkHttpClient ç›¸å…³</li>
<li>ç½‘ç»œè¯·æ±‚ç›¸å…³ä¿¡æ¯</li>
<li>ä¸å…·ä½“æ‰§è¡Œç½‘ç»œè¯·æ±‚æœ‰å…³çš„æ–¹æ³•</li>
</ol>
<h3> OkHttpClient ç›¸å…³</h3>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€éƒ¨åˆ†ï¼ŒOkHttpUtils æœ¬è´¨ä¸Šåªæ˜¯å¯¹ OkHttpClient çš„æ–¹æ³•è¿›è¡Œäº†ä¸€æ¬¡å°è£…ï¼Œæ‰€ä»¥å…¶è‚¯å®šè¦æŒæœ‰ OkHttpClient å¯¹è±¡ï¼Œä¸€èˆ¬æ¥è¯´ä¸€ä¸ª APP åªéœ€è¦ä¸€ä¸ª OkHttpClient å¯¹è±¡å³å¯ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ° OkHttpUtils åšäº†åŒé‡é”å®šçš„å•ä¾‹å¤„ç†ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨<code>OkHttpUtils</code>çš„æ—¶å€™åˆå§‹åŒ–çš„<code>OkHttpClient</code>ä¾¿ä¼šè¢«ä¿å­˜åˆ°è¿™é‡Œï¼Œä¹‹åçš„ä½¿ç”¨ä¸­å°±ä¸éœ€è¦å†å»åå¤åˆ›å»ºäº†ã€‚</p>
<p>æ­¤å¤–åœ¨<code>OkHttpUtils</code>çš„ç»“æ„ä¸­å¯ä»¥æ³¨æ„åˆ°æœ‰ä¸€ä¸ª<code>mPlatform</code>çš„å˜é‡ï¼Œä»–ä¼šæ ¹æ®å½“å‰æ˜¯ Android è¿˜æ˜¯å…¶ä»–å¹³å°çš„ä¸åŒè¢«åˆå§‹åŒ–ä¸º Android ä¸»çº¿ç¨‹æˆ–è€…æ™®é€šçº¿ç¨‹æ± ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨åé¢å›è°ƒç½‘ç»œè¯·æ±‚çŠ¶æ€çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ç½‘ç»œè¯·æ±‚ç›¸å…³ä¿¡æ¯</h3>
<p>æœ‰äº†<code>OkHttpClient</code>å¯¹è±¡ä¹‹åï¼Œä¸‹ä¸€æ­¥ä¾¿æ˜¯åˆ›å»ºä¸€ä¸ªé€‚å½“çš„ç½‘ç»œè¯·æ±‚ã€‚</p>
<p>åœ¨<code>OkHttpUtils</code>ä¸­ä½¿ç”¨çš„æ˜¯<code>OkHttpRequestBuilder &lt;T extends OkHttpRequestBuilder&gt;</code>çš„å­ç±»æ¥æ”¶é›†ã€é…ç½®ç›¸å…³çš„ä¸€äº›å±æ€§ã€‚</p>
<p>åœ¨è¯¥ç±»ä¸­ï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—ç½‘ç»œè¯·æ±‚åŸºæœ¬çš„å‚æ•°ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºæ‰§è¡Œç½‘ç»œè¯·æ±‚çš„<code>RequestCall</code>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªæ–¹æ³•åœ¨å…¶å­ç±»ä¸­çš„å®ç°ä¸€èˆ¬æ˜¯è°ƒç”¨<code>OkHttpRequest</code>å­ç±»çš„<code>build</code>æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°<code>OkHttpRequestBuilder</code>åªæ˜¯å°†ç½‘ç»œè¯·æ±‚çš„ç›¸å…³å‚æ•°ä¼ é€’åˆ°<code>OkHttpRequest</code>ä¸­ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>OkHttpRequest</code>ä¸­ï¼Œåˆ©ç”¨ä¸Šè¿°çš„å‚æ•°å¯ä»¥å¹¶é€šè¿‡<code>generateRequest(Callback callback)</code>æ–¹æ³•åˆ›å»º<code>Request</code>ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„æŠ½è±¡æ–¹æ³•<code>wrapRequestBody()</code>ï¼Œ<code>buildRequest()</code>çš„å®ç°ï¼Œä¹Ÿæ˜¯<code>OkHttpRequest</code>å„ä¸ªå­ç±»ä¸»è¦çš„ä¸åŒç‚¹ã€‚</p>
<blockquote>
<p><code>Callback</code>æ˜¯åœ¨<code>okhttp3.Callback</code>çš„åŸºç¡€ä¸Šå¢åŠ äº† beforeï¼Œprogress å’Œå¯¹è¯·æ±‚ç»“æœçš„å¤„ç†ç­‰çš„å›è°ƒã€‚</p>
</blockquote>
<p><code>OkHttpRequest</code>ç±»çš„<code>build</code>æ–¹æ³•åˆ™åªæ˜¯å°†å…¶è‡ªèº«ä¼ é€’ç»™<code>okhttp3.Call</code>çš„å°è£…ç±»<code>RequestCall</code>ï¼Œåˆ›å»ºå¹¶è¿”å›è¯¥ç±»çš„å¯¹è±¡ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> æ‰§è¡Œç½‘ç»œè¯·æ±‚</h3>
<p><code>RequestCall</code>ç±»åˆ™æ˜¯å¯¹<code>okhttp3.Call</code>ç±»çš„è¿›ä¸€æ­¥å°è£…ï¼Œå¯¹å¤–æä¾›æ›´å¤šçš„æ¥å£ï¼šå¼€å§‹ã€å–æ¶ˆç½‘ç»œè¯·æ±‚<code>cancel()</code>,<code>readTimeOut()</code>â€¦ç­‰æ¥å£ã€‚</p>
<p>å½“æ‰§è¡Œ<code>RequestCall</code>çš„<code>execute</code>æ–¹æ³•æ—¶ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹å…¶æœ€ååªæ˜¯å°†<code>RequestCall</code>å’Œ<code>callback</code>ä¼ é€’ç»™äº†<code>OkHttpUtils</code>ç±»çš„<code>execute</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†<code>okhttp3.Call</code>çš„<code>enqueue()</code>æ–¹æ³•ï¼Œåœ¨è¿™é‡Œæ‰§è¡Œäº†çœŸæ­£çš„ç½‘ç»œè¯·æ±‚ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œç½‘ç»œè¯·æ±‚çš„å›è°ƒï¼Œåˆ™æ˜¯åœ¨æœ¬æ–‡æœ€å¼€å§‹çš„<code>mPlatform</code>æä¾›çš„çº¿ç¨‹ä¸­è¿›è¡Œã€‚è¿™æ ·ä¿è¯äº†åœ¨ Android ä¸­ï¼Œ<code>onBefore</code>ã€<code>onAfter</code>ã€<code>inProgress</code>ç­‰å›è°ƒèƒ½å¤Ÿåœ¨ UI çº¿ç¨‹è¿›è¡Œã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æ€»ç»“</h2>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œ<code>okhttputils</code>å°†åˆå§‹åŒ–<code>OkHttpClient</code>çš„åŠ¨ä½œæå–å‡ºæ¥ï¼Œè¿™æ ·åŒä¸€ä¸ªåº”ç”¨åªéœ€è¦åœ¨æœ€å¼€å§‹çš„æ—¶å€™é…ç½®ä¸€ä¸‹è¯¸å¦‚ç½‘ç»œè¶…æ—¶ã€cookie ç­‰æ—¢å¯ã€‚</p>
<p>åœ¨å…·ä½“çš„å®ç°ä¸­ï¼Œé€šè¿‡<code>OkHttpRequestBuilder</code>æ”¶é›†ç½‘ç»œè¯·æ±‚çš„å±æ€§å¹¶ä¼ é€’ç»™<code>OkHttpRequest</code>ï¼Œåœ¨å…¶å­ç±»ä¸­æŒ‰ç…§ä¸åŒçš„éœ€è¦å®ç°ç”Ÿæˆ<code>Request</code>çš„æ–¹æ³•ã€‚</p>
<p><code>OkHttpRequestBuilder</code>çš„<code>build()</code>æ–¹æ³•ä¼šç”Ÿæˆ<code>RequestCall</code>å¯¹è±¡ï¼Œ<code>RequestCall</code>å¯¹è±¡çš„<code>execute()</code>æ–¹æ³•ä¼šè°ƒç”¨<code>OkHttpRequestBuilder</code>å¯¹è±¡çš„<code>generateRequest()</code>æ–¹æ³•äº§ç”Ÿ<code>Request</code>ï¼Œå¹¶æ®æ­¤äº§ç”Ÿ<code>Call</code>å¯¹è±¡ï¼Œæœ€åé€šè¿‡è¯¥<code>Call</code>å¯¹è±¡çš„ enqueue æ–¹æ³•æ‰§è¡Œç½‘ç»œè¯·æ±‚ã€‚</p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20190317141417.png" type="image/png"/>
    </item>
    <item>
      <title>Python è‡ªåŠ¨åˆ›å»ºå‘å¸ƒ hexo æ–‡ç« å¹¶åŒæ­¥ github</title>
      <link>https://jixiaoyong.github.io/blog/posts/d9a2e1ba.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/d9a2e1ba.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Python è‡ªåŠ¨åˆ›å»ºå‘å¸ƒ hexo æ–‡ç« å¹¶åŒæ­¥ github</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 31 Jan 2018 16:09:12 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€ä»‹</h2>
<blockquote>
<p>ç¯å¢ƒ linux(deepin)</p>
<p>python 2.7</p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œç”¨äºå®ç° hexo æ–‡ç« åˆ›å»ºã€ç”Ÿæˆç½‘é¡µå¹¶é¢„è§ˆã€å‘å¸ƒåˆ°å¯¹åº” <a href="http://xxx.github.io" target="_blank" rel="noopener noreferrer">xxx.github.io</a> åšå®¢çš„å…¨è¿‡ç¨‹ã€‚</p>
<h2> ä½¿ç”¨æ–¹æ³•</h2>
<h3> ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®è‡ªå·±çš„é¡¹ç›®æ›´æ–° <a href="http://main.py" target="_blank" rel="noopener noreferrer">main.py</a> çš„ä¸€ä¸‹å˜é‡ï¼š</h3>
<ul>
<li>
<p>hexo_url = 'your_path/hexo/blog'</p>
<p>ã€å¿…éœ€ã€‘æœ¬åœ° hexo åšå®¢è·¯å¾„</p>
</li>
<li>
<p>hexo_public_dir = 'your_path/hexo/blog/public'</p>
<p>ã€å¿…éœ€ã€‘æœ¬åœ° hexo åšå®¢è¾“å‡ºè·¯å¾„</p>
</li>
<li>
<p>hexo_post_dir = 'your_path/hexo/blog/source/_posts'</p>
<p>ã€å¯é€‰ã€‘æœ¬åœ° hexo åšå®¢æ–‡ç« æºæ–‡ä»¶è·¯å¾„</p>
</li>
<li>
<p>git_dir = 'your_path/xxx.github.io'</p>
<p>ã€å¿…éœ€ã€‘åšå®¢è¦åŒæ­¥çš„ git å·¥ç¨‹è·¯å¾„</p>
</li>
<li>
<p>git_backup_dir = 'your_path/xxx.github.io/blog/backup/sources/_posts'</p>
<p>ã€å¯é€‰ã€‘æœ¬è·¯å¾„ç”¨äºå¤‡ä»½ post æºæ–‡ä»¶åˆ° github</p>
</li>
<li>
<p><a href="http://hexo.py" target="_blank" rel="noopener noreferrer">hexo.py</a> ä¸­çš„<code>post()</code>æ–¹æ³•ä¸­<code>webbrowser.open('http://jixiaoyong.github.io/blog/')</code>ä¸­çš„åšå®¢åœ°å€ï¼Œå‘å¸ƒå®Œåé»˜è®¤æ‰“å¼€è¯¥ç½‘é¡µã€‚ï¼ˆåæœŸä¹Ÿå¯ä»¥æ”¹ä¸º<code>post()</code>å‚æ•°ä¼ å…¥ï¼Œè¿™æ ·åªéœ€è¦æ›´æ”¹<code>main.py</code>å°±è¡Œï¼‰</p>
</li>
</ul>
<h3> è¿è¡Œ<code>main.py</code>æ–‡ä»¶</h3>
<ul>
<li>åœ¨ Linux å‘½ä»¤è¡Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶å›è½¦ï¼Œæ ¹æ®æç¤ºæ“ä½œå³å¯ã€‚</li>
</ul>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â€‹ Windows ä¸‹å¯ä»¥è¿è¡Œ<code>start.cmd</code>è„šæœ¬ï¼ˆå¾…å®ç°ï¼‰</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>
<p>æ“ä½œè¿‡ç¨‹æç¤ºåŠè¯´æ˜å¦‚ä¸‹ï¼šï¼ˆæ¸£è‹±è¯­è¯·å¿½ç•¥...ï¼‰</p>
<ul>
<li>
<p>input yout file name è¾“å…¥è¦å‘å¸ƒçš„æ–‡ç« åç§° xxxï¼ˆå½“å‰ç‰ˆæœ¬æš‚ä¸æ”¯æŒä¸­æ–‡ï¼‰</p>
<p>è¾“å…¥å›è½¦ä¼šè‡ªåŠ¨åˆ›å»º <a href="http://xxx.md" target="_blank" rel="noopener noreferrer">xxx.md</a> æ–‡ä»¶å¹¶æ‰“å¼€ï¼ˆéœ€è¦ç³»ç»Ÿæ”¯æŒè¯¥æ ¼å¼ï¼‰</p>
</li>
<li>
<p>are you finish your post è¾“å…¥ y æˆ– nï¼Œé€‰æ‹©æ˜¯å¦ç”¨ hexo ç¼–è¯‘æ–‡ç« </p>
<p>y:ç¼–è¯‘æ–‡ç«  n:ä¸ç¼–è¯‘æ–‡ç« ï¼Œé€€å‡ºå‘½ä»¤è¡Œ</p>
</li>
<li>
<p>post or not è¾“å…¥ y æˆ– nï¼Œé€‰æ‹©æ˜¯å¦å‘å¸ƒæ–‡ç« åˆ°ç½‘ç«™ï¼Œå¯ä»¥åœ¨æ‰“å¼€çš„é¡µé¢é¢„è§ˆååšå†³å®š</p>
<p>y:å‘å¸ƒæ–‡ç«  n:ä¸å‘å¸ƒæ–‡ç« ï¼Œé€€å‡ºå‘½ä»¤è¡Œ</p>
</li>
<li>
<p>update postã€Šxxxã€‹æç¤ºå¼€å§‹å‘å¸ƒæ–‡ç« ï¼Œè‡ªåŠ¨æ‰“å¼€ç½‘é¡µï¼Œå¹¶ä¿å­˜æºæ–‡ä»¶</p>
</li>
</ul>
</li>
</ul>
<h2> æºä»£ç </h2>
<p>æºä»£ç å·²ç»ä¸Šä¼ <a href="https://github.com/jixiaoyong/AndroidNote/tree/master/code/2018-1-31/python%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E6%96%87%E7%AB%A0" target="_blank" rel="noopener noreferrer">github</a></p>
<h2> åæœŸè®¡åˆ’</h2>
<ul>
<li>å¢åŠ æ–‡ä»¶åä¸­æ–‡æ”¯æŒ</li>
<li><s>å¢åŠ å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ ã€æ›¿æ¢ä¸º github é“¾æ¥</s>(2018/2/2 å·²å®ç°)</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Python å…¥é—¨çŸ¥è¯†</title>
      <link>https://jixiaoyong.github.io/blog/posts/a8f97c56.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/a8f97c56.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Python å…¥é—¨çŸ¥è¯†</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 20 Jan 2018 15:49:17 GMT</pubDate>
      <content:encoded><![CDATA[<p>åŸºäº Python3.x</p>
<p>Python æ–‡ä»¶é»˜è®¤æ ¼å¼<code>.py</code></p>
<p>é¦–è¡Œé»˜è®¤ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2> æ•°æ®ç±»å‹</h2>
<ul>
<li>
<p><strong>æ•°å­—</strong></p>
<p>æ•´æ•° int 1ï¼Œ2ï¼Œ3</p>
<p>é•¿æ•´æ•° long 1112L</p>
<p>æµ®ç‚¹æ•° floatï¼ˆå°æ•°ï¼‰1.23ï¼Œ3.14</p>
<p>å¤æ•° complex 3.14j</p>
</li>
<li>
<p><strong>å­—ç¬¦ä¸²</strong></p>
<p>'abc'ï¼Œ"abc"ï¼Œ'''abcâ€˜â€™â€˜</p>
<p>'x'å’Œ"x" åŒºåˆ«ä¸å¤§</p>
<p>'''abcâ€˜â€™â€˜æ–‡æœ¬å¯ä»¥è·¨è¡Œ</p>
<p>å­—ç¬¦ä¸²å‰é¢åŠ  r æˆ–è€… R è¡¨ç¤ºå­—ç¬¦ä¸²å†…éƒ¨ä¸éœ€è¦è½¬ä¹‰ï¼Œå¦åˆ™è¦ç”¨<code>\</code> è½¬ä¹‰</p>
<p>æ”¯æŒ<code>a[0]</code>å–å€¼</p>
</li>
<li>
<p><strong>å¸ƒå°”å€¼</strong></p>
<p><code>True</code> å’Œ<code>False</code></p>
<p>å¸ƒå°”å€¼å¯ä»¥ç”¨<code>and</code>ã€<code>or</code>å’Œ<code>not</code>è¿ç®—</p>
</li>
<li>
<p><strong>ç©ºå€¼</strong></p>
<p><code>None</code></p>
</li>
<li>
<p><strong>å˜é‡</strong></p>
<p>å‘½åè§„åˆ™ï¼šå¼€å¤´<code>aA_</code>ï¼Œå…¶åå¯ä»¥åŒ…å«<code>aA_1</code></p>
</li>
<li>
<p><strong>å¸¸é‡</strong></p>
<p>ä¸èƒ½å˜çš„å˜é‡</p>
</li>
</ul>
<h2> é›†åˆ</h2>
<ul>
<li>
<p><strong>åˆ—è¡¨ list</strong></p>
<p>[1,2,3,3]</p>
<p>æ’å…¥ list.insert(1,'vaule')</p>
<p>åˆ é™¤ list.pop() / list.pop(1)</p>
</li>
<li>
<p>**å…ƒç»„ tuple **</p>
<p>(1,2,3,3)</p>
<p>ä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä½†æ˜¯ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½å†ä¿®æ”¹</p>
<hr>
</li>
<li>
<p><strong>å­—å…¸ dict</strong></p>
<p a:1,b:vaule=""></p>
<p>é”®å€¼å¯¹ï¼Œè¯»å–å¿«ï¼Œç›¸å½“äº java çš„ map</p>
</li>
<li>
<p><strong>set</strong></p>
<p>set([1,2,3])</p>
<p>é”®çš„é›†åˆï¼Œä¸èƒ½æœ‰é‡å¤çš„ï¼Œç›¸å½“äº java çš„ set</p>
</li>
</ul>
<h2> é€»è¾‘è¯­å¥</h2>
<ul>
<li>if ... : ... elif ... : ... else : ...</li>
<li>for x in xs : ...</li>
<li>while x : ...</li>
</ul>
<h2> è‡ªå®šä¹‰å‡½æ•°</h2>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><strong>return</strong></li>
</ul>
<p>å¯ä»¥æ²¡æœ‰ returnï¼Œé»˜è®¤è¿”å› None</p>
<p>å¯ä»¥ return å¤šä¸ªå€¼ï¼Œå®é™…ä¸Šè¿”å›çš„æ˜¯ä¸€ä¸ª tuple</p>
<ul>
<li><strong>pass</strong></li>
</ul>
<p>ä¸æƒ³æ‰§è¡Œä»»ä½•è¯­å¥ï¼Œä½†æ˜¯ä¸ºäº†ç¬¦åˆè¯­æ³•è§„èŒƒï¼Œå¯ä»¥ç”¨ pass å½“åšå ä½ç¬¦</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><strong>æŠ›å‡ºå¼‚å¸¸</strong></li>
</ul>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ä¸­ TypeError éœ€è¦ç»§æ‰¿è‡ª<code>error</code>æˆ–è€…<code>Exception</code></p>
<ul>
<li><strong>å‚æ•°</strong></li>
</ul>
<p>ä½ç½®å‚æ•°</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é»˜è®¤å‚æ•°</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„</strong> é»˜è®¤å‚æ•°å¿…é¡»æ˜¯å‚æ•°ä¸­åé¢çš„å‡ ä½ï¼›é»˜è®¤å€¼å¿…é¡»ä¸å¯å˜ï¼Œå¦‚ intï¼Œstring ç­‰</p>
<p>å¯å˜å‚æ•°</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>*args</code> è¡¨ç¤ºå‚æ•°ä¸ªæ•°å¯å˜ï¼Œå¯ä»¥è¾“å…¥ list/tuple ç­‰ï¼Œæˆ–è€…ä¾æ¬¡è¾“å…¥å¤šä¸ªå‚æ•°ï¼Œç”¨é€—å·åˆ†éš”</p>
<p>å…³é”®è¯å‚æ•°</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>**keywords</code> è¡¨ç¤ºæ¥å—å…³é”®è¯ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¯ä»¥ä¼ å…¥ dictï¼Œæˆ–è€…ä¾æ¬¡è¾“å…¥å¤šä¸ªå…³é”®è¯å‚æ•°</p>
<p>å‘½åå…³é”®è¯å‚æ•°</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é™åˆ¶è¾“å…¥çš„å…³é”®å­—ï¼Œé™åˆ¶åªæœ‰ name å’Œ age ä½œä¸ºå…³é”®è¯å‚æ•°</p>
<h2> ä½¿ç”¨å…¶ä»–æ–‡ä»¶çš„å‡½æ•°</h2>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ç±»</h2>
<ul>
<li><strong>å®šä¹‰ç±»</strong></li>
</ul>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€æœ‰çš„ç±»æ–¹æ³•å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ¨èå‘½åä¸º selfï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¼ å…¥ç±»å¯¹è±¡ï¼Œæ— éœ€æ‰‹åŠ¨ä¼ å…¥ã€‚</p>
<ul>
<li><strong>ç»§æ‰¿</strong></li>
</ul>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œåˆ™éœ€è¦åœ¨å­ç±»å®šä¹‰æ—¶ä¼ å…¥çˆ¶ç±»</p>
<p>å­ç±»å¦‚æœæœ‰ä¸çˆ¶ç±»åŒåæ–¹æ³•ï¼Œåˆ™ä¼˜å…ˆè°ƒç”¨å­ç±»æ–¹æ³•ï¼Œé™¤éå­ç±»ç‰¹åˆ«è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•</p>
]]></content:encoded>
    </item>
    <item>
      <title>Python çˆ¬å– gityuan æ‰€æœ‰æ–‡ç« åˆ—è¡¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/6e070881.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/6e070881.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Python çˆ¬å– gityuan æ‰€æœ‰æ–‡ç« åˆ—è¡¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 28 Jan 2018 14:03:50 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€ä»‹</h2>
<p>æ›´æ–°å†…å®¹ï¼š</p>
<ul>
<li>çˆ¬å– <a href="http://gityuan.com" target="_blank" rel="noopener noreferrer">gityuan.com</a> ç½‘ç«™æ‰€æœ‰æ–‡ç« åˆ—è¡¨å¹¶è¾“å‡º json</li>
<li>æ±‡æ€»ä¿¡æ¯è¾“å‡º config.json ä¸ºåé¢çš„å®¢æˆ·ç«¯åšå‡†å¤‡</li>
</ul>
<p>æ›´æ–°æ–‡ä»¶ï¼š</p>
<ul>
<li>spider_main.py</li>
<li>html_output.py</li>
<li><strong>gityuan_urls.py</strong></li>
<li><strong>html_downloader.py</strong></li>
</ul>
<h2> ä»£ç </h2>
<ul>
<li><strong>spider_main.py</strong></li>
</ul>
<p>ä½œä¸ºå…¥å£ç±»ï¼Œä¸»è¦å¢åŠ äº†åˆå§‹åŒ–æ‰€æœ‰ URLï¼Œä»¥åŠä¾¿åˆ©è¿™äº› URL çš„åŠŸèƒ½ã€‚</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶<code>craw()</code>æ–¹æ³•ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><strong>html_output.py</strong></li>
</ul>
<p>ä¸»è¦æ”¹åŠ¨å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>output_html(self,file_name)</code>æ–¹æ³•å¢åŠ ä¸€ä¸ª<code>file_name</code>çš„å‚æ•°ï¼Œå¹¶åœ¨å†…éƒ¨è°ƒç”¨<code>self.mkdir()</code>æ–¹æ³•ç”Ÿæˆ output ç›®å½•ï¼Œæ–¹ä¾¿åŒæ—¶è¾“å‡ºå¤šä¸ªæ–‡æ¡£</li>
<li><code>mkdir()</code>æ–¹æ³•ï¼Œåˆ›å»ºæ–‡ä»¶</li>
<li><code>end(self,file_name_start, url, num)</code>æ–¹æ³•ï¼Œè¾“å‡ºæ±‡æ€»æ–‡æ¡£ï¼Œä»£ç å¦‚ä¸‹</li>
</ol>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><strong>gityuan_urls.py</strong></li>
</ul>
<p>ä¸»è¦ä»£ç å¦‚ä¸‹ï¼Œé€šè¿‡å¾ªç¯éå†è·å–æ‰€æœ‰æ–‡ç« åˆ—è¡¨ä¿¡æ¯</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><strong>html_downloader.py</strong></li>
</ul>
<p>å°±åœ¨æœ¬æ–‡ç¼–è¾‘çš„è¿‡ç¨‹ä¸­ï¼Œçˆ¬è™«è¢«è¯†åˆ«ï¼Œå¹¶ä¸”é™åˆ¶è®¿é—®æ–‡ä»¶æ•°é‡ï¼Œæ‰€ä»¥å¯¹ä¸‹è½½åŠŸèƒ½åšäº†ç®€å•çš„ä¼ªè£…ã€å¢åŠ è¶…æ—¶å¤„ç†ã€‚</p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> ç»“è¯­</h2>
<p>å½“å‰çˆ¬è™«ä¸»ä½“åŠŸèƒ½ä»¥åŠå®ç°ï¼Œå¯ä»¥çˆ¬å– <a href="http://gityuan.com" target="_blank" rel="noopener noreferrer">gityuan.com</a> æ‰€æœ‰æœ‰æ•ˆæ–‡ç« åˆ—è¡¨ï¼Œå¯ä»¥æ»¡è¶³å®¢æˆ·ç«¯éœ€æ±‚ã€‚ä½†ä»ç„¶å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>æ²¡æœ‰ä¼ªè£…ï¼Œçˆ¬è™«<strong>å¾ˆå®¹æ˜“</strong>è¢«è¯†åˆ«å¹¶è¢«æ‹’ç»æœåŠ¡ï¼ˆ<s>å°±åœ¨åˆšåˆšå†™ä¸‹è¿™å¥è¯çš„æ—¶å€™ï¼Œå°±å‘ç”Ÿäº†è¢«é™åˆ¶è®¿é—®ï¼ŒçœŸ*ä¹Œé¸¦å˜´</s>ï¼‰ã€‚</li>
<li>ç”±äºåŸç½‘ç«™ç‰¹æ€§ï¼Œå…¶ç½®é¡¶æ–‡ç« æ¯é¡µéƒ½æœ‰ï¼Œä¼šå¯¼è‡´éƒ¨åˆ†æ•°æ®é‡å¤ã€‚</li>
<li>æœªçˆ¬å–å…·ä½“æ–‡ç« å†…å®¹ã€‚</li>
</ol>
<blockquote>
<p><strong>è¯´æ˜</strong></p>
<p>æœ¬æ–‡åªä¸ºå­¦æœ¯ç ”ç©¶ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çš„ç¬¬ä¸‰æ–¹ç½‘ç«™åŠå…¶æ‰€æœ‰èµ„æºå‡å±åŸä¸»æ‰€æœ‰ã€‚å‘ gityuan å¤§ç¥è‡´æ•¬ï¼Œæ¬¢è¿è®¿é—®å…¶<a href="http://gityuan.com/" target="_blank" rel="noopener noreferrer">blog</a>ã€‚</p>
</blockquote>
<h2> æºç </h2>
<p><a href="https://github.com/jixiaoyong/AndroidNote/tree/master/code/2018-1-26/gityuan_spider" target="_blank" rel="noopener noreferrer">github é“¾æ¥</a></p>
<p><code>tag</code>ä¸º<code>gityuan_spider1.5</code></p>
]]></content:encoded>
    </item>
    <item>
      <title>Python çˆ¬è™«çˆ¬å– gityuan.com æ•°æ®å¹¶è¾“å‡º json</title>
      <link>https://jixiaoyong.github.io/blog/posts/9c0ccf0d.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/9c0ccf0d.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Python çˆ¬è™«çˆ¬å– gityuan.com æ•°æ®å¹¶è¾“å‡º json</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 27 Jan 2018 14:25:34 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€ä»‹</h2>
<blockquote>
<p>æœ¬æ–‡åŸºäº Python2.7</p>
</blockquote>
<p>è¿™ç¯‡æ–‡ç« åŸºäºæˆ‘åœ¨<a href="www.imooc.com">æ…•è¯¾ç½‘</a>ä¸Šé¢å­¦ä¹  Python ç®€å•çˆ¬è™«å†™çš„å†…å®¹ï¼Œæ•™ç¨‹å†…å®¹æ˜¯çˆ¬å– 1000 æ¡ç™¾åº¦ç™¾ç§‘çš„æ•°æ®ï¼Œä½†æ˜¯æ•™ç¨‹ä¸­çˆ¬è™«æˆªæ­¢ 2018-01-27 å·²ç»å¤±æ•ˆï¼Œåˆšå¥½çœ‹åˆ°å¤§ç¥ <a href="http://gityuan.com" target="_blank" rel="noopener noreferrer">gityuan.com</a> çš„å†…å®¹ï¼Œäºæ˜¯ç”¨ Python å®ç°çˆ¬å–å…¶ç½‘é¡µå†…å®¹å¹¶ç”Ÿæˆ json æ•°æ®ã€‚</p>
<p>æœ¬æ–‡å³ä¸Šè¿°è¿‡ç¨‹æ•´ç†ã€‚</p>
<p>æœ¬æ–‡æ¶‰åŠæºä»£ç å·²ä¸Šä¼  githubï¼ˆ<a href="https://github.com/jixiaoyong/AndroidNote/tree/master/code/2018-1-26/gityuan_spider" target="_blank" rel="noopener noreferrer">ç‚¹è¿™é‡ŒæŸ¥çœ‹</a>ï¼‰ã€‚</p>
<h2> æ¡†æ¶</h2>
<p>çˆ¬è™«ä¸»è¦æ´»åŠ¨æ˜¯ï¼š</p>
<ol>
<li>çˆ¬å–ç›®æ ‡ç½‘é¡µå†…å®¹</li>
<li>å¯¹è·å–åˆ°çš„å†…å®¹è¿›è¡Œåˆ†æï¼Œè·å–æœ‰ç”¨æ•°æ®</li>
<li>å°†å¤„ç†å¥½çš„æ•°æ®æŒ‰æ ¼å¼è¾“å‡º</li>
</ol>
<p>æ­¤å¤–è¿˜éœ€è¦æœ‰ä¸€ä¸ªä¸“é—¨ç®¡ç†çˆ¬è™«æ´»åŠ¨çš„ä¸»ç±»ï¼Œæ•…è€Œæ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<ol>
<li>spider_main.py å…¥å£ç±»</li>
<li>url_manager.py ç®¡ç†è¦ä¸‹è½½çš„é“¾æ¥</li>
<li>html_downloader.py ä¸‹è½½ç½‘é¡µå†…å®¹</li>
<li>html_paeser.py å¯¹è·å–åˆ°çš„æ•°æ®è¿›è¡Œè§£æã€åŠ å·¥</li>
<li>html_out.py è¾“å‡ºæ ¼å¼åŒ–çš„æ•°æ®</li>
</ol>
<p>ç›®å‰åªå®ç°äº†çˆ¬å– <a href="http://gityuan.com" target="_blank" rel="noopener noreferrer">gityuan.com</a> ç¬¬ä¸€é¡µå†…å®¹å¹¶è¾“å‡º jsonï¼Œæ‰€ä»¥æš‚æ—¶ä¸éœ€è¦å®ç° url_manager.py</p>
<h2> å…³é”®ä»£ç </h2>
<p><strong>spider_main.py</strong></p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>åœ¨<code>__init__()</code> æ–¹æ³•åˆå§‹åŒ–å„ä¸ªå˜é‡ï¼›</li>
<li>åœ¨<code>craw()</code>ä¸­åˆ†åˆ«å®ç°ä¸‹è½½ã€è§£æç½‘é¡µå†…å®¹ã€è¾“å‡ºåŠ å·¥æ•°æ®</li>
</ul>
<p><strong>html_download.py</strong></p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹è½½å¹¶è¿”å›ç½‘é¡µå†…å®¹ï¼Œæ¯”è¾ƒç®€å•</p>
<p><strong>html_parser.py</strong></p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ˜¯çˆ¬è™«åŠŸèƒ½çš„é‡ç‚¹ä¹‹ä¸€ï¼šå¯¹ç½‘é¡µæ•°æ®è¿›è¡Œè§£æï¼Œç”±æ­¤æ•°æ®æ‰å˜ä¸ºå¯ç”¨æ•°æ®</p>
<p>ä¸»è¦æ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹æ’ä»¶<code>BeautifulSoup</code>è§£ææ•°æ®ï¼Œå¹¶ä¿å­˜åˆ°æ•°ç»„<code>res_data</code>ä¸­ï¼Œå…·ä½“è§ä»£ç ä¸­å®ç°</p>
<p><strong>html_output.py</strong></p>
<div class="language-python line-numbers-mode" data-ext="py"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ¬ç±»ä¹Ÿå¾ˆé‡è¦ï¼Œä¸»è¦æ˜¯æ•°æ®å­˜å–ï¼Œä»¥åŠå°†è§£æå¥½çš„æ•°æ®æ ¼å¼åŒ–è¾“å‡º</p>
<h2> è¯´æ˜</h2>
<p>æœ¬æ–‡ä¸­ä»£ç ç»äºŒæ¬¡å¤„ç†ï¼Œä¸ä¸€å®šä¸æºä»£ç ä¸€è‡´ï¼Œä½†æ€è·¯å¦‚æ­¤ï¼Œä»¥ä¾›å‚è€ƒã€‚</p>
]]></content:encoded>
    </item>
    <item>
      <title>Dart Isolate æºç åˆ†æ</title>
      <link>https://jixiaoyong.github.io/blog/posts/a951661c.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/a951661c.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Dart Isolate æºç åˆ†æ</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 28 May 2022 07:20:01 GMT</pubDate>
      <content:encoded><![CDATA[<h2> Isolate</h2>
<p>ğŸ’¡ æœ¬æ–‡åŸºäº Dart 2.17.1</p>
<p><a href="https://api.dart.cn/stable/2.17.1/dart-isolate/Isolate-class.html" target="_blank" rel="noopener noreferrer">Isolate</a>, an isolated Dart execution context.</p>
<p>All Dart code runs in an isolate, and <strong>code can access classes and values only from the same isolate</strong>. Different isolates can communicate by <strong>sending values through ports</strong> (see <a href="https://api.dart.cn/stable/2.17.1/dart-isolate/ReceivePort-class.html" target="_blank" rel="noopener noreferrer">ReceivePort</a>, <a href="https://api.dart.cn/stable/2.17.1/dart-isolate/SendPort-class.html" target="_blank" rel="noopener noreferrer">SendPort</a>).</p>
<blockquote>
<p>In Dart an isolate has its own event loop, its own global fields, can run in parallel with other isolates and have their own live-cycle.<br>
â€” <a href="https://github.com/dart-lang/sdk/issues/36097#issuecomment-746510375" target="_blank" rel="noopener noreferrer">https://github.com/dart-lang/sdk/issues/36097#issuecomment-746510375</a></p>
</blockquote>
<p>The new isolate has its <strong>own memory and its own thread</strong> working in parallel with the main isolate.</p>
<figure><img src="https://jixiaoyong.github.io/images/isolate_and_isolate_group.png" alt="https://www.youtube.com/watch?v=NoVYI94MJio&amp;ab_channel=Flutterly" tabindex="0" loading="lazy"><figcaption><a href="https://www.youtube.com/watch?v=NoVYI94MJio&amp;ab_channel=Flutterly" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=NoVYI94MJio&amp;ab_channel=Flutterly</a></figcaption></figure>
<p><a href="https://www.youtube.com/watch?v=NoVYI94MJio&amp;ab_channel=Flutterly" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=NoVYI94MJio&amp;ab_channel=Flutterly</a></p>
<p>Isolate åˆ›å»ºä¼šå ç”¨å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨<code>IsolateGroup</code>æ¥è§£å†³ï¼Œå¹¶ä¸”ç›®å‰ä¸ºæ­¢ Dart å’Œ Flutter éƒ½é»˜è®¤æ”¯æŒåœ¨ä½¿ç”¨<code>Isolate.spawn</code>åˆ›å»ºæ–° Isolate çš„æ—¶å€™ä½¿ç”¨ IsolateGroupï¼ˆ<code>Isolate.spwanUri</code>åˆ›å»ºçš„æ—¶å€™ä¼šåˆ›å»º<strong>å•ç‹¬</strong>çš„ IsolateGroup å’Œ Isolateï¼‰ã€‚</p>
<blockquote>
<p>ğŸ’¡ åœ¨åˆ›å»º isolate çš„æ—¶å€™å¯ä»¥æ·»åŠ <code>addOnExitListener</code> æˆ–è€…<code>addErrorListener</code>ä¹‹ç±»çš„ç›‘å¬ï¼Œä½†æ˜¯å¯èƒ½åœ¨æ‰§è¡Œæ·»åŠ ä»£ç çš„æ—¶å€™<strong>isolate å°±å·²ç»ç»ˆæ­¢äº†</strong>è€Œå¯¼è‡´è¿™äº›æ–¹æ³•æ”¶ä¸åˆ°å›è°ƒã€‚<br>
ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥åœ¨åˆ›å»º isolate çš„æ—¶å€™æŒ‡å®šä»–çš„çŠ¶æ€ä¸º**<code>paused</code>**ã€‚</p>
</blockquote>
<p>ä¸ isolate æœ‰å…³çš„ç±»æœ‰ï¼š</p>
<ul>
<li><code>Isolate</code> ä½ç½®åœ¨<code>sdk\lib\isolate\isolate.dart</code>ã€‚ä¸»è¦æ˜¯<code>Isolate</code> é€šç”¨æ–¹æ³•ã€å±æ€§çš„æŠ½è±¡æè¿°ï¼Œæ²¡æœ‰å…·ä½“å®ç°ã€‚</li>
<li><code>Isolate</code> ä½ç½®åœ¨<code>sdk\lib\_internal\vm\lib\isolate_patch.dart</code>ï¼Œæ˜¯ app ç­‰å¹³å°å¯¹åº”çš„å…·ä½“å®ç°ï¼Œéƒ¨åˆ†æ–¹æ³•è°ƒç”¨äº† native å±‚çš„ Isolate å®ç°ã€‚</li>
<li><code>Isolate</code> ä½ç½®åœ¨<code>runtime\vm\isolate.h</code>ä»¥åŠ<code>runtime\vm\isolate.cc</code>ä¸­ï¼Œæ˜¯ Isolate çš„ native å±‚å®ç°ã€‚</li>
</ul>
<p>ä»–ä»¬çš„å…³ç³»å¤§è‡´å¦‚å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/isolate_class_dart_and_native.png" alt="Untitled" tabindex="0" loading="lazy"><figcaption>Untitled</figcaption></figure>
<h2> ç®€å•ä½¿ç”¨</h2>
<h3> åˆ›å»ºæ–° Isolate çš„æ–¹å¼ï¼š</h3>
<ul>
<li><code>Isolate(``SendPort controlPort``, {this.pauseCapability, this.terminateCapability});</code> è¿™ç§æ–¹å¼åˆ›å»ºä¸€ç§<strong>èƒ½åŠ›å—é™</strong>çš„ Isolateã€‚The capabilities should be the subset of the capabilities that are available to the original isolate.æœ¬è´¨ä¸Šå¹¶æ²¡æœ‰åœ¨ native å±‚å­µåŒ–ä¸€ä¸ªæ–°çš„ Isolateã€‚</li>
</ul>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><code>Isolate.spawn(``void entryPoint(T message), T message,...)</code> åˆ›å»ºä¸€ä¸ªå’Œå½“å‰ Isolate<strong>å…±äº«åŒä¸€ä»½ä»£ç </strong>çš„ Isolateï¼Œå¹¶æ‰§è¡Œ entryPoint æ–¹æ³•ï¼Œä¸€èˆ¬åœ¨ message ä¸­ä¼ å…¥ SendPort ä»¥ä¾¿ä» entryPoint ä¸­å‘æ¥æ—¶çš„ Isolate å‘é€æ¶ˆæ¯ï¼Œæ–°å»ºçš„ Isolate å’Œå½“å‰ Isolate åœ¨åŒä¸€ä¸ª IsolateGroup ä¸­ã€‚</li>
</ul>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><code>Isolate.spawnUriï¼ˆUri uri,List&lt;String&gt; args,var message,...ï¼‰</code>* æŒ‡å®šçš„<code>uri</code>ä¸­åˆ›å»ºå¹¶å­µåŒ–ä¸€ä¸ª isolateï¼Œæ‰§è¡Œ uri å¯¹åº”çš„ library ä¸­çš„<code>main</code>æ–¹æ³•ï¼ˆ0~2 ä¸ªå…¥å‚ï¼‰ï¼Œå¹¶ä¼ å…¥æ— å‚ã€args æˆ– message ä½œä¸ºå‚æ•°</li>
</ul>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ä½¿ç”¨æ–¹æ³•</h3>
<h4> <strong>pause</strong></h4>
<p><code>Capability pause([Capability? resumeCapability])</code>ï¼Œæš‚åœ Isolateï¼Œåœæ­¢ä»*<code>event loop queue</code>* ä¸­å–ï¼ˆå¹¶å¤„ç†ï¼‰æ¶ˆæ¯ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥å¾€é‡Œé¢åŠ å…¥æ¶ˆæ¯</p>
<p><em><code>resumeCapability</code></em> æ˜¯ç”¨æ¥åŒºåˆ† pause çš„ï¼Œå¿…é¡»ä½¿ç”¨åŒä¸€ä¸ª*<code>resumeCapability</code>*æ¥ resume isolateã€‚</p>
<ul>
<li>ä½¿ç”¨åŒä¸€ä¸ª*<code>resumeCapability</code>*å¤šæ¬¡<code>pause</code>ï¼Œåªéœ€ä¸€æ¬¡<code>resume</code>å°±å¯ä»¥æ¢å¤<code>isolate</code></li>
<li>ä½¿ç”¨ä¸åŒ*<code>resumeCapability</code><em>å¤šæ¬¡<code>pause</code>ï¼Œå¿…é¡»ä½¿ç”¨å¯¹åº”çš„</em><code>resumeCapability</code><em>ä¾æ¬¡<code>resume</code>æ‰å¯ä»¥æ¢å¤<code>isolate</code> ï¼ˆ<strong>æ³¨æ„</strong>ï¼šè¿™é‡Œä¹Ÿåªéœ€è¦ä½¿ç”¨å½“æ—¶ pause isolate çš„</em><code>resumeCapability</code>* ä¾æ¬¡è°ƒç”¨ resume å³å¯ï¼Œè€Œä¸ç”¨ä¿æŒæ¬¡æ•°ä¸€è‡´ï¼Œæ¯”å¦‚ï¼Œæœ‰ 2 ä¸ª*<code>resumeCapability</code> ï¼Œ*è°ƒç”¨ pause æ¬¡æ•°åˆ†åˆ«ä¸º a 1,b 2ï¼Œé‚£ä¹ˆè¦æƒ³ resume isolateï¼Œä¹Ÿåªéœ€è¦åˆ†åˆ«ä½¿ç”¨ a,b è°ƒç”¨ä¸€æ¬¡ resume å³å¯ï¼‰</li>
</ul>
<h4> ping</h4>
<p>ä½¿ç”¨ isolate å¾€<code>receivePort.sendPort</code>å‘é€ response æ¶ˆæ¯ï¼Œ<strong>å³ä½¿ isolate å½“å‰è¢« pause ä¹Ÿå¯ä»¥æ­£å¸¸å‘é€</strong></p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ping å¯ä»¥æ­£å¸¸å‘é€çš„åŸå› æ˜¯ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ MessageHandler ä¸­æœ‰ä¸¤ç§ MessageQueueï¼š<code>oob_queue_</code>å’Œ<code>queue_</code> ï¼Œå‰è€…ä¼˜å…ˆçº§é«˜ï¼Œå³ä½¿ isolate è¢« pause ä¹Ÿä¼šæ‰§è¡Œ</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åƒæ˜¯<code>ping</code>/<code>kill</code>/<code>pause</code>/<code>addOnExitListener</code>/<code>removeOnExitListener</code>è¿™äº›æŒ‡ä»¤æ¶ˆæ¯éƒ½æ˜¯å‹å…¥åˆ°<code>obb_queue_</code>ä¸­ä¼˜å…ˆå¤„ç†çš„ã€‚</p>
<h2> æºç åˆ†æ</h2>
<p>å…ˆçœ‹ä¸€ä¸‹å¸¸ç”¨çš„å‡ ä¸ªæ–¹æ³•æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>
<h3> è·å–å½“å‰ Isolate</h3>
<p>ï¼ˆ<em>sdk/lib/isolate/isolate.dart</em>ï¼‰<code>Isolate.current</code> â†’</p>
<p>(<em>sdk/lib/_internal/vm/lib/isolate_patch.dart</em>) <code>Isolate get current</code> â†’ <code>Isolate._getCurrentIsolate()</code> â†’ <code>_getPortAndCapabilitiesOfCurrentIsolate()</code></p>
<p>ï¼ˆ<em>runtime/lib/isolate.cc</em>ï¼‰<code>DEFINE_NATIVE_ENTRY(Isolate_getPortAndCapabilitiesOfCurrentIsolate, 0, 0)</code></p>
<p>å…ˆçœ‹ä¸€ä¸‹<em>sdk/lib/_internal/vm/lib/isolate_patch.dart</em>ä¸­çš„å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€åæ˜¯æ ¹æ® native ç«¯è¿”å›çš„ä¿¡æ¯ï¼Œæ–°å»ºäº†ä¸€ä¸ª Isolate å¼•ç”¨ï¼Œä½†æ˜¯å› ä¸º<code>_currentIsolate</code>æ˜¯<code>static final</code>çš„ï¼Œæ‰€ä»¥åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œç¡®ä¿äº†åœ¨ Dart SDK ä¸­è°ƒç”¨<code>Isolate.current</code> æ—¶è·å–çš„æ˜¯å½“å‰å”¯ä¸€çš„ Isolateã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨ native ä¸­æ˜¯å¦‚ä½•æ‰¾åˆ°å½“å‰çš„ Isolate çš„ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§æ˜¯ç›´æ¥å–çš„<strong>å½“å‰çº¿ç¨‹å¯¹åº”çš„ isolate</strong>å¯¹åº”çš„å€¼ï¼Œç»è¿‡åŒ…è£…å†è¿”å›åˆ°è°ƒç”¨æ–¹ã€‚</p>
<h3> åˆ›å»º Isolate</h3>
<p>åœ¨ Dart ä¸­åˆ›å»º Isolate æœ‰ 3 ç§æ–¹å¼ï¼š</p>
<ul>
<li><code>Isolate(this.controlPort, {this.pauseCapability, this.terminateCapability});</code> <strong>*create</strong> an* <em>isolateï¼Œæœ¬è´¨ä¸Šåªæ˜¯å°†</em><code>controlPort</code> ç­‰è®¾ç½®ä¸ºä¼ å…¥çš„å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰åœ¨ native å±‚æ–°å»º Isolate</li>
<li><code>Isolate.spawn</code> <strong>create</strong> and <strong>spawns</strong> an <em>isolate</em></li>
<li><code>Isolate.spawnUri</code> <strong>create</strong> and <strong>spawns</strong> an <em>isolate</em></li>
</ul>
<figure><img src="https://jixiaoyong.github.io/images/Isolate_spawn_spawnuri.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>è¿™é‡Œåˆ†æä¸€ä¸‹åé¢ä¸¤ç§æ–¹å¼ï¼Œå¯¹æ¯”ä¸€ä¸‹å·®å¼‚ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äº APP ç­‰æ¥è¯´ï¼Œä¸Šè¿°<code>Isolate.spawn</code>å’Œ<code>Isolate.spawnUri</code>çš„å®ç°éƒ½åœ¨<code>vm</code>ä¸‹é¢çš„<code>isolate_patch.dart</code>ä¸­ï¼ˆjs ä¼šè¿”å›<code>_unsupported()</code>ï¼‰ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶å®ï¼Œæ ¹æ®ä¸Šè¿°çš„ä»£ç ï¼Œä¸ç®¡æ˜¯<code>Isolate.spawnUri()</code> è¿˜æ˜¯<code>Isolate.spawn</code>ï¼Œéƒ½æ˜¯å…ˆè°ƒç”¨<code>RawReceivePort</code>è·å–<code>RawReceivePort readyPort</code>ï¼Œæœ€åéƒ½æ˜¯è°ƒç”¨äº†<code>_spawnCommon(readyPort)</code> æ–¹æ³•ï¼Œæœ€ç»ˆé€šè¿‡<code>new Isolate(controlPort, pauseCapability: capabilities[0], terminateCapability: capabilities[1])</code>æ–¹æ³•åˆ›å»ºäº†æ–°çš„<code>Isolate</code> ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•çš„å®šä¹‰åœ¨<code>sdk/lib/isolate/isolate.dart</code>ä¸­ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Dart ä¸­ï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„ Isolate ä¸»è¦æ˜¯<strong>æŒæœ‰ä¸€ä¸ªå’Œ native ä¸­å¯¹åº” SendPort</strong>ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼š</p>
<ul>
<li><code>Isolate.spawn</code>æœ€åè°ƒç”¨äº†<code>_spawnFunction</code>æ–¹æ³•ï¼ˆnative å±‚å®ç°ä¸º<code>Isolate_spawnFunction</code>ï¼‰ï¼›</li>
<li><code>Isolate.spawnUri</code>æœ€åè°ƒç”¨äº†<code>_spawnUri</code>æ–¹æ³•ï¼ˆnative å±‚å®ç°ä¸º<code>Isolate_spawnUri</code>ï¼‰ã€‚</li>
</ul>
<blockquote>
<p>ğŸ’¡ <code>new RawReceivePort()</code>æ–¹æ³•ä¸»è¦æ˜¯åˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨äº<code>_RawReceivePortImpl</code>çš„<code>static final _portMap = &lt;int, Map&lt;String, dynamic&gt;&gt;{};</code> ä¸­çš„ SendPortï¼ˆå…·ä½“å®ç°åœ¨<code>PortMap::CreatePort</code>ä¸­ï¼‰ã€‚</p>
</blockquote>
<h4> Isolate_spawnFunction</h4>
<p><code>Isolate.spawn</code>æœ€åè°ƒç”¨äº†<code>_spawnFunction</code>æ–¹æ³•ï¼Œæ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„<code>Isolate_spawnFunction</code> çš„å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ï¼Œ<code>Isolate_spawnFunction</code>æ–¹æ³•ä¸­ä¸»è¦è¿˜æ˜¯è§£ææ”¶åˆ°çš„å„ç§å‚æ•°ï¼Œæœ€ååœ¨å½“å‰ isolate å¯¹åº”çš„ IsolateGroup çš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œ<code>SpawnIsolateTask</code>ï¼š</p>
<h5> SpawnIsolateTask</h5>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5> RunLightWeight</h5>
<p>å› ä¸ºè¿™é‡Œæˆ‘ä»¬çš„<code>isolateâ†’group</code>ä¸ä¸ºç©ºï¼Œæ‰€ä»¥èµ°çš„æ˜¯<code>RunLightWeight</code>:</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä¸»è¦è¿›è¡Œäº† 2 æ­¥ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>CreateWithinExistingIsolateGroup</code>åˆ›å»º Isolate</li>
<li>ä½¿ç”¨å…¨å±€çš„<code>initialize_callback</code> ï¼ˆä¹Ÿå°±æ˜¯<code>Isolate::InitializeCallback()</code>ï¼‰åˆå§‹åŒ– Isolate</li>
</ul>
<h6> Isolate::InitializeCallback()</h6>
<p>è¿™å…¶ä¸­çš„<code>Isolate::InitializeCallback()</code>æ˜¯åœ¨<code>Dart::Init</code>çš„æ—¶å€™å°±å·²ç»è®¾ç½®äº†çš„ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šæ–‡çš„<code>Isolate::InitializeCallback()</code>å®é™…ä¸Šå°±æ˜¯<code>OnIsolateInitialize</code>ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯åœ¨ isolate åˆ›å»ºå¥½ä¹‹åè¿›è¡Œç»Ÿä¸€çš„åˆå§‹åŒ–æ“ä½œï¼Œç»‘å®šä¸€äº›æ•°æ®ï¼š</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6> CreateWithinExistingIsolateGroup</h6>
<p><code>CreateWithinExistingIsolateGroup</code> â†’ <code>CreateIsolate</code></p>
<p>å†çœ‹ä¸€ä¸‹åˆ›å»º Isolate çš„å…·ä½“æ–¹æ³•ï¼Œè¿™ä¸ªåœ¨ä¸åŒçš„ device ä¸Šé¢ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬åªå…³æ³¨ vm ä¸‹é¢çš„å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä¸»è¦æœ‰ä¸¤æ­¥ï¼š</p>
<ul>
<li><code>Dart::CreateIsolate</code>åˆ›å»ºäº†<code>Isolate* I</code>ï¼›</li>
<li>ç„¶åè°ƒç”¨<code>Dart::InitializeIsolate</code>åˆå§‹åŒ– isolateã€‚</li>
</ul>
<p><strong>Dart::CreateIsolateï¼š</strong></p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>ğŸ’¡ åœ¨ Dart è™šæ‹Ÿæœºå¯åŠ¨ï¼ˆ<code>Dart::DartInit</code>ï¼‰çš„æ—¶å€™ï¼Œä¹Ÿä¼šè°ƒç”¨<code>Dart::InitIsolate</code>åˆ›å»ºè™šæ‹Ÿæœºå¯¹åº”çš„ Isolateï¼Œæ‰§è¡Œ UI æ“ä½œï¼š<br>
<code>vm_isolate_ = Isolate::InitIsolate(kVmIsolateName, group, api_flags, is_vm_isolate);</code></p>
</blockquote>
<p>åœ¨<code>Isolate::InitIsolate</code>æ–¹æ³•ä¸­ï¼Œå…ˆæ˜¯ç”¨<code>isolate_group</code>åˆ›å»ºäº†æ–°çš„ Isolateï¼Œç„¶åå°†å…¶ä¸<code>Thread</code>ï¼Œ<code>MessageHandler</code>ï¼Œ<code>SendPort</code>ç­‰ç»‘å®šï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Dart::InitializeIsolate</strong></p>
<p>è¿™é‡Œä¸»è¦æ˜¯å¯¹ isolate è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶åœ¨åˆå§‹åŒ–å®Œæˆåé€šçŸ¥åˆ›å»ºè¿™ä¸ª isolate çš„ isolateã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ˜¯è°ƒç”¨<code>Isolate.spawn()</code>çš„è¯ï¼Œå…ˆä»å½“å‰ isolate è·å–å¯¹åº”çš„ Isolate Groupï¼Œç„¶åä½¿ç”¨è¿™ä¸ª Isolate Group åˆ›å»ºé…ç½®ä¸€ä¸ªæ–°çš„ isolateï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ª isolate group ä¸­çš„ Isolate å¯ä»¥å…±äº«å¸¸é‡ï¼Œheap ç­‰ã€‚</p>
<h4> Isolate_spawnUri</h4>
<p>å¦‚æœæ˜¯ä½¿ç”¨<code>Isolate.spawnUri()</code>çš„è¯ï¼Œå°±ä¼šé€šè¿‡<code>Isolate_spawnUri</code>æ¥åˆ›å»º isolateã€‚</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°<code>Isolate_spawnUri</code>è¿˜æ˜¯æ‰§è¡Œäº†<code>SpawnIsolateTask</code> ã€‚</p>
<h5> SpawnIsolateTask</h5>
<p>åœ¨<code>SpawnIsolateTask.Run</code>æ–¹æ³•ä¸­ï¼Œå› ä¸º<code>spawnUri</code>ä¸­<code>IsolateSpawnState</code>çš„<code>IsolateGroup</code>ä¸º<code>nulltrp</code>ï¼Œæ‰€ä»¥è¿™é‡Œæ‰§è¡Œçš„æ˜¯<code>RunHeavyweight(name)</code>ï¼š</p>
<h5> RunHeavyweight</h5>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸»è¦åˆ›å»º Isolate çš„è¿‡ç¨‹åœ¨<code>Isolate::CreateGroupCallback();</code>ä¸­ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»–æ˜¯æ€ä¹ˆæ¥çš„ï¼š</p>
<h5> Isolate::CreateGroupCallback()</h5>
<p>ä»–å’Œä¸Šè¿°<code>Isolate::InitializeCallback_</code>çš„æ¥æºä¸€è‡´ï¼Œéƒ½æ˜¯åœ¨<code>Dart_Initialize</code>ä¸­é…ç½®çš„ï¼Œæ­¤å¤–ï¼Œè¿˜ä½¿ç”¨äº†<code>parent_isolate_-&gt;init_callback_data()</code>ã€‚</p>
<p>å…ˆçœ‹ä¸€ä¸‹çš„<code>CreateIsolateGroupAndSetup</code>å®ç°ï¼š</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œåˆ›å»º Isolate çš„æ—¶å€™ï¼ŒåŒºåˆ†äº†å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li>å¦‚æœæ˜¯ kernel-serviceï¼ˆ<code>DART_KERNEL_ISOLATE_NAME</code>ï¼‰å°±æ‰§è¡Œ<code>CreateAndSetupKernelIsolate</code></li>
<li>å¦‚æœæ˜¯ dartdevï¼ˆ<code>DART_DEV_ISOLATE_NAME</code>ï¼‰å°±æ‰§è¡Œ<code>CreateAndSetupDartDevIsolate</code></li>
<li>å¦‚æœæ˜¯ vm-serviceï¼ˆ<code>DART_VM_SERVICE_ISOLATE_NAME</code>ï¼‰å°±æ‰§è¡Œ<code>CreateAndSetupServiceIsolate</code></li>
<li>å¦‚æœä»¥ä¸Šéƒ½ä¸æ»¡è¶³ï¼Œå°±æ‰§è¡Œ<code>CreateIsolateGroupAndSetupHelper</code></li>
</ul>
<p>æ˜¾ç„¶ï¼Œå½“æˆ‘ä»¬åœ¨ Dart ä»£ç ä¸­è°ƒç”¨<code>Isolate.spawnUri</code>çš„æ—¶å€™ï¼Œè¿™é‡Œä¼šæ‰§è¡Œçš„æ˜¯<code>CreateIsolateGroupAndSetupHelper</code>ï¼š</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œ<code>CreateIsolateGroupAndSetupHelper</code>æŒ‰ç…§æ˜¯ JIT è¿˜æ˜¯ AOT çš„ç¼–è¯‘æ–¹å¼ï¼Œæœ‰ä¸åŒçš„è·å–æ•°æ®çš„æ–¹å¼ï¼Œä½†ä¸ç®¡å“ªç§æ–¹å¼ï¼Œæœ€åéƒ½æ‰§è¡Œäº†ä¸€ä¸‹ä¸‰æ­¥ï¼š</p>
<ul>
<li>åˆ›å»º<code>IsolateData* isolate_data</code> ä½¿ç”¨<code>isolate_group_data</code>åˆ›å»º IsolateData</li>
<li>åˆ›å»º<code>Dart_Isolate isolate</code> åˆ›å»º<code>Dart_Isolate</code>ï¼Œå°†<code>script_uri</code>ï¼Œ<code>isolate_data</code>ï¼Œå’Œ<code>isolate_group_data</code>ç­‰ç»‘å®š</li>
<li>åˆ›å»ºå¹¶è¿”å›<code>Dart_Isolate created_isolate</code>åŒ…è£…<code>isolate</code> ï¼Œè¿›è¡Œæ•°æ®ç»‘å®šï¼Œå¹¶å°† isolate æ ‡è®°ä¸º<code>runnable</code></li>
</ul>
<h6> Dart_CreateIsolateGroup</h6>
<p>è¿™é‡Œåˆ†æä¸€ä¸‹**<code>Dart_CreateIsolateGroup</code>çš„è¿‡ç¨‹ï¼š**</p>
<div class="language-dart line-numbers-mode" data-ext="dart"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> Run(Isolate* child)</h4>
<p>åœ¨ä¸Šé¢çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ— è®ºæ˜¯<code>RunHeavyweight(const char* name)</code>è¿˜æ˜¯<code>RunLightweight(const char* name)</code>æ–¹æ³•ï¼Œæœ€ååœ¨åˆ›å»ºäº†æ–°çš„ isolate ä¹‹åï¼Œéƒ½æ‰§è¡Œäº†<code>Run(Isolate* child)</code>æ–¹æ³•ï¼Œåœ¨è¿™é‡Œæ­£å¼å¯åŠ¨äº† isolateï¼š</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œåªæ˜¯åšäº†ä¸€äº›ç¯å¢ƒå‡†å¤‡ï¼Œç„¶ååœ¨<code>EnqueueEntrypointInvocationAndNotifySpawner</code>æ–¹æ³•ä¸­å°† isolate è¦è¿è¡Œçš„æ‰€æœ‰ä¸œè¥¿éƒ½å‡†å¤‡å¥½ï¼Œç„¶åå†åœ¨<code>Dart_RunLoopAsync</code>æ–¹æ³•ä¸­æ­£å¼å¼€å§‹ isolate å¤„ç† event queue.</p>
<p><strong>EnqueueEntrypointInvocationAndNotifySpawner</strong></p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œä¸»è¦åšäº† 3 ä»¶äº‹ï¼š</p>
<ul>
<li>æŸ¥æ‰¾ isolate å¼€å§‹è¿è¡Œçš„ç¬¬ä¸€ä¸ªæ–¹æ³•<code>entrypoint</code>ï¼Œæ¯”å¦‚<code>Isolate.spawn</code>çš„<code>entrypoint</code>æˆ–è€…<code>Isolate.spawnUri</code>çš„<code>main</code>æ–¹æ³•</li>
<li>è§£æå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ isolate åˆå§‹è¿è¡Œæ–¹æ³•ï¼Œå‚æ•°<code>args</code>ã€<code>messgae</code>ã€æ˜¯å¦<code>spawn_uri</code>ç­‰ç­‰ï¼Œå°†å…¶ä¸ä¸Šä¸€æ­¥æ‰¾åˆ°çš„<code>entrypoint</code>ç»“åˆ</li>
<li>ï¼ˆå¦‚æœéœ€è¦çš„è¯æš‚åœåˆ›å»ºå¥½çš„ isolateï¼‰ï¼Œå¹¶é€šçŸ¥ isolate çš„çˆ¶ isolate å½“å‰ isolate åˆ›å»ºæˆåŠŸï¼ˆé™„å¸¦å½“å‰ isolate çš„<code>send_port</code>ï¼‰</li>
</ul>
<p>è‡³æ­¤ï¼ŒIsolate çš„åˆ›å»ºå·¥ä½œå·²ç»å®Œæˆï¼Œåœ¨<code>Dart_RunLoopAsync</code>å¼€å§‹ isolate å¤„ç†æ¶ˆæ¯ï¼š</p>
<p><strong>Dart_RunLoopAsync</strong></p>
<p>åœ¨è¿™é‡Œä¸»è¦æ˜¯å¼€å§‹å¤„ç† event loopã€‚</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Isolate::Run()</code>å®é™…ä¸Šæ˜¯å¼€å¯äº†å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œé€šè¿‡<code>ThreadPool::ScheduleTaskLocked</code>æ–¹æ³•è·å–<code>new_worker</code>ï¼š</p>
<ul>
<li>å¦‚æœå·²æœ‰çš„ worker æœ‰ç©ºé—²çš„æˆ–è€…å·²ç»è¾¾åˆ°æœ€å¤§æ•°ç›®äº†ï¼Œå°±ç­‰å¾…å·²æœ‰çš„ worker æ‰§è¡Œä»»åŠ¡</li>
<li>å¦åˆ™å°±åˆ›å»ºæ–°çš„ workerï¼Œå¹¶åœ¨æ–°çš„çº¿ç¨‹è¿è¡Œ</li>
</ul>
<p>åœ¨è·å–åˆ° worker ä¹‹åï¼Œå°±æ‰§è¡Œ<code>MessageHandlerTask</code>ï¼ˆè§ä¸‹æ–‡è¯¦ç»†åˆ†æï¼‰ã€‚</p>
<p>æˆ‘ä»¬ä¸»è¦å…³æ³¨ 3 ç‚¹ï¼š</p>
<ul>
<li><code>ScheduleTaskLocked</code> åˆ†é… Worker</li>
<li><code>OSThread::Start</code>ä¸­ä½¿ç”¨<code>&amp;Worker::Main</code> åœ¨æ–°ç³»ç»Ÿçº¿ç¨‹å¼€å¯ Worker å¾ªç¯</li>
<li><code>MessageHandlerTask</code> æ‰§è¡Œå…·ä½“çš„æ¶ˆæ¯åˆ†å‘å†…å®¹</li>
</ul>
<h5> <strong>ScheduleTaskLocked</strong></h5>
<p>å…ˆè¯¦ç»†çœ‹ä¸€ä¸‹è·å–<code>new_worker</code>çš„<code>ThreadPool::ScheduleTaskLocked</code>æ–¹æ³•ï¼š</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼š</p>
<p>å°†å½“å‰ä»»åŠ¡åŠ å…¥åˆ°<code>tasks_</code>é˜Ÿåˆ—ä¸­ã€‚</p>
<ul>
<li>å¦‚æœç©ºé—²<code>count_idle_</code> çš„ Worker æ¯”ç­‰å¾…ä¸­çš„ä»»åŠ¡æ•°<code>pending_tasks_</code>å¤šï¼Œé‚£å°±å‘é€é€šçŸ¥ï¼Œä½¿ç”¨å·²æœ‰çš„ Worker å¤„ç†ä»»åŠ¡ã€‚</li>
<li>å¦‚æœå½“å‰ Worker æ•°é‡å·²ç»æœ€å¤§äº†ï¼Œé‚£å°±å°†ç­‰å¾…ä¸­çš„ä»»åŠ¡æ•° pending<em>tasks</em> åŠ ä¸€ï¼Œç­‰å¾…æœ‰ç©ºé—²çš„ Worker å¤„ç†ä»»åŠ¡ã€‚</li>
<li>å¦åˆ™ï¼Œå°±æ–°å»ºä¸€ä¸ª Workerï¼ˆä¼šå¯¹åº”åˆ›å»ºä¸€ä¸ªæ–°çš„ç³»ç»Ÿçº¿ç¨‹ï¼‰æ¥å¤„ç†ä»»åŠ¡ã€‚</li>
</ul>
<h5> &amp;<strong>Worker::Main</strong></h5>
<p>åœ¨<code>ThreadPool::RunImpl(std::unique_ptr&lt;Task&gt; task)</code>è¿™é‡Œï¼ŒStartThread çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œ**<code>&amp;Worker::Main</code>**å¯åŠ¨äº†ä¸€ä¸ªå¾ªç¯ï¼Œä¸æ–­çš„åœ¨ä»»åŠ¡é˜Ÿåˆ—<code>tasks_</code>ä¸­å–å‡ºæ¶ˆæ¯å¹¶æ‰§è¡Œï¼š</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>MessageHandlerTask</strong></p>
<p>æ— è®ºæ˜¯å“ªç§ Workerï¼Œæœ€åéƒ½æ˜¯æ‰§è¡Œçš„<code>MessageHandlerTask</code>ï¼š</p>
<div class="language-cpp line-numbers-mode" data-ext="cpp"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ‰§è¡Œäº†<code>MessageHandler::HandleMessages</code>æ–¹æ³•ï¼Œæ¥å¤„ç†æ¶ˆæ¯ï¼š</p>
<div class="language-jsx line-numbers-mode" data-ext="jsx"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>MessageHandler::DequeueMessage</code>åˆ™æ˜¯æŒ‰ç…§ä¼˜å…ˆçº§ï¼Œä¾æ¬¡ä»<code>oob_queue_</code>å’Œ<code>queue_</code>ä¸­è·å–æ¶ˆæ¯ï¼š</p>
<div class="language-jsx line-numbers-mode" data-ext="jsx"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³äº<code>oob_queue_</code>å’Œ<code>queue_</code> çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<div class="language-jsx line-numbers-mode" data-ext="jsx"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæ¶ˆæ¯å¤„ç†çš„æ­¥éª¤ä¹Ÿå¯åŠ¨äº†ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>Dart_RunLoopAsync</code>çš„ä¸»è¦åŠŸèƒ½æ˜¯è§¦å‘ isolate çš„<code>message_handler</code>å¤„ç†æ¶ˆæ¯åˆ†å‘ï¼š</p>
<p><code>Dart_RunLoopAsync</code> â†’ <code>Isolate::Run()</code> â†’ <code>message_handler()-&gt;Run()</code> â†’ <strong>pool_-&gt;</strong><code>Run&lt;MessageHandlerTask&gt;</code> <strong>â†’</strong> <code>ThreadPool::RunImpl</code></p>
<p>åœ¨<code>ThreadPool::RunImpl(std::unique_ptr&lt;Task&gt; task)</code>è¿™é‡Œä¸»è¦è§¦å‘äº† 2 æ­¥ï¼š</p>
<ul>
<li><code>ScheduleTaskLocked</code>è·å–åˆ°<code>new_worker</code></li>
<li><code>new_worker</code>è°ƒç”¨<code>ThreadPool::Worker::StartThread()</code>æ–¹æ³•å¼€å¯å¾ªç¯</li>
</ul>
<p>ç„¶åæ ¹æ®æ˜¯å¦åˆ›å»ºäº†<code>new_worker</code>æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>æœ‰<code>new_worker</code>ï¼Œä½¿ç”¨åœ¨<code>OSThread::Start</code>æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç³»ç»Ÿçº¿ç¨‹ï¼Œæ‰§è¡Œ<code>ThreadPool::Worker::Main</code>ï¼ˆè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨ä½¿ç”¨<code>new_worker</code>ä»çº¿ç¨‹æ± ä¸­çš„å–å‡ºä»»åŠ¡æ‰§è¡Œï¼‰</li>
<li>æ²¡æœ‰<code>new_worker</code>ï¼Œé‚£ä¹ˆç­‰å¾…å·²æœ‰çš„ Worker ç©ºé—²æ—¶æ‰§è¡Œä»»åŠ¡</li>
</ul>
<p>æ— è®ºå¦‚ä½•ï¼Œè¿™é‡Œçš„ Worker è¦æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ˜¯åœ¨<code>MessageHandler::Run</code>æ–¹æ³•ä¸­æŒ‡å®šçš„<code>MessageHandlerTask</code> ï¼Œè€Œè¿™ä¸ªä»»åŠ¡çš„å†…å®¹ä¾¿æ˜¯å¼€å¯<code>MessageHandler::HandleMessages</code> æ–¹æ³•ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ä¸æ–­çš„ä¾æ¬¡ä»<code>oob_queue_</code>å’Œ<code>queue_</code>ä¸­è·å–æ¶ˆæ¯å¹¶å¤„ç†ã€‚</p>
<h2> æ€»ç»“</h2>
<figure><img src="https://jixiaoyong.github.io/images/Isolate_spawn_spawnuri_dart_and_native.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Isolate æ˜¯ Dart ä»£ç è¿è¡Œçš„åœ°æ–¹ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„ event loopï¼Œå’Œå…¨å±€å˜é‡ï¼Œåœ¨è‡ªå·±å•ç‹¬çš„çº¿ç¨‹è¿è¡Œã€‚</p>
<p>Isolate.spawn é»˜è®¤ä¼šåˆ›å»ºåœ¨åŒä¸€ä¸ª IsolateGroup ä¸­çš„ Isolateï¼Œä»–ä»¬ä¹‹é—´å…±äº« Heapï¼ˆè¿™é‡Œä¼šå‘ç”Ÿ GCï¼‰å’Œä¸€ä¸ªçº¿ç¨‹æ± ã€‚</p>
<p>Isolate.spawnUri ä¼šä»åˆ¶å®šçš„ Uri ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ IsolateGroup å’Œå¯¹åº”çš„ Isolateï¼Œå¹¶æ‰§è¡Œ Uri ä¸­çš„ main æ–¹æ³•ã€‚</p>
<p>Isolate å†…éƒ¨ç»´æŒä¸€ä¸ª Event Loopã€‚</p>
]]></content:encoded>
      <enclosure url="https://www.youtube.com/watch?v=NoVYI94MJio&amp;ab_channel=Flutterly" type="image/"/>
    </item>
    <item>
      <title>Dart VM</title>
      <link>https://jixiaoyong.github.io/blog/posts/550e5790.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/550e5790.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Dart VM</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 02 Jun 2022 07:18:57 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡æ˜¯å¯¹ Dart å®˜æ–¹ VM çš„ä»‹ç»çš„æ€»ç»“æ‘˜è¦ï¼Œæ¨èç›´æ¥é˜…è¯»<a href="https://github.com/dart-lang/sdk/blob/main/runtime/docs/index.md" target="_blank" rel="noopener noreferrer">å®˜æ–¹åŸæ–‡</a>ã€‚</p>
</blockquote>
<p>Dart VM is a collection of components for executing Dart code natively. Notably, it includes the following:</p>
<ul>
<li><strong>Runtime System</strong>
<ul>
<li>Object Model</li>
<li>Garbage Collection</li>
<li>Snapshots</li>
</ul>
</li>
<li><strong>Core librariesâ€™ native methods</strong></li>
<li><strong>Development Experience components</strong> accessible via&nbsp;<em>service protocol</em>&nbsp;* Debugging * Profiling * Hot-reload</li>
<li><strong>Just-in-Time (JIT) and Ahead-of-Time (AOT) compilation pipelines</strong></li>
<li><strong>Interpreter</strong></li>
<li><strong>ARM simulators</strong></li>
</ul>
<p>ä¸‹å›¾æ˜¯ runtime æ‰§è¡Œä»£ç çš„ç¤ºæ„å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/isolates.png" alt="isolate" tabindex="0" loading="lazy"><figcaption>isolate</figcaption></figure>
<p>isolate ä¸­æœ‰ä¸¤ç§ Threadï¼š</p>
<ul>
<li>ä¸€ä¸ª mutator thread ç”¨æ¥æ‰§è¡Œ dart ä»£ç </li>
<li>å¤šä¸ª helper thread ç”¨æ¥æ‰§è¡Œ GCã€JIT ç­‰</li>
</ul>
<p>æ­¤å¤–ï¼Œä¸€ä¸ª isolate æœ‰ä¸€ä¸ª heapï¼Œç”¨æ¥å­˜å‚¨æ‰€æœ‰çš„ dart objectï¼ˆGC å‘ç”Ÿåœ¨è¿™é‡Œï¼‰ã€‚</p>
<p>ä¸€ä¸ª OSThread ä¸€æ¬¡åªèƒ½è¿›å…¥ä¸€ä¸ª isolateï¼Œå½“å…¶è¿›å…¥ä¹‹åï¼Œè¯¥ isolate çš„ mutator thread ä¾¿å’Œè¿™ä¸ª OSThread å…³è”èµ·æ¥æ‰§è¡Œ dart ä»£ç ã€‚å½“ OSThread è¦è¿›å…¥ä¸€ä¸ª isolate çš„æ—¶å€™ï¼Œå¿…é¡»å…ˆé€€å‡ºå½“å‰å…³è”çš„ isolateã€‚</p>
<p>isolate çš„ mutator thread å¯èƒ½åœ¨ä¸åŒæ—¶é—´å…³è”ä¸åŒçš„ OSThreadï¼Œä½†åŒä¸€æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª OSThreadã€‚</p>
<p>VM æ‰§è¡Œ Dart ä»£ç æœ‰ä¸¤ç§æ–¹å¼ï¼šJIT å’Œ AOTï¼Œä¸ç®¡å“ªä¸€ç§éƒ½ä¸ä¼šç›´æ¥æ‰§è¡Œ Dart æºç ï¼Œè€Œæ˜¯ç»è¿‡è½¬åŒ–ä¹‹åçš„ Kernel Binary(also called&nbsp;<em>dill files</em>)which contain serialized&nbsp;<a href="https://github.com/dart-lang/sdk/blob/main/pkg/kernel/README.md" target="_blank" rel="noopener noreferrer">Kernel ASTs</a>ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä» Dart source code åˆ° Dart VM æ‰§è¡Œåˆ†ä¸ºä¸‹é¢å‡ æ­¥ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/dart-to-kernel.png" alt="dart-to-kernel" tabindex="0" loading="lazy"><figcaption>dart-to-kernel</figcaption></figure>
<blockquote>
<p>VM expects to be given&nbsp;<strong><em>Kernel binaries</em></strong>&nbsp;(also called&nbsp;<em>dill files</em>) which contain serialized&nbsp;<a href="https://github.com/dart-lang/sdk/blob/main/pkg/kernel/README.md" target="_blank" rel="noopener noreferrer">Kernel ASTs</a>. The task of translating <strong>Dart source</strong> into <strong>Kernel AST</strong> is handled by the&nbsp;<a href="https://github.com/dart-lang/sdk/tree/master/pkg/front_end" target="_blank" rel="noopener noreferrer">common front-end (<strong>CFE</strong>)</a> written in Dart and shared between different Dart tools (e.g. VM, dart2js, Dart Dev Compiler).</p>
</blockquote>
<p>Dart VM has multiple ways to execute the code, for example:</p>
<ul>
<li>from source or Kernel binary using <strong>JIT</strong>;</li>
<li>from snapshots:
<ul>
<li>from <strong>AOT</strong> snapshot;</li>
<li>from <strong>AppJIT</strong> snapshot.</li>
</ul>
</li>
</ul>
<h2> 1. Running from source via JIT.</h2>
<h3> ä» Dart Source åŠ è½½åˆ° VM ä¸­</h3>
<p>ä¸ºäº†ä¿è¯ç›´æ¥ä»æºä»£ç æ‰§è¡Œ Dart çš„ä¾¿åˆ©æ€§ï¼Œç‹¬ç«‹çš„ dart å¯æ‰§è¡Œæ–‡ä»¶æ‰¿è½½äº†ä¸€ä¸ªç§°ä¸ºå†…æ ¸æœåŠ¡ï¼ˆ*kernel serviceï¼‰*çš„è¾…åŠ© isolateï¼Œå®ƒå¤„ç† Dart æºä»£ç ç¼–è¯‘æˆå†…æ ¸çš„è¿‡ç¨‹ã€‚ç„¶åï¼ŒVM å°†è¿è¡Œäº§ç”Ÿçš„å†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆKernel Binaryï¼‰ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/kernel-service.png" alt="kernel-service" tabindex="0" loading="lazy"><figcaption>kernel-service</figcaption></figure>
<p>ä¸Šå›¾ä¸­ï¼Œä¸€ä¸ªè¢«ç§°ä¸º<em>kernel service</em>çš„ isolate ä½¿ç”¨ CFE å°† Dart Source ç¼–è¯‘ä¸ºä¸º<em>Kernel Binary</em>ç„¶åäº¤ç»™ main isolate æ‰§è¡Œã€‚</p>
<p>è¿™å¹¶ä¸æ˜¯å®‰æ’ CFE å’Œ VM æ‰§è¡Œ Dart Source çš„å”¯ä¸€æ–¹å¼ï¼Œæ¯”å¦‚ Flutter å°±å°† CFEï¼ˆå°è£…ä¹‹åçš„ï¼‰å’Œ VM åˆ†åˆ«ç½®äºä¸¤ä¸ªè®¾å¤‡ä¸Šï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/flutter-cfe.png" alt="flutter-cfe" tabindex="0" loading="lazy"><figcaption>flutter-cfe</figcaption></figure>
<p>å½“çƒ­æ›´æ–°è§¦å‘æ—¶ï¼ŒFlutter ä½¿ç”¨å°è£…è¿‡çš„ CFE ä»¥åŠä¸€ä¸ª Flutter ç‹¬æœ‰çš„ Kernel-to-Kernel è½¬æ¢ï¼Œå°†ä¿®æ”¹è¿‡çš„ Dart Source ç¼–è¯‘ä¸º Kernel Binaryï¼Œç„¶åæ¨é€åˆ°è®¾å¤‡ä¸Šé¢ï¼ˆæ¯”å¦‚æ‰‹æœºï¼‰æ‰§è¡Œã€‚</p>
<h3> åœ¨ VM ä¸­æ‰§è¡Œ</h3>
<p>ä¸Šé¢æ˜¯ Dart Source åŠ è½½åˆ° VM çš„è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯<strong>Dart ä»£ç åœ¨ VM ä¸­æ‰§è¡Œçš„è¿‡ç¨‹</strong>åˆ†æï¼š</p>
<p>1ï¼‰å½“<em>Kernel Binary</em>åŠ è½½åˆ° VM ä¸­ä¹‹åï¼Œåªä¼šè§£æåŠ è½½çš„ç±»å’Œåº“çš„åŸºæœ¬ä¿¡æ¯ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/kernel-loaded-1.png" alt="kernel-loaded-1" tabindex="0" loading="lazy"><figcaption>kernel-loaded-1</figcaption></figure>
<p>2ï¼‰å½“ runtime å®é™…ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šå»è·å–å®Œæ•´çš„ä¿¡æ¯ç”¨æ¥åˆ›å»ºå¯¹è±¡åˆ†é…å†…å­˜ç­‰ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/kernel-loaded-2.png" alt="kernel-loaded-2" tabindex="0" loading="lazy"><figcaption>kernel-loaded-2</figcaption></figure>
<p>æ­¤æ—¶ï¼Œä»<em>Kernel Binary</em>ä¸­è¯»å–å‡ºäº†<em>class members</em>ï¼Œæ­¤æ—¶å·²ç»æœ‰è¶³å¤Ÿçš„ä¿¡æ¯è®© runtime ç”¨æ¥è°ƒç”¨æ–¹æ³•ï¼ˆsuccessfully resolve and invoke methodsï¼‰äº†ï¼Œæ¯”å¦‚è°ƒç”¨ main æ–¹æ³•ï¼Œä½†æ˜¯<strong>å…·ä½“çš„æ–¹æ³•ä½“æ­¤æ—¶ä¾æ—§è¿˜æ²¡æœ‰è¢«ååºåˆ—</strong>ï¼ˆdeserializedï¼‰ã€‚</p>
<p>3ï¼‰åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ‰€æœ‰çš„ function åªæ˜¯æŒæœ‰äº†ä¸€ä¸ªçœŸæ­£è¦æ‰§è¡Œçš„æ–¹æ³•ä½“çš„<em>placeholder</em>æŒ‡å‘<em>LazyCompileStub</em>ï¼Œå½“ runtime è¦æ‰§è¡Œçš„æ—¶å€™å†åˆ›å»ºå¹¶è¿è¡Œå¯æ‰§è¡Œä»£ç ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/raw-function-lazy-compile.png" alt="raw-function-lazy-compile" tabindex="0" loading="lazy"><figcaption>raw-function-lazy-compile</figcaption></figure>
<p>è¿™æ—¶å€™æ‰§è¡Œæ–¹æ³•æœ‰ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>unoptimized</strong> é»˜è®¤æ‰§è¡Œæ—¶ç›´æ¥ä»<em>Kernel Binary</em>åˆ›å»º<em>IL</em>ç„¶åè½¬åŒ–ä¸º<em>machine code</em>å¹¶è¿è¡Œ</li>
<li><strong>optimized</strong> åœ¨ a é˜¶æ®µçš„çƒ­ç‚¹ä»£ç ä¼šè¢«ä»æ™®é€š<em>IL</em>ä¼˜åŒ–ä¸º<em>SSA IL</em>ï¼Œç„¶åè½¬åŒ–ä¸º<em>machine code</em>è¿è¡Œï¼Œå¦‚æœé‡åˆ°ä¼˜åŒ–å¤±æ•ˆçš„ï¼Œå†å›é€€åˆ° a é˜¶æ®µæ‰§è¡Œä»£ç ï¼ˆåé¢æ˜¯å¦éœ€è¦å†èµ° b é˜¶æ®µï¼Œéœ€è¦é‡æ–°åˆ¤æ–­ï¼‰</li>
</ol>
<h4> unoptimized code</h4>
<p>è¿™ä¸ªé˜¶æ®µï¼Œä»<em>Kernel Binary</em>ç”Ÿæˆ<em>Machine Code</em>ä¸»è¦åˆ†ä¸º 2 æ­¥ï¼š</p>
<p><strong>ï¼ˆ1ï¼‰<em>Kernel Binary</em> â†’ <em>IL</em></strong></p>
<p>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä»<em>Kernel Binary</em>ä¸­çš„<em>AST</em>ä¸­è§£æäº§ç”Ÿå¯¹åº”çš„<em>control flow graph</em>(<strong>CFG</strong>)ã€‚</p>
<blockquote>
<p>CFG ç”±<em>intermediate language</em>(<strong>IL</strong>) ç»„æˆï¼Œè¿™ä¸ªé˜¶æ®µä½¿ç”¨çš„ IL æŒ‡ä»¤ç±»ä¼¼åŸºäº stack çš„è™šæ‹Ÿæœºï¼šä»–ä»¬ä» stack ä¸­è¯»å–æ“ä½œæ•°ï¼Œæ‰§è¡Œæ“ä½œï¼Œç„¶åå°†ç»“æœ push å›è¿™ä¸ª stack ä¸­ã€‚</p>
</blockquote>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/unoptimized-compilation.png" alt="unoptimized-compilation" tabindex="0" loading="lazy"><figcaption>unoptimized-compilation</figcaption></figure>
<p>ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ–¹æ³•éƒ½æœ‰å¯¹åº”çš„<em>Dart/Kernel AST bodies</em>ï¼ˆæ¯”å¦‚ä¸€äº›<em>native</em>æ–¹æ³•æˆ–è€…<em>artificial tear-off functions</em> generated by Dart VMï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä»–ä»¬å‡­ç©ºåˆ›å»ºï¼ˆ<em>in these cases IL is just created from the thin air</em>ï¼‰ã€‚</p>
<p><strong>(2) <em>IL</em> â†’ <em>Machine Code</em></strong></p>
<p>ç”±ä¸€æ¡ IL å¯¹åº”ç”Ÿæˆå¤šè¡Œ machine language instruction</p>
<p>åœ¨è¿™ä¸ªé˜¶æ®µä¸ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œä¸»è¦ç›®çš„æ˜¯å¿«é€Ÿåˆ›å»ºå‡ºå¯æ‰§è¡Œä»£ç ï¼ˆ<em>produce executable code quickly</em>ï¼‰</p>
<p><strong>å†…è”ç¼“å­˜ï¼ˆinline cachingï¼‰</strong></p>
<p>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç¼–è¯‘å™¨ï¼ˆ<em>unoptimizing compiler</em>ï¼‰ä¸ä¼šå°è¯•é™æ€è§£æä»»ä½•æ²¡æœ‰åœ¨ Kernel Binary ä¸­è§£æçš„è°ƒç”¨ï¼ˆ<em>any calls that were not resolved in Kernel binary</em>ï¼‰ï¼Œå› æ­¤è°ƒç”¨ (<code>MethodInvocation</code> or&nbsp;<code>PropertyGet</code> AST nodes) è¢«è®¤ä¸ºæ˜¯å®Œå…¨åŠ¨æ€çš„ï¼ŒVM ä½¿ç”¨å†…è”ç¼“å­˜ï¼ˆinline cachingï¼‰æ¥å®ç°åŠ¨æ€è°ƒç”¨ã€‚</p>
<p>å†…è”ç¼“å­˜çš„å®ç°ä¸»è¦æœ‰ï¼š</p>
<ul>
<li>ä¸€ä¸ª<strong>call site specific cache</strong>ï¼Œå°†è°ƒç”¨çš„ç±»ä¸æ–¹æ³•æ˜ å°„åœ¨ä¸€èµ·ï¼Œå¦‚æœ receiver å’Œå·²æœ‰çš„ç¼“å­˜ç±»å¯¹åº”ï¼Œé‚£ä¹ˆå°±åº”è¯¥è°ƒç”¨å¯¹åº”çš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸ªè®¡æ•°å™¨ï¼ˆ<em>invocation frequency counters</em>ï¼‰æ ‡è®°è¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡ï¼ˆå¯¹åº”ä¸‹æ–‡çš„ RawICDataï¼‰</li>
<li>ä¸€ä¸ªå…±äº«çš„<strong>lookup stub</strong>ï¼Œå®ç°äº†æ–¹æ³•è°ƒç”¨çš„æœ€å¿«è·¯å¾„ï¼ˆ<em>method invocation fast path</em>ï¼‰ï¼Œåœ¨å‘ç”Ÿè°ƒç”¨æ—¶é€šè¿‡ lookup stub æŸ¥è¯¢æ˜¯å¦æœ‰ entry ä¸ receiver çš„ç±»åŒ¹é…ï¼Œæœ‰çš„è¯å°±ç”¨è°ƒç”¨ entry å¹¶å¢åŠ  frequency counterï¼›å¦åˆ™å°±è°ƒç”¨ç³»ç»Ÿçš„ runtime system helper å…œåº•ï¼ˆå¦‚æœæˆåŠŸè¿è¡Œäº†å°±æ›´æ–°ä¸Šé¢çš„ç¼“å­˜ï¼Œè¿™æ ·ä¸‹æ¬¡è°ƒç”¨å°±ä¸ç”¨å†èµ° runtime äº†ï¼‰ã€‚</li>
</ul>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/inline-cache-1.png" alt="inline-cache-1" tabindex="0" loading="lazy"><figcaption>inline-cache-1</figcaption></figure>
<aside>
ğŸ’¡ **Unoptimizing compiler** by itself is enough to execute any possible Dart code.</aside>
<h4> optimized code</h4>
<p>è™½ç„¶<strong>Unoptimizing compiler</strong>å¯ä»¥æ‰§è¡Œä»»æ„ Dart ä»£ç ï¼Œä½†æ˜¯å¤ªæ…¢äº†ï¼Œæ‰€ä»¥åœ¨ä»¥ä¸Šè¿°æ–¹å¼æ‰§è¡Œä»£ç çš„åŒæ—¶ä¼šè®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>Inline cache æ”¶é›†åœ¨è°ƒç”¨ç‚¹çš„<strong>receiver ç±»å‹</strong>ï¼ˆ<em>receiver types observed at callsites</em>ï¼‰</li>
<li>å’Œæ–¹æ³•å¯¹åº”çš„ execution counters ä»¥åŠ basic blocks within functions è¿½è¸ªä»£ç çš„<strong>çƒ­ç‚¹åŒºåŸŸ</strong>ï¼ˆhot regions of the codeï¼‰</li>
</ul>
<p>Optimized compilations å’Œ Unoptimizing compiler å¼€å§‹çš„æ­¥éª¤ç±»ä¼¼ï¼š</p>
<p><strong>(1) <em>Kernel Binary</em> â†’ <em>unoptimized IL</em></strong></p>
<p><strong>(2) <em>unoptimized IL</em> â†’ <em>SSA based IL</em> â†’ <em>optimized IL</em></strong></p>
<p>å½“ä¸Šè¿°ä»£ç æ‰§è¡Œçš„æ—¶å€™ï¼Œå¦‚æœç¨‹åºè°ƒç”¨è®¡æ•°å™¨ï¼ˆ<em>invocation frequency counters</em>ï¼‰åˆ°è¾¾æŸä¸ªé˜ˆå€¼ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¢«äº¤ç»™ä¸€ä¸ªåå°ä¼˜åŒ–ç¼–è¯‘å™¨ï¼ˆ<em>background optimizing compiler</em>ï¼‰æ¥ä¼˜åŒ–ï¼Œå°† unoptimized IL è½¬åŒ–ä¸º*SSAï¼ˆstatic single assignmentï¼‰*å½¢å¼çš„ ILã€‚</p>
<p>æœ€åå°† SSA IL ä¼˜åŒ–ä¸º optimized ILã€‚</p>
<p><strong>(3) <em>optimized IL</em> â†’ <em>machine code</em></strong></p>
<p>åœ¨ä¼˜åŒ–å®Œæˆåï¼Œç¼–è¯‘å™¨ä¼šè¦æ±‚ mutator thread è¿›å…¥ safepoint å¹¶å°†ä¼˜åŒ–åçš„ä»£ç ç»‘å®šåˆ°æ–¹æ³•ä¸Šï¼ˆattaches optimized code to the functionï¼‰ã€‚</p>
<blockquote>
<p>safepoint çš„å«ä¹‰æ˜¯ï¼Œthread å…³è”çš„ stateï¼ˆæ¯”å¦‚ heapï¼Œstack frame ç­‰ï¼‰æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸ä¸­æ–­çº¿ç¨‹çš„æƒ…å†µä¸‹è®¿é—®æˆ–ä¿®æ”¹ã€‚é€šå¸¸æ„å‘³ç€ thread è¢«æš‚åœï¼Œæˆ–è€…åœ¨å½“å‰ç¯å¢ƒå¤–ï¼ˆæ¯”å¦‚æ‰§è¡Œ native ä»£ç ï¼‰ã€‚</p>
</blockquote>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/optimizing-compilation.png" alt="optimizing-compilation" tabindex="0" loading="lazy"><figcaption>optimizing-compilation</figcaption></figure>
<p>ä¸Šè¿°è¿™ç§åŸºäºä¹è§‚å‡è®¾çš„ä¼˜åŒ–ï¼Œå¯èƒ½æ²¡æ³•å¤„ç†éƒ¨åˆ†æƒ…å†µï¼Œä»è€Œå›é€€åˆ°æœªä¼˜åŒ–çš„ä»£ç ï¼ˆdeoptimizationï¼‰ï¼Œç„¶åå†æ‰§è¡Œæœªä¼˜åŒ–è¿‡ç¨‹ï¼ˆé€šå¸¸ä¼šä¸¢å¼ƒä¼˜åŒ–åçš„ä»£ç ï¼Œå†åˆ¤æ–­æ˜¯å¦æœ‰çƒ­ç‚¹ä»£ç éœ€è¦ä¼˜åŒ–ï¼‰ï¼Œä¸»è¦æœ‰ 2 ç§æ–¹å¼ï¼š</p>
<ol>
<li><strong><em>eager deoptimization</em></strong> åœ¨å†…è”æ£€æŸ¥çš„æ—¶å€™ï¼Œåˆ¤æ–­ä¼˜åŒ–çš„æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œä¸æ»¡è¶³çš„è¯å°±ä¸¢å¼ƒä¼˜åŒ–ä»£ç </li>
<li><strong><em>lazy deoptimization</em></strong> å…¨å±€åˆ†ææŒ‡ç¤ºåœ¨æ›´æ”¹ä¼˜åŒ–ä»£ç çš„å†…å®¹æ—¶ä¸¢å¼ƒä¼˜åŒ–ä»£ç ï¼ˆä¹‹å‰ä¼˜åŒ–çš„æ¡ä»¶ä¸æ»¡è¶³äº†ï¼‰ã€‚</li>
</ol>
<h2> 2. Running from <strong>AOT</strong> snapshot</h2>
<p>Snapshot's format is low level and optimized for fast startupï¼ŒåŒ…å«äº†è¦åˆ›å»ºçš„ object ä»¥åŠå¦‚ä½•å…³è”è¿™äº›å¯¹è±¡çš„è¯´æ˜ä¿¡æ¯ï¼ˆinstructionsï¼‰ã€‚</p>
<p>VM å¯ä»¥å°† Heap/ç”šè‡³æ˜¯ Heap ä¸­çš„ object graph åºåˆ—åŒ–æˆä¸º snapshotï¼Œç„¶åå†ä»è¿™ä¸ª snapshot ä¸­é‡å»ºå¯¹åº”çš„çŠ¶æ€ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/snapshot.png" alt="snapshot" tabindex="0" loading="lazy"><figcaption>snapshot</figcaption></figure>
<p>æœ€åˆçš„ snapshot å¹¶ä¸åŒ…å« machine codeï¼Œç›´åˆ° AOT compiler çš„å‡ºç°ã€‚</p>
<p>AOT compiler å’Œ snapshot-with-code ä½¿å¾— VM å¯ä»¥åœ¨é‚£äº› JIT å—é™çš„è®¾å¤‡ä¸Šè¿è¡Œï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/snapshot-with-code.png" alt="snapshot-with-code" tabindex="0" loading="lazy"><figcaption>snapshot-with-code</figcaption></figure>
<p><strong>snapshot-with-code</strong>å’Œæ™®é€šçš„<strong>snapshot</strong>åŸºæœ¬ä¸€è‡´ï¼Œ<strong>å”¯ä¸€ä¸åŒçš„æ˜¯å¤šå‡ºçš„ machine code ä¸éœ€è¦ deserizlization</strong>ï¼Œäº‹å®ä¸Š machine code åœ¨è¢«åˆ†é…åˆ°å†…å­˜åå¯ä»¥ç«‹å³æˆä¸º heap çš„ä¸€éƒ¨åˆ†ï¼ˆ<em>directly become part of the heap after it was mapped into memory</em>ï¼‰ã€‚</p>
<h2> 3. Running from <strong>AppJIT</strong> snapshot</h2>
<p><strong>AppJIT</strong> snapshot ä¸»è¦ç”¨äºå‡å°‘å¤§å‹ Dart application çš„ JIT çƒ­èº«æ—¶é—´ã€‚</p>
<p>AppJIT snapshots were introduced to <strong>reduce JIT warm up time for large Dart applications</strong> like&nbsp;<code>dartanalyzer</code>or&nbsp;<code>dart2js</code>. When these tools are used on small projects they spent as much time doing actual work as VM spends JIT compiling these apps.</p>
<p>ä»–çš„ä¸»è¦å®ç°æ˜¯ï¼šå…ˆç”¨æ¨¡æ‹Ÿæ•°æ®åœ¨ VM ä¸Šè¿è¡Œï¼Œç„¶åå°†å…¶ç”Ÿæˆçš„ code ä»¥åŠ VM å†…éƒ¨çš„æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º AppJIT snapshot åŠ è½½åˆ° VM ä¸­è¿è¡Œï¼Œåªåœ¨æ­£å¼çš„æ•°æ®å’Œæ¨¡æ‹Ÿè®­ç»ƒçš„é…ç½®æ— æ³•åŒ¹é…çš„æ—¶å€™æ‰§è¡Œ JITï¼ˆ<em>execution profile on the real data does not match execution profile observed during training</em>ï¼‰ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/snapshot-appjit.png" alt="snapshot-appjit" tabindex="0" loading="lazy"><figcaption>snapshot-appjit</figcaption></figure>
<h2> 4. Running from <strong>AppAOT</strong> snapshot</h2>
<p>AOT ä¸ JIT å„æœ‰ä¼˜åŠ£ï¼š</p>
<ul>
<li>AOT å¯åŠ¨æ—¶é—´æ›´çŸ­</li>
<li>JIT å³°å€¼æ€§èƒ½æ›´ä¼˜</li>
</ul>
<p>æ— æ³•è¿›è¡Œ JIT æ„å‘³ç€</p>
<ol>
<li>AOT snapshot&nbsp;<em>must</em>&nbsp;contain executable code for each and every function that could be invoked during application execution;</li>
<li>the executable code&nbsp;<em>must not</em>&nbsp;rely on any speculative assumptions that could be violated during execution;</li>
</ol>
<p>ä¸ºäº†æ»¡è¶³ä¸Šè¿°è¦æ±‚ï¼ŒAOT æ±‡ç¼–è¿‡ç¨‹ä¼šè¿›è¡Œå…¨å±€é™æ€åˆ†æä»¥ç¡®å®šç¨‹åºçš„å“ªäº›éƒ¨åˆ†æ˜¯å¯ä»¥ä»å·²çŸ¥çš„ entry point è§¦è¾¾çš„ï¼Œåˆ†é…å“ªäº›ç±»çš„å®ä¾‹ï¼Œä»¥åŠç±»å‹åœ¨ç¨‹åºä¸­æ˜¯å¦‚ä½•åº”ç”¨çš„ï¼ˆwhich parts of the application are reachable from known set of&nbsp;<em>entry points</em>, instances of which classes are allocated and how types flow through the programï¼‰ã€‚</p>
<p>AOT ä¸Šè¿°è¿™äº›åˆ†ææ˜¯ä¿å®ˆçš„ï¼Œå¯èƒ½åœ¨å‡†ç¡®æ€§ä¸ŠçŠ¯é”™ï¼Œä¸ä¹‹ç›¸æ¯”ï¼ŒJIT åˆ™åœ¨æ€§èƒ½æ–¹é¢ä¸è¡Œï¼Œå› ä¸º JIT éœ€è¦ deoptimize å…œåº•å®ç°æ­£ç¡®çš„è¡Œä¸ºã€‚</p>
<p>æ‰€ä»¥ AOT å°†æ‰€æœ‰æ½œåœ¨çš„å¯è§¦è¾¾çš„åŠŸèƒ½ç¼–è¯‘ä¸º native codeï¼Œè€Œæ— éœ€æŠ•æœºæ€§ä¼˜åŒ–ï¼ˆAll potentially reachable functions are then compiled to native code without any speculative optimizationsï¼‰ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/dart_vm/aot.png" alt="aot" tabindex="0" loading="lazy"><figcaption>aot</figcaption></figure>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒAOT ä¸­ï¼ŒKernel Binary å…ˆç»è¿‡ TFA æ”¶é›†å˜é‡ã€æ–¹æ³•ç­‰ä¿¡æ¯ï¼Œä»¥æ­¤æ¥<strong>ç§»é™¤ä¸å¯è¾¾çš„æ–¹æ³•</strong>ï¼Œå¹¶ devirtuablize methodï¼ˆç¡®å®š<a href="https://www.techopedia.com/definition/24299/virtual-method#:~:text=A%20virtual%20method%20is%20a,oriented%20language%2C%20such%20as%20C%23." target="_blank" rel="noopener noreferrer">è™šæ‹Ÿæ–¹æ³•</a>çš„å…·ä½“æ‰§è¡Œï¼‰ã€‚ä¹‹åç»è¿‡ VM å†ç§»é™¤ä¸€äº›ä¸å¯è¾¾æ–¹æ³•ã€‚</p>
<p>Resulting snapshot can then be run using&nbsp;<em>precompiled runtime</em>, a special variant of the Dart VM which excludes components like JIT and dynamic code loading facilities.</p>
<h3> Switchable Calls</h3>
<p>å³ä½¿æœ‰å…¨å±€å’Œå±€éƒ¨åˆ†æï¼ŒAOT ç¼–è¯‘ä¾ç„¶å¯èƒ½åŒ…å«ä¸€äº›æ— æ³•è¢«éè™šæ‹ŸåŒ–ï¼ˆ<em>devirtualized</em>ï¼‰çš„ call sitesï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒAOT ç¼–è¯‘å‡ºçš„ä»£ç å’Œ runtime ä¼šä½¿ç”¨ JIT ä¸­ç”¨åˆ°çš„å†…è”ç¼“å­˜ï¼ˆ<em>Inline Caching</em>ï¼‰æŠ€æœ¯çš„æ‹“å±•â€”â€”<strong><em>switchable calls</em></strong>ã€‚</p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://github.com/dart-lang/sdk/blob/main/runtime/docs/index.md" target="_blank" rel="noopener noreferrer">sdk/index.md at main Â· dart-lang/sdk</a></p>
<p><a href="https://www.jianshu.com/p/a5b1997a01ba" target="_blank" rel="noopener noreferrer">Dart VM ä»‹ç»</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/dart_vm/isolates.png" type="image/png"/>
    </item>
    <item>
      <title>ä¹‹å‰å‘å¸ƒçš„å‡ ä¸ª App</title>
      <link>https://jixiaoyong.github.io/blog/posts/1a589649.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/1a589649.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">ä¹‹å‰å‘å¸ƒçš„å‡ ä¸ª App</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 08 Jan 2018 14:35:34 GMT</pubDate>
      <content:encoded><![CDATA[<p>åœ¨ä¹‹å‰å­¦ä¹  android çš„è¿‡ç¨‹ä¸­ï¼Œè·Ÿç€æ•™ç¨‹åšäº†å‡ ä¸ª appï¼Œè™½ç„¶éšç€ä½¿ç”¨çš„ api çš„å¤±æ•ˆï¼Œå¤§å¤šæ•°åº”ç”¨å¦‚ä»Šå·²ç»ä¸èƒ½æ­£å¸¸ä½¿ç”¨äº†ï¼Œä½†æ˜¯ä½œä¸ºåˆå…¥ç¼–ç¨‹çš„ä¸€ç‚¹ç‚¹å°çºªå¿µï¼Œè¿˜æ˜¯ä¸ºä»–ä»¬å†™ä¸€ä¸ªç´¢å¼•æ–‡ç« ï¼Œè‡³å°‘èƒ½å¤Ÿæ™šä¸€äº›æ¶ˆå¯‚äºè¿™å¹¿é˜”çš„æ•°æ®æµ·æ´‹ä¸­ã€‚</p>
<h2> <a href="http://jixiaoyong.github.io/jixiaoyong.github.io/blog/backup/blog_2016To2017/2016/05/NiceNews/" target="_blank" rel="noopener noreferrer">NiceNews</a></h2>
<p>Posted on 2016-05-30</p>
<p>NieceNews æˆ‘åˆ¶ä½œçš„ç¬¬äºŒæ¬¾ APPï¼Œä¸€ä¸ªå®æ—¶æ–°é—»è½¯ä»¶ã€‚</p>
<figure><img src="http://jixiaoyong.github.io/jixiaoyong.github.io/blog/backup/blog_2016To2017/2016/05/NiceNews/images/icon.png" alt="NiceNews" tabindex="0" loading="lazy"><figcaption>NiceNews</figcaption></figure>
<h2> <a href="http://jixiaoyong.github.io/jixiaoyong.github.io/blog/backup/blog_2016To2017/2016/07/IWeather/" target="_blank" rel="noopener noreferrer">IWeather</a></h2>
<p>Posted on 2016-07-16</p>
<p>IWeatherï¼Œæˆ‘çš„ç¬¬ä¸‰ä¸ª Android åº”ç”¨ï¼Œä¸€ä¸ªå¤©æ°”é¢„æŠ¥ APPã€‚</p>
<figure><img src="http://jixiaoyong.github.io/blog/backup/blog_2016To2017/2016/07/IWeather/images/1.png" alt="IWeather" tabindex="0" loading="lazy"><figcaption>IWeather</figcaption></figure>
<h2> <a href="http://jixiaoyong.github.io/jixiaoyong.github.io/blog/backup/blog_2016To2017/2016/07/2048/" target="_blank" rel="noopener noreferrer">2048</a></h2>
<p>Posted on 2016-07-21</p>
<p>2048ï¼Œæˆ‘çš„ç¬¬å››ä¸ª Android åº”ç”¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æˆ‘çš„ç¬¬ä¸€æ¬¾æ¸¸æˆ APPã€‚</p>
<figure><img src="http://jixiaoyong.github.io/blogbackup/blog_2016To2017/2016/07/2048/images/1.png" alt="2048" tabindex="0" loading="lazy"><figcaption>2048</figcaption></figure>
<h2> <a href="http://jixiaoyong.github.io/jixiaoyong.github.io/blog/backup/blog_2016To2017/2016/07/I%E7%9C%8B%E7%9F%A5%E4%B9%8E/" target="_blank" rel="noopener noreferrer">I çœ‹çŸ¥ä¹</a></h2>
<p>Posted on 2016-07-24 |</p>
<p>i çœ‹çŸ¥ä¹ï¼Œæˆ‘çš„ç¬¬äº”ä¸ª Android åº”ç”¨ã€‚</p>
<figure><img src="http://jixiaoyong.github.io/blog/backup/blog_2016To2017/2016/07/Içœ‹çŸ¥ä¹/images/1.png" alt="logo" tabindex="0" loading="lazy"><figcaption>logo</figcaption></figure>
<p>å­¦ä¹ çš„è¿‡ç¨‹éœ€è¦ä¸æ–­çš„é‡å¤ï¼Œæ›´éœ€è¦æœ‰æ¡ç†çš„æ€»ç»“ï¼Œæˆ‘ä¼šæŠŠå¹³æ—¶å­¦ä¹ çš„å¿ƒå¾—ä½“ä¼šï¼Œç»éªŒï¼Œä»¥åŠæ— èŠæ—¶çç¢ç£¨å¾—å‡ºæ¥çš„ç¨€å¥‡å¤æ€ªçš„æƒ³æ³•æ”¾åˆ°è¿™é‡Œï¼Œä¸»è¦æ˜¯ä¸ºäº†è‡ªå·±èƒ½å¤Ÿåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æœ‰è®¡åˆ’çš„æ€»ç»“å­¦ä¹ åˆ°çš„çŸ¥è¯†ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿ä¹‹åæŸ¥é˜…ã€‚</p>
]]></content:encoded>
      <enclosure url="http://jixiaoyong.github.io/jixiaoyong.github.io/blog/backup/blog_2016To2017/2016/05/NiceNews/images/icon.png" type="image/png"/>
    </item>
    <item>
      <title>ä» Sunflower å¼€å§‹å­¦ä¹ ä¼˜é›…çš„ Jetpack æ¶æ„</title>
      <link>https://jixiaoyong.github.io/blog/posts/27065732.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/27065732.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">ä» Sunflower å¼€å§‹å­¦ä¹ ä¼˜é›…çš„ Jetpack æ¶æ„</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 24 Jan 2019 11:48:31 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>Google å¤§æ³• NBï¼ï¼ï¼(ç ´éŸ³)</p>
</blockquote>
<h2> å‰è¨€</h2>
<p><a href="https://developer.android.google.cn/jetpack/" target="_blank" rel="noopener noreferrer">Jetpack</a>æ˜¯ Google æ¨å‡ºçš„ä¸€ç³»åˆ— Android è½¯ä»¶é›†åˆï¼Œ<em>"ä½¿æ‚¨å¯ä»¥æ›´è½»æ¾åœ°å¼€å‘å‡ºè‰²çš„ Android åº”ç”¨ã€‚è¿™äº›ç»„ä»¶å¯å¸®åŠ©æ‚¨éµå¾ªæœ€ä½³åšæ³•ã€è®©æ‚¨æ‘†è„±ç¼–å†™æ ·æ¿ä»£ç çš„å·¥ä½œå¹¶ç®€åŒ–å¤æ‚ä»»åŠ¡ï¼Œä»¥ä¾¿æ‚¨å°†ç²¾åŠ›é›†ä¸­æ”¾åœ¨æ‰€éœ€çš„ä»£ç ä¸Š"</em>ã€‚</p>
<p><a href="https://github.com/googlesamples/android-sunflower" target="_blank" rel="noopener noreferrer">Sunflower</a>åˆ™æ˜¯ Google ç”¨æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Jetpack è¿›è¡Œ Android å¼€å‘çš„ Demoï¼Œæœ‰ç€éå¸¸ä¼˜é›…çš„æ¶æ„ä¸ååˆ†ç®€æ´çš„ä»£ç ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¾ˆå¥½åœ°å­¦ä¹  Jetpack ä»¥åŠ MVVM æ€æƒ³ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦æ˜¯ç»“åˆ Sunflower ä¸­çš„ç¤ºä¾‹ä»£ç ï¼Œåˆ†æ Jetpack æ¶æ„ä¸­å„éƒ¨åˆ†çš„ä½œç”¨ï¼Œä»¥åŠä»–ä»¬å¦‚ä½•å·§å¦™çš„æ­é…ä½¿ç”¨ï¼Œæ–¹ä¾¿æŒ‡å¯¼æ—¥åå¯¹ Jetpack çš„ä½¿ç”¨ã€‚</p>
<blockquote>
<p>æœ¬æ–‡ä¸­çš„å¤§éƒ¨åˆ†ä»£ç ã€ç¤ºæ„å›¾é™¤éç‰¹æ®Šæ³¨æ˜å¤–ï¼Œçš†æ¥è‡ª Google çš„<a href="https://github.com/googlesamples/android-sunflower" target="_blank" rel="noopener noreferrer">Sunflower å·¥ç¨‹</a>æˆ–å…¶ä»–äº’è”ç½‘èµ„æºï¼Œæ ¹æ®ç¯‡å¹…éœ€è¦åšäº†éƒ¨åˆ†ç²¾ç®€ï¼Œæ‰€æœ‰æƒç›Šå½’åŸä½œè€…æ‰€æœ‰ã€‚</p>
</blockquote>
<p>ä¸‹å›¾æ˜¯<a href="https://developer.android.google.cn/jetpack/" target="_blank" rel="noopener noreferrer">Google Jetpack å®˜ç½‘</a>å¯¹ Jetpack çš„ä»‹ç»å›¾ï¼š</p>

## å¯¹ Sunflower çš„æ•´ä½“åˆ†æ
<p>ä¸‹å›¾æ˜¯ Sunflower æ¶æ„çš„ç®€å•ç¤ºæ„å›¾ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20190124212220.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒAPP çš„ç•Œé¢æœ‰<code>æˆ‘çš„èŠ±å›­</code>ã€<code>æ¤ç‰©ç›®å½•</code>å’Œ<code>æ¤ç‰©ä»‹ç»</code>ä¸‰éƒ¨åˆ†ï¼Œè¿™ä¸‰è€…çš„åˆ‡æ¢é€»è¾‘é€šè¿‡å®ç°ã€‚</p>
<p>æ¯ä¸ªç•Œé¢çš„<strong>XML</strong>ä¸­çš„å¸ƒå±€ä¿¡æ¯ï¼ˆåŒ…æ‹¬<code>æ•°æ®ã€äº‹ä»¶ï¼ˆclickListenerç­‰ï¼‰ï¼ŒRecycleViewçš„LayoutManagerï¼ŒAdapterç­‰ç­‰</code>ï¼‰é€šè¿‡<strong>DataBinding</strong>ä¸<strong>ViewModel</strong>ä¸­çš„å¯è§‚å¯Ÿæ•°æ®<strong>LiveData</strong>ç»‘å®šåœ¨ä¸€èµ·ï¼Œåªè¦æ•°æ®åº“ä¸­çš„<code>æ•°æ®</code>æœ‰æ›´æ–°ï¼Œå°±ä¼šé€šè¿‡<code>LiveData</code>ä¸»åŠ¨é€šçŸ¥å¸ƒå±€æ›´æ–°ç•Œé¢ï¼›åŒæ—¶<code>DataBinding</code>è¿˜é€šè¿‡ä¸<code>Adapter</code>ï¼ˆè¿™äº›ç»§æ‰¿è‡ª<strong>ListAdapter</strong>çš„ Adapter å®ç°äº†çš„ä½œç”¨ï¼‰å°†<code>ItemView</code>çš„<code>ViewModel</code>ä¸å¸ƒå±€<code>XML</code>ä¸­ç»‘å®šåœ¨ä¸€èµ·ï¼Œé€šè¿‡<code>BindingAdapter</code>å¯¹<code>XML</code>ä¸­çš„æ•°æ®åšé¢„å¤„ç†ï¼ˆåŠ è½½ imgUrl ä¸­çš„å›¾ç‰‡åˆ° ImageView ç­‰ç­‰ï¼‰ã€‚</p>
<p>åœ¨ä¸­æŒ‡å®šè¿™äº›<code>DataBinding</code>ä¸ä¹‹é—´ä»¥åŠ<code>ViewModel</code>ä¸<code>æ•°æ®åº“</code>ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œè¿™äº›æ•°æ®ä¸æ“ä½œéƒ½å—ç€çš„å½±å“ã€‚</p>
<p><code>ViewModel</code>çš„æ•°æ®æ¥æºâ€”â€”<code>Model</code>åœ¨è¿™é‡Œçš„å®ç°æ˜¯ä¸€ä¸ª<code>æ•°æ®åº“</code>ã€‚æ¯ä¸ª<code>ViewModel</code>æœ‰ä¸€ä¸ª<code>XXXViewModelFactory</code>ç±»ï¼Œç”¨æ¥ä½¿ç”¨æ•°æ®ç±»<code>XXXRepository</code>ç±»çš„å®ä¾‹åˆ›å»ºå¯¹åº”çš„<code>ViewModel</code>ã€‚<code>XXXViewModelFactory</code>å‘<code>Activity</code>ç­‰å±è”½äº†<code>ViewModel</code>çš„å…·ä½“å®ç°ã€‚</p>
<p><code>XXXRepository</code>ç±»çš„å‡ºç°æ—¶ä¸ºäº†å°†<code>ViewModel</code>ä¸æ•°æ®çš„å…·ä½“å®ç°è§£è€¦åˆï¼Œè¿™æ ·<code>ViewModel</code>åªéœ€è¦å…³å¿ƒä»–è¦çš„æ“ä½œè€Œä¸å¿…å…³ç³»æ•°æ®æ¥æºçš„å…·ä½“å®ç°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>XXXRepository</code>ç±»å¯¹åº”å°è£…äº†è¿™æ•°æ®åº“<code>AppDatabase</code>ä¸­å¯¹ä¸¤ä¸ªè¡¨çš„æ“ä½œã€‚</p>
<p>æ•°æ®åº“ä½¿ç”¨å®ç°ï¼Œä»åº•å±‚å¼€å§‹ä¾æ¬¡åˆ†ä¸º<code>è¡¨Entity</code>ï¼Œ<code>æ•°æ®è®¿é—®å¯¹è±¡DAO</code>å’Œ<code>æ•°æ®åº“DataBase</code>ä¸‰ä¸ªå±‚æ¬¡ã€‚æ¯ä¸ª DAO å¯¹åº”ä¸€ä¸ªåŒ…è£…ç±»<code>XXXRepository</code>ç±»ä¾›<code>ViewModel</code>ä½¿ç”¨ã€‚</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>åˆ™ç®¡ç†ç€ä¸€ä¸ªä» Json è¯»å–æ•°æ®å¹¶åŠ è½½åˆ°æ•°æ®åº“ä¸­çš„åå°ä»»åŠ¡<code>SeedDatabaseWorker</code>ã€‚<h2> å…·ä½“å®ç°åˆ†æ</h2>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹**<code>View</code>**éƒ¨åˆ†ï¼ŒSunflower åªæœ‰ç®€å•çš„ 3 ä¸ªé¡µé¢ï¼Œå…¨éƒ½æ˜¯ç”¨<code>Fragment</code>å®ç°ï¼Œç”±<code>Activity</code>é€šè¿‡<code>Navigation</code>æ§åˆ¶åˆ‡æ¢ï¼š</p>
<ul>
<li><code>GardenActivity</code> ä¸»é¡µé¢ï¼Œå”¯ä¸€çš„ä¸€ä¸ª Activity</li>
<li><code>GardenFragment</code> æˆ‘çš„èŠ±å›­ ç•Œé¢ï¼Œä¼šæ˜¾ç¤ºç”¨æˆ·åœ¨æ¤ç‰©ç›®å½•ä¸­é€‰æ‹©å¹¶ç§æ¤çš„æ¤ç‰©ä¿¡æ¯</li>
<li><code>PlantListFragment</code> æ¤ç‰©ç›®å½• ç•Œé¢ï¼Œæ‰€æœ‰çš„æ¤ç‰©ä¿¡æ¯åˆ—è¡¨</li>
<li><code>PlantDetailFragment</code> æ¤ç‰©ä»‹ç» ç•Œé¢ï¼Œå½“åœ¨â€œæˆ‘çš„èŠ±å›­â€æˆ–â€œæ¤ç‰©åˆ—è¡¨â€é€‰æ‹©äº†æŸä¸ªæ¤ç‰©åï¼Œä¼šè¿›å…¥è¯¥ç•Œé¢æ˜¾ç¤ºæ¤ç‰©è¯¦ç»†ä»‹ç»</li>
</ul>
<h3> Navigation æ§åˆ¶ç•Œé¢åˆ‡æ¢</h3>
<p>å…ˆçœ‹ä¸€ä¸‹<a href="https://developer.android.google.cn/topic/libraries/architecture/navigation/" target="_blank" rel="noopener noreferrer">Navigation</a>çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>Navigation æ˜¯ APP è®¾è®¡ä¸­çš„å…³é”®éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰ç”¨æˆ·ä»ä¸åŒçš„ç•Œé¢åˆ‡æ¢ã€è¿›å…¥å’Œæ¨å‡ºçš„äº¤äº’é€»è¾‘ã€‚</p>
</blockquote>
<p>å’Œå¸ƒå±€æ–‡ä»¶ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼–è¯‘å™¨çš„å¯è§†åŒ–ç•Œé¢ä¸­ï¼Œç›´æ¥é¢„è§ˆã€è®¾è®¡ä¸åŒç•Œé¢åˆ‡æ¢æ•ˆæœã€‚ä»–å¯ä»¥è´Ÿè´£<code>Fragment</code>ã€<code>Activity</code>ã€<code>Navigation graphs</code> ä¸ <code>subgraphs</code> ä»¥åŠ<code>Custom destination types</code>ï¼Œä»–ä»¬ä¹‹é—´é€šè¿‡ä¸åŒçš„<code>action</code>è¿æ¥èµ·æ¥ã€‚</p>
<p>é€šè¿‡å®˜æ–¹æ–‡æ¡£å¯çŸ¥ï¼Œ<code>Navigation</code>å¯ä»¥å’Œ<code>AppBar</code>ï¼Œ<code>ToolBar</code>ç­‰ç»„åˆèµ·æ¥æ§åˆ¶ Fragment æ˜¾ç¤ºï¼Œæ­¤å¤–å¯ä»¥é€šè¿‡<code>ViewModel</code>åœ¨ç»‘å®šåˆ°åŒä¸€ä¸ª<code>Activity</code>çš„<code>Fragment</code>ä¹‹é—´å…±äº«æ•°æ®ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡<a href="https://developer.android.google.cn/topic/libraries/architecture/navigation/navigation-pass-data" target="_blank" rel="noopener noreferrer"><code>Bundle</code>æˆ–<code>Safe Args</code></a>åœ¨ä¸¤ä¸ª<code>Fragment</code>ä¹‹é—´ä¼ é€’æ•°æ®ã€‚</p>
<p>é‚£ä¹ˆï¼Œåœ¨<code>Sunflower</code>ä¸­<code>Navigation</code>æ˜¯æ€ä¹ˆæ§åˆ¶ç•Œé¢åˆ‡æ¢çš„å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œåœ¨<code>res/navigation/</code>ç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ª<code>åµŒå¥—å¯¼èˆªå›¾(Nested navigation graphs)</code>,å®šä¹‰å„ä¸ªç•Œé¢ä¹‹å‰çš„åˆ‡æ¢å…³ç³»ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨ Activity å¯¹åº”çš„ XML ä¸­æ’å…¥è¯¥å¯¼èˆªï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹‹åå°±å¯ä»¥åœ¨ Activity æˆ–è€… Fragment ä¸­è·å–è¯¥å¯¼èˆªçš„å®åŠ›ï¼Œç”¨æ¥åˆ‡æ¢ç•Œé¢äº†ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> DataBinding ç»‘å®šå¸ƒå±€å’Œæ•°æ®</h3>
<p>Navigation è§£å†³äº†ä¸åŒçš„å¸ƒå±€é—´äº¤äº’çš„é€»è¾‘ï¼ŒDataBinding åˆ™å……å½“å¸ƒå±€ View å’Œæ•°æ®ï¼ˆViewModelã€LiveDataï¼‰ä¹‹é—´çš„æ¡¥æ¢ï¼Œå°†äºŒè€…è”ç³»èµ·æ¥ã€‚</p>
<p>ä»<a href="https://developer.android.google.cn/topic/libraries/data-binding/" target="_blank" rel="noopener noreferrer">å®˜ç½‘</a>çš„è¡¨è¿°ä¸­æˆ‘ä»¬çŸ¥é“ï¼ŒDataBinding ä½¿ç”¨åœ¨ XML ä¸­å£°æ˜çš„æ–¹å¼ï¼ˆè€Œéç¼–ç¨‹çš„æ–¹å¼ï¼‰ï¼Œå°†å¸ƒå±€ä¸­çš„ç»„ä»¶æ†ç»‘åˆ° APP ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®ä¸Šï¼Œè¿™æ ·å½“æ•°æ®æ›´æ–°æ—¶ï¼Œå¸ƒå±€ä¹Ÿä¼šéšä¹‹è‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>DataBinding åœ¨ XML ä¸­çš„å½¢å¼å¦‚ä¸‹ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯åŸå…ˆçš„é¡µé¢å¸ƒå±€ä¿¡æ¯<code>&lt;ConstraintLayout... /&gt;</code>åŒ…è£¹åœ¨<code>&lt;layout... /&gt;</code>ä¸­ï¼ŒåŒæ—¶å¤šäº†ä¸€ä¸ªæ•°æ®åŸŸ<code>&lt;data... /&gt;</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰ä¸€äº›å˜é‡<code>&lt;variable... /&gt;</code>ï¼Œå¹¶åœ¨å¸ƒå±€ä¸­ä½¿ç”¨ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é™¤äº†å¸¸è§çš„<code>android:text</code>ï¼Œ<code>android:onClick</code>ç­‰é€šç”¨çš„å±æ€§å¯ä»¥ç›´æ¥ç»‘å®šå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è‡ªå®šä¹‰<a href="https://developer.android.google.cn/topic/libraries/data-binding/binding-adapters.html" target="_blank" rel="noopener noreferrer"><strong>Binding adapters</strong></a>æ”¯æŒæ›´å¤šå½¢å¼çš„å±æ€§ç»‘å®šï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç å°±æ”¯æŒäº†<code>app:goneUnless</code>çš„è§£æï¼Œæˆ‘ä»¬åªè¦åœ¨ XML ä¸­ä¸ºç»„ä»¶åŠ ä¸Šè¿™ä¸ªå±æ€§å°±å¯ä»¥å®ç°ç›¸åº”çš„æ•ˆæœï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¯¹åº”çš„ Activity æˆ– Fragment ä¸­ï¼Œç”¨å¦‚ä¸‹ä»£ç å°†å¸ƒå±€ä¸é¡µé¢ç»‘å®šåˆ°ä¸€èµ·ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„<code>ActivityMainBinding</code>ç±»æ˜¯<code>DataBinding</code>æ ¹æ® XML æ–‡ä»¶çš„åå­—è‡ªåŠ¨æ›¿æˆ‘ä»¬ç”Ÿæˆçš„ï¼Œè§„å¾‹æ˜¯<code>XMLæ–‡ä»¶å+Binding</code>çš„é©¼å³°å‘½åã€‚</p>
<p>åœ¨ Sunflower ä¸­æœ‰ç±»ä¼¼çš„åº”ç”¨æœ‰å¾ˆå¤šå¤„ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ViewModel ç®¡ç†æ•°æ®ä¸é¡µé¢çš„äº¤äº’</h3>
<p><code>DataBinding</code>é€šè¿‡æ ‡è®°çš„å½¢å¼å°†æ•°æ®å’Œç»„ä»¶ç»‘å®šï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä»–ä½¿ç”¨çš„æ•°æ®åˆ™æ˜¯æ¥è‡ªäº<code>ViewModel</code>çš„ã€‚åœ¨é¡µé¢<code>Activity</code>(æˆ–<code>Fragment</code>) ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†è¿™ä¸¤è€…ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p><code>ViewModel</code>æ˜¯è®¾è®¡ç”¨æ¥ä»¥ä¸€ç§å¯ä»¥æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸï¼ˆ<code>lifecycle</code>ï¼‰çš„æ–¹å¼å­˜å‚¨å’Œç®¡ç†ä¸ UI ç›¸å…³çš„æ•°æ®ï¼Œå®ƒå¯ä»¥å…è®¸æ•°æ®åœ¨è¯¸å¦‚å±å¹•æ—‹è½¬çš„å˜åŒ–ä¸­å­˜æ´»ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´<code>VideModule</code>çš„æ•°æ®ç”Ÿå‘½å‘¨æœŸå¯èƒ½è¦æ¯”ä»–é™„ç€çš„<code>Activity</code>æˆ–<code>Fragment</code>çš„ç”Ÿå‘½å‘¨æœŸé•¿ã€‚</p>
<p>åŒæ—¶ï¼Œ<code>UI controller</code>å¯ä»¥åœ¨<code>Activity</code>ç­‰ä¸å†éœ€è¦æ•°æ®æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨<code>ViewModel</code>çš„<code>onCleared()</code>æ–¹æ³•æ¸…é™¤è¿™äº›æ•°æ®ä»¥é¿å…å†…å­˜æ³„æ¼ã€‚</p>
<p>ä¸‹å›¾æ˜¯<code>ViewModel</code>å’Œ<code>Activity</code>çš„ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”ï¼š</p>

æ­¤å¤–ï¼Œç”±äºé»˜è®¤çš„è·å– ViewModel çš„æ–¹æ³•åªèƒ½è°ƒå–æ— å‚æ„é€ å‡½æ•°ï¼Œå½“éœ€è¦å‘ ViewModel ä¼ é€’å‚æ•°æ—¶ï¼Œå°±éœ€è¦ç”¨åˆ° Factory å·¥å‚æ¨¡å¼æ¥åˆ›å»º ViewModelï¼š
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿˜å¯ä»¥å°†<code>ViewModel</code>äº<code>LiveData</code>ç»“åˆï¼Œè¿™æ ·åœ¨<code>Activity</code>ç­‰åœ°æ–¹å¯¹<code>LiveData</code>è¿›è¡Œè®¢é˜…åï¼Œå½“<code>LiveData</code>çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶<code>Activity</code>ç­‰å¯ä»¥åŠæ—¶å¾—åˆ°é€šçŸ¥ï¼Œè€Œåšå‡ºç›¸åº”å˜åŒ–ã€‚æ­¤å¤–<code>ViewModel</code>ä¸<code>lifecycle</code>çš„ç»“åˆå¯ä»¥ä¿è¯åœ¨<code>Activity</code>ç­‰ç”Ÿå‘½å‘¨æœŸç»“æŸåæ•°æ®å¾—åˆ°åŠæ—¶çš„æ¸…ç†ã€‚</p>
<h3> Room ä¿å­˜æ•°æ®</h3>
<blockquote>
<p>Room æŒä¹…æ€§åº“åœ¨ SQLite ä¸Šæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä»¥ä¾¿åœ¨å……åˆ†åˆ©ç”¨ SQLite å¼ºå¤§åŠŸèƒ½çš„åŒæ—¶ï¼Œèƒ½å¤Ÿæµç•…çš„è®¿é—®æ•°æ®åº“ã€‚â€”â€”Android Developers</p>
</blockquote>
<p><code>Room</code>éœ€è¦ 3 ä¸ªå…ƒç´ ï¼š</p>
<ul>
<li><code>Database</code> æ•°æ®åº“ï¼Œå¯ä»¥æä¾›å¯¹è¡¨æ ¼çš„æ“ä½œæ–¹æ³•<code>@DAO</code>ã€‚æ˜¯ä¸€ä¸ªç»§æ‰¿è‡ª<code>RoomDatabase</code>çš„æŠ½è±¡ç±»ã€‚</li>
<li><code>Entity</code> è¡¨æ ¼ï¼Œè§„å®šäº†æ¯ä¸ªè¡¨æ ¼å¯ä»¥ä¿å­˜çš„æ•°æ®æ ¼å¼ã€‚æ˜¯ä¸€ä¸ªæ™®é€šç±»ã€‚</li>
<li><code>Dao</code> æ•°æ®è®¿é—®ç»“æ„ï¼ˆ<code>Data Access Object</code>ï¼‰ï¼Œå®šä¹‰äº†å¯¹è¡¨æ ¼<code>@Entity</code>ä¸­çš„æ•°æ®çš„æ“ä½œã€‚æ˜¯ä¸€ä¸ªæ¥å£æˆ–è€…æŠ½è±¡ç±»ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥å¯¹<code>@DAO</code>è¿›è¡Œè¿›ä¸€æ­¥çš„å°è£…å¾—åˆ°ä¸€ä¸ª<code>XXXRepository</code>ç±»ï¼Œ<code>ViewModel</code>é€šè¿‡è¿™ä¸ª<code>XXXRepository</code>ç±»æ¥æ“ä½œæ•°æ®ï¼Œä»è€Œå°†å…¶ä¸æ•°æ®çš„å…·ä½“å®ç°è§£è€¦ã€‚</p>
<h3> WorkManager ç®¡ç†ä»»åŠ¡</h3>
<p><code>WorkManager</code>ç”¨æ¥ç®¡ç†å³æ—¶æˆ–å®šæ—¶ä»»åŠ¡ï¼Œå®˜æ–¹å®šä¹‰æ˜¯åœ¨æŒ‡å®šçº¦æŸæ¡ä»¶æˆç†Ÿæ—¶å¯é çš„åœ¨åå°æ‰§è¡Œå¯¹åº”çš„ä»»åŠ¡ã€‚</p>
<p>å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒè¿™ä¸ª<a href="https://gist.github.com/jixiaoyong/041d8b0775e392302b4cd57a98b4f6fa" target="_blank" rel="noopener noreferrer">GIST</a>ã€‚</p>
<p>å’Œä»–ç›¸å…³çš„æœ‰ä¸‹é¢å‡ ä¸ªå…³é”®ç±»ï¼š</p>
<ul>
<li><code>Worker</code> å®šä¹‰è¦æ‰§è¡Œçš„ä»»åŠ¡å†…å®¹</li>
<li><code>WorkRequest</code> ä»£è¡¨ä¸€é¡¹å•ç‹¬çš„ä»»åŠ¡ï¼Œæ˜ç¡®å…·ä½“è¦æ‰§è¡Œçš„ä»»åŠ¡å†…å®¹ï¼ˆWorkerï¼‰ã€ä»»åŠ¡çš„ç±»å‹ï¼ˆWorkRequest.Builder çš„å­ç±»ï¼Œå†³å®šä»»åŠ¡ä¸€æ¬¡æ€§è¿˜æ˜¯é‡å¤çš„ï¼‰ä»¥åŠä»»åŠ¡æ‰§è¡Œçš„æ¡ä»¶ï¼ˆConstraintsï¼Œå¦‚è”ç½‘ã€ç”µæ± ç”µé‡ç­‰ç­‰ï¼‰</li>
<li>WorkManager æ‰§è¡Œç®¡ç† WorkRequestï¼Œå®‰æ’æ‰§è¡Œ Worker ä¸­çš„å·¥ä½œå†…å®¹ã€‚</li>
</ul>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://developer.android.google.cn/jetpack/" target="_blank" rel="noopener noreferrer">Android Jetpack å®˜ç½‘</a></p>
<p><a href="https://blog.csdn.net/weixin_42215792/article/details/80395379" target="_blank" rel="noopener noreferrer">Android Jetpack-Navigation ä½¿ç”¨ä¸­å‚æ•°çš„ä¼ é€’</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20190124212220.png" type="image/png"/>
    </item>
    <item>
      <title>åˆ©ç”¨ travis é€šè¿‡ Hexo åœ¨ Github ä¸Šè‡ªåŠ¨éƒ¨ç½² Markdown æ–‡æ¡£</title>
      <link>https://jixiaoyong.github.io/blog/posts/b00ac86a.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/b00ac86a.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">åˆ©ç”¨ travis é€šè¿‡ Hexo åœ¨ Github ä¸Šè‡ªåŠ¨éƒ¨ç½² Markdown æ–‡æ¡£</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 20 Dec 2018 14:35:34 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<blockquote>
<p>æœ¬æ–‡ä»‹ç»äº†ä¸€ä¸ªåªéœ€è¦æ›´æ–° Markdown æ–‡æ¡£åˆ° Githubï¼Œå³å¯å®æ—¶æ›´æ–°åšå®¢å†…å®¹çš„æ–¹æ³•ã€‚</p>
<p>æœ¬æ–‡å‚è€ƒ<a href="https://juejin.im/post/5a1fa30c6fb9a045263b5d2a" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç« </a> å®ç°ï¼Œå¹¶æ ¹æ®æˆ‘çš„éœ€æ±‚æ›´æ”¹äº†éƒ¨åˆ†å†…å®¹ï¼Œä»¥å®ç°<strong>éƒ¨ç½²å¤šä¸ª hexo å·¥ç¨‹åˆ°åŒä¸€ Github é¡¹ç›®ä¸åŒç›®å½•ä¸‹</strong>ã€‚</p>
</blockquote>
<p>Github ä¸ºæˆ‘ä»¬æä¾›äº†<a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">Github Pages</a> æ–¹ä¾¿æˆ‘ä»¬å»ºç«‹ç®€å•çš„ç½‘é¡µæ¥ä»‹ç»é¡¹ç›®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç”¨ä»–æ¥æ­å»ºé™æ€åšå®¢ã€‚</p>
<p>é€šè¿‡<a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a>å¯ä»¥å°†æˆ‘ä»¬å†™çš„<code>Markdownæ–‡æ¡£</code>æ ¼å¼åŒ–ä¸º<code>é™æ€ç½‘é¡µ</code>ï¼Œå†å°†å…¶éƒ¨ç½²åˆ° Github ä¸Šé¢å¯¹åº”çš„<code>user_name.github.io</code>ä¸Šé¢ï¼Œå°±å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªåœ¨çº¿çš„é™æ€åšå®¢ã€‚</p>
<p>ä½†æ˜¯å— Hexo çš„é™åˆ¶ï¼Œæ¯æ¬¡æ›´æ–°åšå®¢å†…å®¹éƒ½éœ€è¦åœ¨æ›´æ–°å®Œ Markdown æ–‡æ¡£åï¼Œéƒ½éœ€è¦å†æ¬¡é‡æ–°åˆ›å»ºå¯¹åº”çš„é™æ€ç½‘é¡µã€å°†æ›´æ–°æäº¤åˆ° Githubã€‚è¿™æ ·çš„æ­¥éª¤ç¹çä¸”æ²¡æœ‰æ„ä¹‰ï¼Œè€Œä¸”æ›´æ¢ç”µè„‘åè¿™äº›ç¯å¢ƒéƒ½éœ€è¦é‡æ–°è®¾ç½®ä¸€æ¬¡ã€‚</p>
<p>é€šè¿‡<a href="https://www.travis-ci.org" target="_blank" rel="noopener noreferrer">travis</a>æä¾›çš„å…è´¹ CI æŠ€æœ¯ï¼Œå¯ä»¥è®©äº‘æœåŠ¡å™¨ä»£æ›¿æˆ‘ä»¬å®ç° Hexo åˆ›å»ºä»¥åŠåŒæ­¥ Github ç­‰æ­¥éª¤ï¼Œæ¯æ¬¡æ›´æ–°åšå®¢æ—¶<strong>åªéœ€è¦å°†å†™å¥½çš„ Markdown æ–‡æ¡£æ¨é€åˆ° Github é¡¹ç›®å¯¹åº”ç›®å½•ä¸­ï¼Œç­‰å¾…ä¸€ä¼šå„¿å°±å¯ä»¥çœ‹åˆ°æ›´æ–°åçš„åšå®¢äº†</strong>ã€‚</p>
<p>å…·ä½“æ­å»ºè¿‡ç¨‹å¯ä»¥å‚è€ƒ<a href="https://juejin.im/post/5a1fa30c6fb9a045263b5d2a" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç« </a> æœ¬æ–‡åªè®²è¿°å®ç°<strong>éƒ¨ç½²å¤šä¸ª hexo å·¥ç¨‹åˆ°åŒä¸€ Github é¡¹ç›®ä¸åŒç›®å½•ä¸‹</strong>éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼šã€‚</p>
<blockquote>
<p><strong>æ‡’â€”â€”æ˜¯ç¬¬ä¸€ç”Ÿäº§åŠ›</strong></p>
</blockquote>
<h2> å…·ä½“å·®å¼‚</h2>
<h3> hexo åˆ†æ”¯çš„ç»“æ„</h3>
<p>å› ä¸ºæœ‰å¤šä¸ª hexo é¡¹ç›®ï¼Œæ‰€ä»¥åœ¨ github é¡¹ç›®çš„ hexo åˆ†æ”¯ä¸‹ï¼Œå¯¹ä¸åŒçš„ hexo é¡¹ç›®åˆ†åˆ«æ–°å»ºæ–‡ä»¶å¤¹å­˜æ”¾ã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> .travis.yml</h3>
<p>é‡ç‚¹ä¿®æ”¹<code>script:</code>å’Œ<code>after_script:</code>ä¸¤éƒ¨åˆ†ï¼š</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–‡æ¡£é“¾æ¥ï¼š<a href="https://github.com/jixiaoyong/jixiaoyong.github.io/blob/hexo_blog/.travis.yml" target="_blank" rel="noopener noreferrer">.travis.yml</a></p>
<h2> æ›´æ–°åšå®¢å†…å®¹</h2>
<p>å½“ä»¥ä¸Šå†…å®¹éƒ½é…ç½®å®Œæˆåï¼Œåªè¦æ–°å»ºä¸€ä¸ªç¬¦åˆ hexo è¦æ±‚çš„æ–‡æ¡£ï¼Œå¹¶æäº¤åˆ° Github å¯¹åº”é¡¹ç›®çš„ hexo åˆ†æ”¯ä¸­<code>source</code>ç›®å½•ï¼ŒTravis ä¾¿ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºå¹¶æ›´æ–°é™æ€ç½‘é¡µã€‚</p>
<h2> å‚è€ƒæ–‡æ¡£</h2>
<p><a href="https://juejin.im/post/5a1fa30c6fb9a045263b5d2a" target="_blank" rel="noopener noreferrer">Hexo é‡ä¸Š Travis-CIï¼šå¯èƒ½æ˜¯æœ€é€šä¿—æ˜“æ‡‚çš„è‡ªåŠ¨å‘å¸ƒåšå®¢å›¾æ–‡æ•™ç¨‹</a> ï¼ˆå®Œå…¨åœ¨è¯¥æ–‡æ¡£æŒ‡å¯¼ä¸‹å®Œæˆï¼Œéƒ¨åˆ†æ­¥éª¤æœ‰å·®å¼‚ï¼Œæ„Ÿè°¢ä½œè€…<a href="https://juejin.im/user/56efe6461ea493005565dafd" target="_blank" rel="noopener noreferrer">MichaelX</a> ï¼‰</p>
]]></content:encoded>
    </item>
    <item>
      <title>Hexo+Github=Blog</title>
      <link>https://jixiaoyong.github.io/blog/posts/f7965978.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/f7965978.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">Hexo+Github=Blog</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 24 Mar 2016 22:06:06 GMT</pubDate>
      <content:encoded><![CDATA[<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸€ç›´ä»¥æ¥ï¼Œä¸ºäº†æœ‰ä¸€ä¸ªåˆé€‚çš„åœ¨çº¿å†™å­—çš„åœ°æ–¹ï¼Œæˆ‘å°è¯•è¿‡è®¸å¤šç§å·¥å…·ï¼Œä»æœ€åˆçš„ QQ ç©ºé—´å¼€å§‹ï¼Œåˆ°å„ç§é—¨æˆ·ç½‘ç«™çš„åšå®¢ï¼Œå†åˆ°è‡ªå·±å¼€å§‹å°è¯•æ­å»ºåšå®¢ï¼Œä¸€è·¯å¥”å¿™ï¼Œé—¨æˆ·ç½‘ç«™çš„é™åˆ¶å¤ªå¤šï¼Œè‡ªå·±æ­å»ºçš„åšå®¢åˆæ—¶å¸¸ç”±äºç©ºé—´æä¾›å•†çš„å„ç§é—®é¢˜è€Œæ— æ³•è®¿é—®ã€‚è®¸å¤šæ—¶å€™ä¸€ä¸ªå¹³å°åªèƒ½ä½¿ç”¨ä¸€æ®µæ—¶é—´ï¼Œè¿™æ ·å­é¢ é¢ æ’æ’å¤§æ¦‚ä¹Ÿæœ‰äº”å…­å¹´çš„æ—¶é—´äº†ã€‚</p>
<p>ä¸€ç›´å¬è¯´ github è¿™ä¸ªå¹³å°çš„å„ç§ä¼˜ç‚¹ï¼Œå°¤å…¶æ˜¯å¯ä»¥ä½œä¸ºç¨³å®šè€Œå…è´¹çš„ç©ºé—´æ‰˜ç®¡åšå®¢æœ€ä»¤æˆ‘å¿ƒåŠ¨ï¼Œä½†æ˜¯ä¹‹å‰å¤šæ¬¡å°è¯•ä¸å¾—å…¶é“ï¼Œç»ˆä»¥å¤±è´¥å‘Šç»ˆã€‚æœ€è¿‘åœ¨å­¦ä¹  Android è¯­è¨€çš„æ—¶å€™ï¼Œåˆå†æ¬¡ç”¨èµ·äº† githubï¼Œä¸è¿‡è¿™æ¬¡æ˜¯ç”¨å®ƒæ¥å­˜å‚¨ä»£ç ã€‚ä¸å¾—ä¸æ‰¿è®¤ï¼Œä½¿ç”¨ github æ¥æ§åˆ¶ç¨‹åºç‰ˆæœ¬çœŸæ˜¯ä¸€ä»¶ä»¤äººæ„‰æ‚¦çš„äº‹ä»¶ã€‚</p>
<p>æœºç¼˜å·§åˆï¼Œå› ä¸ºéœ€è¦å°†å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›ç¬”è®°ï¼Œå¿ƒå¾—æ€»ç»“æ‰¾ä¸ªåœ°æ–¹æ•´ç†ï¼Œæ˜¾ç„¶å•çº¯çš„ä½¿ç”¨ github å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ï¼Œè€Œå…¶ä»–çš„å¹³å°çš„åšå®¢é™åˆ¶åˆå¤ªå¤šï¼Œäºæ˜¯åˆå°è¯•ç”¨ github æ­å»ºä¸€ä¸ªåšå®¢ï¼Œè™½ç„¶å¯¹è¿™äº›çŸ¥è¯†å¹¶ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä½†è¯¯æ‰“è¯¯æ’ç«Ÿç„¶ä¹ŸæˆåŠŸçš„æ­å»ºå¥½äº†åšå®¢ã€‚ä¸‹é¢å°±æŠŠæ•´ä¸ªå»ºç«™çš„è¿‡ç¨‹å¤§æ¦‚æ¢³ç†ä¸€ä¸‹ï¼Œä»¥ä¾¿ä»¥åæŸ¥çœ‹ã€‚</p>
<h2> å‡†å¤‡ git å’Œ node ç¯å¢ƒ</h2>
<p>ä¸‹è½½è½¯ä»¶ï¼š</p>
<ul>
<li>git</li>
<li>github windows å®¢æˆ·ç«¯ (å¯é€‰)</li>
<li>node å®¢æˆ·ç«¯</li>
</ul>
<h3> è£… git ç¯å¢ƒ</h3>
<ul>
<li>
<p>å®‰è£… git:</p>
<p>git å®‰è£…æ—¶æŒ‰ç…§é»˜è®¤çš„é…ç½®ï¼Œä¸€è·¯ç‚¹å‡»ç¡®å®šå°±å¯ä»¥ã€‚</p>
</li>
<li>
<p>å®‰è£… github å®¢æˆ·ç«¯ï¼ˆå¯é€‰ï¼Œå¦‚æœç†Ÿæ‚‰ git å‘½ä»¤å¯ä»¥ç›´æ¥å‘½ä»¤è¡Œæ“ä½œï¼‰</p>
<p>github å®‰è£…åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>ç”¨å®˜ç½‘çš„å®‰è£…åŒ…ï¼Œåœ¨å®‰è£…çš„æ—¶å€™éœ€è¦ä»ç½‘ä¸Šä¸‹è½½èµ„æ–™ï¼Œå—ç½‘é€Ÿé™åˆ¶ï¼Œè¿™ç§æ–¹æ³•å¾ˆæ…¢ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ï¼›</li>
<li>ç›´æ¥æ‰¾ä¸€ä»½ github ç¦»çº¿å®‰è£…åŒ…è§£å‹åˆ°æœ¬åœ°å³å¯ä½¿ç”¨ï¼Œæˆ‘å°±æ˜¯ä½¿ç”¨åä¸€ç§æ–¹æ³•ã€‚</li>
</ul>
</li>
</ul>
<h3> å®‰è£… node</h3>
<p>å®‰è£… node å®¢æˆ·ç«¯ï¼š</p>
<p>ä¸‹è½½å¹¶å®‰è£… node ,æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ node-v5.7.1-x64ã€‚</p>
<h3> æ ¡éªŒç¯å¢ƒ</h3>
<p>åœ¨å®‰è£…å®Œ git, node ä¹‹å<code>win é”® + R</code> è¾“å…¥ <code>cmd</code> æ‰“å¼€ windows è‡ªå¸¦ç»ˆç«¯çª—å£ï¼›</p>
<p>åˆ†åˆ«è¾“å…¥<code>git</code> ã€ <code>npm</code>ä¹‹åï¼Œå¦‚æœæ˜¾ç¤ºå‡º <em>å¸®åŠ©ä¿¡æ¯</em> è€Œé <em>â€œä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶â€</em> è¿™æ ·çš„æç¤ºï¼Œå°±è¯´æ˜ git å’Œ node å·²ç»é…ç½®å¥½äº†ç¯å¢ƒå˜é‡ï¼Œå¦åˆ™å°±éœ€è¦æ‰‹åŠ¨é…ç½®ã€‚</p>
<h4> é…ç½®ç¯å¢ƒå˜é‡æ–¹æ³•ï¼š</h4>
<ul>
<li>æ­¤ç”µè„‘ â€“&gt; å³é”® â€“&gt; å±æ€§ â€“&gt; é«˜çº§ç³»ç»Ÿè®¾ç½® â€“&gt; ç¯å¢ƒå˜é‡</li>
<li>æ‰¾åˆ°ç”¨æˆ·ç¯å¢ƒå˜é‡ â€“&gt; pathï¼Œå¹¶æ·»åŠ  git å’Œ npm çš„å®‰è£…è·¯å¾„ã€‚</li>
</ul>
<blockquote>
<p>æ›´è¯¦ç»†çš„æ•™ç¨‹å¯ä»¥å‚è€ƒè¿™é‡Œï¼š<a href="https://www.google.com/search?q=%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" target="_blank" rel="noopener noreferrer">å¦‚ä½•ä¿®æ”¹ç¯å¢ƒå˜é‡</a></p>
</blockquote>
<p>è¿™æ ·å­ git å’Œ node åº”è¯¥å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚</p>
<h2> å®‰è£…é…ç½® hexo</h2>
<h3> å®‰è£… hexo</h3>
<p>æ‰“å¼€å‘½ä»¤è¡Œï¼Œå…¨å±€å®‰è£… Hexo ,åŠ  -g å‚æ•°ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥çœ‹ hexo ç‰ˆæœ¬</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç»“æœï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ°è¿™é‡Œ hexo å°±åœ¨ç”µè„‘ä¸Šé¢å®‰è£…å¥½äº†ã€‚</p>
<h3> é…ç½® hexo</h3>
<ul>
<li>è¿›å…¥å­˜æ”¾ hexo æ–‡ä»¶çš„ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ blog å­˜å‚¨ hexo çš„æ–‡ä»¶</li>
</ul>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç„¶åè¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¯åŠ¨ hexo æœåŠ¡å™¨</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰“å¼€æœ¬åœ°åœ°å€ï¼š<a href="http://localhost:4000/" target="_blank" rel="noopener noreferrer">http://localhost:4000/</a> ï¼Œå°±å¯ä»¥çœ‹åˆ°æœ¬åœ°æ­å»ºå¥½çš„ hexo åšå®¢äº†<br>
è¿™æ ·å­ä¸€ä¸ª hexo åšå®¢å°±åœ¨æœ¬åœ°æ­å»ºå¥½äº†</p>
<h3> ç›®å½•çš„è§£é‡Šï¼š</h3>
<p>scaffolds è„šæ‰‹æ¶ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå·¥å…·æ¨¡æ¿ scripts å†™æ–‡ä»¶çš„ jsï¼Œæ‰©å±• hexo çš„åŠŸèƒ½<br>
source å­˜æ”¾åšå®¢æ­£æ–‡å†…å®¹<br>
source/_drafts è‰ç¨¿ç®±<br>
source/_posts æ–‡ä»¶ç®±<br>
themes å­˜æ”¾çš®è‚¤çš„ç›®å½•<br>
themes/landscape é»˜è®¤çš„çš®è‚¤<br>
_config.yml å…¨å±€çš„é…ç½®æ–‡ä»¶<br>
db.json é™æ€å¸¸é‡</p>
<h3> ä¸€äº› hexo è¯­å¥è§£é‡Š</h3>
<p>help æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯<br>
init åˆ›å»ºä¸€ä¸ª hexo é¡¹ç›®<br>
migrate ä»å…¶ä»–ç³»ç»Ÿå‘ hexo è¿ç§»<br>
version æŸ¥çœ‹ hexo çš„ç‰ˆæœ¬<br>
â€“config å‚æ•°ï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œä»£æ›¿é»˜è®¤çš„_config.yml<br>
â€“debug å‚æ•°ï¼Œè°ƒè¯•æ¨¡å¼ï¼Œè¾“å‡ºæ‰€æœ‰æ—¥å¿—ä¿¡æ¯<br>
â€“safe å‚æ•°ï¼Œå®‰å…¨æ¨¡å¼ï¼Œç¦ç”¨æ‰€æœ‰çš„æ’ä»¶å’Œè„šæœ¬<br>
â€“silent å‚æ•°ï¼Œæ— æ—¥å¿—è¾“å‡ºæ¨¡å¼</p>
<h3> æ–°å»ºæ–‡ç« </h3>
<p>å‘½åä¸ºâ€œæ–°çš„æ–‡ç« â€ï¼Œè¾“å…¥å‘½ä»¤ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>hexo é»˜è®¤ç”Ÿæˆ md æ–‡ä»¶ï¼Œæ–°ç”Ÿæˆçš„æ–‡ç« åœ¨ç›®å½•ï¼š.\blog\source_posts\æ–°çš„æ–‡ç« .mdï¼Œå¯¹å…¶è¿›è¡Œç›¸åº”çš„ç¼–è¾‘å³å¯<br>
æ–‡ç« æ ¼å¼ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>æˆ–è€…ä½ ä¹Ÿå¯ä»¥ç›´æ¥è‡ªå·±åœ¨å¯¹åº”ä½ç½®æ–°å»º file_name.md æ–‡ä»¶ï¼ˆå¸¸ç”¨ï¼‰</p>
</blockquote>
<h2> é…ç½® github</h2>
<ul>
<li>æ³¨å†Œå¹¶ç™»å½• github<br>
è¿›å…¥ <a href="https://github.com/" target="_blank" rel="noopener noreferrer">https://github.com/</a> ï¼Œæ³¨å†Œæ–°è´¦æˆ·ï¼Œå¹¶ä¸”ç™»å½•</li>
<li>æ–°å»º respositoy<br>
åœ¨ä¸»é¡µç‚¹å‡» New respositoy æ–°å»ºä¸€ä¸ªåå­—ä¸º <a href="http://yourname.github.io" target="_blank" rel="noopener noreferrer">yourname.github.io</a><br>
çš„ respositoyï¼›</li>
<li>è®¾ç½®æ–°å»ºä¸€ä¸ª github pages<br>
è¿›å…¥ä»“åº“ä¸»é¡µï¼Œé€‰æ‹© settings --&gt; github pages --&gt; Launch automatic page generator ,æŒ‰ç…§é»˜è®¤çš„ä¸»é¢˜é…ç½®é€‰æ‹©ä¸€ä¸ªå°±å¥½</li>
</ul>
<h2> ä¸Šä¼ ç½‘ç«™</h2>
<p>å¯¹äº hexo çš„ç›¸å…³é…ç½®ï¼š<br>
æ‰“å¼€_config.ymlï¼Œä¿®æ”¹ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤„ç”±äºæˆ‘æ˜¯å°†ç½‘ç«™æ”¾åœ¨äºŒçº§ç›®å½• ./blog/ ä¸‹é¢ï¼Œæ‰€ä»¥ root ç›®å½•è®¾ç½®å¦‚æ­¤ï¼Œä½¿ç”¨çš„æ˜¯ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºçš„æ—¶å€™ï¼Œcss ç­‰ç”±äºè·¯å¾„ä¸å¯¹ï¼ŒåŠ è½½å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚</p>
<h3> éƒ¨ç½²æ–¹æ³• 1</h3>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™è¡Œè¯­å¥æ˜¯ä½¿ç”¨ hexo è‡ªåŠ¨ deploy åˆ° github æ—¶çš„è®¾ç½®ï¼Œ~å¦‚æœæ­£å¸¸çš„è¯ï¼Œå½“ç”¨ hexo å¯¹ç½‘ç«™é™æ€åŒ–å¤„ç†åï¼Œå†æ‰§è¡Œ hexo deploy å°±å¯ä»¥è‡ªåŠ¨éƒ¨ç½²åˆ° github ä¸Šé¢äº†ï¼Œä½†æ˜¯æˆ‘çš„ç”µè„‘ git æˆ–è€… node ç”±äºæ˜¯ä¸åŒæ—¶é—´è£…çš„æœŸé—´è¿˜é‡è£…äº†å‡ æ¬¡ç³»ç»Ÿï¼Œå¯èƒ½å¯¼è‡´æŸäº›è®¾ç½®æœ‰è¯¯ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œ hexo deploy çš„æ—¶å€™ä¸€ç›´æç¤ºæœ‰é—®é¢˜ï¼Œæ•…è€Œé‡‡ç”¨å¦ä¸€ç§åŠæ³•æ‰‹åŠ¨åŒæ­¥ç½‘ç«™ï¼Œè¿™å¥è¯ä¹Ÿå¯ä»¥ä¸ä¿®æ”¹ã€‚~</p>
<h3> éƒ¨ç½²æ–¹æ³• 2</h3>
<ul>
<li>
<p>ç”¨ hexo å¯¹æ–‡ç« è¿›è¡Œé™æ€åŒ–å¤„ç†ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
</ul>
<p>åœ¨<code>blog\public</code>ç›®å½•ä¸‹ç”Ÿæˆçš„ <code>public</code> åŒ…å«æ‰€æœ‰çš„é™æ€åŒ–æ–‡ä»¶ï¼Œæ­¤æ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å†…æ‰€æœ‰çš„å†…å®¹å°±æ˜¯å¤„ç†å¥½çš„ç½‘ç«™ï¼Œå°†å…¶å‘å¸ƒåˆ°åˆé€‚çš„ç©ºé—´å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚<br>
ç”±äºä¹‹å‰çš„ git æˆ–è€… node é…ç½®æœ‰è¯¯ï¼Œæ‰€ä»¥è¿™æ—¶å€™é‡‡ç”¨æ‰‹åŠ¨åŒæ­¥ç½‘ç«™ï¼š</p>
<ul>
<li>å°†ä¸Šæ¬¡åœ¨ github ä¸Šå»ºç«‹çš„é¡¹ç›® <a href="http://yourname.github.io" target="_blank" rel="noopener noreferrer">yourname.github.io</a><br>
åŒæ­¥åˆ°æœ¬åœ°ã€‚<br>
åŒæ­¥çš„æ–¹æ³•å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯ä½¿ç”¨ github çš„ windows å®¢æˆ·ç«¯ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼š</li>
</ul>
<p>æ‰“å¼€ github å®¢æˆ·ç«¯ï¼Œæ‰¾åˆ°é¡¹ç›®ï¼Œé€‰æ‹© clone åˆ°æœ¬åœ°å³å¯ã€‚</p>
<p>ä¹‹åæ‰“å¼€åŒæ­¥çš„é¡¹ç›®ï¼Œç¡®è®¤å½“å‰çš„ branch æ˜¯ masterï¼Œå¦åˆ™åŒæ­¥ä¹‹åç½‘ç«™ä¸ä¼šæ˜¾ç¤ºã€‚</p>
<p>åœ¨ github åŒæ­¥çš„ç›®å½•ä¸‹æ‰¾åˆ°ä¸Šæ¬¡å»ºå¥½çš„é¡¹ç›®<code>yourname.github.io</code>,è¿›å…¥ä¹‹åï¼Œå°†ä¸Šæ–‡è·å¾—åˆ°çš„ public å†…å®¹æ”¾å…¥ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯å°†åšå®¢æ”¾åœ¨å­ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ª blog æ–‡ä»¶å¤¹ç”¨äºæ”¾ç½®åšå®¢ï¼Œæ‰€ä»¥å°±æ˜¯å°† public<br>
å…¨éƒ¨å†…å®¹ æ”¾å…¥./yourname.github.io/blog/ ç›®å½•ä¸‹ï¼Œè¿™æ ·å­åœ¨ç½‘ç«™ä¸Šæ˜¾ç¤ºçš„æ—¶å€™ï¼Œåšå®¢çš„ç½‘å€å°±æ˜¯ <a href="http://yourname.github.io/blog/" target="_blank" rel="noopener noreferrer">http://yourname.github.io/blog/</a></p>
<p>è¿™æ ·ä¸€ä¸ªç®€å•çš„åˆ©ç”¨ github æ‰˜ç®¡çš„ hexo åšå®¢å°±æ­å»ºå¥½äº†ã€‚</p>
<blockquote>
<p>æ³¨ï¼šæœ¬æ–‡å†…å®¹æ˜¯æ ¹æ®æˆ‘å»ºç«‹åšå®¢æ—¶çš„åšæ³•æ•´ç†è€Œæˆï¼Œå…¶ä¸­æœ‰éƒ¨åˆ†å†…å®¹æ˜¯å‚è€ƒç½‘ä¸Šçš„æ•™ç¨‹ï¼Œæ–‡ä¸­å¼•ç”¨çš„æ–‡å­—å…¨éƒ¨æ¥è‡ª<a href="http://blog.fens.me/hexo-bootstarp-github/" target="_blank" rel="noopener noreferrer">http://blog.fens.me/hexo-bootstarp-github/</a> ï¼Œæ­¤æ–‡å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ï¼Œæ„Ÿè°¢ä½œè€…å¼ ä¸¹ (Conan) çš„åˆ†äº«ã€‚</p>
</blockquote>
]]></content:encoded>
    </item>
    <item>
      <title>åŠ è½½å·²å®‰è£…åº”ç”¨ã€æœªå®‰è£… apk ä¸­çš„èµ„æº</title>
      <link>https://jixiaoyong.github.io/blog/posts/8d60b485.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/8d60b485.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">åŠ è½½å·²å®‰è£…åº”ç”¨ã€æœªå®‰è£… apk ä¸­çš„èµ„æº</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 15 Apr 2018 13:40:32 GMT</pubDate>
      <content:encoded><![CDATA[<p>åŠ è½½å·²å®‰è£…åº”ç”¨ã€æœªå®‰è£… apk ä¸­çš„èµ„æºï¼Œå…¶æ€è·¯ä¸»è¦æ˜¯è·å–åˆ°å¯¹åº”çš„ ClassLoader/Contextï¼Œé€šè¿‡ ClassLoader åŠ è½½ R.java ç­‰ç±»ï¼Œå†é€šè¿‡åå°„è·å–å¯¹åº”çš„èµ„æº id åŠèµ„æºã€‚</p>
<h2> åŠ è½½å·²å®‰è£…åº”ç”¨èµ„æº</h2>
<h3> sharedUserId</h3>
<p>åœ¨å½“å‰åº”ç”¨ä¸­åŠ è½½å·²å®‰è£…çš„å…¶ä»–åº”ç”¨èµ„æºï¼Œéœ€è¦äºŒè€…æœ‰ç›¸åŒçš„<code>sharedUserId</code>ï¼Œè¿™æ · Android ç³»ç»Ÿä¸ºäºŒè€…åˆ†é…åŒä¸€ä¸ª Linux ç”¨æˆ· IDï¼Œä¸¤ä¸ª App å¯ä»¥ç›¸äº’è®¿é—®ä»£ç ã€èµ„æºç­‰ã€‚</p>
<blockquote>
<p>é€šè¿‡ Shared User idï¼Œæ‹¥æœ‰åŒä¸€ä¸ª User id çš„å¤šä¸ª APK å¯ä»¥é…ç½®æˆè¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚æ‰€ä»¥é»˜è®¤å°±æ˜¯å¯ä»¥äº’ç›¸è®¿é—®ä»»æ„æ•°æ®ã€‚ä¹Ÿå¯ä»¥é…ç½®æˆè¿è¡Œæˆä¸åŒçš„è¿›ç¨‹ï¼ŒåŒæ—¶å¯ä»¥è®¿é—®å…¶ä»– APK çš„æ•°æ®ç›®å½•ä¸‹çš„æ•°æ®åº“å’Œæ–‡ä»¶ã€‚å°±åƒè®¿é—®æœ¬ç¨‹åºçš„æ•°æ®ä¸€æ ·ã€‚</p>
<p><a href="https://blog.csdn.net/jiangwei0910410003/article/details/51316688" target="_blank" rel="noopener noreferrer">Android é€†å‘ä¹‹æ—…---Android ä¸­çš„ sharedUserId å±æ€§è¯¦è§£ - CSDN åšå®¢</a></p>
</blockquote>
<p>å…·ä½“è®¾ç½®æ–¹æ³•å¦‚ä¸‹</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ç­›é€‰æ‰€æœ‰å·²å®‰è£…åº”ç”¨ä¿¡æ¯</h3>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ç”Ÿæˆæ’ä»¶ App çš„ Context</h3>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3> é€šè¿‡ Context åå°„è·å–æ’ä»¶ App ä¸­çš„èµ„æº</h3>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> åŠ è½½æœªå®‰è£… Apk å†…èµ„æº</h2>
<h3> è·å– apk ä¿¡æ¯</h3>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> è·å– ClassLoader</h3>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>getDir() è°ƒç”¨äº† Context çš„ getDir()</p>
<p>Retrieve, creating if needed, a new directory in which the application can place its own custom data files. You can use the returned File object to create and access files in this directory. Note that files created through a File object will only be accessible by your own application; you can only set the mode of the entire directory, not of individual files.</p>
</blockquote>
<h3> é€šè¿‡åå°„åŠ è½½ç±»ï¼Œè·å–èµ„æº</h3>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>AssetManager.addAssetPath()</code>æ–¹æ³•æ˜¯ç”¨æ¥å°† apk ç­‰ä¸­çš„èµ„æºæ·»åŠ åˆ°<code>AssetManager</code>ä¸­ï¼Œå†é€šè¿‡å…¶è·å–åˆ°<code>Resourceså¯¹è±¡</code>ï¼Œè¿™æ ·å°±è·å–åˆ°æœªå®‰è£… apk ä¸­çš„èµ„æºäº†ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å‚è€ƒèµ„æº</h2>
<p><a href="https://www.cnblogs.com/lee0oo0/p/3665066.html" target="_blank" rel="noopener noreferrer">Android ä¹‹ Android apk åŠ¨æ€åŠ è½½æœºåˆ¶çš„ç ”ç©¶ï¼ˆäºŒï¼‰ï¼šèµ„æºåŠ è½½å’Œ activity ç”Ÿå‘½å‘¨æœŸç®¡ç† - lee0oo0 - åšå®¢å›­ </a></p>
<p><a href="https://blog.csdn.net/jiangwei0910410003/article/details/51316688" target="_blank" rel="noopener noreferrer">Android é€†å‘ä¹‹æ—…---Android ä¸­çš„ sharedUserId å±æ€§è¯¦è§£ - CSDN åšå®¢</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>æ•°æ®ç»“æ„_Hash è¡¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/1f6681a0.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/1f6681a0.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">æ•°æ®ç»“æ„_Hash è¡¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sun, 23 Dec 2018 09:35:36 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>Hash è¡¨æ˜¯ä¸€ç§å¯ä»¥å¿«é€Ÿæ’å…¥å’ŒæŸ¥æ‰¾çš„æ•°æ®ç»“æ„ï¼Œå°†æ•°æ®ä¿å­˜åœ¨é€šè¿‡ hash å‡½æ•°è®¡ç®—å¾—åˆ°çš„ä¸‹æ ‡ä¸­ã€‚</p>
<p>æ’å…¥å’Œåˆ é™¤ æ‰€éœ€æ—¶é—´ä¸º O(1)ã€‚åœ¨ç¡®å®šå®¹é‡ã€æ— éœ€éå†æ—¶æ•ˆæœæœ€å¥½ã€‚</p>
<p>å½“å…¶å¤§å°æ¥è¿‘å®¹é‡æ—¶ï¼Œæ•ˆç‡ä¼šå˜å¾—å¾ˆå·®ã€‚</p>
<h2> å­˜å‚¨æ–¹å¼</h2>
<p>Hash è¡¨æœ‰ä¸¤ç§å­˜å‚¨æ–¹å¼</p>
<ol>
<li>
<p>å¼€æ”¾åœ°å€æ³•</p>
<p>å¼€æ”¾åœ°å€æ³•ï¼Œç›´æ¥å°†æ•°æ®å­˜å‚¨åœ¨æ•°ç»„ä¸­ã€‚</p>
<p>å½“ hash ç®—å‡ºçš„åœ°å€å·²ç»è¢«å ç”¨æ—¶ï¼Œåˆ™èµ°è¿‡ä¸€å®šçš„æ­¥é•¿æ‰¾åˆ°å¦å¤–ä¸€ä¸ªç©ºä½ï¼ˆåœ¨å¡«å……è´¨æ•°å¾ˆå¤§æ—¶å°±ä¼šå¾ˆè€—æ—¶ï¼‰å¹¶ä¿å­˜æ•°æ®ã€‚</p>
</li>
<li>
<p>é“¾åœ°å€æ³•</p>
<p>é“¾åœ°å€æ³•ï¼Œåˆ›å»ºä¿å­˜æ•°æ®çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„ä¸­ä¸ç›´æ¥ä¿å­˜æ•°æ®ï¼Œè€Œæ˜¯ä¿å­˜ä¸€ä¸ªç”¨æ¥å­˜å‚¨è¿™äº›æ•°æ®çš„é“¾è¡¨ï¼Œå°†æ•°æ®é¡¹ç›´æ¥å­˜å‚¨çš„é“¾è¡¨ä¸­ã€‚</p>
<p>å½“ hash ç®—æ³•è®¡ç®—å‡ºçš„åœ°å€æ—¶ï¼Œéå†æ•°ç»„ä¸­å¯¹åº”çš„é“¾è¡¨æ‰¾åˆ°ç©ºä½å¹¶ä¿å­˜ã€‚</p>
</li>
</ol>
<p>å…¶ä¸­ï¼Œå¼€æ”¾åœ°å€æ³•åˆåˆ†ä¸º 3 ç§å®ç°ï¼š</p>
<ul>
<li>
<p>çº¿æ€§æ¢æµ‹</p>
<p>æ¯æ¬¡å‰è¿›çš„æ­¥é•¿ä¸º 1</p>
<p>å³æŸ¥æ‰¾çš„ä½ç½®ä¾æ¬¡æ˜¯<code>x + 1,2,3,4,5,â€¦â€¦</code></p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p>äºŒæ¬¡æ¢æµ‹</p>
<p>æ¯æ¬¡å‰è¿›çš„æ­¥é•¿ä¸ºå½“å‰æŸ¥æ‰¾æ¬¡æ•°çš„å¹³æ–¹</p>
<p>å³æŸ¥æ‰¾çš„ä½ç½®ä¾æ¬¡æ˜¯<code>x + 1,4,9,â€¦â€¦</code></p>
<div class="language-text line-numbers-mode" data-ext="text"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p>å†å“ˆå¸Œæ³•</p>
<p>æ¯æ¬¡å‰è¿›çš„æ­¥é•¿æ˜¯æ ¹æ®å¦å¤–ä¸€ä¸ª hash ç®—æ³•è®¡ç®—å‡ºæ¥çš„å€¼</p>
<p>è¿™ä¸ªç®—æ³•è¦æ±‚å¦‚ä¸‹ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å·²ç»æœ‰ä¸€ä¸ªå…¬è®¤çš„æ¯”è¾ƒå¥½çš„äºŒæ¬¡ hash ç®—æ³•ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ul>
<h2> æ¯”è¾ƒ</h2>
<p><strong>å†å“ˆå¸Œæ³• VS äºŒæ¬¡æ¢æµ‹æ³•</strong></p>
<p>åœ¨å°å‹å“ˆå¸Œè¡¨ä¸­ï¼Œå†å“ˆå¸Œæ³•æ¯”äºŒæ¬¡æ¢æµ‹å¥½ï¼›</p>
<p>ä½†å¦‚æœå®¹é‡å……è¶³ï¼Œå¹¶ä¸”å®¹é‡å¤§å°ä¸å†å˜åŒ–æ—¶ï¼ŒäºŒæ¬¡æ¢æµ‹æ•ˆæœå¥½ï¼Œåœ¨è£…å¡«å› å­å°äº 0.5 æ—¶å‡ ä¹æ²¡æœ‰æ€§èƒ½æŸå¤±</p>
<p><strong>å¼€æ”¾åœ°å€æ³• VS é“¾åœ°å€æ³•</strong></p>
<p>hash è¡¨å®¹å™¨å¤§å°æœªçŸ¥æ—¶ï¼Œç”¨é“¾åœ°å€æ³•æ¯”è¾ƒå¥½</p>
<p>å½“è£…å¡«å› å­å˜å¾—å¾ˆå¤§æ—¶ï¼Œå¼€æ”¾åœ°å€æ³•æ€§èƒ½ä¸‹é™å¾ˆå¿«ï¼Œä½†é“¾åœ°å€æ³•åªæ˜¯çº¿æ€§ä¸‹é™ã€‚</p>
<h2> æºç </h2>
<p><a href="https://github.com/jixiaoyong/Notes-Files/blob/master/AndroidLearningResource/java_note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/tree/Hash.kt" target="_blank" rel="noopener noreferrer">ğŸ‘‰ ç‚¹è¿™é‡Œ</a>æŸ¥çœ‹æºç </p>
]]></content:encoded>
    </item>
    <item>
      <title>æ•°æ®ç»“æ„_äºŒå‰æ ‘</title>
      <link>https://jixiaoyong.github.io/blog/posts/101c73f.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/101c73f.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">æ•°æ®ç»“æ„_äºŒå‰æ ‘</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 03 Jan 2019 14:09:40 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>æœ¬æ–‡ä»‹ç»äº†äºŒå‰æ ‘ï¼ŒåŠå…¶åº”ç”¨ã€‚</p>
<p>æ ‘ï¼Œæ—¢èƒ½åƒé“¾è¡¨é‚£æ ·å¿«é€Ÿæ’å…¥å’Œåˆ é™¤ï¼Œåˆå¯ä»¥åƒæ•°ç»„é‚£æ ·å¿«é€ŸæŸ¥æ‰¾ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20190103200423.png" alt="æ ‘" tabindex="0" loading="lazy"><figcaption>æ ‘</figcaption></figure>
<p>æ¯æ£µæ ‘æœ‰ä¸”åªæœ‰ä¸€ä¸ª<strong>æ ¹</strong>ï¼Œä»æ ¹åˆ°ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹<strong>æœ‰ä¸”åªæœ‰ä¸€æ¡è·¯å¾„</strong>ï¼›æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æœ‰ 0 ä¸ªæˆ–è€…å¤šä¸ª<strong>å­èŠ‚ç‚¹</strong>ï¼Œæ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹å«åš<strong>å¶å­èŠ‚ç‚¹</strong>ã€‚</p>
<p><strong>å±‚</strong>æ˜¯æŒ‡ä»æ ¹èŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„â€œä»£â€æ ‘ï¼Œæ ¹èŠ‚ç‚¹çš„åœ¨<strong>0 å±‚</strong>ã€‚</p>
<h2> äºŒå‰æœç´¢æ ‘</h2>
<p>ä¸€ä¸ªèŠ‚ç‚¹åªèƒ½æœ‰ 0~2 ä¸ªå­èŠ‚ç‚¹çš„æ ‘å«åš<strong>äºŒå‰æ ‘</strong>ï¼›</p>
<p>å¦‚æœäºŒå‰æ ‘çš„å·¦å­èŠ‚ç‚¹çš„å…³é”®å­—å°äºè¯¥èŠ‚ç‚¹ï¼Œå³å­èŠ‚ç‚¹çš„å…³é”®å­—å¤§äºè¯¥èŠ‚ç‚¹ï¼Œåˆ™è¯¥äºŒå‰æ ‘ç§°ä¸º<strong>äºŒå‰æœç´¢æ ‘</strong>ã€‚</p>
<p>å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªäºŒå‰æ ‘çš„èŠ‚ç‚¹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> éå†</h3>
<p>éå†æ ‘æŒ‡å®‰è£…ä¸€å®šçš„é¡ºåºè®¿é—®æ•°çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‰ç…§è®¿é—®èŠ‚ç‚¹çš„é¡ºåºä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š</p>
<ul>
<li>å‰åºéå†</li>
<li>ä¸­åºéå†</li>
<li>ååºéå†</li>
</ul>
<p>ä»¥ä¸­åºéå†ä¸ºä¾‹ï¼Œå…¶è®¿é—®èŠ‚ç‚¹çš„é¡ºåºå¦‚ä¸‹ï¼š</p>
<ol>
<li>è°ƒç”¨è‡ªèº«éå†è¯¥èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼›</li>
<li>è®¿é—®è¿™ä¸ªèŠ‚ç‚¹ï¼›</li>
<li>è°ƒç”¨è‡ªèº«éå†è¯¥èŠ‚ç‚¹çš„å³å­æ ‘ã€‚</li>
</ol>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> æœ€å¤§å€¼å’Œæœ€å°å€¼</h3>
<p>äºŒå‰æœç´¢æ ‘çš„æœ€å¤§å€¼æ˜¯å³å­æ ‘ä¸­æœ€å³ç«¯æ²¡æœ‰å­èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼›</p>
<p>äºŒå‰æœç´¢æ ‘çš„æœ€å°å€¼æ˜¯å·¦å­æ ‘ä¸­æœ€å·¦ç«¯æ²¡æœ‰å­èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ã€‚</p>
<h3> åˆ é™¤</h3>
<p>äºŒå‰æœç´¢æ ‘å› ä¸ºèŠ‚ç‚¹è¦æ»¡è¶³<code>å·¦å­èŠ‚ç‚¹ &lt; èŠ‚ç‚¹ &lt; å³å­èŠ‚ç‚¹</code>è¿™ä¸ªæ¡ä»¶ï¼Œæ‰€ä»¥åˆ é™¤éœ€è¦åˆ†ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p>
<p>æŒ‰ç…§è¦åˆ é™¤çš„èŠ‚ç‚¹å­èŠ‚ç‚¹æ•°ç›®çš„ä¸åŒï¼Œåˆ†ä¸º 3 ç§æƒ…å†µ</p>
<ul>
<li>
<p>è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶èŠ‚ç‚¹ å°†å…¶çˆ¶èŠ‚ç‚¹çš„æŒ‡å‘è®¾ä¸º null å³å¯</p>
</li>
<li>
<p>è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸”åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ å°†å…¶çˆ¶èŠ‚ç‚¹æŒ‡å‘å…¶å­èŠ‚ç‚¹</p>
</li>
<li>
<p>è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ è¿™æ—¶å€™å¯ä»¥æ‰¾è¯¥å­èŠ‚ç‚¹çš„å³å­æ ‘ä¸­æœ€å°çš„ï¼ˆæˆ–è€…å·¦å­æ ‘ä¸­æœ€å¤§çš„ï¼‰èŠ‚ç‚¹å¹¶æ›¿æ¢æ‰è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œ</p>
<p>ä¸æ­¤åŒæ—¶å¦‚æœè¿™ä¸ªèŠ‚ç‚¹æœ‰å³å­èŠ‚ç‚¹ï¼ˆæˆ–å¯¹åº”çš„å·¦å­èŠ‚ç‚¹ï¼‰åˆ™æŒ‰ç…§ 2/3 çš„è§„åˆ™å¤„ç†ï¼Œè¿™æ ·å°±èƒ½ä¿è¯è¿™ä¸ªæ ‘çš„ç»“æ„ä¸ä¼šå‡ºé”™</p>
</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> å“ˆå¤«æ›¼ç¼–ç </h2>
<p>å“ˆå¤«æ›¼ç¼–ç ç”¨æ¥å¯¹ä¸€æ®µæ–‡æœ¬è¿›è¡Œå‹ç¼©ï¼Œè§£å‹ã€‚</p>
<blockquote>
<p>å‹ç¼©ï¼šç”¨å­—ç¬¦çš„ç¼–ç æ›¿ä»£å­—ç¬¦</p>
<p>è§£å‹ï¼šç”¨å­—ç¬¦ä»£æ›¿å¯¹åº”çš„ç¼–ç </p>
</blockquote>
<p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>

</li>
<li>

</li>
<li>

</li>
<li>

</li>
</ul>
<p>å…¶è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20190103203447.png" alt="å“ˆå¤«æ›¼ç¼–ç ç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>å“ˆå¤«æ›¼ç¼–ç ç¤ºæ„å›¾</figcaption></figure>
<h2> æºç </h2>
<p><a href="https://github.com/jixiaoyong/Notes-Files/blob/master/AndroidLearningResource/java_note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/tree/BinaryTree.kt" target="_blank" rel="noopener noreferrer">ğŸ‘‰ ç‚¹è¿™é‡Œ</a> æŸ¥çœ‹<code>äºŒå‰æ ‘</code>æºç </p>
<p><a href="https://github.com/jixiaoyong/Notes-Files/blob/master/AndroidLearningResource/java_note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/tree/HuffmanCodeUtils.kt" target="_blank" rel="noopener noreferrer">ğŸ‘‰ ç‚¹è¿™é‡Œ</a> æŸ¥çœ‹<code>å“ˆå¤«æ›¼ç¼–ç </code>æºç </p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20190103200423.png" type="image/png"/>
    </item>
    <item>
      <title>æ•°æ®ç»“æ„_å›¾</title>
      <link>https://jixiaoyong.github.io/blog/posts/a71f2ecc.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/a71f2ecc.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">æ•°æ®ç»“æ„_å›¾</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Thu, 27 Dec 2018 15:59:36 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p><strong>å›¾</strong>ï¼Œæ˜¯ç”±å¯ä»¥æœ‰å¤šä¸ªè¾¹çš„é¡¶ç‚¹ç»„æˆçš„ç»“æ„ã€‚</p>
<p>ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´æœ‰è¾¹è¿æ¥ï¼Œåˆ™ç§°è¿™ä¸¤ä¸ªé¡¶ç‚¹æ˜¯<strong>é‚»æ¥</strong>çš„ã€‚</p>
<p>å‡ ä¸ªç›¸äº’é‚»æ¥çš„é¡¶ç‚¹ç»„æˆçš„çº¿å«åš<strong>è·¯å¾„</strong>,è‡³å°‘æœ‰ä¸€æ¡è·¯å¾„å¯ä»¥åˆ°è¾¾æ‰€æœ‰é¡¶ç‚¹çš„å›¾å«åš<strong>è¿é€šå›¾</strong>ã€‚</p>
<p>å¦‚æœå›¾çš„é¡¶ç‚¹åªèƒ½ä» Aâ†’Bï¼Œä¸èƒ½ä» Bâ†’Aï¼Œå°±ç§°å›¾æ˜¯<strong>æœ‰å‘å›¾</strong>ã€‚</p>
<p>å¦‚æœè¾¹è¢«èµ‹äºˆä¸€å®šçš„æƒå€¼ï¼ˆæ•°å­—ï¼‰ï¼Œå°±ç§°å›¾ä¸º<strong>å¸¦æƒå›¾</strong></p>
<img width="30%" height="30%" src="https://jixiaoyong.github.io/images/20181227232301.png">
<h2> å­˜å‚¨æ–¹å¼</h2>
<p>å›¾ä¸€èˆ¬æœ‰ä¸¤ç§å­˜å‚¨æ–¹å¼ï¼š</p>
<ul>
<li>
<p>é‚»æ¥çŸ©é˜µ ç”¨ N*N çš„æ•°ç»„ä¿å­˜å›¾ä¸­æ‰€æœ‰çš„é¡¶ç‚¹ï¼Œ<code>Arr[m][n]</code>å³è¡¨ç¤º mã€n é¡¶ç‚¹æ˜¯å¦é‚»æ¥ï¼ˆY:1,N:0ï¼‰ã€‚</p>
<p>æ¯”è¾ƒå åœ°æ–¹ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20181227233341.png" alt="é‚»æ¥çŸ©é˜µ" tabindex="0" loading="lazy"><figcaption>é‚»æ¥çŸ©é˜µ</figcaption></figure>
</li>
<li>
<p>é‚»æ¥è¡¨ ç”¨ä¸€ä¸ª N å¤§å°çš„æ•°ç»„ä¿å­˜ï¼Œæ•°ç»„å…ƒç´ æ˜¯ä¿å­˜ç€é¡¶ç‚¹å’Œä»–æ‰€æœ‰çš„é‚»æ¥ç‚¹çš„é“¾è¡¨ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20181227233435.png" alt="é‚»æ¥è¡¨" tabindex="0" loading="lazy"><figcaption>é‚»æ¥è¡¨</figcaption></figure>
</li>
</ul>
<h2> æ“ä½œ</h2>
<p>å›¾çš„æ“ä½œæœ‰æ’å…¥ï¼ˆé¡¶ç‚¹ï¼‰ï¼Œæœç´¢ç­‰ç­‰ã€‚</p>
<p>ä»¥ä¸‹æ“ä½œä»¥é‚»æ¥è¡¨æ–¹å¼ä¸ºä¾‹ã€‚</p>
<h3> æ’å…¥</h3>
<p>æ’å…¥åˆ†ä¸ºæ’å…¥é¡¶ç‚¹å’Œæ’å…¥è¾¹ã€‚</p>
<p>æ’å…¥è¾¹çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œè¦åŒæ—¶æ›´æ–° start å’Œ end ä¸¤ä¸ªé¡¶ç‚¹å¯¹åº”çš„é“¾è¡¨ã€‚</p>
<h3> ç§»é™¤</h3>
<p>åŸç†åŒæ’å…¥è¾¹ã€‚</p>
<h3> æœç´¢</h3>
<p>æœç´¢è¦æ±‚ä»æŸä¸ªç‰¹å®šé¡¶ç‚¹å¼€å§‹ï¼Œæ²¿ç€è¾¹ç§»åŠ¨åˆ°å…¶ä»–é¡¶ç‚¹ï¼Œç§»åŠ¨å®Œæ¯•åè¦ä¿è¯è®¿é—®äº†æ¯ä¸ªé¡¶ç‚¹ã€‚</p>
<p>æœç´¢åˆåˆ†ä¸º DFSï¼ˆæ·±åº¦ä¼˜å…ˆæœç´¢ï¼‰ã€BFSï¼ˆå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼‰ã€‚</p>
<h4> DFS</h4>
<p>DFS çš„æ€æƒ³æ˜¯ï¼Œä¾æ¬¡æ²¿ç€é¡¶ç‚¹æŸä¸€ä¸ªé‚»æ¥ç‚¹ï¼Œçºµæ·±è®¿é—®ï¼Œå°†è¯¥é‚»æ¥ç‚¹å½“åšæ–°çš„é¡¶ç‚¹å‹å…¥æ ˆä¸­ï¼Œç»§ç»­çºµæ·±è®¿é—®ï¼Œç›´åˆ°æœ‰é¡¶ç‚¹æ²¡æœ‰å¯ä»¥è®¿é—®çš„é‚»æ¥é¡¶ç‚¹ï¼Œå°†å…¶æ‰“å°å‡ºæ¥ï¼ˆä»æ ˆä¸­æ¨å‡ºï¼‰ï¼›ç„¶åå†è¿”å›ä¸Šä¸€å±‚çš„é‚»æ¥é¡¶ç‚¹ä¸­è¿˜å¯ä»¥è®¿é—®çš„é¡¶ç‚¹ï¼ˆæŸ¥æ‰¾å½“å‰æ ˆé¡¶å…ƒç´ æœªè®¿é—®çš„é‚»æ¥ç‚¹ï¼‰ï¼Œç›´åˆ°æ²¡æœ‰å¯ä»¥è®¿é—®çš„é¡¶ç‚¹ã€‚</p>
<p>ç”¨æ ˆå®ç°ï¼Œä¼šå…ˆå¾€æ·±å¤„éå†å®Œä¸€æ¡è·¯å¾„ï¼Œå†éå†ä¸‹ä¸€æ¡ã€‚æ¯ä¸ªé¡¶ç‚¹åªè®¿é—®ä¸€æ¬¡</p>
<p>è§„åˆ™ï¼š</p>
<ul>
<li>

</li>
<li>

</li>
<li>

</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4> BFS</h4>
<p>BFS çš„æ€æƒ³æ˜¯ï¼Œå‘å°†å½“å‰é¡¶ç‚¹çš„æ‰€æœ‰å¯ä»¥è®¿é—®çš„é‚»æ¥ç‚¹è®¿é—®å®Œæ¯•ï¼›ä¹‹åå°†è¯¥é¡¶ç‚¹æ‰“å°ï¼ˆæ¨å‡ºï¼‰ï¼Œå†å»è®¿é—®å…¶é‚»æ¥ç‚¹çš„æ‰€æœ‰å¯ä»¥è®¿é—®é‚»æ¥ç‚¹ï¼ˆä»é˜Ÿåˆ—å¤´å–å‡ºä¸€ä¸ªé¡¶ç‚¹ï¼ŒæŸ¥æ‰¾å…¶æœªè®¿é—®çš„é‚»æ¥ç‚¹ï¼‰ã€‚</p>
<p>ç”¨é˜Ÿåˆ—å®ç°ï¼Œä¼šå…ˆéå†å®Œæœ¬å±‚æ‰€æœ‰çš„é¡¶ç‚¹ï¼Œç„¶åå†ç§»å‘ä¸‹ä¸€å±‚</p>
<p>è§„åˆ™ï¼š</p>
<ul>
<li>

</li>
<li>

</li>
<li>

</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æœ€å°ç”Ÿæˆæ ‘ MST</h2>
<blockquote>
<p>ç”Ÿæˆæ ‘ï¼ˆTemplate:Lang-en-shortï¼‰æ˜¯å…·æœ‰å›¾ G çš„å…¨éƒ¨é¡¶ç‚¹ï¼Œä½†è¾¹æ•°æœ€å°‘çš„è¿é€šå­å›¾ã€‚</p>
<p>â€”â€”ç»´åŸºç™¾ç§‘</p>
</blockquote>
<p>å¸¦æƒå›¾çš„ç”Ÿæˆæ ‘ä¸­ï¼Œæ€»æƒé‡æœ€å°çš„ç§°ä¸ºæœ€å°ç”Ÿæˆæ ‘ã€‚</p>
<p>æœ€å°ç”Ÿæˆæ ‘è¾¹æ¯”é¡¶ç‚¹æ•°å° 1ã€‚</p>
<ul>
<li>
<p>å½“å›¾çš„æ¯ä¸€æ¡è¾¹çš„æƒå€¼éƒ½ç›¸åŒæ—¶ï¼Œè¯¥å›¾çš„æ‰€æœ‰ç”Ÿæˆæ ‘éƒ½æ˜¯æœ€å°ç”Ÿæˆæ ‘ã€‚</p>
</li>
<li>
<p>å¦‚æœå›¾çš„æ¯ä¸€æ¡è¾¹çš„æƒå€¼éƒ½äº’ä¸ç›¸åŒï¼Œé‚£ä¹ˆæœ€å°ç”Ÿæˆæ ‘å°†åªæœ‰ä¸€ä¸ªã€‚</p>
</li>
</ul>
<p>æ— å‘ä¸å¸¦æƒå›¾ä¸­ï¼Œåªéœ€è¦æ‰¾å‡ºæœ€å°æ•°é‡çš„è¾¹å³å¯ã€‚ç”¨ DFS æ¯”è¾ƒå¥½å®ç°ï¼Œå› ä¸ºä»–å¯¹æ¯ä¸ªé¡¶ç‚¹åªè®¿é—®ä¸€æ¬¡ã€‚</p>
<h2> æ‹“æ‰‘æ’åº</h2>
<p>æ‹“æ‰‘æ’åºæ˜¯æŒ‡<strong>æœ‰å‘å›¾</strong>çš„é¡¶ç‚¹æ’åºï¼Œæ»¡è¶³ä»¥ä¸‹æ¡ä»¶<a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">*</a>ï¼š</p>
<ol>
<li>æ¯ä¸ªé¡¶ç‚¹å‡ºç°ä¸”åªå‡ºç°ä¸€æ¬¡ï¼›</li>
<li>è‹¥ A åœ¨åºåˆ—ä¸­æ’åœ¨ B çš„å‰é¢ï¼Œåˆ™åœ¨å›¾ä¸­ä¸å­˜åœ¨ä» B åˆ° A çš„<a href="https://zh.wikipedia.org/wiki/%E8%B7%AF%E5%BE%84_(%E5%9B%BE%E8%AE%BA)" target="_blank" rel="noopener noreferrer">è·¯å¾„</a>ã€‚</li>
</ol>
<p>å®ç°æ€è·¯æ˜¯ï¼š</p>
<ul>
<li>
<p>ä¾æ¬¡æ¨å‡ºæœ‰å‘å›¾ä¸­æ²¡æœ‰åç»§ç‚¹çš„é¡¶ç‚¹ä½œä¸ºæ’åºçš„æœ€åé¡¹ï¼Œè¿™æ˜¯å› ä¸ºæŒ‰ç…§æ‹“æ‰‘æ’åº<code>æ¡ä»¶2</code>æ²¡æœ‰åç»§ç‚¹çš„é¡¶ç‚¹å¿…ç„¶æ’åœ¨åé¢ï¼›</p>
</li>
<li>
<p>å½“å»æ‰æ²¡æœ‰åç»§ç‚¹çš„é¡¶ç‚¹ååˆä¼šäº§ç”Ÿæ–°çš„æ²¡æœ‰åç»§ç‚¹çš„é¡¶ç‚¹ï¼Œè¿™æ ·ä¾æ¬¡å¾ªç¯ï¼Œå½“å›¾ä¸­æ²¡æœ‰é¡¶ç‚¹çš„æ—¶å€™ï¼Œå°±å¯ä»¥åœ¨æœ‰å‘æ— ç¯å›¾ä¸­å®Œæˆæ‹“æ‰‘æ’åºã€‚</p>
</li>
</ul>
<p>å¯¹äºæœ‰ç¯å­˜åœ¨ï¼ˆå³å­˜åœ¨ç±»ä¼¼ Aâ†’Bï¼ŒBâ†’Cï¼ŒCâ†’A çš„æƒ…å†µï¼‰çš„æœ‰å‘å›¾ï¼Œä¼šå‡ºç°æ‰¾ä¸åˆ°<code>æ²¡æœ‰åç»§ç‚¹çš„é¡¶ç‚¹</code>ï¼Œä½†åŒæ—¶<code>å›¾ä¸­é¡¶ç‚¹æ•°ä¸ä¸º0</code>çš„æƒ…å†µï¼Œé‡åˆ°è¿™ç§æƒ…å†µé€€å‡ºå¾ªç¯ï¼Œå¹¶è¯´æ˜æœ‰ç¯å­˜åœ¨å³å¯ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æºç </h2>
<p><a href="https://github.com/jixiaoyong/Notes-Files/blob/master/AndroidLearningResource/java_note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/graph/GraphClazz.kt" target="_blank" rel="noopener noreferrer">ğŸ‘‰ ç‚¹è¿™é‡Œ</a> æŸ¥çœ‹<code>DFS/BFS/MST</code>æºç </p>
<p><a href="https://github.com/jixiaoyong/Notes-Files/blob/master/AndroidLearningResource/java_note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/graph/Digraph.kt" target="_blank" rel="noopener noreferrer">ğŸ‘‰ ç‚¹è¿™é‡Œ</a> æŸ¥çœ‹<code>æ‹“æ‰‘æ’åº</code>æºç </p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://zh.wikipedia.org/wiki/%E6%8B%93%E6%92%B2%E6%8E%92%E5%BA%8F" target="_blank" rel="noopener noreferrer">æ‹“æ‰‘æ’åºâ€”â€”ç»´åŸºç™¾ç§‘</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20181227233341.png" type="image/png"/>
    </item>
    <item>
      <title>æ•°æ®ç»“æ„_å †</title>
      <link>https://jixiaoyong.github.io/blog/posts/b3af796a.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/b3af796a.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">æ•°æ®ç»“æ„_å †</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 25 Dec 2018 12:51:36 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œç”¨ä»–å®ç°çš„ä¼˜å…ˆçº§é˜Ÿåˆ—æ’å…¥å’Œåˆ é™¤æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>L</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(LogN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">L</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2> ç‰¹å¾</h2>
<ol>
<li>å †æ˜¯å®Œå…¨äºŒå‰æ ‘<a href="#%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91">*</a></li>
<li>å¸¸ç”¨æ•°ç»„å®ç°</li>
<li>æ¯ä¸ªå †çš„èŠ‚ç‚¹éƒ½æ»¡è¶³å †çš„æ¡ä»¶ï¼Œå³å †çš„æ¯ä¸ªèŠ‚ç‚¹å…³é”®å­—éƒ½å¤§äºï¼ˆæˆ–ç­‰äºï¼‰å­èŠ‚ç‚¹çš„å…³é”®å­—</li>
</ol>
<p><code>ç‰¹å¾3</code>ä¿è¯äº†æ ¹èŠ‚ç‚¹æ˜¯å †ä¸­æœ€å¤§çš„å€¼ï¼Œä»¥åŠé¡ºç€æŸä¸€ä¸ªèŠ‚ç‚¹ä¸€ç›´åˆ°é‡åˆ°å¶èŠ‚ç‚¹çš„è·¯å¾„ä¸Šçš„èŠ‚ç‚¹å…³é”®å­—æ˜¯ä¾æ¬¡é€’å‡çš„ï¼Œä½†æ˜¯æ²¡æ³•ä¿è¯è¿™ä¸ªå€¼æ˜¯è¿™ä¸ªå †ä¸­çš„æœ€å°å€¼ï¼Œè¿™æ˜¯å› ä¸ºå †ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹çš„ä½ç½®å’Œå¤§å°æ— å…³ï¼Œä¸¤æ¡è¿™æ ·çš„è·¯å¾„ä¹‹å‰çš„å€¼çš„å¤§å°æ²¡æœ‰ä¸€å®šçš„å…³ç³»ã€‚</p>
<h2> æ“ä½œ</h2>
<p>å †å¯ä»¥è¿›è¡Œæ’å…¥ã€ç§»é™¤ï¼Œéå†ç­‰æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>L</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(LogN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">L</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>ã€‚åˆæ¬¡ä¹‹å¤–ï¼Œåˆ©ç”¨å †æ ¹èŠ‚ç‚¹å…³é”®å€¼æœ€å¤§è¿™ä¸ªå±æ€§ï¼Œè¿˜å¯ä»¥è¿›è¡Œå †æ’åº,æ—¶é—´å¤æ‚åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo>âˆ—</mo><mi>L</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N*LogN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>ã€‚</p>
<p>å¯¹äºåœ¨æ•°ç»„ä¸­ä¿å­˜çš„å †ï¼Œè®¾å…ƒç´ ä¸‹æ ‡ä¸º<code>x</code>ï¼Œåˆ™å„ä¸ªç›¸å…³å…ƒç´ ä¸‹æ ‡å¦‚ä¸‹ï¼š</p>
<ul>
<li>çˆ¶èŠ‚ç‚¹<code> (x-1)/2</code></li>
<li>å·¦å­èŠ‚ç‚¹ <code>2*x+1</code></li>
<li>å³å­èŠ‚ç‚¹ <code>2*x+2</code></li>
</ul>
<p>åœ¨æ’å…¥ï¼Œç§»é™¤çš„æ—¶å€™ä¸ºäº†ä¿è¯æ»¡è¶³å †çš„æ¡ä»¶ï¼Œéœ€è¦å¯¹å †è¿›è¡Œå‘ä¸Šæˆ–å‘ä¸‹çš„éå†ï¼Œå°†ä¿®æ”¹çš„å€¼ç§»åŠ¨åˆ°å¯¹åº”çš„ä½ç½®ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°å¤åˆ¶å’Œäº¤æ¢ã€‚å¦‚æœæ¯æ¬¡æ¯”è¾ƒéƒ½éœ€è¦äº¤æ¢æ•°æ®çš„è¯ä¼šå¤åˆ¶å¾ˆå¤šæ¬¡ï¼Œè€Œå¦‚æœå°†æœ€ç»ˆè¦ç§»åŠ¨å€¼ä¿å­˜åœ¨ä¸´æ—¶å˜é‡ä¸­ï¼Œç”¨ä¸€ä¸ªå€¼ä¸“é—¨è®°å½•è¦ç§»åŠ¨åˆ°çš„ä¸‹æ ‡ï¼Œåœ¨æ¯æ¬¡ç¬¦åˆæ¡ä»¶æ—¶åªå¤åˆ¶å‚ä¸å¯¹æ¯”çš„å€¼ï¼Œåœ¨æœ€åå†å°†è¦ä¸´æ—¶ä¿å­˜çš„å€¼å¤åˆ¶åˆ°ç›®çš„ä¸‹æ ‡ï¼Œå°±ä¼šå‡å°‘å¤åˆ¶çš„æ¬¡æ•°ã€‚</p>
<p>å¦‚ä¸‹å›¾å°±å°†å¤åˆ¶æ¬¡æ•°ä» 9 æ¬¡å‡å°‘åˆ°äº† 5 æ¬¡ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20181225213813.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3> æ’å…¥</h3>
<p>æ’å…¥æ“ä½œæ€è·¯æ˜¯ï¼Œå°†å…ƒç´ æ’å…¥åˆ°æ•°ç»„æœ€åä¸€ä½ï¼Œç„¶åä¾æ¬¡å‘å…ƒç´ çˆ¶èŠ‚ç‚¹éå†ï¼Œå°†ä¸æ»¡è¶³çš„å…ƒç´ ä¸‹æ²‰ï¼Œç›´åˆ°æ‰¾åˆ°æ»¡è¶³<code>å †ç‰¹å¾3</code>ï¼ˆçˆ¶èŠ‚ç‚¹å…³é”®å­—å¤§äºè¯¥ç‚¹ï¼Œå¹¶ä¸”å­èŠ‚ç‚¹å…³é”®å­—å°äºè¯¥ç‚¹ï¼‰çš„ä¸‹æ ‡ï¼Œæˆ–è€…æŒ‡å‘äº†æ ¹ç›®å½•ï¼Œå°†è¯¥å…ƒç´ æ’å…¥è¯¥å¤„ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> ç§»é™¤</h3>
<p>ç§»é™¤æŒ‡çš„æ˜¯å°†æ ¹èŠ‚ç‚¹æ¨å‡ºå †ä¸­ã€‚</p>
<p>åŸºæœ¬æ€è·¯æ˜¯å°†æ ¹èŠ‚ç‚¹æ¨å‡ºï¼Œå†å°†æ•°ç»„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ˆåŒæ—¶ä¹Ÿæ˜¯å †çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼‰ç§»åŠ¨åˆ°æ ¹èŠ‚ç‚¹ç©ºå‡ºçš„ä½ç½®ï¼Œå†ä¾æ¬¡å‘ä¸‹éå†ï¼Œç›´åˆ°å°†è¯¥èŠ‚ç‚¹æ”¾åˆ°ç¬¦åˆå †æ¡ä»¶çš„ä½ç½®æˆ–è€…åˆ°è¾¾å¶å­èŠ‚ç‚¹ã€‚</p>
<p>å’Œæ’å…¥ç›¸æ¯”ï¼Œç§»é™¤æ—¶è¦ç§»åŠ¨çš„èŠ‚ç‚¹è¦æ¯”è¾ƒçš„ç¨å¾®å¤šäº›ã€‚</p>
<ul>
<li>è¯¥èŠ‚ç‚¹æ˜¯å¶èŠ‚ç‚¹ ç›´æ¥æ’å…¥ âœ…</li>
<li>æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ å’Œä¸¤ä¸ªå¶å­èŠ‚ç‚¹ä¸­æœ€å¤§çš„æ¯”è¾ƒï¼Œå¦‚æœå°äºåˆ™äº¤æ¢ï¼Œå¹¶å†å’Œæ–°çš„å­èŠ‚ç‚¹æ¯”è¾ƒ</li>
<li>åªæœ‰å·¦èŠ‚ç‚¹ å¦‚æœå·¦èŠ‚ç‚¹å¤§äºæœ¬èŠ‚ç‚¹åˆ™äº¤æ¢ï¼Œå¦åˆ™å°±æ˜¯è¯¥ä½ç½®</li>
</ul>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> å †æ’åº</h3>
<p>åˆ©ç”¨å †<code>æ ¹èŠ‚ç‚¹å…³é”®å€¼æœ€å¤§</code>è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥è¿›è¡Œå †æ’åºã€‚</p>
<p>åªéœ€è¦å°†å¾…æ’åºçš„æ•°ç»„ä¾æ¬¡æ’å…¥å †ä¸­ï¼Œç„¶åå†ä¾æ¬¡ç§»é™¤å³å¯ã€‚</p>
<p>è¿™æ ·éœ€è¦æœ‰ä¸¤å€ä¸å¾…æ’åºæ•°ç»„å¤§å°çš„ç©ºé—´ã€‚å¦‚æœæ¯æ¬¡æ’å…¥æ—¶å€™åªä¿å­˜æ•°æ®ï¼Œä¸è¿›è¡Œå‘ä¸Šéå†ï¼Œåœ¨æ¯æ¬¡ç§»é™¤æ•°æ®æ—¶è¿›è¡Œå‘ä¸‹éå†ï¼Œå°†å½“å‰å‰©ä½™æ•°æ®æœ€å¤§å€¼é€‰å‡ºæ¥ï¼ˆå…¶ä½™æ•°æ®ä»ç„¶æ— åºï¼‰ä»å †ä¸­ç§»é™¤æ ¹å…ƒç´ æ—¶éƒ½ä¼šåœ¨æ•°ç»„æœ«å°¾ç©ºå‡ºä¸€ä¸ªä½ç½®ï¼Œå°†è¯¥å€¼å­˜å‚¨åœ¨è¯¥ä½ç½®å³å¯ï¼Œè¿™æ ·ç­‰å®Œå…¨æ’å…¥ã€ç§»é™¤åå°±å¾—åˆ°ä¸€ä¸ªæœ‰åºæ•°ç»„ã€ä»æ•°ç»„æœ«å°¾å¼€å§‹ä¾æ¬¡å‡å°ã€‘</p>
<p>å †æ’åºå’Œå¿«é€Ÿæ’åºæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ <code>O(N*LogN)</code> ï¼Œä½†æ˜¯ç”±äºå‘ä¸Šã€å‘ä¸‹éå†è€—æ—¶ï¼Œå®é™…ä¸Šè¦æ¯”å¿«é€Ÿæ’åºç¨æ…¢ä¸€äº›ã€‚ä½†æ˜¯å †æ’åºå †æ•°æ®åˆå§‹åˆ†å¸ƒä¸æ•æ„Ÿä¸€ç›´éƒ½æ˜¯ <code>O(N*LogN)</code> ï¼Œå¿«é€Ÿæ’åºåœ¨æŸäº›æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦å¯è¾¾åˆ° <code>O(N^2)</code> ã€‚</p>
<h2> é™„å½•</h2>
<h3> æ»¡äºŒå‰æ ‘</h3>
<p>æ»¡äºŒå‰æ ‘æŒ‡é™¤æœ€åä¸€å±‚æ— ä»»ä½•å­èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸€å±‚ä¸Šçš„æ‰€æœ‰ç»“ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­ç»“ç‚¹äºŒå‰æ ‘ã€‚</p>
<p>å¦‚æœä¸€ä¸ªäºŒå‰æ ‘çš„å±‚æ•°ä¸º Kï¼Œä¸”èŠ‚ç‚¹æ€»æ•°æ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mn>2</mn><mi>k</mi></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">(2^k) -1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> ï¼Œåˆ™å®ƒå°±æ˜¯æ»¡äºŒå‰æ ‘ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20181225210750.png" alt="æ»¡äºŒå‰æ ‘" tabindex="0" loading="lazy"><figcaption>æ»¡äºŒå‰æ ‘</figcaption></figure>
<h3> å®Œå…¨äºŒå‰æ ‘</h3>
<p>å®Œå…¨äºŒå‰æ ‘ å¦‚æœå°†äºŒå‰æ ‘æ¯å±‚ä»å·¦åˆ°å³éå†ï¼Œé‚£ä¹ˆå®Œå…¨äºŒå‰æ ‘åªæœ‰æœ€åä¸€å±‚çš„å³è¾¹ä¼šå‡ºç°æ²¡æœ‰å¶å­èŠ‚ç‚¹çš„æƒ…å†µï¼Œå³åœ¨å‰ 1~n ä¹‹é—´æ²¡æœ‰â€œæ´â€ã€‚</p>
<p>å¦‚ä¸‹å›¾å°±æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20181225211304.png" alt="å®Œå…¨äºŒå‰æ ‘" tabindex="0" loading="lazy"><figcaption>å®Œå…¨äºŒå‰æ ‘</figcaption></figure>
<p>ä½†ä¸‹å›¾ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20181223211217.png" alt="ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘" tabindex="0" loading="lazy"><figcaption>ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘</figcaption></figure>
<h2> æºç </h2>
<p><a href="https://github.com/jixiaoyong/Notes-Files/blob/master/AndroidLearningResource/java_note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/tree/HeadClazz.kt" target="_blank" rel="noopener noreferrer">ğŸ‘‰ ç‚¹è¿™é‡Œ</a> æŸ¥çœ‹æºç </p>
<h2> å‚è€ƒé“¾æ¥</h2>
<p><a href="https://baike.baidu.com/item/%E6%BB%A1%E4%BA%8C%E5%8F%89%E6%A0%91" target="_blank" rel="noopener noreferrer">æ»¡äºŒå‰æ ‘â€”â€”ç™¾åº¦ç™¾ç§‘</a></p>
<p><a href="https://blog.csdn.net/u013812939/article/details/46798743" target="_blank" rel="noopener noreferrer">å®Œå…¨äºŒå‰æ ‘ä¸æ»¡äºŒå‰æ ‘çš„åŒºåˆ«</a></p>
<p>ã€ŠJava æ•°æ®ç»“æ„å’Œç®—æ³• ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ Robert Lafore é™ˆç»´å®</p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20181225213813.png" type="image/png"/>
    </item>
    <item>
      <title>æ•°æ®ç»“æ„_æ€»ç»“</title>
      <link>https://jixiaoyong.github.io/blog/posts/851be5ef.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/851be5ef.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">æ•°æ®ç»“æ„_æ€»ç»“</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Sat, 05 Jan 2019 05:55:50 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>æœ¬æ–‡æ±‡æ€»äº†æ•°æ®ç»“æ„çš„ä¼˜ç¼ºç‚¹åŠåº”ç”¨åœºæ™¯ã€‚</p>
<p>é€šç”¨æ•°æ®ç»“æ„ï¼šæ•°ç»„ã€é“¾è¡¨ã€æ ‘ã€å“ˆå¸Œè¡¨</p>
<p>ä¸“ç”¨æ•°æ®ç»“æ„ï¼šæ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆçº§é˜Ÿåˆ—</p>
<p>æ’åºï¼šå†’æ³¡æ’åºã€é€‰æ‹©æ’åºã€æ’å…¥æ’åºï¼Œå¸Œå°”æ’åºã€å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºã€å †æ’åº</p>
<p>å›¾ï¼šé‚»æ¥çŸ©é˜µã€é‚»æ¥è¡¨</p>
<h2> é€šç”¨æ•°æ®ç»“æ„</h2>
<p>è¿™äº›æ•°æ®ç»“æ„ä½¿ç”¨å…³é”®å­—çš„å€¼å­˜å‚¨ã€æŸ¥æ‰¾æ•°æ®</p>
<p>å…¶é€Ÿåº¦å¦‚ä¸‹ï¼š</p>
<p><code>å“ˆå¸Œè¡¨ &gt; æ ‘ &gt; é“¾è¡¨ &gt; æ•°ç»„</code></p>
<p>æ•°ç»„ï¼šæ•°æ®é‡å°ï¼Œå¤§å°å¯ä»¥é¢„æµ‹æ—¶ä½¿ç”¨</p>
<p>é“¾è¡¨ï¼šæ•°æ®å¤§å°ä¸å¯é¢„çŸ¥ï¼Œæˆ–éœ€è¦é¢‘ç¹æ’å…¥åˆ é™¤å…ƒç´ æ—¶ä½¿ç”¨</p>
<p>äºŒå‰æœç´¢æ ‘ï¼šå¦‚æœæ•°ç»„å’Œé“¾è¡¨éƒ½å¾ˆæ…¢æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘äºŒå‰æ ‘</p>
<p>å¹³è¡¡æ ‘ï¼šäºŒå‰æœç´¢æ ‘å¾ˆå¿«ï¼Œä½†æ˜¯å¦‚æœé‡åˆ°æ•°æ®æ˜¯é€†åºçš„æ—¶å€™ï¼Œå°±ä¼šå¾ˆè€—æ€§èƒ½ï¼Œè€Œå¹³è¡¡æ ‘åˆ™ä¸ä¼š</p>
<p>å“ˆå¸Œè¡¨ï¼šåœ¨æ•°æ®å­˜å‚¨ç»“æ„ä¸­æœ€å¿«ï¼Œä½†æ˜¯éœ€è¦æœ‰é¢å¤–çš„ç©ºé—´</p>
<p>ä¸‹é¢æ˜¯ä»¥ä¸Šæ•°æ®ç»“æ„çš„é€Ÿåº¦ï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20190105140704.png" alt="é€šç”¨æ•°æ®ç»“æ„é€Ÿåº¦ç»Ÿè®¡" tabindex="0" loading="lazy"><figcaption>é€šç”¨æ•°æ®ç»“æ„é€Ÿåº¦ç»Ÿè®¡</figcaption></figure>
<h2> ä¸“ç”¨æ•°æ®ç»“æ„</h2>
<p>åŒ…æ‹¬æ ˆã€é˜Ÿåˆ—ã€ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆå †ï¼‰ï¼Œéƒ½æ˜¯æŠ½è±¡æ•°æ®ç»“æ„ (ADT)ï¼Œç”±æ›´åŠ åŸºç¡€çš„<code>é€šç”¨æ•°æ®ç»“æ„</code>ç»„æˆã€‚</p>
<p>ä¸èƒ½æŸ¥æ‰¾æˆ–è€…éå†ï¼Œåªèƒ½è®¿é—®æŒ‡å®šå…ƒç´ ï¼ˆå¤´éƒ¨ï¼Œé˜Ÿåˆ—ä¹Ÿå¯ä»¥è®¿é—®å°¾éƒ¨ï¼‰ã€‚</p>
<h3> æ ˆ</h3>
<p>å…ˆè¿›åå‡º (FILO)ï¼Œæœ€åæ’å…¥çš„æ•°æ®åœ¨æ ˆé¡¶ï¼Œæ¯æ¬¡åªèƒ½è®¿é—®æ ˆé¡¶å…ƒç´ ã€‚</p>
<h3> é˜Ÿåˆ—</h3>
<p>å…ˆè¿›å…ˆå‡º (FIFO)ï¼Œæœ€åæ’å…¥çš„æ•°æ®åœ¨é˜Ÿå°¾ï¼Œæœ€å…ˆæ’å…¥çš„åœ¨é˜Ÿé¦–ï¼Œæ¯æ¬¡å…ˆå¼¹å‡ºé˜Ÿé¦–çš„å…ƒç´ ã€‚</p>
<h3> ä¼˜å…ˆçº§é˜Ÿåˆ—</h3>
<p>æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œä¸åŒçš„æ˜¯ä¼˜å…ˆçº§é«˜çš„åœ¨é˜Ÿé¦–ï¼Œä¼˜å…ˆçº§ä½çš„åœ¨é˜Ÿå°¾ï¼Œæ¯æ¬¡å¼¹å‡ºä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ï¼ˆè¿™æ„å‘³ç€æ¯æ¬¡æ’å…¥æˆ–å¼¹å‡ºæ—¶è¦è¿›è¡Œæ’åºï¼‰ã€‚</p>
<h3> æ•ˆç‡</h3>
<figure><img src="https://jixiaoyong.github.io/images/20190105141727.png" alt="ä¸“ç”¨æ•°æ®ç»“æ„æ•ˆç‡æ¯”è¾ƒ" tabindex="0" loading="lazy"><figcaption>ä¸“ç”¨æ•°æ®ç»“æ„æ•ˆç‡æ¯”è¾ƒ</figcaption></figure>
<h2> æ’åº</h2>
<p>æ’åºåŒ…æ‹¬å†’æ³¡æ’åºã€é€‰æ‹©æ’åºã€æ’å…¥æ’åºï¼Œå¸Œå°”æ’åºã€å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºã€å †æ’åºã€‚</p>
<p>ä¸€èˆ¬ä½¿ç”¨æ’åºä¼˜å…ˆçº§ï¼š</p>
<p><code>æ’å…¥æ’åº &gt; å¸Œå°”æ’åº &gt; å¿«é€Ÿæ’åº &gt; å½’å¹¶æ’åº &gt; å †æ’åº</code></p>
<p>å½’å¹¶æ’åºï¼šéœ€è¦è¾…åŠ©å­˜å‚¨ç©ºé—´</p>
<p>å †æ’åºï¼šéœ€è¦ä¸€ä¸ªå †çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¿«é€Ÿæ’åºæ›´é€‚äºééšæœºæ•°æ®</p>
<p>å¿«é€Ÿæ’åºï¼šå¤„ç†ééšæœºæ•°æ®æ—¶ä¼šæ…¢åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>N</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mtext>â€‹</mtext></mrow><annotation encoding="application/x-tex">O(N^2)â€‹</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">â€‹</span></span></span></span></p>
<p>ä¸‹é¢æ˜¯æ’åºç®—æ³•æ¯”è¾ƒï¼š</p>
<figure><img src="https://jixiaoyong.github.io/images/20190105142406.png" alt="æ’åºç®—æ³•æ¯”è¾ƒ" tabindex="0" loading="lazy"><figcaption>æ’åºç®—æ³•æ¯”è¾ƒ</figcaption></figure>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20190105140704.png" type="image/png"/>
    </item>
    <item>
      <title>æ•°æ®ç»“æ„_æ•°ç»„ï¼Œé“¾è¡¨</title>
      <link>https://jixiaoyong.github.io/blog/posts/9a784fe0.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/9a784fe0.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">æ•°æ®ç»“æ„_æ•°ç»„ï¼Œé“¾è¡¨</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Tue, 01 Jan 2019 03:19:52 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>æœ¬æ–‡ä»‹ç»äº†æ•°ç»„ã€é“¾è¡¨ç­‰æ•°æ®ç»“æ„ã€‚</p>
<p>è®¾å®šæ‰€æœ‰æ’åºï¼šå° â†’ å¤§ã€‚</p>
<h2> æ•°ç»„</h2>
<p>æ•°ç»„ï¼ˆarrayï¼‰æ˜¯ä¸€ç»„å…·æœ‰ç›¸åŒç±»å‹å…ƒç´ çš„é›†åˆï¼Œç”¨ä¸€æ®µè¿ç»­çš„å†…å­˜æ¥ä¿å­˜ã€‚ä½¿ç”¨ä¸‹æ ‡æ¥è®¿é—®ä¿å­˜çš„å…ƒç´ ï¼Œå¦‚<code>a[0]</code>ã€‚</p>
<p>æ•°ç»„æ˜¯ä¸€ç§æ•°æ®å­˜å‚¨ç»“æ„ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ•°ç»„å¤§å°å›ºå®šï¼Œå¯¹æŒ‡å®šä¸‹æ ‡å…ƒç´ è¯»å†™å¿« O(1)ï¼Œä½†æ˜¯æŸ¥æ‰¾æ…¢ O(N)ï¼Œåˆ é™¤å…ƒç´ æ…¢ O(N)ã€‚</p>
<h3> æœ‰åºæ•°ç»„</h3>
<p>åœ¨æ¯æ¬¡æ’å…¥çš„æ—¶å€™å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼Œå°±å¾—åˆ°æœ‰åºæ•°ç»„ã€‚</p>
<p>æœ‰åºæ•°ç»„æŸ¥æ‰¾å¿« O(LogN)ï¼Œä½†æ’å…¥æ…¢ O(N)ï¼Œåˆ é™¤å…ƒç´ æ…¢ O(N)ã€‚</p>
<p><strong>æœ‰åºæ•°ç»„æ’å…¥</strong>ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æœ‰åºæ•°ç»„è¦æ‰¾åˆ°æŸä¸ªå…ƒç´  t å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œå…¶æ€æƒ³æ˜¯ï¼š</p>
<ol>
<li>é€‰å–ä¸€ä¸ªä¸­é—´å€¼ n å°†å½“å‰æ•°ç»„ä¸€åˆ†ä¸ºäºŒã€‚</li>
<li>å¦‚æœ<code>t==n</code>é‚£ä¹ˆæŸ¥æ‰¾ç»“æŸï¼Œå¦‚æœ<code>t&lt;n</code>,é‚£ä¹ˆåœ¨å³åŠéƒ¨åˆ†æ•°ç»„æŸ¥æ‰¾ï¼Œå¦åˆ™åœ¨å·¦åŠéƒ¨åˆ†æ•°ç»„æŸ¥æ‰¾ã€‚</li>
<li>é‡å¤æ­¥éª¤<code>1</code>,<code>2</code>ï¼Œç›´åˆ°æ‰¾åˆ° n æˆ–è€…æ•°ç»„å·²ç»ä¸å¯å†åˆ†ï¼ˆä¸å­˜åœ¨ nï¼‰ï¼Œç»“æŸæŸ¥æ‰¾ã€‚</li>
</ol>
<p><strong>äºŒåˆ†æ³•æŸ¥æ‰¾</strong>ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> é“¾è¡¨</h2>
<p>é“¾è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹é™¤äº†ä¿å­˜çš„æ•°æ®å¤–ï¼Œè¿˜ä¿å­˜ç€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨<code>next</code>ï¼Œæœ€åä¸€ä¸ªå…ƒç´ ä¸­è¯¥å¼•ç”¨ä¸º<code>null</code>ã€‚</p>
<p>é“¾è¡¨çš„å¤§å°ä¸å›ºå®šï¼ŒæŸ¥æ‰¾ï¼Œåˆ é™¤ï¼Œæ’å…¥æŒ‡å®šèŠ‚ç‚¹éƒ½éœ€è¦ O(N)</p>
<p>é“¾è¡¨æœ‰ä»¥ä¸‹åˆ†ç±»ï¼š</p>
<ul>
<li>
<p>å•é“¾è¡¨ æ¯ä¸ªèŠ‚ç‚¹åªæœ‰æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œé“¾è¡¨åªä¿ç•™ç¬¬ä¸€ä¸ªé“¾èŠ‚ç‚¹çš„å¼•ç”¨<code>first</code></p>
<figure><img src="https://jixiaoyong.github.io/images/20190101132535.png" alt="å•é“¾è¡¨" tabindex="0" loading="lazy"><figcaption>å•é“¾è¡¨</figcaption></figure>
</li>
<li>
<p>åŒå‘é“¾è¡¨ æ¯ä¸ªèŠ‚ç‚¹ä¿å­˜æœ‰çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„å¼•ç”¨ã€‚åŒå‘é“¾è¡¨ä¹Ÿå¯ä»¥æ˜¯åŒç«¯é“¾è¡¨ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20190101132614.png" alt="åŒå‘é“¾è¡¨" tabindex="0" loading="lazy"><figcaption>åŒå‘é“¾è¡¨</figcaption></figure>
</li>
</ul>
<p><strong>åŒç«¯é“¾è¡¨</strong> åŒç«¯é“¾è¡¨ä¿å­˜ç¬¬ä¸€ä¸ªé“¾èŠ‚ç‚¹<code>farst</code>å’Œæœ€åä¸€ä¸ªé“¾èŠ‚ç‚¹<code>last</code>çš„å¼•ç”¨ã€‚</p>
<figure><img src="https://jixiaoyong.github.io/images/20190101132649.png" alt="åŒç«¯é“¾è¡¨" tabindex="0" loading="lazy"><figcaption>åŒç«¯é“¾è¡¨</figcaption></figure>
<h2> æºç </h2>
<p><a href="https://github.com/jixiaoyong/Notes-Files/tree/master/AndroidLearningResource/java_note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/link" target="_blank" rel="noopener noreferrer">ğŸ‘‰ ç‚¹è¿™é‡Œ</a> æŸ¥çœ‹<code>é“¾è¡¨</code>æºç </p>
<h2> å‚è€ƒæ–‡çŒ®</h2>
<p><a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E7%BB%84" target="_blank" rel="noopener noreferrer">æ•°ç»„--ç»´åŸºç™¾ç§‘</a></p>
<p><a href="https://book.douban.com/subject/1144007/" target="_blank" rel="noopener noreferrer">Java æ•°æ®ç»“æ„å’Œç®—æ³•ï¼ˆç¬¬äºŒç‰ˆï¼‰Robert Laforce è®¡æ™“äº‘ç­‰è¯‘</a></p>
]]></content:encoded>
      <enclosure url="https://jixiaoyong.github.io/images/20190101132535.png" type="image/png"/>
    </item>
    <item>
      <title>æ•°æ®ç»“æ„_æ ˆå’Œé˜Ÿåˆ—</title>
      <link>https://jixiaoyong.github.io/blog/posts/8d059318.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/8d059318.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">æ•°æ®ç»“æ„_æ ˆå’Œé˜Ÿåˆ—</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Wed, 02 Jan 2019 11:54:53 GMT</pubDate>
      <content:encoded><![CDATA[<h2> å‰è¨€</h2>
<p>æœ¬æ–‡ä»‹ç»æ ˆã€é˜Ÿåˆ—ä¸¤ç§æŠ½è±¡æ•°æ®ç±»å‹ã€‚</p>
<h2> æ ˆ</h2>
<p>æ ˆ<code>stack</code>ï¼Œåˆç§°å †æ ˆï¼Œæ˜¯ä¸€ç§æŠ½è±¡æ•°æ®ç±»å‹ï¼Œæ¯æ¬¡åªèƒ½è®¿é—®æ ˆé¡¶å…ƒç´ <code>top</code>ï¼Œå¯ä»¥è¿›è¡Œå‹å…¥<code>push</code>å’Œæ¨å‡º<code>pop</code>æ“ä½œã€‚å…¶å…ƒç´ <strong>å…ˆè¿›åå‡º (FILO)</strong>ã€‚</p>
<h2> é˜Ÿåˆ—</h2>
<p>é˜Ÿåˆ—<code>queue</code>,æ˜¯å’Œæ ˆç›¸å¯¹çš„ä¸€ç§æŠ½è±¡æ•°æ®ç±»å‹ï¼Œæ¯æ¬¡ä»åç«¯<code>rear</code>æ’å…¥ï¼Œä»å‰ç«¯<code>front</code>åˆ é™¤ã€‚å…¶å…ƒç´ <strong>å…ˆè¿›å…ˆå‡º (FIFO)</strong>ã€‚</p>
<p>ç”¨é“¾è¡¨å®ç°çš„é˜Ÿåˆ—å¯ä»¥è‡ªç”±æ‰©å……ï¼Œä¸å­˜åœ¨ä¼ªæº¢å‡ºé—®é¢˜ï¼Œä½†æ˜¯æ’å…¥å’Œè¯»å–æ¯”è¾ƒè€—æ—¶ï¼›</p>
<p>ç”¨æ•°ç»„å®ç°çš„é˜Ÿåˆ—å¤§å°å›ºå®šï¼Œå¯ä»¥ä½¿ç”¨<strong>å¾ªç¯é˜Ÿåˆ—</strong>è§£å†³ä¼ªæº¢å‡ºé—®é¢˜ï¼Œå³å½“å°¾ç«¯ï¼ˆå‰ç«¯ä¹Ÿç±»ä¼¼ï¼‰æŒ‡é’ˆæŒ‡å‘è¶…å‡ºæ•°ç»„å¤§å°æ—¶ï¼Œå¯ä»¥æŒ‡å‘æ•°ç»„å¼€å§‹ä½ç½®ï¼Œå› ä¸ºæ­¤æ—¶å¤§å°ä¸è¶…è¿‡æ•°ç»„çš„é˜Ÿåˆ—å‰ç«¯å·²ç»æŒ‡å‘ 0 ä¹‹åçš„ä½ç½®äº†ï¼Œæ‰€ä»¥ä¸ä¼šå†²çªã€‚</p>
<h3> ä¼˜å…ˆçº§é˜Ÿåˆ—</h3>
<p>å’Œé˜Ÿåˆ—å®šä¹‰ä¸€è‡´ï¼Œåªæ˜¯åœ¨æ¯æ¬¡æ’å…¥çš„æ—¶å€™éƒ½è¿›è¡Œæ’åºï¼Œä»¥æ»¡è¶³æ’åºè§„åˆ™ï¼ˆå¦‚<code>å°¾ç«¯â†’å‰ç«¯</code> <code>å°â†’å¤§</code>ï¼‰ã€‚</p>
<h2> ä¸­ç¼€è¡¨è¾¾å¼ä¸åç¼€è¡¨è¾¾å¼</h2>
<p>ä¸­ç¼€è¡¨è¾¾å¼ï¼ŒæŒ‡è¿ç®—ç¬¦åœ¨æ“ä½œæ•°ä¸­é—´çš„ï¼Œå¦‚<code>1 + 2</code>ã€‚</p>
<p>åç¼€è¡¨è¾¾å¼ï¼ŒæŒ‡è¿ç®—ç¬¦åœ¨æ“ä½œæ•°åé¢çš„ï¼Œå¦‚<code>1 2 +</code>ã€‚</p>
<p>ä¸­ç¼€è¡¨è¾¾å¼ â†” åç¼€è¡¨è¾¾å¼ï¼š</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è½¬æ¢è§„åˆ™ï¼š</p>
<p>è®¾ä¸€ä¸ªæ ˆç”¨äºä¿å­˜è¿ç®—ç¬¦ï¼Œä»å·¦åˆ°å³ä¾æ¬¡éå†ä¸­ç¼€è¡¨è¾¾å¼ï¼Œå‡è®¾è¯»å–åˆ°çš„æ˜¯<code>x</code></p>
<ol>
<li>
<p>å¦‚æœæ˜¯æ“ä½œæ•°ï¼Œåˆ™ç›´æ¥æ‰“å°</p>
</li>
<li>
<p>å¦‚æœæ˜¯è¿ç®—ç¬¦<code>(</code>ï¼Œåˆ™å‹å…¥æ ˆä¸­</p>
</li>
<li>
<p>å¦‚æœæ˜¯è¿ç®—ç¬¦<code>)</code>ï¼Œåˆ™æ¨å‡ºæ ˆä¸­çš„å…ƒç´ ï¼Œç›´åˆ°é‡åˆ°<code>(</code>,æ¨å‡º<code>(</code>ï¼Œç»§ç»­è¯»å–ä¸‹ä¸€ä¸ª</p>
</li>
<li>
<p>å¦åˆ™ï¼Œè¯»å–æ ˆé¡¶å…ƒç´ <code>top</code>ï¼Œå¦‚æœæ˜¯<code>(</code>ï¼Œå°†<code>x</code>å‹å…¥æ ˆä¸­ï¼›</p>
<p>å¦‚æœ<code>x</code>ä¼˜å…ˆäº<code>top</code>ï¼Œå°†<code>x</code>å‹å…¥æ ˆä¸­ï¼›</p>
<p>å¦åˆ™ï¼Œå°†<code>top</code>æ¨å‡ºï¼Œåœ¨æ­¤å’Œæ–°çš„<code>top</code>æ¯”è¾ƒï¼Œç›´åˆ°é‡åˆ°<code>top</code>æ˜¯<code>(</code>æˆ–è€…ä¼˜å…ˆçº§æ¯”<code>x</code>é«˜ï¼Œæˆ–è€…æ ˆå·²ç»ç©ºäº†ï¼Œå°†<code>x</code>æ’å…¥æ ˆä¸­ã€‚</p>
</li>
</ol>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æºç </h2>
<p>ğŸ‘‰<a href="https://github.com/jixiaoyong/Notes-Files/blob/master/AndroidLearningResource/java_note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/InfixAndPostfix/CovertInfixToPostfix.java" target="_blank" rel="noopener noreferrer">ç‚¹è¿™é‡Œ</a>æŸ¥çœ‹<code>ä¸­ç¼€è¡¨è¾¾å¼ â†’ åç¼€è¡¨è¾¾å¼</code>æºç </p>
<h2> å‚è€ƒèµ„æ–™</h2>
<p><a href="https://zh.wikipedia.org/wiki/%E5%A0%86%E6%A0%88" target="_blank" rel="noopener noreferrer">å †æ ˆâ€”â€”ç»´åŸºç™¾ç§‘</a></p>
<p><a href="https://zh.wikipedia.org/wiki/%E9%98%9F%E5%88%97" target="_blank" rel="noopener noreferrer">é˜Ÿåˆ—â€”â€”ç»´åŸºç™¾ç§‘</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>æ•°æ®ç»“æ„_ç®€å•æ’åº</title>
      <link>https://jixiaoyong.github.io/blog/posts/125c8a12.html</link>
      <guid>https://jixiaoyong.github.io/blog/posts/125c8a12.html</guid>
      <source url="https://jixiaoyong.github.io/blog/rss.xml">æ•°æ®ç»“æ„_ç®€å•æ’åº</source>
      <description>Let&amp;apos;s make something different!</description>
      <pubDate>Mon, 31 Dec 2018 06:45:45 GMT</pubDate>
      <content:encoded><![CDATA[<h2> ç®€å•æ’åº</h2>
<p>æ‰€æœ‰æ’åºé¡ºåºä¸º <code>å° â†’ å¤§</code>ã€‚</p>
<p>æ—¶é—´è´Ÿè´£åº¦éƒ½æ˜¯ O(N<sup>2</sup>)ã€‚</p>
<p>æ’åºé€Ÿåº¦ï¼š<code>æ’å…¥æ’åº&gt;é€‰æ‹©æ’åº&gt;å†’æ³¡æ’åº</code></p>
<h3> å†’æ³¡æ’åº</h3>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(N<sup>2</sup>)</p>
<p>æœ€æ…¢çš„æ’åºï¼Œä½†æ˜¯ç®€å•</p>
<p>è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä»å·¦åˆ°å³ï¼Œæ¯”è¾ƒ a å’Œ bï¼Œå¦‚æœ<code>a&gt;b</code>ï¼Œå°±äº¤æ¢ a å’Œ b çš„ä½ç½®</li>
<li>å†å°† aï¼Œb ä¸­è¾ƒå¤§çš„é‚£ä¸ªä¸ c æŒ‰ç…§ 2 çš„è§„åˆ™æ¯”è¾ƒï¼Œç›´åˆ°æœ€åä¸€ä½</li>
<li>é‡å¤ 1ï¼Œ2 ç›´åˆ°æ²¡æœ‰å¾…æ’åºçš„é¡¹ç›®</li>
</ol>
<p>å…¶æ€æƒ³æ˜¯ï¼šæ¯æ¬¡é€‰å‡ºå½“å‰æœªæ’åºçš„å…ƒç´ ä¸­æœ€å¤§çš„å…ƒç´ å¹¶æ”¾åˆ°é˜Ÿå°¾ï¼ˆæ¯æ¬¡æ¯”è¾ƒæœ€å¤§å…ƒç´ éƒ½ä¼šâ€œå†’æ³¡â€åˆ°é˜Ÿå°¾ï¼‰ï¼Œè¿™æ ·å½“è¿ç»­éå† n æ¬¡åï¼Œæ¯ä¸ªå…ƒç´ éƒ½ä¼šæ’å¥½åºã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> é€‰æ‹©æ’åº</h3>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(N<sup>2</sup>)</p>
<p>å› ä¸ºäº¤æ¢æ¬¡æ•°å°‘ï¼Œæ‰€ä»¥æ¯”å†’æ³¡å¿«</p>
<p>è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ol>
<li>å‡è®¾ç¬¬ä¸€é¡¹å€¼æœ€å¤§ï¼Œè®¾å…¶åæ ‡ä¸º<code>max</code>ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ¯”è¾ƒ<code>max</code>å’Œå…¶ä»–å…ƒç´ ï¼Œå¦‚æœé‡åˆ°æ¯”<code>max</code>å¤§çš„ï¼Œå°† max åæ ‡æŒ‡å‘è¯¥å€¼</li>
<li>æ¯è½®ç»“æŸå<code>max</code>å°±è¡¨ç¤ºè¿™è½®æ¯”è¾ƒæœ€å¤§çš„å€¼åæ ‡ï¼Œå°†å…¶ä¸å½“å‰æœªæ’åºçš„æœ€åä¸€é¡¹äº¤æ¢</li>
<li>è¿™æ ·é‡å¤æ­¥éª¤ 1ï¼Œ2ï¼Œ <code>næ¬¡</code>å°±å¯ä»¥æ’åºå®Œæˆ</li>
</ol>
<p>å…¶æ€æƒ³æ˜¯ï¼šæ¯æ¬¡æ¯”è¾ƒå½“å‰æœ€å¤§çš„å€¼ï¼Œè®°å½•ä¸‹å…¶åæ ‡ï¼Œç­‰å½“å‰æ¯”è¾ƒå®Œæˆå°±å’Œ<code>æœªæ¯”è¾ƒçš„æœ€åä¸€ä½</code>äº¤æ¢ï¼Œï¼ˆè¿™æ ·å­é¿å…æ¯æ¬¡æ¯”è¾ƒéƒ½è¦äº¤æ¢ï¼‰ã€‚åŒæ ·è¿™æ ·å­æ¯”è¾ƒ n æ¬¡å°±å¯ä»¥å®Œæˆæ’åºã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3> æ’å…¥æ’åº</h3>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(N<sup>2</sup>)</p>
<p>æ¯”å†’æ³¡å¿«ä¸€å€ï¼Œæ¯”é€‰æ‹©æ’åºå¿«ä¸€äº›</p>
<p>æ€æƒ³ï¼šå‡è®¾ä¸€ä¸ªæ ‡è®°å…ƒç´ çš„å·¦è¾¹å…¨éƒ¨æ˜¯æœ‰åºæ•°ç»„ï¼Œå³è¾¹å…¨æ˜¯æ— åºæ•°ç»„ï¼Œé‚£ä¹ˆåªéœ€è¦å°†å³è¾¹çš„å…ƒç´ ä¾æ¬¡æ‹¿å‡ºæ¥æ’å…¥åˆ°å·¦è¾¹çš„æœ‰åºæ•°ç»„ä¸­å³å¯ã€‚åˆšå¼€å§‹è¿™ä¸ªæ ‡è®°å…ƒç´ å¯ä»¥ä¸º 0 æˆ–è€… 1ï¼ˆå‡è®¾ä¸€ä¸ªå…ƒç´ å°±æ˜¯æœ‰åºçš„ï¼‰ã€‚</p>
<div class="language-kotlin line-numbers-mode" data-ext="kt"><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2> æºç </h2>
<p><a href="https://github.com/jixiaoyong/Notes-Files/blob/master/AndroidLearningResource/java_note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/sort/BasicSort.kt" target="_blank" rel="noopener noreferrer">ğŸ‘‰ ç‚¹è¿™é‡Œ</a>æŸ¥çœ‹æºç </p>
]]></content:encoded>
    </item>
  </channel>
</rss>